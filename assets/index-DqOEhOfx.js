function d8(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();function vw(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function x3(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function s(){var r=!1;try{r=this instanceof s}catch{}return r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),t}var $C={exports:{}},xm={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uO;function f8(){if(uO)return xm;uO=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,r,i){var o=null;if(i!==void 0&&(o=""+i),r.key!==void 0&&(o=""+r.key),"key"in r){i={};for(var a in r)a!=="key"&&(i[a]=r[a])}else i=r;return r=i.ref,{$$typeof:n,type:s,key:o,ref:r!==void 0?r:null,props:i}}return xm.Fragment=e,xm.jsx=t,xm.jsxs=t,xm}var hO;function p8(){return hO||(hO=1,$C.exports=f8()),$C.exports}var E=p8(),DC={exports:{}},ct={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dO;function m8(){if(dO)return ct;dO=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;function m(z){return z===null||typeof z!="object"?null:(z=f&&z[f]||z["@@iterator"],typeof z=="function"?z:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b=Object.assign,w={};function v(z,X,ie){this.props=z,this.context=X,this.refs=w,this.updater=ie||y}v.prototype.isReactComponent={},v.prototype.setState=function(z,X){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,X,"setState")},v.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function S(){}S.prototype=v.prototype;function T(z,X,ie){this.props=z,this.context=X,this.refs=w,this.updater=ie||y}var I=T.prototype=new S;I.constructor=T,b(I,v.prototype),I.isPureReactComponent=!0;var k=Array.isArray,O={H:null,A:null,T:null,S:null,V:null},V=Object.prototype.hasOwnProperty;function P(z,X,ie,se,ve,we){return ie=we.ref,{$$typeof:n,type:z,key:X,ref:ie!==void 0?ie:null,props:we}}function D(z,X){return P(z.type,X,void 0,void 0,void 0,z.props)}function $(z){return typeof z=="object"&&z!==null&&z.$$typeof===n}function R(z){var X={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(ie){return X[ie]})}var A=/\/+/g;function U(z,X){return typeof z=="object"&&z!==null&&z.key!=null?R(""+z.key):X.toString(36)}function F(){}function ne(z){switch(z.status){case"fulfilled":return z.value;case"rejected":throw z.reason;default:switch(typeof z.status=="string"?z.then(F,F):(z.status="pending",z.then(function(X){z.status==="pending"&&(z.status="fulfilled",z.value=X)},function(X){z.status==="pending"&&(z.status="rejected",z.reason=X)})),z.status){case"fulfilled":return z.value;case"rejected":throw z.reason}}throw z}function Q(z,X,ie,se,ve){var we=typeof z;(we==="undefined"||we==="boolean")&&(z=null);var Se=!1;if(z===null)Se=!0;else switch(we){case"bigint":case"string":case"number":Se=!0;break;case"object":switch(z.$$typeof){case n:case e:Se=!0;break;case d:return Se=z._init,Q(Se(z._payload),X,ie,se,ve)}}if(Se)return ve=ve(z),Se=se===""?"."+U(z,0):se,k(ve)?(ie="",Se!=null&&(ie=Se.replace(A,"$&/")+"/"),Q(ve,X,ie,"",function(Ue){return Ue})):ve!=null&&($(ve)&&(ve=D(ve,ie+(ve.key==null||z&&z.key===ve.key?"":(""+ve.key).replace(A,"$&/")+"/")+Se)),X.push(ve)),1;Se=0;var Oe=se===""?".":se+":";if(k(z))for(var De=0;De<z.length;De++)se=z[De],we=Oe+U(se,De),Se+=Q(se,X,ie,we,ve);else if(De=m(z),typeof De=="function")for(z=De.call(z),De=0;!(se=z.next()).done;)se=se.value,we=Oe+U(se,De++),Se+=Q(se,X,ie,we,ve);else if(we==="object"){if(typeof z.then=="function")return Q(ne(z),X,ie,se,ve);throw X=String(z),Error("Objects are not valid as a React child (found: "+(X==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":X)+"). If you meant to render a collection of children, use an array instead.")}return Se}function G(z,X,ie){if(z==null)return z;var se=[],ve=0;return Q(z,se,"","",function(we){return X.call(ie,we,ve++)}),se}function K(z){if(z._status===-1){var X=z._result;X=X(),X.then(function(ie){(z._status===0||z._status===-1)&&(z._status=1,z._result=ie)},function(ie){(z._status===0||z._status===-1)&&(z._status=2,z._result=ie)}),z._status===-1&&(z._status=0,z._result=X)}if(z._status===1)return z._result.default;throw z._result}var J=typeof reportError=="function"?reportError:function(z){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var X=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof z=="object"&&z!==null&&typeof z.message=="string"?String(z.message):String(z),error:z});if(!window.dispatchEvent(X))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",z);return}console.error(z)};function ce(){}return ct.Children={map:G,forEach:function(z,X,ie){G(z,function(){X.apply(this,arguments)},ie)},count:function(z){var X=0;return G(z,function(){X++}),X},toArray:function(z){return G(z,function(X){return X})||[]},only:function(z){if(!$(z))throw Error("React.Children.only expected to receive a single React element child.");return z}},ct.Component=v,ct.Fragment=t,ct.Profiler=r,ct.PureComponent=T,ct.StrictMode=s,ct.Suspense=l,ct.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,ct.__COMPILER_RUNTIME={__proto__:null,c:function(z){return O.H.useMemoCache(z)}},ct.cache=function(z){return function(){return z.apply(null,arguments)}},ct.cloneElement=function(z,X,ie){if(z==null)throw Error("The argument must be a React element, but you passed "+z+".");var se=b({},z.props),ve=z.key,we=void 0;if(X!=null)for(Se in X.ref!==void 0&&(we=void 0),X.key!==void 0&&(ve=""+X.key),X)!V.call(X,Se)||Se==="key"||Se==="__self"||Se==="__source"||Se==="ref"&&X.ref===void 0||(se[Se]=X[Se]);var Se=arguments.length-2;if(Se===1)se.children=ie;else if(1<Se){for(var Oe=Array(Se),De=0;De<Se;De++)Oe[De]=arguments[De+2];se.children=Oe}return P(z.type,ve,void 0,void 0,we,se)},ct.createContext=function(z){return z={$$typeof:o,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null},z.Provider=z,z.Consumer={$$typeof:i,_context:z},z},ct.createElement=function(z,X,ie){var se,ve={},we=null;if(X!=null)for(se in X.key!==void 0&&(we=""+X.key),X)V.call(X,se)&&se!=="key"&&se!=="__self"&&se!=="__source"&&(ve[se]=X[se]);var Se=arguments.length-2;if(Se===1)ve.children=ie;else if(1<Se){for(var Oe=Array(Se),De=0;De<Se;De++)Oe[De]=arguments[De+2];ve.children=Oe}if(z&&z.defaultProps)for(se in Se=z.defaultProps,Se)ve[se]===void 0&&(ve[se]=Se[se]);return P(z,we,void 0,void 0,null,ve)},ct.createRef=function(){return{current:null}},ct.forwardRef=function(z){return{$$typeof:a,render:z}},ct.isValidElement=$,ct.lazy=function(z){return{$$typeof:d,_payload:{_status:-1,_result:z},_init:K}},ct.memo=function(z,X){return{$$typeof:u,type:z,compare:X===void 0?null:X}},ct.startTransition=function(z){var X=O.T,ie={};O.T=ie;try{var se=z(),ve=O.S;ve!==null&&ve(ie,se),typeof se=="object"&&se!==null&&typeof se.then=="function"&&se.then(ce,J)}catch(we){J(we)}finally{O.T=X}},ct.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},ct.use=function(z){return O.H.use(z)},ct.useActionState=function(z,X,ie){return O.H.useActionState(z,X,ie)},ct.useCallback=function(z,X){return O.H.useCallback(z,X)},ct.useContext=function(z){return O.H.useContext(z)},ct.useDebugValue=function(){},ct.useDeferredValue=function(z,X){return O.H.useDeferredValue(z,X)},ct.useEffect=function(z,X,ie){var se=O.H;if(typeof ie=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return se.useEffect(z,X)},ct.useId=function(){return O.H.useId()},ct.useImperativeHandle=function(z,X,ie){return O.H.useImperativeHandle(z,X,ie)},ct.useInsertionEffect=function(z,X){return O.H.useInsertionEffect(z,X)},ct.useLayoutEffect=function(z,X){return O.H.useLayoutEffect(z,X)},ct.useMemo=function(z,X){return O.H.useMemo(z,X)},ct.useOptimistic=function(z,X){return O.H.useOptimistic(z,X)},ct.useReducer=function(z,X,ie){return O.H.useReducer(z,X,ie)},ct.useRef=function(z){return O.H.useRef(z)},ct.useState=function(z){return O.H.useState(z)},ct.useSyncExternalStore=function(z,X,ie){return O.H.useSyncExternalStore(z,X,ie)},ct.useTransition=function(){return O.H.useTransition()},ct.version="19.1.0",ct}var fO;function ww(){return fO||(fO=1,DC.exports=m8()),DC.exports}var te=ww();const zu=vw(te);var OC={exports:{}},vm={},PC={exports:{}},MC={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pO;function g8(){return pO||(pO=1,function(n){function e(G,K){var J=G.length;G.push(K);e:for(;0<J;){var ce=J-1>>>1,z=G[ce];if(0<r(z,K))G[ce]=K,G[J]=z,J=ce;else break e}}function t(G){return G.length===0?null:G[0]}function s(G){if(G.length===0)return null;var K=G[0],J=G.pop();if(J!==K){G[0]=J;e:for(var ce=0,z=G.length,X=z>>>1;ce<X;){var ie=2*(ce+1)-1,se=G[ie],ve=ie+1,we=G[ve];if(0>r(se,J))ve<z&&0>r(we,se)?(G[ce]=we,G[ve]=J,ce=ve):(G[ce]=se,G[ie]=J,ce=ie);else if(ve<z&&0>r(we,J))G[ce]=we,G[ve]=J,ce=ve;else break e}}return K}function r(G,K){var J=G.sortIndex-K.sortIndex;return J!==0?J:G.id-K.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],d=1,f=null,m=3,y=!1,b=!1,w=!1,v=!1,S=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function k(G){for(var K=t(u);K!==null;){if(K.callback===null)s(u);else if(K.startTime<=G)s(u),K.sortIndex=K.expirationTime,e(l,K);else break;K=t(u)}}function O(G){if(w=!1,k(G),!b)if(t(l)!==null)b=!0,V||(V=!0,U());else{var K=t(u);K!==null&&Q(O,K.startTime-G)}}var V=!1,P=-1,D=5,$=-1;function R(){return v?!0:!(n.unstable_now()-$<D)}function A(){if(v=!1,V){var G=n.unstable_now();$=G;var K=!0;try{e:{b=!1,w&&(w=!1,T(P),P=-1),y=!0;var J=m;try{t:{for(k(G),f=t(l);f!==null&&!(f.expirationTime>G&&R());){var ce=f.callback;if(typeof ce=="function"){f.callback=null,m=f.priorityLevel;var z=ce(f.expirationTime<=G);if(G=n.unstable_now(),typeof z=="function"){f.callback=z,k(G),K=!0;break t}f===t(l)&&s(l),k(G)}else s(l);f=t(l)}if(f!==null)K=!0;else{var X=t(u);X!==null&&Q(O,X.startTime-G),K=!1}}break e}finally{f=null,m=J,y=!1}K=void 0}}finally{K?U():V=!1}}}var U;if(typeof I=="function")U=function(){I(A)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,ne=F.port2;F.port1.onmessage=A,U=function(){ne.postMessage(null)}}else U=function(){S(A,0)};function Q(G,K){P=S(function(){G(n.unstable_now())},K)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(G){G.callback=null},n.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<G?Math.floor(1e3/G):5},n.unstable_getCurrentPriorityLevel=function(){return m},n.unstable_next=function(G){switch(m){case 1:case 2:case 3:var K=3;break;default:K=m}var J=m;m=K;try{return G()}finally{m=J}},n.unstable_requestPaint=function(){v=!0},n.unstable_runWithPriority=function(G,K){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var J=m;m=G;try{return K()}finally{m=J}},n.unstable_scheduleCallback=function(G,K,J){var ce=n.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?ce+J:ce):J=ce,G){case 1:var z=-1;break;case 2:z=250;break;case 5:z=1073741823;break;case 4:z=1e4;break;default:z=5e3}return z=J+z,G={id:d++,callback:K,priorityLevel:G,startTime:J,expirationTime:z,sortIndex:-1},J>ce?(G.sortIndex=J,e(u,G),t(l)===null&&G===t(u)&&(w?(T(P),P=-1):w=!0,Q(O,J-ce))):(G.sortIndex=z,e(l,G),b||y||(b=!0,V||(V=!0,U()))),G},n.unstable_shouldYield=R,n.unstable_wrapCallback=function(G){var K=m;return function(){var J=m;m=K;try{return G.apply(this,arguments)}finally{m=J}}}}(MC)),MC}var mO;function y8(){return mO||(mO=1,PC.exports=g8()),PC.exports}var LC={exports:{}},or={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gO;function b8(){if(gO)return or;gO=1;var n=ww();function e(l){var u="https://react.dev/errors/"+l;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)u+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+l+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function i(l,u,d){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:f==null?null:""+f,children:l,containerInfo:u,implementation:d}}var o=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(l,u){if(l==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return or.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,or.createPortal=function(l,u){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(e(299));return i(l,u,null,d)},or.flushSync=function(l){var u=o.T,d=s.p;try{if(o.T=null,s.p=2,l)return l()}finally{o.T=u,s.p=d,s.d.f()}},or.preconnect=function(l,u){typeof l=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,s.d.C(l,u))},or.prefetchDNS=function(l){typeof l=="string"&&s.d.D(l)},or.preinit=function(l,u){if(typeof l=="string"&&u&&typeof u.as=="string"){var d=u.as,f=a(d,u.crossOrigin),m=typeof u.integrity=="string"?u.integrity:void 0,y=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;d==="style"?s.d.S(l,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:f,integrity:m,fetchPriority:y}):d==="script"&&s.d.X(l,{crossOrigin:f,integrity:m,fetchPriority:y,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},or.preinitModule=function(l,u){if(typeof l=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var d=a(u.as,u.crossOrigin);s.d.M(l,{crossOrigin:d,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&s.d.M(l)},or.preload=function(l,u){if(typeof l=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var d=u.as,f=a(d,u.crossOrigin);s.d.L(l,d,{crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},or.preloadModule=function(l,u){if(typeof l=="string")if(u){var d=a(u.as,u.crossOrigin);s.d.m(l,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:d,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else s.d.m(l)},or.requestFormReset=function(l){s.d.r(l)},or.unstable_batchedUpdates=function(l,u){return l(u)},or.useFormState=function(l,u,d){return o.H.useFormState(l,u,d)},or.useFormStatus=function(){return o.H.useHostTransitionStatus()},or.version="19.1.0",or}var yO;function x8(){if(yO)return LC.exports;yO=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),LC.exports=b8(),LC.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bO;function v8(){if(bO)return vm;bO=1;var n=y8(),e=ww(),t=x8();function s(c){var h="https://react.dev/errors/"+c;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)h+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+c+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function i(c){var h=c,p=c;if(c.alternate)for(;h.return;)h=h.return;else{c=h;do h=c,(h.flags&4098)!==0&&(p=h.return),c=h.return;while(c)}return h.tag===3?p:null}function o(c){if(c.tag===13){var h=c.memoizedState;if(h===null&&(c=c.alternate,c!==null&&(h=c.memoizedState)),h!==null)return h.dehydrated}return null}function a(c){if(i(c)!==c)throw Error(s(188))}function l(c){var h=c.alternate;if(!h){if(h=i(c),h===null)throw Error(s(188));return h!==c?null:c}for(var p=c,g=h;;){var _=p.return;if(_===null)break;var C=_.alternate;if(C===null){if(g=_.return,g!==null){p=g;continue}break}if(_.child===C.child){for(C=_.child;C;){if(C===p)return a(_),c;if(C===g)return a(_),h;C=C.sibling}throw Error(s(188))}if(p.return!==g.return)p=_,g=C;else{for(var L=!1,B=_.child;B;){if(B===p){L=!0,p=_,g=C;break}if(B===g){L=!0,g=_,p=C;break}B=B.sibling}if(!L){for(B=C.child;B;){if(B===p){L=!0,p=C,g=_;break}if(B===g){L=!0,g=C,p=_;break}B=B.sibling}if(!L)throw Error(s(189))}}if(p.alternate!==g)throw Error(s(190))}if(p.tag!==3)throw Error(s(188));return p.stateNode.current===p?c:h}function u(c){var h=c.tag;if(h===5||h===26||h===27||h===6)return c;for(c=c.child;c!==null;){if(h=u(c),h!==null)return h;c=c.sibling}return null}var d=Object.assign,f=Symbol.for("react.element"),m=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),b=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),v=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),T=Symbol.for("react.consumer"),I=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),V=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),D=Symbol.for("react.lazy"),$=Symbol.for("react.activity"),R=Symbol.for("react.memo_cache_sentinel"),A=Symbol.iterator;function U(c){return c===null||typeof c!="object"?null:(c=A&&c[A]||c["@@iterator"],typeof c=="function"?c:null)}var F=Symbol.for("react.client.reference");function ne(c){if(c==null)return null;if(typeof c=="function")return c.$$typeof===F?null:c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case b:return"Fragment";case v:return"Profiler";case w:return"StrictMode";case O:return"Suspense";case V:return"SuspenseList";case $:return"Activity"}if(typeof c=="object")switch(c.$$typeof){case y:return"Portal";case I:return(c.displayName||"Context")+".Provider";case T:return(c._context.displayName||"Context")+".Consumer";case k:var h=c.render;return c=c.displayName,c||(c=h.displayName||h.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case P:return h=c.displayName||null,h!==null?h:ne(c.type)||"Memo";case D:h=c._payload,c=c._init;try{return ne(c(h))}catch{}}return null}var Q=Array.isArray,G=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,J={pending:!1,data:null,method:null,action:null},ce=[],z=-1;function X(c){return{current:c}}function ie(c){0>z||(c.current=ce[z],ce[z]=null,z--)}function se(c,h){z++,ce[z]=c.current,c.current=h}var ve=X(null),we=X(null),Se=X(null),Oe=X(null);function De(c,h){switch(se(Se,h),se(we,c),se(ve,null),h.nodeType){case 9:case 11:c=(c=h.documentElement)&&(c=c.namespaceURI)?FD(c):0;break;default:if(c=h.tagName,h=h.namespaceURI)h=FD(h),c=VD(h,c);else switch(c){case"svg":c=1;break;case"math":c=2;break;default:c=0}}ie(ve),se(ve,c)}function Ue(){ie(ve),ie(we),ie(Se)}function Ke(c){c.memoizedState!==null&&se(Oe,c);var h=ve.current,p=VD(h,c.type);h!==p&&(se(we,c),se(ve,p))}function Xe(c){we.current===c&&(ie(ve),ie(we)),Oe.current===c&&(ie(Oe),pm._currentValue=J)}var mt=Object.prototype.hasOwnProperty,kt=n.unstable_scheduleCallback,jt=n.unstable_cancelCallback,Ft=n.unstable_shouldYield,$t=n.unstable_requestPaint,xt=n.unstable_now,Jt=n.unstable_getCurrentPriorityLevel,br=n.unstable_ImmediatePriority,wn=n.unstable_UserBlockingPriority,rr=n.unstable_NormalPriority,Us=n.unstable_LowPriority,Ar=n.unstable_IdlePriority,Bs=n.log,Rr=n.unstable_setDisableYieldValue,Wt=null,gt=null;function $n(c){if(typeof Bs=="function"&&Rr(c),gt&&typeof gt.setStrictMode=="function")try{gt.setStrictMode(Wt,c)}catch{}}var Dn=Math.clz32?Math.clz32:ia,cl=Math.log,Gc=Math.LN2;function ia(c){return c>>>=0,c===0?32:31-(cl(c)/Gc|0)|0}var ui=256,oa=4194304;function Kr(c){var h=c&42;if(h!==0)return h;switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return c&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return c}}function Fh(c,h,p){var g=c.pendingLanes;if(g===0)return 0;var _=0,C=c.suspendedLanes,L=c.pingedLanes;c=c.warmLanes;var B=g&134217727;return B!==0?(g=B&~C,g!==0?_=Kr(g):(L&=B,L!==0?_=Kr(L):p||(p=B&~c,p!==0&&(_=Kr(p))))):(B=g&~C,B!==0?_=Kr(B):L!==0?_=Kr(L):p||(p=g&~c,p!==0&&(_=Kr(p)))),_===0?0:h!==0&&h!==_&&(h&C)===0&&(C=_&-_,p=h&-h,C>=p||C===32&&(p&4194048)!==0)?h:_}function Hc(c,h){return(c.pendingLanes&~(c.suspendedLanes&~c.pingedLanes)&h)===0}function pp(c,h){switch(c){case 1:case 2:case 4:case 8:case 64:return h+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mp(){var c=ui;return ui<<=1,(ui&4194048)===0&&(ui=256),c}function gp(){var c=oa;return oa<<=1,(oa&62914560)===0&&(oa=4194304),c}function aa(c){for(var h=[],p=0;31>p;p++)h.push(c);return h}function la(c,h){c.pendingLanes|=h,h!==268435456&&(c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0)}function yp(c,h,p,g,_,C){var L=c.pendingLanes;c.pendingLanes=p,c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0,c.expiredLanes&=p,c.entangledLanes&=p,c.errorRecoveryDisabledLanes&=p,c.shellSuspendCounter=0;var B=c.entanglements,q=c.expirationTimes,fe=c.hiddenUpdates;for(p=L&~p;0<p;){var _e=31-Dn(p),Ee=1<<_e;B[_e]=0,q[_e]=-1;var me=fe[_e];if(me!==null)for(fe[_e]=null,_e=0;_e<me.length;_e++){var ge=me[_e];ge!==null&&(ge.lane&=-536870913)}p&=~Ee}g!==0&&ho(c,g,0),C!==0&&_===0&&c.tag!==0&&(c.suspendedLanes|=C&~(L&~h))}function ho(c,h,p){c.pendingLanes|=h,c.suspendedLanes&=~h;var g=31-Dn(h);c.entangledLanes|=h,c.entanglements[g]=c.entanglements[g]|1073741824|p&4194090}function bp(c,h){var p=c.entangledLanes|=h;for(c=c.entanglements;p;){var g=31-Dn(p),_=1<<g;_&h|c[g]&h&&(c[g]|=h),p&=~_}}function ul(c){switch(c){case 2:c=1;break;case 8:c=4;break;case 32:c=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:c=128;break;case 268435456:c=134217728;break;default:c=0}return c}function Vh(c){return c&=-c,2<c?8<c?(c&134217727)!==0?32:268435456:8:2}function hl(){var c=K.p;return c!==0?c:(c=window.event,c===void 0?32:rO(c.type))}function M0(c,h){var p=K.p;try{return K.p=c,h()}finally{K.p=p}}var Tn=Math.random().toString(36).slice(2),ds="__reactFiber$"+Tn,Yn="__reactProps$"+Tn,hi="__reactContainer$"+Tn,xp="__reactEvents$"+Tn,P1="__reactListeners$"+Tn,dl="__reactHandles$"+Tn,L0="__reactResources$"+Tn,qc="__reactMarker$"+Tn;function fl(c){delete c[ds],delete c[Yn],delete c[xp],delete c[P1],delete c[dl]}function ca(c){var h=c[ds];if(h)return h;for(var p=c.parentNode;p;){if(h=p[hi]||p[ds]){if(p=h.alternate,h.child!==null||p!==null&&p.child!==null)for(c=jD(c);c!==null;){if(p=c[ds])return p;c=jD(c)}return h}c=p,p=c.parentNode}return null}function fo(c){if(c=c[ds]||c[hi]){var h=c.tag;if(h===5||h===6||h===13||h===26||h===27||h===3)return c}return null}function po(c){var h=c.tag;if(h===5||h===26||h===27||h===6)return c.stateNode;throw Error(s(33))}function xr(c){var h=c[L0];return h||(h=c[L0]={hoistableStyles:new Map,hoistableScripts:new Map}),h}function Wn(c){c[qc]=!0}var vp=new Set,Uh={};function Vi(c,h){ua(c,h),ua(c+"Capture",h)}function ua(c,h){for(Uh[c]=h,c=0;c<h.length;c++)vp.add(h[c])}var F0=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),V0={},Kc={};function U0(c){return mt.call(Kc,c)?!0:mt.call(V0,c)?!1:F0.test(c)?Kc[c]=!0:(V0[c]=!0,!1)}function pl(c,h,p){if(U0(h))if(p===null)c.removeAttribute(h);else{switch(typeof p){case"undefined":case"function":case"symbol":c.removeAttribute(h);return;case"boolean":var g=h.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){c.removeAttribute(h);return}}c.setAttribute(h,""+p)}}function mo(c,h,p){if(p===null)c.removeAttribute(h);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(h);return}c.setAttribute(h,""+p)}}function zs(c,h,p,g){if(g===null)c.removeAttribute(p);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(p);return}c.setAttributeNS(h,p,""+g)}}var Xc,B0;function ha(c){if(Xc===void 0)try{throw Error()}catch(p){var h=p.stack.trim().match(/\n( *(at )?)/);Xc=h&&h[1]||"",B0=-1<p.stack.indexOf(`
    at`)?" (<anonymous>)":-1<p.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Xc+c+B0}var Bh=!1;function zh(c,h){if(!c||Bh)return"";Bh=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(h){var Ee=function(){throw Error()};if(Object.defineProperty(Ee.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ee,[])}catch(ge){var me=ge}Reflect.construct(c,[],Ee)}else{try{Ee.call()}catch(ge){me=ge}c.call(Ee.prototype)}}else{try{throw Error()}catch(ge){me=ge}(Ee=c())&&typeof Ee.catch=="function"&&Ee.catch(function(){})}}catch(ge){if(ge&&me&&typeof ge.stack=="string")return[ge.stack,me.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var _=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");_&&_.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var C=g.DetermineComponentFrameRoot(),L=C[0],B=C[1];if(L&&B){var q=L.split(`
`),fe=B.split(`
`);for(_=g=0;g<q.length&&!q[g].includes("DetermineComponentFrameRoot");)g++;for(;_<fe.length&&!fe[_].includes("DetermineComponentFrameRoot");)_++;if(g===q.length||_===fe.length)for(g=q.length-1,_=fe.length-1;1<=g&&0<=_&&q[g]!==fe[_];)_--;for(;1<=g&&0<=_;g--,_--)if(q[g]!==fe[_]){if(g!==1||_!==1)do if(g--,_--,0>_||q[g]!==fe[_]){var _e=`
`+q[g].replace(" at new "," at ");return c.displayName&&_e.includes("<anonymous>")&&(_e=_e.replace("<anonymous>",c.displayName)),_e}while(1<=g&&0<=_);break}}}finally{Bh=!1,Error.prepareStackTrace=p}return(p=c?c.displayName||c.name:"")?ha(p):""}function wp(c){switch(c.tag){case 26:case 27:case 5:return ha(c.type);case 16:return ha("Lazy");case 13:return ha("Suspense");case 19:return ha("SuspenseList");case 0:case 15:return zh(c.type,!1);case 11:return zh(c.type.render,!1);case 1:return zh(c.type,!0);case 31:return ha("Activity");default:return""}}function jh(c){try{var h="";do h+=wp(c),c=c.return;while(c);return h}catch(p){return`
Error generating stack: `+p.message+`
`+p.stack}}function vr(c){switch(typeof c){case"bigint":case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function _p(c){var h=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function M1(c){var h=_p(c)?"checked":"value",p=Object.getOwnPropertyDescriptor(c.constructor.prototype,h),g=""+c[h];if(!c.hasOwnProperty(h)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var _=p.get,C=p.set;return Object.defineProperty(c,h,{configurable:!0,get:function(){return _.call(this)},set:function(L){g=""+L,C.call(this,L)}}),Object.defineProperty(c,h,{enumerable:p.enumerable}),{getValue:function(){return g},setValue:function(L){g=""+L},stopTracking:function(){c._valueTracker=null,delete c[h]}}}}function Wh(c){c._valueTracker||(c._valueTracker=M1(c))}function Sp(c){if(!c)return!1;var h=c._valueTracker;if(!h)return!0;var p=h.getValue(),g="";return c&&(g=_p(c)?c.checked?"true":"false":c.value),c=g,c!==p?(h.setValue(c),!0):!1}function Yc(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}var L1=/[\n"\\]/g;function Qn(c){return c.replace(L1,function(h){return"\\"+h.charCodeAt(0).toString(16)+" "})}function Xr(c,h,p,g,_,C,L,B){c.name="",L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"?c.type=L:c.removeAttribute("type"),h!=null?L==="number"?(h===0&&c.value===""||c.value!=h)&&(c.value=""+vr(h)):c.value!==""+vr(h)&&(c.value=""+vr(h)):L!=="submit"&&L!=="reset"||c.removeAttribute("value"),h!=null?ml(c,L,vr(h)):p!=null?ml(c,L,vr(p)):g!=null&&c.removeAttribute("value"),_==null&&C!=null&&(c.defaultChecked=!!C),_!=null&&(c.checked=_&&typeof _!="function"&&typeof _!="symbol"),B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?c.name=""+vr(B):c.removeAttribute("name")}function Qc(c,h,p,g,_,C,L,B){if(C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(c.type=C),h!=null||p!=null){if(!(C!=="submit"&&C!=="reset"||h!=null))return;p=p!=null?""+vr(p):"",h=h!=null?""+vr(h):p,B||h===c.value||(c.value=h),c.defaultValue=h}g=g??_,g=typeof g!="function"&&typeof g!="symbol"&&!!g,c.checked=B?c.checked:!!g,c.defaultChecked=!!g,L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"&&(c.name=L)}function ml(c,h,p){h==="number"&&Yc(c.ownerDocument)===c||c.defaultValue===""+p||(c.defaultValue=""+p)}function da(c,h,p,g){if(c=c.options,h){h={};for(var _=0;_<p.length;_++)h["$"+p[_]]=!0;for(p=0;p<c.length;p++)_=h.hasOwnProperty("$"+c[p].value),c[p].selected!==_&&(c[p].selected=_),_&&g&&(c[p].defaultSelected=!0)}else{for(p=""+vr(p),h=null,_=0;_<c.length;_++){if(c[_].value===p){c[_].selected=!0,g&&(c[_].defaultSelected=!0);return}h!==null||c[_].disabled||(h=c[_])}h!==null&&(h.selected=!0)}}function rn(c,h,p){if(h!=null&&(h=""+vr(h),h!==c.value&&(c.value=h),p==null)){c.defaultValue!==h&&(c.defaultValue=h);return}c.defaultValue=p!=null?""+vr(p):""}function Jc(c,h,p,g){if(h==null){if(g!=null){if(p!=null)throw Error(s(92));if(Q(g)){if(1<g.length)throw Error(s(93));g=g[0]}p=g}p==null&&(p=""),h=p}p=vr(h),c.defaultValue=p,g=c.textContent,g===p&&g!==""&&g!==null&&(c.value=g)}function di(c,h){if(h){var p=c.firstChild;if(p&&p===c.lastChild&&p.nodeType===3){p.nodeValue=h;return}}c.textContent=h}var Zc=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function z0(c,h,p){var g=h.indexOf("--")===0;p==null||typeof p=="boolean"||p===""?g?c.setProperty(h,""):h==="float"?c.cssFloat="":c[h]="":g?c.setProperty(h,p):typeof p!="number"||p===0||Zc.has(h)?h==="float"?c.cssFloat=p:c[h]=(""+p).trim():c[h]=p+"px"}function Cp(c,h,p){if(h!=null&&typeof h!="object")throw Error(s(62));if(c=c.style,p!=null){for(var g in p)!p.hasOwnProperty(g)||h!=null&&h.hasOwnProperty(g)||(g.indexOf("--")===0?c.setProperty(g,""):g==="float"?c.cssFloat="":c[g]="");for(var _ in h)g=h[_],h.hasOwnProperty(_)&&p[_]!==g&&z0(c,_,g)}else for(var C in h)h.hasOwnProperty(C)&&z0(c,C,h[C])}function Tp(c){if(c.indexOf("-")===-1)return!1;switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var F1=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),V1=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Gh(c){return V1.test(""+c)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":c}var fa=null;function fi(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var pa=null,ma=null;function Ep(c){var h=fo(c);if(h&&(c=h.stateNode)){var p=c[Yn]||null;e:switch(c=h.stateNode,h.type){case"input":if(Xr(c,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name),h=p.name,p.type==="radio"&&h!=null){for(p=c;p.parentNode;)p=p.parentNode;for(p=p.querySelectorAll('input[name="'+Qn(""+h)+'"][type="radio"]'),h=0;h<p.length;h++){var g=p[h];if(g!==c&&g.form===c.form){var _=g[Yn]||null;if(!_)throw Error(s(90));Xr(g,_.value,_.defaultValue,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name)}}for(h=0;h<p.length;h++)g=p[h],g.form===c.form&&Sp(g)}break e;case"textarea":rn(c,p.value,p.defaultValue);break e;case"select":h=p.value,h!=null&&da(c,!!p.multiple,h,!1)}}}var go=!1;function j0(c,h,p){if(go)return c(h,p);go=!0;try{var g=c(h);return g}finally{if(go=!1,(pa!==null||ma!==null)&&(Mb(),pa&&(h=pa,c=ma,ma=pa=null,Ep(h),c)))for(h=0;h<c.length;h++)Ep(c[h])}}function eu(c,h){var p=c.stateNode;if(p===null)return null;var g=p[Yn]||null;if(g===null)return null;p=g[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(c=c.type,g=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!g;break e;default:c=!1}if(c)return null;if(p&&typeof p!="function")throw Error(s(231,h,typeof p));return p}var Ui=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),pi=!1;if(Ui)try{var tu={};Object.defineProperty(tu,"passive",{get:function(){pi=!0}}),window.addEventListener("test",tu,tu),window.removeEventListener("test",tu,tu)}catch{pi=!1}var yo=null,gl=null,ga=null;function Ip(){if(ga)return ga;var c,h=gl,p=h.length,g,_="value"in yo?yo.value:yo.textContent,C=_.length;for(c=0;c<p&&h[c]===_[c];c++);var L=p-c;for(g=1;g<=L&&h[p-g]===_[C-g];g++);return ga=_.slice(c,1<g?1-g:void 0)}function bo(c){var h=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&h===13&&(c=13)):c=h,c===10&&(c=13),32<=c||c===13?c:0}function xo(){return!0}function kp(){return!1}function Cs(c){function h(p,g,_,C,L){this._reactName=p,this._targetInst=_,this.type=g,this.nativeEvent=C,this.target=L,this.currentTarget=null;for(var B in c)c.hasOwnProperty(B)&&(p=c[B],this[B]=p?p(C):C[B]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?xo:kp,this.isPropagationStopped=kp,this}return d(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var p=this.nativeEvent;p&&(p.preventDefault?p.preventDefault():typeof p.returnValue!="unknown"&&(p.returnValue=!1),this.isDefaultPrevented=xo)},stopPropagation:function(){var p=this.nativeEvent;p&&(p.stopPropagation?p.stopPropagation():typeof p.cancelBubble!="unknown"&&(p.cancelBubble=!0),this.isPropagationStopped=xo)},persist:function(){},isPersistent:xo}),h}var Kt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hh=Cs(Kt),nu=d({},Kt,{view:0,detail:0}),W0=Cs(nu),qh,Kh,vo,su=d({},nu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ou,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==vo&&(vo&&c.type==="mousemove"?(qh=c.screenX-vo.screenX,Kh=c.screenY-vo.screenY):Kh=qh=0,vo=c),qh)},movementY:function(c){return"movementY"in c?c.movementY:Kh}}),mi=Cs(su),G0=d({},su,{dataTransfer:0}),U1=Cs(G0),ru=d({},nu,{relatedTarget:0}),Xh=Cs(ru),Np=d({},Kt,{animationName:0,elapsedTime:0,pseudoElement:0}),Yh=Cs(Np),H0=d({},Kt,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),Qh=Cs(H0),B1=d({},Kt,{data:0}),Ap=Cs(B1),iu={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},q0={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},K0={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Rp(c){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(c):(c=K0[c])?!!h[c]:!1}function ou(){return Rp}var X0=d({},nu,{key:function(c){if(c.key){var h=iu[c.key]||c.key;if(h!=="Unidentified")return h}return c.type==="keypress"?(c=bo(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?q0[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ou,charCode:function(c){return c.type==="keypress"?bo(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?bo(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),Jh=Cs(X0),Y0=d({},su,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$p=Cs(Y0),ya=d({},nu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ou}),Q0=Cs(ya),J0=d({},Kt,{propertyName:0,elapsedTime:0,pseudoElement:0}),Z0=Cs(J0),eb=d({},su,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),Zh=Cs(eb),wr=d({},Kt,{newState:0,oldState:0}),tb=Cs(wr),nb=[9,13,27,32],wo=Ui&&"CompositionEvent"in window,x=null;Ui&&"documentMode"in document&&(x=document.documentMode);var N=Ui&&"TextEvent"in window&&!x,M=Ui&&(!wo||x&&8<x&&11>=x),W=" ",ue=!1;function be(c,h){switch(c){case"keyup":return nb.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Re(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var Dt=!1;function fs(c,h){switch(c){case"compositionend":return Re(h);case"keypress":return h.which!==32?null:(ue=!0,W);case"textInput":return c=h.data,c===W&&ue?null:c;default:return null}}function Ot(c,h){if(Dt)return c==="compositionend"||!wo&&be(c,h)?(c=Ip(),ga=gl=yo=null,Dt=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return M&&h.locale!=="ko"?null:h.data;default:return null}}var Ts={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ps(c){var h=c&&c.nodeName&&c.nodeName.toLowerCase();return h==="input"?!!Ts[c.type]:h==="textarea"}function ba(c,h,p,g){pa?ma?ma.push(g):ma=[g]:pa=g,h=zb(h,"onChange"),0<h.length&&(p=new Hh("onChange","change",null,p,g),c.push({event:p,listeners:h}))}var js=null,_o=null;function Dp(c){DD(c,0)}function sb(c){var h=po(c);if(Sp(h))return c}function eR(c,h){if(c==="change")return h}var tR=!1;if(Ui){var z1;if(Ui){var j1="oninput"in document;if(!j1){var nR=document.createElement("div");nR.setAttribute("oninput","return;"),j1=typeof nR.oninput=="function"}z1=j1}else z1=!1;tR=z1&&(!document.documentMode||9<document.documentMode)}function sR(){js&&(js.detachEvent("onpropertychange",rR),_o=js=null)}function rR(c){if(c.propertyName==="value"&&sb(_o)){var h=[];ba(h,_o,c,fi(c)),j0(Dp,h)}}function zH(c,h,p){c==="focusin"?(sR(),js=h,_o=p,js.attachEvent("onpropertychange",rR)):c==="focusout"&&sR()}function jH(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return sb(_o)}function WH(c,h){if(c==="click")return sb(h)}function GH(c,h){if(c==="input"||c==="change")return sb(h)}function HH(c,h){return c===h&&(c!==0||1/c===1/h)||c!==c&&h!==h}var Yr=typeof Object.is=="function"?Object.is:HH;function Op(c,h){if(Yr(c,h))return!0;if(typeof c!="object"||c===null||typeof h!="object"||h===null)return!1;var p=Object.keys(c),g=Object.keys(h);if(p.length!==g.length)return!1;for(g=0;g<p.length;g++){var _=p[g];if(!mt.call(h,_)||!Yr(c[_],h[_]))return!1}return!0}function iR(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function oR(c,h){var p=iR(c);c=0;for(var g;p;){if(p.nodeType===3){if(g=c+p.textContent.length,c<=h&&g>=h)return{node:p,offset:h-c};c=g}e:{for(;p;){if(p.nextSibling){p=p.nextSibling;break e}p=p.parentNode}p=void 0}p=iR(p)}}function aR(c,h){return c&&h?c===h?!0:c&&c.nodeType===3?!1:h&&h.nodeType===3?aR(c,h.parentNode):"contains"in c?c.contains(h):c.compareDocumentPosition?!!(c.compareDocumentPosition(h)&16):!1:!1}function lR(c){c=c!=null&&c.ownerDocument!=null&&c.ownerDocument.defaultView!=null?c.ownerDocument.defaultView:window;for(var h=Yc(c.document);h instanceof c.HTMLIFrameElement;){try{var p=typeof h.contentWindow.location.href=="string"}catch{p=!1}if(p)c=h.contentWindow;else break;h=Yc(c.document)}return h}function W1(c){var h=c&&c.nodeName&&c.nodeName.toLowerCase();return h&&(h==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||h==="textarea"||c.contentEditable==="true")}var qH=Ui&&"documentMode"in document&&11>=document.documentMode,ed=null,G1=null,Pp=null,H1=!1;function cR(c,h,p){var g=p.window===p?p.document:p.nodeType===9?p:p.ownerDocument;H1||ed==null||ed!==Yc(g)||(g=ed,"selectionStart"in g&&W1(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),Pp&&Op(Pp,g)||(Pp=g,g=zb(G1,"onSelect"),0<g.length&&(h=new Hh("onSelect","select",null,h,p),c.push({event:h,listeners:g}),h.target=ed)))}function au(c,h){var p={};return p[c.toLowerCase()]=h.toLowerCase(),p["Webkit"+c]="webkit"+h,p["Moz"+c]="moz"+h,p}var td={animationend:au("Animation","AnimationEnd"),animationiteration:au("Animation","AnimationIteration"),animationstart:au("Animation","AnimationStart"),transitionrun:au("Transition","TransitionRun"),transitionstart:au("Transition","TransitionStart"),transitioncancel:au("Transition","TransitionCancel"),transitionend:au("Transition","TransitionEnd")},q1={},uR={};Ui&&(uR=document.createElement("div").style,"AnimationEvent"in window||(delete td.animationend.animation,delete td.animationiteration.animation,delete td.animationstart.animation),"TransitionEvent"in window||delete td.transitionend.transition);function lu(c){if(q1[c])return q1[c];if(!td[c])return c;var h=td[c],p;for(p in h)if(h.hasOwnProperty(p)&&p in uR)return q1[c]=h[p];return c}var hR=lu("animationend"),dR=lu("animationiteration"),fR=lu("animationstart"),KH=lu("transitionrun"),XH=lu("transitionstart"),YH=lu("transitioncancel"),pR=lu("transitionend"),mR=new Map,K1="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");K1.push("scrollEnd");function Bi(c,h){mR.set(c,h),Vi(h,[c])}var gR=new WeakMap;function gi(c,h){if(typeof c=="object"&&c!==null){var p=gR.get(c);return p!==void 0?p:(h={value:c,source:h,stack:jh(h)},gR.set(c,h),h)}return{value:c,source:h,stack:jh(h)}}var yi=[],nd=0,X1=0;function rb(){for(var c=nd,h=X1=nd=0;h<c;){var p=yi[h];yi[h++]=null;var g=yi[h];yi[h++]=null;var _=yi[h];yi[h++]=null;var C=yi[h];if(yi[h++]=null,g!==null&&_!==null){var L=g.pending;L===null?_.next=_:(_.next=L.next,L.next=_),g.pending=_}C!==0&&yR(p,_,C)}}function ib(c,h,p,g){yi[nd++]=c,yi[nd++]=h,yi[nd++]=p,yi[nd++]=g,X1|=g,c.lanes|=g,c=c.alternate,c!==null&&(c.lanes|=g)}function Y1(c,h,p,g){return ib(c,h,p,g),ob(c)}function sd(c,h){return ib(c,null,null,h),ob(c)}function yR(c,h,p){c.lanes|=p;var g=c.alternate;g!==null&&(g.lanes|=p);for(var _=!1,C=c.return;C!==null;)C.childLanes|=p,g=C.alternate,g!==null&&(g.childLanes|=p),C.tag===22&&(c=C.stateNode,c===null||c._visibility&1||(_=!0)),c=C,C=C.return;return c.tag===3?(C=c.stateNode,_&&h!==null&&(_=31-Dn(p),c=C.hiddenUpdates,g=c[_],g===null?c[_]=[h]:g.push(h),h.lane=p|536870912),C):null}function ob(c){if(50<om)throw om=0,nC=null,Error(s(185));for(var h=c.return;h!==null;)c=h,h=c.return;return c.tag===3?c.stateNode:null}var rd={};function QH(c,h,p,g){this.tag=c,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Qr(c,h,p,g){return new QH(c,h,p,g)}function Q1(c){return c=c.prototype,!(!c||!c.isReactComponent)}function xa(c,h){var p=c.alternate;return p===null?(p=Qr(c.tag,h,c.key,c.mode),p.elementType=c.elementType,p.type=c.type,p.stateNode=c.stateNode,p.alternate=c,c.alternate=p):(p.pendingProps=h,p.type=c.type,p.flags=0,p.subtreeFlags=0,p.deletions=null),p.flags=c.flags&65011712,p.childLanes=c.childLanes,p.lanes=c.lanes,p.child=c.child,p.memoizedProps=c.memoizedProps,p.memoizedState=c.memoizedState,p.updateQueue=c.updateQueue,h=c.dependencies,p.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},p.sibling=c.sibling,p.index=c.index,p.ref=c.ref,p.refCleanup=c.refCleanup,p}function bR(c,h){c.flags&=65011714;var p=c.alternate;return p===null?(c.childLanes=0,c.lanes=h,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=p.childLanes,c.lanes=p.lanes,c.child=p.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=p.memoizedProps,c.memoizedState=p.memoizedState,c.updateQueue=p.updateQueue,c.type=p.type,h=p.dependencies,c.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),c}function ab(c,h,p,g,_,C){var L=0;if(g=c,typeof c=="function")Q1(c)&&(L=1);else if(typeof c=="string")L=Zq(c,p,ve.current)?26:c==="html"||c==="head"||c==="body"?27:5;else e:switch(c){case $:return c=Qr(31,p,h,_),c.elementType=$,c.lanes=C,c;case b:return cu(p.children,_,C,h);case w:L=8,_|=24;break;case v:return c=Qr(12,p,h,_|2),c.elementType=v,c.lanes=C,c;case O:return c=Qr(13,p,h,_),c.elementType=O,c.lanes=C,c;case V:return c=Qr(19,p,h,_),c.elementType=V,c.lanes=C,c;default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case S:case I:L=10;break e;case T:L=9;break e;case k:L=11;break e;case P:L=14;break e;case D:L=16,g=null;break e}L=29,p=Error(s(130,c===null?"null":typeof c,"")),g=null}return h=Qr(L,p,h,_),h.elementType=c,h.type=g,h.lanes=C,h}function cu(c,h,p,g){return c=Qr(7,c,g,h),c.lanes=p,c}function J1(c,h,p){return c=Qr(6,c,null,h),c.lanes=p,c}function Z1(c,h,p){return h=Qr(4,c.children!==null?c.children:[],c.key,h),h.lanes=p,h.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},h}var id=[],od=0,lb=null,cb=0,bi=[],xi=0,uu=null,va=1,wa="";function hu(c,h){id[od++]=cb,id[od++]=lb,lb=c,cb=h}function xR(c,h,p){bi[xi++]=va,bi[xi++]=wa,bi[xi++]=uu,uu=c;var g=va;c=wa;var _=32-Dn(g)-1;g&=~(1<<_),p+=1;var C=32-Dn(h)+_;if(30<C){var L=_-_%5;C=(g&(1<<L)-1).toString(32),g>>=L,_-=L,va=1<<32-Dn(h)+_|p<<_|g,wa=C+c}else va=1<<C|p<<_|g,wa=c}function eS(c){c.return!==null&&(hu(c,1),xR(c,1,0))}function tS(c){for(;c===lb;)lb=id[--od],id[od]=null,cb=id[--od],id[od]=null;for(;c===uu;)uu=bi[--xi],bi[xi]=null,wa=bi[--xi],bi[xi]=null,va=bi[--xi],bi[xi]=null}var _r=null,On=null,Gt=!1,du=null,So=!1,nS=Error(s(519));function fu(c){var h=Error(s(418,""));throw Fp(gi(h,c)),nS}function vR(c){var h=c.stateNode,p=c.type,g=c.memoizedProps;switch(h[ds]=c,h[Yn]=g,p){case"dialog":wt("cancel",h),wt("close",h);break;case"iframe":case"object":case"embed":wt("load",h);break;case"video":case"audio":for(p=0;p<lm.length;p++)wt(lm[p],h);break;case"source":wt("error",h);break;case"img":case"image":case"link":wt("error",h),wt("load",h);break;case"details":wt("toggle",h);break;case"input":wt("invalid",h),Qc(h,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0),Wh(h);break;case"select":wt("invalid",h);break;case"textarea":wt("invalid",h),Jc(h,g.value,g.defaultValue,g.children),Wh(h)}p=g.children,typeof p!="string"&&typeof p!="number"&&typeof p!="bigint"||h.textContent===""+p||g.suppressHydrationWarning===!0||LD(h.textContent,p)?(g.popover!=null&&(wt("beforetoggle",h),wt("toggle",h)),g.onScroll!=null&&wt("scroll",h),g.onScrollEnd!=null&&wt("scrollend",h),g.onClick!=null&&(h.onclick=jb),h=!0):h=!1,h||fu(c)}function wR(c){for(_r=c.return;_r;)switch(_r.tag){case 5:case 13:So=!1;return;case 27:case 3:So=!0;return;default:_r=_r.return}}function Mp(c){if(c!==_r)return!1;if(!Gt)return wR(c),Gt=!0,!1;var h=c.tag,p;if((p=h!==3&&h!==27)&&((p=h===5)&&(p=c.type,p=!(p!=="form"&&p!=="button")||bC(c.type,c.memoizedProps)),p=!p),p&&On&&fu(c),wR(c),h===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(s(317));e:{for(c=c.nextSibling,h=0;c;){if(c.nodeType===8)if(p=c.data,p==="/$"){if(h===0){On=ji(c.nextSibling);break e}h--}else p!=="$"&&p!=="$!"&&p!=="$?"||h++;c=c.nextSibling}On=null}}else h===27?(h=On,$l(c.type)?(c=_C,_C=null,On=c):On=h):On=_r?ji(c.stateNode.nextSibling):null;return!0}function Lp(){On=_r=null,Gt=!1}function _R(){var c=du;return c!==null&&(Or===null?Or=c:Or.push.apply(Or,c),du=null),c}function Fp(c){du===null?du=[c]:du.push(c)}var sS=X(null),pu=null,_a=null;function yl(c,h,p){se(sS,h._currentValue),h._currentValue=p}function Sa(c){c._currentValue=sS.current,ie(sS)}function rS(c,h,p){for(;c!==null;){var g=c.alternate;if((c.childLanes&h)!==h?(c.childLanes|=h,g!==null&&(g.childLanes|=h)):g!==null&&(g.childLanes&h)!==h&&(g.childLanes|=h),c===p)break;c=c.return}}function iS(c,h,p,g){var _=c.child;for(_!==null&&(_.return=c);_!==null;){var C=_.dependencies;if(C!==null){var L=_.child;C=C.firstContext;e:for(;C!==null;){var B=C;C=_;for(var q=0;q<h.length;q++)if(B.context===h[q]){C.lanes|=p,B=C.alternate,B!==null&&(B.lanes|=p),rS(C.return,p,c),g||(L=null);break e}C=B.next}}else if(_.tag===18){if(L=_.return,L===null)throw Error(s(341));L.lanes|=p,C=L.alternate,C!==null&&(C.lanes|=p),rS(L,p,c),L=null}else L=_.child;if(L!==null)L.return=_;else for(L=_;L!==null;){if(L===c){L=null;break}if(_=L.sibling,_!==null){_.return=L.return,L=_;break}L=L.return}_=L}}function Vp(c,h,p,g){c=null;for(var _=h,C=!1;_!==null;){if(!C){if((_.flags&524288)!==0)C=!0;else if((_.flags&262144)!==0)break}if(_.tag===10){var L=_.alternate;if(L===null)throw Error(s(387));if(L=L.memoizedProps,L!==null){var B=_.type;Yr(_.pendingProps.value,L.value)||(c!==null?c.push(B):c=[B])}}else if(_===Oe.current){if(L=_.alternate,L===null)throw Error(s(387));L.memoizedState.memoizedState!==_.memoizedState.memoizedState&&(c!==null?c.push(pm):c=[pm])}_=_.return}c!==null&&iS(h,c,p,g),h.flags|=262144}function ub(c){for(c=c.firstContext;c!==null;){if(!Yr(c.context._currentValue,c.memoizedValue))return!0;c=c.next}return!1}function mu(c){pu=c,_a=null,c=c.dependencies,c!==null&&(c.firstContext=null)}function ir(c){return SR(pu,c)}function hb(c,h){return pu===null&&mu(c),SR(c,h)}function SR(c,h){var p=h._currentValue;if(h={context:h,memoizedValue:p,next:null},_a===null){if(c===null)throw Error(s(308));_a=h,c.dependencies={lanes:0,firstContext:h},c.flags|=524288}else _a=_a.next=h;return p}var JH=typeof AbortController<"u"?AbortController:function(){var c=[],h=this.signal={aborted:!1,addEventListener:function(p,g){c.push(g)}};this.abort=function(){h.aborted=!0,c.forEach(function(p){return p()})}},ZH=n.unstable_scheduleCallback,eq=n.unstable_NormalPriority,ms={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function oS(){return{controller:new JH,data:new Map,refCount:0}}function Up(c){c.refCount--,c.refCount===0&&ZH(eq,function(){c.controller.abort()})}var Bp=null,aS=0,ad=0,ld=null;function tq(c,h){if(Bp===null){var p=Bp=[];aS=0,ad=cC(),ld={status:"pending",value:void 0,then:function(g){p.push(g)}}}return aS++,h.then(CR,CR),h}function CR(){if(--aS===0&&Bp!==null){ld!==null&&(ld.status="fulfilled");var c=Bp;Bp=null,ad=0,ld=null;for(var h=0;h<c.length;h++)(0,c[h])()}}function nq(c,h){var p=[],g={status:"pending",value:null,reason:null,then:function(_){p.push(_)}};return c.then(function(){g.status="fulfilled",g.value=h;for(var _=0;_<p.length;_++)(0,p[_])(h)},function(_){for(g.status="rejected",g.reason=_,_=0;_<p.length;_++)(0,p[_])(void 0)}),g}var TR=G.S;G.S=function(c,h){typeof h=="object"&&h!==null&&typeof h.then=="function"&&tq(c,h),TR!==null&&TR(c,h)};var gu=X(null);function lS(){var c=gu.current;return c!==null?c:mn.pooledCache}function db(c,h){h===null?se(gu,gu.current):se(gu,h.pool)}function ER(){var c=lS();return c===null?null:{parent:ms._currentValue,pool:c}}var zp=Error(s(460)),IR=Error(s(474)),fb=Error(s(542)),cS={then:function(){}};function kR(c){return c=c.status,c==="fulfilled"||c==="rejected"}function pb(){}function NR(c,h,p){switch(p=c[p],p===void 0?c.push(h):p!==h&&(h.then(pb,pb),h=p),h.status){case"fulfilled":return h.value;case"rejected":throw c=h.reason,RR(c),c;default:if(typeof h.status=="string")h.then(pb,pb);else{if(c=mn,c!==null&&100<c.shellSuspendCounter)throw Error(s(482));c=h,c.status="pending",c.then(function(g){if(h.status==="pending"){var _=h;_.status="fulfilled",_.value=g}},function(g){if(h.status==="pending"){var _=h;_.status="rejected",_.reason=g}})}switch(h.status){case"fulfilled":return h.value;case"rejected":throw c=h.reason,RR(c),c}throw jp=h,zp}}var jp=null;function AR(){if(jp===null)throw Error(s(459));var c=jp;return jp=null,c}function RR(c){if(c===zp||c===fb)throw Error(s(483))}var bl=!1;function uS(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function hS(c,h){c=c.updateQueue,h.updateQueue===c&&(h.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,callbacks:null})}function xl(c){return{lane:c,tag:0,payload:null,callback:null,next:null}}function vl(c,h,p){var g=c.updateQueue;if(g===null)return null;if(g=g.shared,(Zt&2)!==0){var _=g.pending;return _===null?h.next=h:(h.next=_.next,_.next=h),g.pending=h,h=ob(c),yR(c,null,p),h}return ib(c,g,h,p),ob(c)}function Wp(c,h,p){if(h=h.updateQueue,h!==null&&(h=h.shared,(p&4194048)!==0)){var g=h.lanes;g&=c.pendingLanes,p|=g,h.lanes=p,bp(c,p)}}function dS(c,h){var p=c.updateQueue,g=c.alternate;if(g!==null&&(g=g.updateQueue,p===g)){var _=null,C=null;if(p=p.firstBaseUpdate,p!==null){do{var L={lane:p.lane,tag:p.tag,payload:p.payload,callback:null,next:null};C===null?_=C=L:C=C.next=L,p=p.next}while(p!==null);C===null?_=C=h:C=C.next=h}else _=C=h;p={baseState:g.baseState,firstBaseUpdate:_,lastBaseUpdate:C,shared:g.shared,callbacks:g.callbacks},c.updateQueue=p;return}c=p.lastBaseUpdate,c===null?p.firstBaseUpdate=h:c.next=h,p.lastBaseUpdate=h}var fS=!1;function Gp(){if(fS){var c=ld;if(c!==null)throw c}}function Hp(c,h,p,g){fS=!1;var _=c.updateQueue;bl=!1;var C=_.firstBaseUpdate,L=_.lastBaseUpdate,B=_.shared.pending;if(B!==null){_.shared.pending=null;var q=B,fe=q.next;q.next=null,L===null?C=fe:L.next=fe,L=q;var _e=c.alternate;_e!==null&&(_e=_e.updateQueue,B=_e.lastBaseUpdate,B!==L&&(B===null?_e.firstBaseUpdate=fe:B.next=fe,_e.lastBaseUpdate=q))}if(C!==null){var Ee=_.baseState;L=0,_e=fe=q=null,B=C;do{var me=B.lane&-536870913,ge=me!==B.lane;if(ge?(Pt&me)===me:(g&me)===me){me!==0&&me===ad&&(fS=!0),_e!==null&&(_e=_e.next={lane:0,tag:B.tag,payload:B.payload,callback:null,next:null});e:{var nt=c,Ye=B;me=h;var ln=p;switch(Ye.tag){case 1:if(nt=Ye.payload,typeof nt=="function"){Ee=nt.call(ln,Ee,me);break e}Ee=nt;break e;case 3:nt.flags=nt.flags&-65537|128;case 0:if(nt=Ye.payload,me=typeof nt=="function"?nt.call(ln,Ee,me):nt,me==null)break e;Ee=d({},Ee,me);break e;case 2:bl=!0}}me=B.callback,me!==null&&(c.flags|=64,ge&&(c.flags|=8192),ge=_.callbacks,ge===null?_.callbacks=[me]:ge.push(me))}else ge={lane:me,tag:B.tag,payload:B.payload,callback:B.callback,next:null},_e===null?(fe=_e=ge,q=Ee):_e=_e.next=ge,L|=me;if(B=B.next,B===null){if(B=_.shared.pending,B===null)break;ge=B,B=ge.next,ge.next=null,_.lastBaseUpdate=ge,_.shared.pending=null}}while(!0);_e===null&&(q=Ee),_.baseState=q,_.firstBaseUpdate=fe,_.lastBaseUpdate=_e,C===null&&(_.shared.lanes=0),kl|=L,c.lanes=L,c.memoizedState=Ee}}function $R(c,h){if(typeof c!="function")throw Error(s(191,c));c.call(h)}function DR(c,h){var p=c.callbacks;if(p!==null)for(c.callbacks=null,c=0;c<p.length;c++)$R(p[c],h)}var cd=X(null),mb=X(0);function OR(c,h){c=Aa,se(mb,c),se(cd,h),Aa=c|h.baseLanes}function pS(){se(mb,Aa),se(cd,cd.current)}function mS(){Aa=mb.current,ie(cd),ie(mb)}var wl=0,pt=null,on=null,Jn=null,gb=!1,ud=!1,yu=!1,yb=0,qp=0,hd=null,sq=0;function Gn(){throw Error(s(321))}function gS(c,h){if(h===null)return!1;for(var p=0;p<h.length&&p<c.length;p++)if(!Yr(c[p],h[p]))return!1;return!0}function yS(c,h,p,g,_,C){return wl=C,pt=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,G.H=c===null||c.memoizedState===null?y$:b$,yu=!1,C=p(g,_),yu=!1,ud&&(C=MR(h,p,g,_)),PR(c),C}function PR(c){G.H=Sb;var h=on!==null&&on.next!==null;if(wl=0,Jn=on=pt=null,gb=!1,qp=0,hd=null,h)throw Error(s(300));c===null||Es||(c=c.dependencies,c!==null&&ub(c)&&(Es=!0))}function MR(c,h,p,g){pt=c;var _=0;do{if(ud&&(hd=null),qp=0,ud=!1,25<=_)throw Error(s(301));if(_+=1,Jn=on=null,c.updateQueue!=null){var C=c.updateQueue;C.lastEffect=null,C.events=null,C.stores=null,C.memoCache!=null&&(C.memoCache.index=0)}G.H=uq,C=h(p,g)}while(ud);return C}function rq(){var c=G.H,h=c.useState()[0];return h=typeof h.then=="function"?Kp(h):h,c=c.useState()[0],(on!==null?on.memoizedState:null)!==c&&(pt.flags|=1024),h}function bS(){var c=yb!==0;return yb=0,c}function xS(c,h,p){h.updateQueue=c.updateQueue,h.flags&=-2053,c.lanes&=~p}function vS(c){if(gb){for(c=c.memoizedState;c!==null;){var h=c.queue;h!==null&&(h.pending=null),c=c.next}gb=!1}wl=0,Jn=on=pt=null,ud=!1,qp=yb=0,hd=null}function $r(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Jn===null?pt.memoizedState=Jn=c:Jn=Jn.next=c,Jn}function Zn(){if(on===null){var c=pt.alternate;c=c!==null?c.memoizedState:null}else c=on.next;var h=Jn===null?pt.memoizedState:Jn.next;if(h!==null)Jn=h,on=c;else{if(c===null)throw pt.alternate===null?Error(s(467)):Error(s(310));on=c,c={memoizedState:on.memoizedState,baseState:on.baseState,baseQueue:on.baseQueue,queue:on.queue,next:null},Jn===null?pt.memoizedState=Jn=c:Jn=Jn.next=c}return Jn}function wS(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Kp(c){var h=qp;return qp+=1,hd===null&&(hd=[]),c=NR(hd,c,h),h=pt,(Jn===null?h.memoizedState:Jn.next)===null&&(h=h.alternate,G.H=h===null||h.memoizedState===null?y$:b$),c}function bb(c){if(c!==null&&typeof c=="object"){if(typeof c.then=="function")return Kp(c);if(c.$$typeof===I)return ir(c)}throw Error(s(438,String(c)))}function _S(c){var h=null,p=pt.updateQueue;if(p!==null&&(h=p.memoCache),h==null){var g=pt.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(h={data:g.data.map(function(_){return _.slice()}),index:0})))}if(h==null&&(h={data:[],index:0}),p===null&&(p=wS(),pt.updateQueue=p),p.memoCache=h,p=h.data[h.index],p===void 0)for(p=h.data[h.index]=Array(c),g=0;g<c;g++)p[g]=R;return h.index++,p}function Ca(c,h){return typeof h=="function"?h(c):h}function xb(c){var h=Zn();return SS(h,on,c)}function SS(c,h,p){var g=c.queue;if(g===null)throw Error(s(311));g.lastRenderedReducer=p;var _=c.baseQueue,C=g.pending;if(C!==null){if(_!==null){var L=_.next;_.next=C.next,C.next=L}h.baseQueue=_=C,g.pending=null}if(C=c.baseState,_===null)c.memoizedState=C;else{h=_.next;var B=L=null,q=null,fe=h,_e=!1;do{var Ee=fe.lane&-536870913;if(Ee!==fe.lane?(Pt&Ee)===Ee:(wl&Ee)===Ee){var me=fe.revertLane;if(me===0)q!==null&&(q=q.next={lane:0,revertLane:0,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null}),Ee===ad&&(_e=!0);else if((wl&me)===me){fe=fe.next,me===ad&&(_e=!0);continue}else Ee={lane:0,revertLane:fe.revertLane,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},q===null?(B=q=Ee,L=C):q=q.next=Ee,pt.lanes|=me,kl|=me;Ee=fe.action,yu&&p(C,Ee),C=fe.hasEagerState?fe.eagerState:p(C,Ee)}else me={lane:Ee,revertLane:fe.revertLane,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},q===null?(B=q=me,L=C):q=q.next=me,pt.lanes|=Ee,kl|=Ee;fe=fe.next}while(fe!==null&&fe!==h);if(q===null?L=C:q.next=B,!Yr(C,c.memoizedState)&&(Es=!0,_e&&(p=ld,p!==null)))throw p;c.memoizedState=C,c.baseState=L,c.baseQueue=q,g.lastRenderedState=C}return _===null&&(g.lanes=0),[c.memoizedState,g.dispatch]}function CS(c){var h=Zn(),p=h.queue;if(p===null)throw Error(s(311));p.lastRenderedReducer=c;var g=p.dispatch,_=p.pending,C=h.memoizedState;if(_!==null){p.pending=null;var L=_=_.next;do C=c(C,L.action),L=L.next;while(L!==_);Yr(C,h.memoizedState)||(Es=!0),h.memoizedState=C,h.baseQueue===null&&(h.baseState=C),p.lastRenderedState=C}return[C,g]}function LR(c,h,p){var g=pt,_=Zn(),C=Gt;if(C){if(p===void 0)throw Error(s(407));p=p()}else p=h();var L=!Yr((on||_).memoizedState,p);L&&(_.memoizedState=p,Es=!0),_=_.queue;var B=UR.bind(null,g,_,c);if(Xp(2048,8,B,[c]),_.getSnapshot!==h||L||Jn!==null&&Jn.memoizedState.tag&1){if(g.flags|=2048,dd(9,vb(),VR.bind(null,g,_,p,h),null),mn===null)throw Error(s(349));C||(wl&124)!==0||FR(g,h,p)}return p}function FR(c,h,p){c.flags|=16384,c={getSnapshot:h,value:p},h=pt.updateQueue,h===null?(h=wS(),pt.updateQueue=h,h.stores=[c]):(p=h.stores,p===null?h.stores=[c]:p.push(c))}function VR(c,h,p,g){h.value=p,h.getSnapshot=g,BR(h)&&zR(c)}function UR(c,h,p){return p(function(){BR(h)&&zR(c)})}function BR(c){var h=c.getSnapshot;c=c.value;try{var p=h();return!Yr(c,p)}catch{return!0}}function zR(c){var h=sd(c,2);h!==null&&ni(h,c,2)}function TS(c){var h=$r();if(typeof c=="function"){var p=c;if(c=p(),yu){$n(!0);try{p()}finally{$n(!1)}}}return h.memoizedState=h.baseState=c,h.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ca,lastRenderedState:c},h}function jR(c,h,p,g){return c.baseState=p,SS(c,on,typeof g=="function"?g:Ca)}function iq(c,h,p,g,_){if(_b(c))throw Error(s(485));if(c=h.action,c!==null){var C={payload:_,action:c,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(L){C.listeners.push(L)}};G.T!==null?p(!0):C.isTransition=!1,g(C),p=h.pending,p===null?(C.next=h.pending=C,WR(h,C)):(C.next=p.next,h.pending=p.next=C)}}function WR(c,h){var p=h.action,g=h.payload,_=c.state;if(h.isTransition){var C=G.T,L={};G.T=L;try{var B=p(_,g),q=G.S;q!==null&&q(L,B),GR(c,h,B)}catch(fe){ES(c,h,fe)}finally{G.T=C}}else try{C=p(_,g),GR(c,h,C)}catch(fe){ES(c,h,fe)}}function GR(c,h,p){p!==null&&typeof p=="object"&&typeof p.then=="function"?p.then(function(g){HR(c,h,g)},function(g){return ES(c,h,g)}):HR(c,h,p)}function HR(c,h,p){h.status="fulfilled",h.value=p,qR(h),c.state=p,h=c.pending,h!==null&&(p=h.next,p===h?c.pending=null:(p=p.next,h.next=p,WR(c,p)))}function ES(c,h,p){var g=c.pending;if(c.pending=null,g!==null){g=g.next;do h.status="rejected",h.reason=p,qR(h),h=h.next;while(h!==g)}c.action=null}function qR(c){c=c.listeners;for(var h=0;h<c.length;h++)(0,c[h])()}function KR(c,h){return h}function XR(c,h){if(Gt){var p=mn.formState;if(p!==null){e:{var g=pt;if(Gt){if(On){t:{for(var _=On,C=So;_.nodeType!==8;){if(!C){_=null;break t}if(_=ji(_.nextSibling),_===null){_=null;break t}}C=_.data,_=C==="F!"||C==="F"?_:null}if(_){On=ji(_.nextSibling),g=_.data==="F!";break e}}fu(g)}g=!1}g&&(h=p[0])}}return p=$r(),p.memoizedState=p.baseState=h,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:KR,lastRenderedState:h},p.queue=g,p=p$.bind(null,pt,g),g.dispatch=p,g=TS(!1),C=RS.bind(null,pt,!1,g.queue),g=$r(),_={state:h,dispatch:null,action:c,pending:null},g.queue=_,p=iq.bind(null,pt,_,C,p),_.dispatch=p,g.memoizedState=c,[h,p,!1]}function YR(c){var h=Zn();return QR(h,on,c)}function QR(c,h,p){if(h=SS(c,h,KR)[0],c=xb(Ca)[0],typeof h=="object"&&h!==null&&typeof h.then=="function")try{var g=Kp(h)}catch(L){throw L===zp?fb:L}else g=h;h=Zn();var _=h.queue,C=_.dispatch;return p!==h.memoizedState&&(pt.flags|=2048,dd(9,vb(),oq.bind(null,_,p),null)),[g,C,c]}function oq(c,h){c.action=h}function JR(c){var h=Zn(),p=on;if(p!==null)return QR(h,p,c);Zn(),h=h.memoizedState,p=Zn();var g=p.queue.dispatch;return p.memoizedState=c,[h,g,!1]}function dd(c,h,p,g){return c={tag:c,create:p,deps:g,inst:h,next:null},h=pt.updateQueue,h===null&&(h=wS(),pt.updateQueue=h),p=h.lastEffect,p===null?h.lastEffect=c.next=c:(g=p.next,p.next=c,c.next=g,h.lastEffect=c),c}function vb(){return{destroy:void 0,resource:void 0}}function ZR(){return Zn().memoizedState}function wb(c,h,p,g){var _=$r();g=g===void 0?null:g,pt.flags|=c,_.memoizedState=dd(1|h,vb(),p,g)}function Xp(c,h,p,g){var _=Zn();g=g===void 0?null:g;var C=_.memoizedState.inst;on!==null&&g!==null&&gS(g,on.memoizedState.deps)?_.memoizedState=dd(h,C,p,g):(pt.flags|=c,_.memoizedState=dd(1|h,C,p,g))}function e$(c,h){wb(8390656,8,c,h)}function t$(c,h){Xp(2048,8,c,h)}function n$(c,h){return Xp(4,2,c,h)}function s$(c,h){return Xp(4,4,c,h)}function r$(c,h){if(typeof h=="function"){c=c();var p=h(c);return function(){typeof p=="function"?p():h(null)}}if(h!=null)return c=c(),h.current=c,function(){h.current=null}}function i$(c,h,p){p=p!=null?p.concat([c]):null,Xp(4,4,r$.bind(null,h,c),p)}function IS(){}function o$(c,h){var p=Zn();h=h===void 0?null:h;var g=p.memoizedState;return h!==null&&gS(h,g[1])?g[0]:(p.memoizedState=[c,h],c)}function a$(c,h){var p=Zn();h=h===void 0?null:h;var g=p.memoizedState;if(h!==null&&gS(h,g[1]))return g[0];if(g=c(),yu){$n(!0);try{c()}finally{$n(!1)}}return p.memoizedState=[g,h],g}function kS(c,h,p){return p===void 0||(wl&1073741824)!==0?c.memoizedState=h:(c.memoizedState=p,c=uD(),pt.lanes|=c,kl|=c,p)}function l$(c,h,p,g){return Yr(p,h)?p:cd.current!==null?(c=kS(c,p,g),Yr(c,h)||(Es=!0),c):(wl&42)===0?(Es=!0,c.memoizedState=p):(c=uD(),pt.lanes|=c,kl|=c,h)}function c$(c,h,p,g,_){var C=K.p;K.p=C!==0&&8>C?C:8;var L=G.T,B={};G.T=B,RS(c,!1,h,p);try{var q=_(),fe=G.S;if(fe!==null&&fe(B,q),q!==null&&typeof q=="object"&&typeof q.then=="function"){var _e=nq(q,g);Yp(c,h,_e,ti(c))}else Yp(c,h,g,ti(c))}catch(Ee){Yp(c,h,{then:function(){},status:"rejected",reason:Ee},ti())}finally{K.p=C,G.T=L}}function aq(){}function NS(c,h,p,g){if(c.tag!==5)throw Error(s(476));var _=u$(c).queue;c$(c,_,h,J,p===null?aq:function(){return h$(c),p(g)})}function u$(c){var h=c.memoizedState;if(h!==null)return h;h={memoizedState:J,baseState:J,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ca,lastRenderedState:J},next:null};var p={};return h.next={memoizedState:p,baseState:p,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ca,lastRenderedState:p},next:null},c.memoizedState=h,c=c.alternate,c!==null&&(c.memoizedState=h),h}function h$(c){var h=u$(c).next.queue;Yp(c,h,{},ti())}function AS(){return ir(pm)}function d$(){return Zn().memoizedState}function f$(){return Zn().memoizedState}function lq(c){for(var h=c.return;h!==null;){switch(h.tag){case 24:case 3:var p=ti();c=xl(p);var g=vl(h,c,p);g!==null&&(ni(g,h,p),Wp(g,h,p)),h={cache:oS()},c.payload=h;return}h=h.return}}function cq(c,h,p){var g=ti();p={lane:g,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null},_b(c)?m$(h,p):(p=Y1(c,h,p,g),p!==null&&(ni(p,c,g),g$(p,h,g)))}function p$(c,h,p){var g=ti();Yp(c,h,p,g)}function Yp(c,h,p,g){var _={lane:g,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null};if(_b(c))m$(h,_);else{var C=c.alternate;if(c.lanes===0&&(C===null||C.lanes===0)&&(C=h.lastRenderedReducer,C!==null))try{var L=h.lastRenderedState,B=C(L,p);if(_.hasEagerState=!0,_.eagerState=B,Yr(B,L))return ib(c,h,_,0),mn===null&&rb(),!1}catch{}finally{}if(p=Y1(c,h,_,g),p!==null)return ni(p,c,g),g$(p,h,g),!0}return!1}function RS(c,h,p,g){if(g={lane:2,revertLane:cC(),action:g,hasEagerState:!1,eagerState:null,next:null},_b(c)){if(h)throw Error(s(479))}else h=Y1(c,p,g,2),h!==null&&ni(h,c,2)}function _b(c){var h=c.alternate;return c===pt||h!==null&&h===pt}function m$(c,h){ud=gb=!0;var p=c.pending;p===null?h.next=h:(h.next=p.next,p.next=h),c.pending=h}function g$(c,h,p){if((p&4194048)!==0){var g=h.lanes;g&=c.pendingLanes,p|=g,h.lanes=p,bp(c,p)}}var Sb={readContext:ir,use:bb,useCallback:Gn,useContext:Gn,useEffect:Gn,useImperativeHandle:Gn,useLayoutEffect:Gn,useInsertionEffect:Gn,useMemo:Gn,useReducer:Gn,useRef:Gn,useState:Gn,useDebugValue:Gn,useDeferredValue:Gn,useTransition:Gn,useSyncExternalStore:Gn,useId:Gn,useHostTransitionStatus:Gn,useFormState:Gn,useActionState:Gn,useOptimistic:Gn,useMemoCache:Gn,useCacheRefresh:Gn},y$={readContext:ir,use:bb,useCallback:function(c,h){return $r().memoizedState=[c,h===void 0?null:h],c},useContext:ir,useEffect:e$,useImperativeHandle:function(c,h,p){p=p!=null?p.concat([c]):null,wb(4194308,4,r$.bind(null,h,c),p)},useLayoutEffect:function(c,h){return wb(4194308,4,c,h)},useInsertionEffect:function(c,h){wb(4,2,c,h)},useMemo:function(c,h){var p=$r();h=h===void 0?null:h;var g=c();if(yu){$n(!0);try{c()}finally{$n(!1)}}return p.memoizedState=[g,h],g},useReducer:function(c,h,p){var g=$r();if(p!==void 0){var _=p(h);if(yu){$n(!0);try{p(h)}finally{$n(!1)}}}else _=h;return g.memoizedState=g.baseState=_,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:_},g.queue=c,c=c.dispatch=cq.bind(null,pt,c),[g.memoizedState,c]},useRef:function(c){var h=$r();return c={current:c},h.memoizedState=c},useState:function(c){c=TS(c);var h=c.queue,p=p$.bind(null,pt,h);return h.dispatch=p,[c.memoizedState,p]},useDebugValue:IS,useDeferredValue:function(c,h){var p=$r();return kS(p,c,h)},useTransition:function(){var c=TS(!1);return c=c$.bind(null,pt,c.queue,!0,!1),$r().memoizedState=c,[!1,c]},useSyncExternalStore:function(c,h,p){var g=pt,_=$r();if(Gt){if(p===void 0)throw Error(s(407));p=p()}else{if(p=h(),mn===null)throw Error(s(349));(Pt&124)!==0||FR(g,h,p)}_.memoizedState=p;var C={value:p,getSnapshot:h};return _.queue=C,e$(UR.bind(null,g,C,c),[c]),g.flags|=2048,dd(9,vb(),VR.bind(null,g,C,p,h),null),p},useId:function(){var c=$r(),h=mn.identifierPrefix;if(Gt){var p=wa,g=va;p=(g&~(1<<32-Dn(g)-1)).toString(32)+p,h=""+h+"R"+p,p=yb++,0<p&&(h+="H"+p.toString(32)),h+=""}else p=sq++,h=""+h+"r"+p.toString(32)+"";return c.memoizedState=h},useHostTransitionStatus:AS,useFormState:XR,useActionState:XR,useOptimistic:function(c){var h=$r();h.memoizedState=h.baseState=c;var p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return h.queue=p,h=RS.bind(null,pt,!0,p),p.dispatch=h,[c,h]},useMemoCache:_S,useCacheRefresh:function(){return $r().memoizedState=lq.bind(null,pt)}},b$={readContext:ir,use:bb,useCallback:o$,useContext:ir,useEffect:t$,useImperativeHandle:i$,useInsertionEffect:n$,useLayoutEffect:s$,useMemo:a$,useReducer:xb,useRef:ZR,useState:function(){return xb(Ca)},useDebugValue:IS,useDeferredValue:function(c,h){var p=Zn();return l$(p,on.memoizedState,c,h)},useTransition:function(){var c=xb(Ca)[0],h=Zn().memoizedState;return[typeof c=="boolean"?c:Kp(c),h]},useSyncExternalStore:LR,useId:d$,useHostTransitionStatus:AS,useFormState:YR,useActionState:YR,useOptimistic:function(c,h){var p=Zn();return jR(p,on,c,h)},useMemoCache:_S,useCacheRefresh:f$},uq={readContext:ir,use:bb,useCallback:o$,useContext:ir,useEffect:t$,useImperativeHandle:i$,useInsertionEffect:n$,useLayoutEffect:s$,useMemo:a$,useReducer:CS,useRef:ZR,useState:function(){return CS(Ca)},useDebugValue:IS,useDeferredValue:function(c,h){var p=Zn();return on===null?kS(p,c,h):l$(p,on.memoizedState,c,h)},useTransition:function(){var c=CS(Ca)[0],h=Zn().memoizedState;return[typeof c=="boolean"?c:Kp(c),h]},useSyncExternalStore:LR,useId:d$,useHostTransitionStatus:AS,useFormState:JR,useActionState:JR,useOptimistic:function(c,h){var p=Zn();return on!==null?jR(p,on,c,h):(p.baseState=c,[c,p.queue.dispatch])},useMemoCache:_S,useCacheRefresh:f$},fd=null,Qp=0;function Cb(c){var h=Qp;return Qp+=1,fd===null&&(fd=[]),NR(fd,c,h)}function Jp(c,h){h=h.props.ref,c.ref=h!==void 0?h:null}function Tb(c,h){throw h.$$typeof===f?Error(s(525)):(c=Object.prototype.toString.call(h),Error(s(31,c==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":c)))}function x$(c){var h=c._init;return h(c._payload)}function v$(c){function h(le,Z){if(c){var he=le.deletions;he===null?(le.deletions=[Z],le.flags|=16):he.push(Z)}}function p(le,Z){if(!c)return null;for(;Z!==null;)h(le,Z),Z=Z.sibling;return null}function g(le){for(var Z=new Map;le!==null;)le.key!==null?Z.set(le.key,le):Z.set(le.index,le),le=le.sibling;return Z}function _(le,Z){return le=xa(le,Z),le.index=0,le.sibling=null,le}function C(le,Z,he){return le.index=he,c?(he=le.alternate,he!==null?(he=he.index,he<Z?(le.flags|=67108866,Z):he):(le.flags|=67108866,Z)):(le.flags|=1048576,Z)}function L(le){return c&&le.alternate===null&&(le.flags|=67108866),le}function B(le,Z,he,Ce){return Z===null||Z.tag!==6?(Z=J1(he,le.mode,Ce),Z.return=le,Z):(Z=_(Z,he),Z.return=le,Z)}function q(le,Z,he,Ce){var Be=he.type;return Be===b?_e(le,Z,he.props.children,Ce,he.key):Z!==null&&(Z.elementType===Be||typeof Be=="object"&&Be!==null&&Be.$$typeof===D&&x$(Be)===Z.type)?(Z=_(Z,he.props),Jp(Z,he),Z.return=le,Z):(Z=ab(he.type,he.key,he.props,null,le.mode,Ce),Jp(Z,he),Z.return=le,Z)}function fe(le,Z,he,Ce){return Z===null||Z.tag!==4||Z.stateNode.containerInfo!==he.containerInfo||Z.stateNode.implementation!==he.implementation?(Z=Z1(he,le.mode,Ce),Z.return=le,Z):(Z=_(Z,he.children||[]),Z.return=le,Z)}function _e(le,Z,he,Ce,Be){return Z===null||Z.tag!==7?(Z=cu(he,le.mode,Ce,Be),Z.return=le,Z):(Z=_(Z,he),Z.return=le,Z)}function Ee(le,Z,he){if(typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint")return Z=J1(""+Z,le.mode,he),Z.return=le,Z;if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case m:return he=ab(Z.type,Z.key,Z.props,null,le.mode,he),Jp(he,Z),he.return=le,he;case y:return Z=Z1(Z,le.mode,he),Z.return=le,Z;case D:var Ce=Z._init;return Z=Ce(Z._payload),Ee(le,Z,he)}if(Q(Z)||U(Z))return Z=cu(Z,le.mode,he,null),Z.return=le,Z;if(typeof Z.then=="function")return Ee(le,Cb(Z),he);if(Z.$$typeof===I)return Ee(le,hb(le,Z),he);Tb(le,Z)}return null}function me(le,Z,he,Ce){var Be=Z!==null?Z.key:null;if(typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint")return Be!==null?null:B(le,Z,""+he,Ce);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case m:return he.key===Be?q(le,Z,he,Ce):null;case y:return he.key===Be?fe(le,Z,he,Ce):null;case D:return Be=he._init,he=Be(he._payload),me(le,Z,he,Ce)}if(Q(he)||U(he))return Be!==null?null:_e(le,Z,he,Ce,null);if(typeof he.then=="function")return me(le,Z,Cb(he),Ce);if(he.$$typeof===I)return me(le,Z,hb(le,he),Ce);Tb(le,he)}return null}function ge(le,Z,he,Ce,Be){if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint")return le=le.get(he)||null,B(Z,le,""+Ce,Be);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case m:return le=le.get(Ce.key===null?he:Ce.key)||null,q(Z,le,Ce,Be);case y:return le=le.get(Ce.key===null?he:Ce.key)||null,fe(Z,le,Ce,Be);case D:var yt=Ce._init;return Ce=yt(Ce._payload),ge(le,Z,he,Ce,Be)}if(Q(Ce)||U(Ce))return le=le.get(he)||null,_e(Z,le,Ce,Be,null);if(typeof Ce.then=="function")return ge(le,Z,he,Cb(Ce),Be);if(Ce.$$typeof===I)return ge(le,Z,he,hb(Z,Ce),Be);Tb(Z,Ce)}return null}function nt(le,Z,he,Ce){for(var Be=null,yt=null,We=Z,Je=Z=0,ks=null;We!==null&&Je<he.length;Je++){We.index>Je?(ks=We,We=null):ks=We.sibling;var Vt=me(le,We,he[Je],Ce);if(Vt===null){We===null&&(We=ks);break}c&&We&&Vt.alternate===null&&h(le,We),Z=C(Vt,Z,Je),yt===null?Be=Vt:yt.sibling=Vt,yt=Vt,We=ks}if(Je===he.length)return p(le,We),Gt&&hu(le,Je),Be;if(We===null){for(;Je<he.length;Je++)We=Ee(le,he[Je],Ce),We!==null&&(Z=C(We,Z,Je),yt===null?Be=We:yt.sibling=We,yt=We);return Gt&&hu(le,Je),Be}for(We=g(We);Je<he.length;Je++)ks=ge(We,le,Je,he[Je],Ce),ks!==null&&(c&&ks.alternate!==null&&We.delete(ks.key===null?Je:ks.key),Z=C(ks,Z,Je),yt===null?Be=ks:yt.sibling=ks,yt=ks);return c&&We.forEach(function(Ll){return h(le,Ll)}),Gt&&hu(le,Je),Be}function Ye(le,Z,he,Ce){if(he==null)throw Error(s(151));for(var Be=null,yt=null,We=Z,Je=Z=0,ks=null,Vt=he.next();We!==null&&!Vt.done;Je++,Vt=he.next()){We.index>Je?(ks=We,We=null):ks=We.sibling;var Ll=me(le,We,Vt.value,Ce);if(Ll===null){We===null&&(We=ks);break}c&&We&&Ll.alternate===null&&h(le,We),Z=C(Ll,Z,Je),yt===null?Be=Ll:yt.sibling=Ll,yt=Ll,We=ks}if(Vt.done)return p(le,We),Gt&&hu(le,Je),Be;if(We===null){for(;!Vt.done;Je++,Vt=he.next())Vt=Ee(le,Vt.value,Ce),Vt!==null&&(Z=C(Vt,Z,Je),yt===null?Be=Vt:yt.sibling=Vt,yt=Vt);return Gt&&hu(le,Je),Be}for(We=g(We);!Vt.done;Je++,Vt=he.next())Vt=ge(We,le,Je,Vt.value,Ce),Vt!==null&&(c&&Vt.alternate!==null&&We.delete(Vt.key===null?Je:Vt.key),Z=C(Vt,Z,Je),yt===null?Be=Vt:yt.sibling=Vt,yt=Vt);return c&&We.forEach(function(h8){return h(le,h8)}),Gt&&hu(le,Je),Be}function ln(le,Z,he,Ce){if(typeof he=="object"&&he!==null&&he.type===b&&he.key===null&&(he=he.props.children),typeof he=="object"&&he!==null){switch(he.$$typeof){case m:e:{for(var Be=he.key;Z!==null;){if(Z.key===Be){if(Be=he.type,Be===b){if(Z.tag===7){p(le,Z.sibling),Ce=_(Z,he.props.children),Ce.return=le,le=Ce;break e}}else if(Z.elementType===Be||typeof Be=="object"&&Be!==null&&Be.$$typeof===D&&x$(Be)===Z.type){p(le,Z.sibling),Ce=_(Z,he.props),Jp(Ce,he),Ce.return=le,le=Ce;break e}p(le,Z);break}else h(le,Z);Z=Z.sibling}he.type===b?(Ce=cu(he.props.children,le.mode,Ce,he.key),Ce.return=le,le=Ce):(Ce=ab(he.type,he.key,he.props,null,le.mode,Ce),Jp(Ce,he),Ce.return=le,le=Ce)}return L(le);case y:e:{for(Be=he.key;Z!==null;){if(Z.key===Be)if(Z.tag===4&&Z.stateNode.containerInfo===he.containerInfo&&Z.stateNode.implementation===he.implementation){p(le,Z.sibling),Ce=_(Z,he.children||[]),Ce.return=le,le=Ce;break e}else{p(le,Z);break}else h(le,Z);Z=Z.sibling}Ce=Z1(he,le.mode,Ce),Ce.return=le,le=Ce}return L(le);case D:return Be=he._init,he=Be(he._payload),ln(le,Z,he,Ce)}if(Q(he))return nt(le,Z,he,Ce);if(U(he)){if(Be=U(he),typeof Be!="function")throw Error(s(150));return he=Be.call(he),Ye(le,Z,he,Ce)}if(typeof he.then=="function")return ln(le,Z,Cb(he),Ce);if(he.$$typeof===I)return ln(le,Z,hb(le,he),Ce);Tb(le,he)}return typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint"?(he=""+he,Z!==null&&Z.tag===6?(p(le,Z.sibling),Ce=_(Z,he),Ce.return=le,le=Ce):(p(le,Z),Ce=J1(he,le.mode,Ce),Ce.return=le,le=Ce),L(le)):p(le,Z)}return function(le,Z,he,Ce){try{Qp=0;var Be=ln(le,Z,he,Ce);return fd=null,Be}catch(We){if(We===zp||We===fb)throw We;var yt=Qr(29,We,null,le.mode);return yt.lanes=Ce,yt.return=le,yt}finally{}}}var pd=v$(!0),w$=v$(!1),vi=X(null),Co=null;function _l(c){var h=c.alternate;se(gs,gs.current&1),se(vi,c),Co===null&&(h===null||cd.current!==null||h.memoizedState!==null)&&(Co=c)}function _$(c){if(c.tag===22){if(se(gs,gs.current),se(vi,c),Co===null){var h=c.alternate;h!==null&&h.memoizedState!==null&&(Co=c)}}else Sl()}function Sl(){se(gs,gs.current),se(vi,vi.current)}function Ta(c){ie(vi),Co===c&&(Co=null),ie(gs)}var gs=X(0);function Eb(c){for(var h=c;h!==null;){if(h.tag===13){var p=h.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||p.data==="$?"||wC(p)))return h}else if(h.tag===19&&h.memoizedProps.revealOrder!==void 0){if((h.flags&128)!==0)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===c)break;for(;h.sibling===null;){if(h.return===null||h.return===c)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}function $S(c,h,p,g){h=c.memoizedState,p=p(g,h),p=p==null?h:d({},h,p),c.memoizedState=p,c.lanes===0&&(c.updateQueue.baseState=p)}var DS={enqueueSetState:function(c,h,p){c=c._reactInternals;var g=ti(),_=xl(g);_.payload=h,p!=null&&(_.callback=p),h=vl(c,_,g),h!==null&&(ni(h,c,g),Wp(h,c,g))},enqueueReplaceState:function(c,h,p){c=c._reactInternals;var g=ti(),_=xl(g);_.tag=1,_.payload=h,p!=null&&(_.callback=p),h=vl(c,_,g),h!==null&&(ni(h,c,g),Wp(h,c,g))},enqueueForceUpdate:function(c,h){c=c._reactInternals;var p=ti(),g=xl(p);g.tag=2,h!=null&&(g.callback=h),h=vl(c,g,p),h!==null&&(ni(h,c,p),Wp(h,c,p))}};function S$(c,h,p,g,_,C,L){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(g,C,L):h.prototype&&h.prototype.isPureReactComponent?!Op(p,g)||!Op(_,C):!0}function C$(c,h,p,g){c=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(p,g),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(p,g),h.state!==c&&DS.enqueueReplaceState(h,h.state,null)}function bu(c,h){var p=h;if("ref"in h){p={};for(var g in h)g!=="ref"&&(p[g]=h[g])}if(c=c.defaultProps){p===h&&(p=d({},p));for(var _ in c)p[_]===void 0&&(p[_]=c[_])}return p}var Ib=typeof reportError=="function"?reportError:function(c){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var h=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof c=="object"&&c!==null&&typeof c.message=="string"?String(c.message):String(c),error:c});if(!window.dispatchEvent(h))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",c);return}console.error(c)};function T$(c){Ib(c)}function E$(c){console.error(c)}function I$(c){Ib(c)}function kb(c,h){try{var p=c.onUncaughtError;p(h.value,{componentStack:h.stack})}catch(g){setTimeout(function(){throw g})}}function k$(c,h,p){try{var g=c.onCaughtError;g(p.value,{componentStack:p.stack,errorBoundary:h.tag===1?h.stateNode:null})}catch(_){setTimeout(function(){throw _})}}function OS(c,h,p){return p=xl(p),p.tag=3,p.payload={element:null},p.callback=function(){kb(c,h)},p}function N$(c){return c=xl(c),c.tag=3,c}function A$(c,h,p,g){var _=p.type.getDerivedStateFromError;if(typeof _=="function"){var C=g.value;c.payload=function(){return _(C)},c.callback=function(){k$(h,p,g)}}var L=p.stateNode;L!==null&&typeof L.componentDidCatch=="function"&&(c.callback=function(){k$(h,p,g),typeof _!="function"&&(Nl===null?Nl=new Set([this]):Nl.add(this));var B=g.stack;this.componentDidCatch(g.value,{componentStack:B!==null?B:""})})}function hq(c,h,p,g,_){if(p.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(h=p.alternate,h!==null&&Vp(h,p,_,!0),p=vi.current,p!==null){switch(p.tag){case 13:return Co===null?rC():p.alternate===null&&Pn===0&&(Pn=3),p.flags&=-257,p.flags|=65536,p.lanes=_,g===cS?p.flags|=16384:(h=p.updateQueue,h===null?p.updateQueue=new Set([g]):h.add(g),oC(c,g,_)),!1;case 22:return p.flags|=65536,g===cS?p.flags|=16384:(h=p.updateQueue,h===null?(h={transitions:null,markerInstances:null,retryQueue:new Set([g])},p.updateQueue=h):(p=h.retryQueue,p===null?h.retryQueue=new Set([g]):p.add(g)),oC(c,g,_)),!1}throw Error(s(435,p.tag))}return oC(c,g,_),rC(),!1}if(Gt)return h=vi.current,h!==null?((h.flags&65536)===0&&(h.flags|=256),h.flags|=65536,h.lanes=_,g!==nS&&(c=Error(s(422),{cause:g}),Fp(gi(c,p)))):(g!==nS&&(h=Error(s(423),{cause:g}),Fp(gi(h,p))),c=c.current.alternate,c.flags|=65536,_&=-_,c.lanes|=_,g=gi(g,p),_=OS(c.stateNode,g,_),dS(c,_),Pn!==4&&(Pn=2)),!1;var C=Error(s(520),{cause:g});if(C=gi(C,p),im===null?im=[C]:im.push(C),Pn!==4&&(Pn=2),h===null)return!0;g=gi(g,p),p=h;do{switch(p.tag){case 3:return p.flags|=65536,c=_&-_,p.lanes|=c,c=OS(p.stateNode,g,c),dS(p,c),!1;case 1:if(h=p.type,C=p.stateNode,(p.flags&128)===0&&(typeof h.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(Nl===null||!Nl.has(C))))return p.flags|=65536,_&=-_,p.lanes|=_,_=N$(_),A$(_,c,p,g),dS(p,_),!1}p=p.return}while(p!==null);return!1}var R$=Error(s(461)),Es=!1;function Ws(c,h,p,g){h.child=c===null?w$(h,null,p,g):pd(h,c.child,p,g)}function $$(c,h,p,g,_){p=p.render;var C=h.ref;if("ref"in g){var L={};for(var B in g)B!=="ref"&&(L[B]=g[B])}else L=g;return mu(h),g=yS(c,h,p,L,C,_),B=bS(),c!==null&&!Es?(xS(c,h,_),Ea(c,h,_)):(Gt&&B&&eS(h),h.flags|=1,Ws(c,h,g,_),h.child)}function D$(c,h,p,g,_){if(c===null){var C=p.type;return typeof C=="function"&&!Q1(C)&&C.defaultProps===void 0&&p.compare===null?(h.tag=15,h.type=C,O$(c,h,C,g,_)):(c=ab(p.type,null,g,h,h.mode,_),c.ref=h.ref,c.return=h,h.child=c)}if(C=c.child,!zS(c,_)){var L=C.memoizedProps;if(p=p.compare,p=p!==null?p:Op,p(L,g)&&c.ref===h.ref)return Ea(c,h,_)}return h.flags|=1,c=xa(C,g),c.ref=h.ref,c.return=h,h.child=c}function O$(c,h,p,g,_){if(c!==null){var C=c.memoizedProps;if(Op(C,g)&&c.ref===h.ref)if(Es=!1,h.pendingProps=g=C,zS(c,_))(c.flags&131072)!==0&&(Es=!0);else return h.lanes=c.lanes,Ea(c,h,_)}return PS(c,h,p,g,_)}function P$(c,h,p){var g=h.pendingProps,_=g.children,C=c!==null?c.memoizedState:null;if(g.mode==="hidden"){if((h.flags&128)!==0){if(g=C!==null?C.baseLanes|p:p,c!==null){for(_=h.child=c.child,C=0;_!==null;)C=C|_.lanes|_.childLanes,_=_.sibling;h.childLanes=C&~g}else h.childLanes=0,h.child=null;return M$(c,h,g,p)}if((p&536870912)!==0)h.memoizedState={baseLanes:0,cachePool:null},c!==null&&db(h,C!==null?C.cachePool:null),C!==null?OR(h,C):pS(),_$(h);else return h.lanes=h.childLanes=536870912,M$(c,h,C!==null?C.baseLanes|p:p,p)}else C!==null?(db(h,C.cachePool),OR(h,C),Sl(),h.memoizedState=null):(c!==null&&db(h,null),pS(),Sl());return Ws(c,h,_,p),h.child}function M$(c,h,p,g){var _=lS();return _=_===null?null:{parent:ms._currentValue,pool:_},h.memoizedState={baseLanes:p,cachePool:_},c!==null&&db(h,null),pS(),_$(h),c!==null&&Vp(c,h,g,!0),null}function Nb(c,h){var p=h.ref;if(p===null)c!==null&&c.ref!==null&&(h.flags|=4194816);else{if(typeof p!="function"&&typeof p!="object")throw Error(s(284));(c===null||c.ref!==p)&&(h.flags|=4194816)}}function PS(c,h,p,g,_){return mu(h),p=yS(c,h,p,g,void 0,_),g=bS(),c!==null&&!Es?(xS(c,h,_),Ea(c,h,_)):(Gt&&g&&eS(h),h.flags|=1,Ws(c,h,p,_),h.child)}function L$(c,h,p,g,_,C){return mu(h),h.updateQueue=null,p=MR(h,g,p,_),PR(c),g=bS(),c!==null&&!Es?(xS(c,h,C),Ea(c,h,C)):(Gt&&g&&eS(h),h.flags|=1,Ws(c,h,p,C),h.child)}function F$(c,h,p,g,_){if(mu(h),h.stateNode===null){var C=rd,L=p.contextType;typeof L=="object"&&L!==null&&(C=ir(L)),C=new p(g,C),h.memoizedState=C.state!==null&&C.state!==void 0?C.state:null,C.updater=DS,h.stateNode=C,C._reactInternals=h,C=h.stateNode,C.props=g,C.state=h.memoizedState,C.refs={},uS(h),L=p.contextType,C.context=typeof L=="object"&&L!==null?ir(L):rd,C.state=h.memoizedState,L=p.getDerivedStateFromProps,typeof L=="function"&&($S(h,p,L,g),C.state=h.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof C.getSnapshotBeforeUpdate=="function"||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(L=C.state,typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount(),L!==C.state&&DS.enqueueReplaceState(C,C.state,null),Hp(h,g,C,_),Gp(),C.state=h.memoizedState),typeof C.componentDidMount=="function"&&(h.flags|=4194308),g=!0}else if(c===null){C=h.stateNode;var B=h.memoizedProps,q=bu(p,B);C.props=q;var fe=C.context,_e=p.contextType;L=rd,typeof _e=="object"&&_e!==null&&(L=ir(_e));var Ee=p.getDerivedStateFromProps;_e=typeof Ee=="function"||typeof C.getSnapshotBeforeUpdate=="function",B=h.pendingProps!==B,_e||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(B||fe!==L)&&C$(h,C,g,L),bl=!1;var me=h.memoizedState;C.state=me,Hp(h,g,C,_),Gp(),fe=h.memoizedState,B||me!==fe||bl?(typeof Ee=="function"&&($S(h,p,Ee,g),fe=h.memoizedState),(q=bl||S$(h,p,q,g,me,fe,L))?(_e||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(h.flags|=4194308)):(typeof C.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=g,h.memoizedState=fe),C.props=g,C.state=fe,C.context=L,g=q):(typeof C.componentDidMount=="function"&&(h.flags|=4194308),g=!1)}else{C=h.stateNode,hS(c,h),L=h.memoizedProps,_e=bu(p,L),C.props=_e,Ee=h.pendingProps,me=C.context,fe=p.contextType,q=rd,typeof fe=="object"&&fe!==null&&(q=ir(fe)),B=p.getDerivedStateFromProps,(fe=typeof B=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(L!==Ee||me!==q)&&C$(h,C,g,q),bl=!1,me=h.memoizedState,C.state=me,Hp(h,g,C,_),Gp();var ge=h.memoizedState;L!==Ee||me!==ge||bl||c!==null&&c.dependencies!==null&&ub(c.dependencies)?(typeof B=="function"&&($S(h,p,B,g),ge=h.memoizedState),(_e=bl||S$(h,p,_e,g,me,ge,q)||c!==null&&c.dependencies!==null&&ub(c.dependencies))?(fe||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(g,ge,q),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(g,ge,q)),typeof C.componentDidUpdate=="function"&&(h.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof C.componentDidUpdate!="function"||L===c.memoizedProps&&me===c.memoizedState||(h.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||L===c.memoizedProps&&me===c.memoizedState||(h.flags|=1024),h.memoizedProps=g,h.memoizedState=ge),C.props=g,C.state=ge,C.context=q,g=_e):(typeof C.componentDidUpdate!="function"||L===c.memoizedProps&&me===c.memoizedState||(h.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||L===c.memoizedProps&&me===c.memoizedState||(h.flags|=1024),g=!1)}return C=g,Nb(c,h),g=(h.flags&128)!==0,C||g?(C=h.stateNode,p=g&&typeof p.getDerivedStateFromError!="function"?null:C.render(),h.flags|=1,c!==null&&g?(h.child=pd(h,c.child,null,_),h.child=pd(h,null,p,_)):Ws(c,h,p,_),h.memoizedState=C.state,c=h.child):c=Ea(c,h,_),c}function V$(c,h,p,g){return Lp(),h.flags|=256,Ws(c,h,p,g),h.child}var MS={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function LS(c){return{baseLanes:c,cachePool:ER()}}function FS(c,h,p){return c=c!==null?c.childLanes&~p:0,h&&(c|=wi),c}function U$(c,h,p){var g=h.pendingProps,_=!1,C=(h.flags&128)!==0,L;if((L=C)||(L=c!==null&&c.memoizedState===null?!1:(gs.current&2)!==0),L&&(_=!0,h.flags&=-129),L=(h.flags&32)!==0,h.flags&=-33,c===null){if(Gt){if(_?_l(h):Sl(),Gt){var B=On,q;if(q=B){e:{for(q=B,B=So;q.nodeType!==8;){if(!B){B=null;break e}if(q=ji(q.nextSibling),q===null){B=null;break e}}B=q}B!==null?(h.memoizedState={dehydrated:B,treeContext:uu!==null?{id:va,overflow:wa}:null,retryLane:536870912,hydrationErrors:null},q=Qr(18,null,null,0),q.stateNode=B,q.return=h,h.child=q,_r=h,On=null,q=!0):q=!1}q||fu(h)}if(B=h.memoizedState,B!==null&&(B=B.dehydrated,B!==null))return wC(B)?h.lanes=32:h.lanes=536870912,null;Ta(h)}return B=g.children,g=g.fallback,_?(Sl(),_=h.mode,B=Ab({mode:"hidden",children:B},_),g=cu(g,_,p,null),B.return=h,g.return=h,B.sibling=g,h.child=B,_=h.child,_.memoizedState=LS(p),_.childLanes=FS(c,L,p),h.memoizedState=MS,g):(_l(h),VS(h,B))}if(q=c.memoizedState,q!==null&&(B=q.dehydrated,B!==null)){if(C)h.flags&256?(_l(h),h.flags&=-257,h=US(c,h,p)):h.memoizedState!==null?(Sl(),h.child=c.child,h.flags|=128,h=null):(Sl(),_=g.fallback,B=h.mode,g=Ab({mode:"visible",children:g.children},B),_=cu(_,B,p,null),_.flags|=2,g.return=h,_.return=h,g.sibling=_,h.child=g,pd(h,c.child,null,p),g=h.child,g.memoizedState=LS(p),g.childLanes=FS(c,L,p),h.memoizedState=MS,h=_);else if(_l(h),wC(B)){if(L=B.nextSibling&&B.nextSibling.dataset,L)var fe=L.dgst;L=fe,g=Error(s(419)),g.stack="",g.digest=L,Fp({value:g,source:null,stack:null}),h=US(c,h,p)}else if(Es||Vp(c,h,p,!1),L=(p&c.childLanes)!==0,Es||L){if(L=mn,L!==null&&(g=p&-p,g=(g&42)!==0?1:ul(g),g=(g&(L.suspendedLanes|p))!==0?0:g,g!==0&&g!==q.retryLane))throw q.retryLane=g,sd(c,g),ni(L,c,g),R$;B.data==="$?"||rC(),h=US(c,h,p)}else B.data==="$?"?(h.flags|=192,h.child=c.child,h=null):(c=q.treeContext,On=ji(B.nextSibling),_r=h,Gt=!0,du=null,So=!1,c!==null&&(bi[xi++]=va,bi[xi++]=wa,bi[xi++]=uu,va=c.id,wa=c.overflow,uu=h),h=VS(h,g.children),h.flags|=4096);return h}return _?(Sl(),_=g.fallback,B=h.mode,q=c.child,fe=q.sibling,g=xa(q,{mode:"hidden",children:g.children}),g.subtreeFlags=q.subtreeFlags&65011712,fe!==null?_=xa(fe,_):(_=cu(_,B,p,null),_.flags|=2),_.return=h,g.return=h,g.sibling=_,h.child=g,g=_,_=h.child,B=c.child.memoizedState,B===null?B=LS(p):(q=B.cachePool,q!==null?(fe=ms._currentValue,q=q.parent!==fe?{parent:fe,pool:fe}:q):q=ER(),B={baseLanes:B.baseLanes|p,cachePool:q}),_.memoizedState=B,_.childLanes=FS(c,L,p),h.memoizedState=MS,g):(_l(h),p=c.child,c=p.sibling,p=xa(p,{mode:"visible",children:g.children}),p.return=h,p.sibling=null,c!==null&&(L=h.deletions,L===null?(h.deletions=[c],h.flags|=16):L.push(c)),h.child=p,h.memoizedState=null,p)}function VS(c,h){return h=Ab({mode:"visible",children:h},c.mode),h.return=c,c.child=h}function Ab(c,h){return c=Qr(22,c,null,h),c.lanes=0,c.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},c}function US(c,h,p){return pd(h,c.child,null,p),c=VS(h,h.pendingProps.children),c.flags|=2,h.memoizedState=null,c}function B$(c,h,p){c.lanes|=h;var g=c.alternate;g!==null&&(g.lanes|=h),rS(c.return,h,p)}function BS(c,h,p,g,_){var C=c.memoizedState;C===null?c.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:g,tail:p,tailMode:_}:(C.isBackwards=h,C.rendering=null,C.renderingStartTime=0,C.last=g,C.tail=p,C.tailMode=_)}function z$(c,h,p){var g=h.pendingProps,_=g.revealOrder,C=g.tail;if(Ws(c,h,g.children,p),g=gs.current,(g&2)!==0)g=g&1|2,h.flags|=128;else{if(c!==null&&(c.flags&128)!==0)e:for(c=h.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&B$(c,p,h);else if(c.tag===19)B$(c,p,h);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===h)break e;for(;c.sibling===null;){if(c.return===null||c.return===h)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}g&=1}switch(se(gs,g),_){case"forwards":for(p=h.child,_=null;p!==null;)c=p.alternate,c!==null&&Eb(c)===null&&(_=p),p=p.sibling;p=_,p===null?(_=h.child,h.child=null):(_=p.sibling,p.sibling=null),BS(h,!1,_,p,C);break;case"backwards":for(p=null,_=h.child,h.child=null;_!==null;){if(c=_.alternate,c!==null&&Eb(c)===null){h.child=_;break}c=_.sibling,_.sibling=p,p=_,_=c}BS(h,!0,p,null,C);break;case"together":BS(h,!1,null,null,void 0);break;default:h.memoizedState=null}return h.child}function Ea(c,h,p){if(c!==null&&(h.dependencies=c.dependencies),kl|=h.lanes,(p&h.childLanes)===0)if(c!==null){if(Vp(c,h,p,!1),(p&h.childLanes)===0)return null}else return null;if(c!==null&&h.child!==c.child)throw Error(s(153));if(h.child!==null){for(c=h.child,p=xa(c,c.pendingProps),h.child=p,p.return=h;c.sibling!==null;)c=c.sibling,p=p.sibling=xa(c,c.pendingProps),p.return=h;p.sibling=null}return h.child}function zS(c,h){return(c.lanes&h)!==0?!0:(c=c.dependencies,!!(c!==null&&ub(c)))}function dq(c,h,p){switch(h.tag){case 3:De(h,h.stateNode.containerInfo),yl(h,ms,c.memoizedState.cache),Lp();break;case 27:case 5:Ke(h);break;case 4:De(h,h.stateNode.containerInfo);break;case 10:yl(h,h.type,h.memoizedProps.value);break;case 13:var g=h.memoizedState;if(g!==null)return g.dehydrated!==null?(_l(h),h.flags|=128,null):(p&h.child.childLanes)!==0?U$(c,h,p):(_l(h),c=Ea(c,h,p),c!==null?c.sibling:null);_l(h);break;case 19:var _=(c.flags&128)!==0;if(g=(p&h.childLanes)!==0,g||(Vp(c,h,p,!1),g=(p&h.childLanes)!==0),_){if(g)return z$(c,h,p);h.flags|=128}if(_=h.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),se(gs,gs.current),g)break;return null;case 22:case 23:return h.lanes=0,P$(c,h,p);case 24:yl(h,ms,c.memoizedState.cache)}return Ea(c,h,p)}function j$(c,h,p){if(c!==null)if(c.memoizedProps!==h.pendingProps)Es=!0;else{if(!zS(c,p)&&(h.flags&128)===0)return Es=!1,dq(c,h,p);Es=(c.flags&131072)!==0}else Es=!1,Gt&&(h.flags&1048576)!==0&&xR(h,cb,h.index);switch(h.lanes=0,h.tag){case 16:e:{c=h.pendingProps;var g=h.elementType,_=g._init;if(g=_(g._payload),h.type=g,typeof g=="function")Q1(g)?(c=bu(g,c),h.tag=1,h=F$(null,h,g,c,p)):(h.tag=0,h=PS(null,h,g,c,p));else{if(g!=null){if(_=g.$$typeof,_===k){h.tag=11,h=$$(null,h,g,c,p);break e}else if(_===P){h.tag=14,h=D$(null,h,g,c,p);break e}}throw h=ne(g)||g,Error(s(306,h,""))}}return h;case 0:return PS(c,h,h.type,h.pendingProps,p);case 1:return g=h.type,_=bu(g,h.pendingProps),F$(c,h,g,_,p);case 3:e:{if(De(h,h.stateNode.containerInfo),c===null)throw Error(s(387));g=h.pendingProps;var C=h.memoizedState;_=C.element,hS(c,h),Hp(h,g,null,p);var L=h.memoizedState;if(g=L.cache,yl(h,ms,g),g!==C.cache&&iS(h,[ms],p,!0),Gp(),g=L.element,C.isDehydrated)if(C={element:g,isDehydrated:!1,cache:L.cache},h.updateQueue.baseState=C,h.memoizedState=C,h.flags&256){h=V$(c,h,g,p);break e}else if(g!==_){_=gi(Error(s(424)),h),Fp(_),h=V$(c,h,g,p);break e}else{switch(c=h.stateNode.containerInfo,c.nodeType){case 9:c=c.body;break;default:c=c.nodeName==="HTML"?c.ownerDocument.body:c}for(On=ji(c.firstChild),_r=h,Gt=!0,du=null,So=!0,p=w$(h,null,g,p),h.child=p;p;)p.flags=p.flags&-3|4096,p=p.sibling}else{if(Lp(),g===_){h=Ea(c,h,p);break e}Ws(c,h,g,p)}h=h.child}return h;case 26:return Nb(c,h),c===null?(p=qD(h.type,null,h.pendingProps,null))?h.memoizedState=p:Gt||(p=h.type,c=h.pendingProps,g=Wb(Se.current).createElement(p),g[ds]=h,g[Yn]=c,Hs(g,p,c),Wn(g),h.stateNode=g):h.memoizedState=qD(h.type,c.memoizedProps,h.pendingProps,c.memoizedState),null;case 27:return Ke(h),c===null&&Gt&&(g=h.stateNode=WD(h.type,h.pendingProps,Se.current),_r=h,So=!0,_=On,$l(h.type)?(_C=_,On=ji(g.firstChild)):On=_),Ws(c,h,h.pendingProps.children,p),Nb(c,h),c===null&&(h.flags|=4194304),h.child;case 5:return c===null&&Gt&&((_=g=On)&&(g=Uq(g,h.type,h.pendingProps,So),g!==null?(h.stateNode=g,_r=h,On=ji(g.firstChild),So=!1,_=!0):_=!1),_||fu(h)),Ke(h),_=h.type,C=h.pendingProps,L=c!==null?c.memoizedProps:null,g=C.children,bC(_,C)?g=null:L!==null&&bC(_,L)&&(h.flags|=32),h.memoizedState!==null&&(_=yS(c,h,rq,null,null,p),pm._currentValue=_),Nb(c,h),Ws(c,h,g,p),h.child;case 6:return c===null&&Gt&&((c=p=On)&&(p=Bq(p,h.pendingProps,So),p!==null?(h.stateNode=p,_r=h,On=null,c=!0):c=!1),c||fu(h)),null;case 13:return U$(c,h,p);case 4:return De(h,h.stateNode.containerInfo),g=h.pendingProps,c===null?h.child=pd(h,null,g,p):Ws(c,h,g,p),h.child;case 11:return $$(c,h,h.type,h.pendingProps,p);case 7:return Ws(c,h,h.pendingProps,p),h.child;case 8:return Ws(c,h,h.pendingProps.children,p),h.child;case 12:return Ws(c,h,h.pendingProps.children,p),h.child;case 10:return g=h.pendingProps,yl(h,h.type,g.value),Ws(c,h,g.children,p),h.child;case 9:return _=h.type._context,g=h.pendingProps.children,mu(h),_=ir(_),g=g(_),h.flags|=1,Ws(c,h,g,p),h.child;case 14:return D$(c,h,h.type,h.pendingProps,p);case 15:return O$(c,h,h.type,h.pendingProps,p);case 19:return z$(c,h,p);case 31:return g=h.pendingProps,p=h.mode,g={mode:g.mode,children:g.children},c===null?(p=Ab(g,p),p.ref=h.ref,h.child=p,p.return=h,h=p):(p=xa(c.child,g),p.ref=h.ref,h.child=p,p.return=h,h=p),h;case 22:return P$(c,h,p);case 24:return mu(h),g=ir(ms),c===null?(_=lS(),_===null&&(_=mn,C=oS(),_.pooledCache=C,C.refCount++,C!==null&&(_.pooledCacheLanes|=p),_=C),h.memoizedState={parent:g,cache:_},uS(h),yl(h,ms,_)):((c.lanes&p)!==0&&(hS(c,h),Hp(h,null,null,p),Gp()),_=c.memoizedState,C=h.memoizedState,_.parent!==g?(_={parent:g,cache:g},h.memoizedState=_,h.lanes===0&&(h.memoizedState=h.updateQueue.baseState=_),yl(h,ms,g)):(g=C.cache,yl(h,ms,g),g!==_.cache&&iS(h,[ms],p,!0))),Ws(c,h,h.pendingProps.children,p),h.child;case 29:throw h.pendingProps}throw Error(s(156,h.tag))}function Ia(c){c.flags|=4}function W$(c,h){if(h.type!=="stylesheet"||(h.state.loading&4)!==0)c.flags&=-16777217;else if(c.flags|=16777216,!JD(h)){if(h=vi.current,h!==null&&((Pt&4194048)===Pt?Co!==null:(Pt&62914560)!==Pt&&(Pt&536870912)===0||h!==Co))throw jp=cS,IR;c.flags|=8192}}function Rb(c,h){h!==null&&(c.flags|=4),c.flags&16384&&(h=c.tag!==22?gp():536870912,c.lanes|=h,bd|=h)}function Zp(c,h){if(!Gt)switch(c.tailMode){case"hidden":h=c.tail;for(var p=null;h!==null;)h.alternate!==null&&(p=h),h=h.sibling;p===null?c.tail=null:p.sibling=null;break;case"collapsed":p=c.tail;for(var g=null;p!==null;)p.alternate!==null&&(g=p),p=p.sibling;g===null?h||c.tail===null?c.tail=null:c.tail.sibling=null:g.sibling=null}}function An(c){var h=c.alternate!==null&&c.alternate.child===c.child,p=0,g=0;if(h)for(var _=c.child;_!==null;)p|=_.lanes|_.childLanes,g|=_.subtreeFlags&65011712,g|=_.flags&65011712,_.return=c,_=_.sibling;else for(_=c.child;_!==null;)p|=_.lanes|_.childLanes,g|=_.subtreeFlags,g|=_.flags,_.return=c,_=_.sibling;return c.subtreeFlags|=g,c.childLanes=p,h}function fq(c,h,p){var g=h.pendingProps;switch(tS(h),h.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return An(h),null;case 1:return An(h),null;case 3:return p=h.stateNode,g=null,c!==null&&(g=c.memoizedState.cache),h.memoizedState.cache!==g&&(h.flags|=2048),Sa(ms),Ue(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(c===null||c.child===null)&&(Mp(h)?Ia(h):c===null||c.memoizedState.isDehydrated&&(h.flags&256)===0||(h.flags|=1024,_R())),An(h),null;case 26:return p=h.memoizedState,c===null?(Ia(h),p!==null?(An(h),W$(h,p)):(An(h),h.flags&=-16777217)):p?p!==c.memoizedState?(Ia(h),An(h),W$(h,p)):(An(h),h.flags&=-16777217):(c.memoizedProps!==g&&Ia(h),An(h),h.flags&=-16777217),null;case 27:Xe(h),p=Se.current;var _=h.type;if(c!==null&&h.stateNode!=null)c.memoizedProps!==g&&Ia(h);else{if(!g){if(h.stateNode===null)throw Error(s(166));return An(h),null}c=ve.current,Mp(h)?vR(h):(c=WD(_,g,p),h.stateNode=c,Ia(h))}return An(h),null;case 5:if(Xe(h),p=h.type,c!==null&&h.stateNode!=null)c.memoizedProps!==g&&Ia(h);else{if(!g){if(h.stateNode===null)throw Error(s(166));return An(h),null}if(c=ve.current,Mp(h))vR(h);else{switch(_=Wb(Se.current),c){case 1:c=_.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:c=_.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":c=_.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":c=_.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":c=_.createElement("div"),c.innerHTML="<script><\/script>",c=c.removeChild(c.firstChild);break;case"select":c=typeof g.is=="string"?_.createElement("select",{is:g.is}):_.createElement("select"),g.multiple?c.multiple=!0:g.size&&(c.size=g.size);break;default:c=typeof g.is=="string"?_.createElement(p,{is:g.is}):_.createElement(p)}}c[ds]=h,c[Yn]=g;e:for(_=h.child;_!==null;){if(_.tag===5||_.tag===6)c.appendChild(_.stateNode);else if(_.tag!==4&&_.tag!==27&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===h)break e;for(;_.sibling===null;){if(_.return===null||_.return===h)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}h.stateNode=c;e:switch(Hs(c,p,g),p){case"button":case"input":case"select":case"textarea":c=!!g.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&Ia(h)}}return An(h),h.flags&=-16777217,null;case 6:if(c&&h.stateNode!=null)c.memoizedProps!==g&&Ia(h);else{if(typeof g!="string"&&h.stateNode===null)throw Error(s(166));if(c=Se.current,Mp(h)){if(c=h.stateNode,p=h.memoizedProps,g=null,_=_r,_!==null)switch(_.tag){case 27:case 5:g=_.memoizedProps}c[ds]=h,c=!!(c.nodeValue===p||g!==null&&g.suppressHydrationWarning===!0||LD(c.nodeValue,p)),c||fu(h)}else c=Wb(c).createTextNode(g),c[ds]=h,h.stateNode=c}return An(h),null;case 13:if(g=h.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(_=Mp(h),g!==null&&g.dehydrated!==null){if(c===null){if(!_)throw Error(s(318));if(_=h.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(s(317));_[ds]=h}else Lp(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;An(h),_=!1}else _=_R(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=_),_=!0;if(!_)return h.flags&256?(Ta(h),h):(Ta(h),null)}if(Ta(h),(h.flags&128)!==0)return h.lanes=p,h;if(p=g!==null,c=c!==null&&c.memoizedState!==null,p){g=h.child,_=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(_=g.alternate.memoizedState.cachePool.pool);var C=null;g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(C=g.memoizedState.cachePool.pool),C!==_&&(g.flags|=2048)}return p!==c&&p&&(h.child.flags|=8192),Rb(h,h.updateQueue),An(h),null;case 4:return Ue(),c===null&&fC(h.stateNode.containerInfo),An(h),null;case 10:return Sa(h.type),An(h),null;case 19:if(ie(gs),_=h.memoizedState,_===null)return An(h),null;if(g=(h.flags&128)!==0,C=_.rendering,C===null)if(g)Zp(_,!1);else{if(Pn!==0||c!==null&&(c.flags&128)!==0)for(c=h.child;c!==null;){if(C=Eb(c),C!==null){for(h.flags|=128,Zp(_,!1),c=C.updateQueue,h.updateQueue=c,Rb(h,c),h.subtreeFlags=0,c=p,p=h.child;p!==null;)bR(p,c),p=p.sibling;return se(gs,gs.current&1|2),h.child}c=c.sibling}_.tail!==null&&xt()>Ob&&(h.flags|=128,g=!0,Zp(_,!1),h.lanes=4194304)}else{if(!g)if(c=Eb(C),c!==null){if(h.flags|=128,g=!0,c=c.updateQueue,h.updateQueue=c,Rb(h,c),Zp(_,!0),_.tail===null&&_.tailMode==="hidden"&&!C.alternate&&!Gt)return An(h),null}else 2*xt()-_.renderingStartTime>Ob&&p!==536870912&&(h.flags|=128,g=!0,Zp(_,!1),h.lanes=4194304);_.isBackwards?(C.sibling=h.child,h.child=C):(c=_.last,c!==null?c.sibling=C:h.child=C,_.last=C)}return _.tail!==null?(h=_.tail,_.rendering=h,_.tail=h.sibling,_.renderingStartTime=xt(),h.sibling=null,c=gs.current,se(gs,g?c&1|2:c&1),h):(An(h),null);case 22:case 23:return Ta(h),mS(),g=h.memoizedState!==null,c!==null?c.memoizedState!==null!==g&&(h.flags|=8192):g&&(h.flags|=8192),g?(p&536870912)!==0&&(h.flags&128)===0&&(An(h),h.subtreeFlags&6&&(h.flags|=8192)):An(h),p=h.updateQueue,p!==null&&Rb(h,p.retryQueue),p=null,c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(p=c.memoizedState.cachePool.pool),g=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(g=h.memoizedState.cachePool.pool),g!==p&&(h.flags|=2048),c!==null&&ie(gu),null;case 24:return p=null,c!==null&&(p=c.memoizedState.cache),h.memoizedState.cache!==p&&(h.flags|=2048),Sa(ms),An(h),null;case 25:return null;case 30:return null}throw Error(s(156,h.tag))}function pq(c,h){switch(tS(h),h.tag){case 1:return c=h.flags,c&65536?(h.flags=c&-65537|128,h):null;case 3:return Sa(ms),Ue(),c=h.flags,(c&65536)!==0&&(c&128)===0?(h.flags=c&-65537|128,h):null;case 26:case 27:case 5:return Xe(h),null;case 13:if(Ta(h),c=h.memoizedState,c!==null&&c.dehydrated!==null){if(h.alternate===null)throw Error(s(340));Lp()}return c=h.flags,c&65536?(h.flags=c&-65537|128,h):null;case 19:return ie(gs),null;case 4:return Ue(),null;case 10:return Sa(h.type),null;case 22:case 23:return Ta(h),mS(),c!==null&&ie(gu),c=h.flags,c&65536?(h.flags=c&-65537|128,h):null;case 24:return Sa(ms),null;case 25:return null;default:return null}}function G$(c,h){switch(tS(h),h.tag){case 3:Sa(ms),Ue();break;case 26:case 27:case 5:Xe(h);break;case 4:Ue();break;case 13:Ta(h);break;case 19:ie(gs);break;case 10:Sa(h.type);break;case 22:case 23:Ta(h),mS(),c!==null&&ie(gu);break;case 24:Sa(ms)}}function em(c,h){try{var p=h.updateQueue,g=p!==null?p.lastEffect:null;if(g!==null){var _=g.next;p=_;do{if((p.tag&c)===c){g=void 0;var C=p.create,L=p.inst;g=C(),L.destroy=g}p=p.next}while(p!==_)}}catch(B){hn(h,h.return,B)}}function Cl(c,h,p){try{var g=h.updateQueue,_=g!==null?g.lastEffect:null;if(_!==null){var C=_.next;g=C;do{if((g.tag&c)===c){var L=g.inst,B=L.destroy;if(B!==void 0){L.destroy=void 0,_=h;var q=p,fe=B;try{fe()}catch(_e){hn(_,q,_e)}}}g=g.next}while(g!==C)}}catch(_e){hn(h,h.return,_e)}}function H$(c){var h=c.updateQueue;if(h!==null){var p=c.stateNode;try{DR(h,p)}catch(g){hn(c,c.return,g)}}}function q$(c,h,p){p.props=bu(c.type,c.memoizedProps),p.state=c.memoizedState;try{p.componentWillUnmount()}catch(g){hn(c,h,g)}}function tm(c,h){try{var p=c.ref;if(p!==null){switch(c.tag){case 26:case 27:case 5:var g=c.stateNode;break;case 30:g=c.stateNode;break;default:g=c.stateNode}typeof p=="function"?c.refCleanup=p(g):p.current=g}}catch(_){hn(c,h,_)}}function To(c,h){var p=c.ref,g=c.refCleanup;if(p!==null)if(typeof g=="function")try{g()}catch(_){hn(c,h,_)}finally{c.refCleanup=null,c=c.alternate,c!=null&&(c.refCleanup=null)}else if(typeof p=="function")try{p(null)}catch(_){hn(c,h,_)}else p.current=null}function K$(c){var h=c.type,p=c.memoizedProps,g=c.stateNode;try{e:switch(h){case"button":case"input":case"select":case"textarea":p.autoFocus&&g.focus();break e;case"img":p.src?g.src=p.src:p.srcSet&&(g.srcset=p.srcSet)}}catch(_){hn(c,c.return,_)}}function jS(c,h,p){try{var g=c.stateNode;Pq(g,c.type,p,h),g[Yn]=h}catch(_){hn(c,c.return,_)}}function X$(c){return c.tag===5||c.tag===3||c.tag===26||c.tag===27&&$l(c.type)||c.tag===4}function WS(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||X$(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.tag===27&&$l(c.type)||c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function GS(c,h,p){var g=c.tag;if(g===5||g===6)c=c.stateNode,h?(p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p).insertBefore(c,h):(h=p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p,h.appendChild(c),p=p._reactRootContainer,p!=null||h.onclick!==null||(h.onclick=jb));else if(g!==4&&(g===27&&$l(c.type)&&(p=c.stateNode,h=null),c=c.child,c!==null))for(GS(c,h,p),c=c.sibling;c!==null;)GS(c,h,p),c=c.sibling}function $b(c,h,p){var g=c.tag;if(g===5||g===6)c=c.stateNode,h?p.insertBefore(c,h):p.appendChild(c);else if(g!==4&&(g===27&&$l(c.type)&&(p=c.stateNode),c=c.child,c!==null))for($b(c,h,p),c=c.sibling;c!==null;)$b(c,h,p),c=c.sibling}function Y$(c){var h=c.stateNode,p=c.memoizedProps;try{for(var g=c.type,_=h.attributes;_.length;)h.removeAttributeNode(_[0]);Hs(h,g,p),h[ds]=c,h[Yn]=p}catch(C){hn(c,c.return,C)}}var ka=!1,Hn=!1,HS=!1,Q$=typeof WeakSet=="function"?WeakSet:Set,Is=null;function mq(c,h){if(c=c.containerInfo,gC=Yb,c=lR(c),W1(c)){if("selectionStart"in c)var p={start:c.selectionStart,end:c.selectionEnd};else e:{p=(p=c.ownerDocument)&&p.defaultView||window;var g=p.getSelection&&p.getSelection();if(g&&g.rangeCount!==0){p=g.anchorNode;var _=g.anchorOffset,C=g.focusNode;g=g.focusOffset;try{p.nodeType,C.nodeType}catch{p=null;break e}var L=0,B=-1,q=-1,fe=0,_e=0,Ee=c,me=null;t:for(;;){for(var ge;Ee!==p||_!==0&&Ee.nodeType!==3||(B=L+_),Ee!==C||g!==0&&Ee.nodeType!==3||(q=L+g),Ee.nodeType===3&&(L+=Ee.nodeValue.length),(ge=Ee.firstChild)!==null;)me=Ee,Ee=ge;for(;;){if(Ee===c)break t;if(me===p&&++fe===_&&(B=L),me===C&&++_e===g&&(q=L),(ge=Ee.nextSibling)!==null)break;Ee=me,me=Ee.parentNode}Ee=ge}p=B===-1||q===-1?null:{start:B,end:q}}else p=null}p=p||{start:0,end:0}}else p=null;for(yC={focusedElem:c,selectionRange:p},Yb=!1,Is=h;Is!==null;)if(h=Is,c=h.child,(h.subtreeFlags&1024)!==0&&c!==null)c.return=h,Is=c;else for(;Is!==null;){switch(h=Is,C=h.alternate,c=h.flags,h.tag){case 0:break;case 11:case 15:break;case 1:if((c&1024)!==0&&C!==null){c=void 0,p=h,_=C.memoizedProps,C=C.memoizedState,g=p.stateNode;try{var nt=bu(p.type,_,p.elementType===p.type);c=g.getSnapshotBeforeUpdate(nt,C),g.__reactInternalSnapshotBeforeUpdate=c}catch(Ye){hn(p,p.return,Ye)}}break;case 3:if((c&1024)!==0){if(c=h.stateNode.containerInfo,p=c.nodeType,p===9)vC(c);else if(p===1)switch(c.nodeName){case"HEAD":case"HTML":case"BODY":vC(c);break;default:c.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((c&1024)!==0)throw Error(s(163))}if(c=h.sibling,c!==null){c.return=h.return,Is=c;break}Is=h.return}}function J$(c,h,p){var g=p.flags;switch(p.tag){case 0:case 11:case 15:Tl(c,p),g&4&&em(5,p);break;case 1:if(Tl(c,p),g&4)if(c=p.stateNode,h===null)try{c.componentDidMount()}catch(L){hn(p,p.return,L)}else{var _=bu(p.type,h.memoizedProps);h=h.memoizedState;try{c.componentDidUpdate(_,h,c.__reactInternalSnapshotBeforeUpdate)}catch(L){hn(p,p.return,L)}}g&64&&H$(p),g&512&&tm(p,p.return);break;case 3:if(Tl(c,p),g&64&&(c=p.updateQueue,c!==null)){if(h=null,p.child!==null)switch(p.child.tag){case 27:case 5:h=p.child.stateNode;break;case 1:h=p.child.stateNode}try{DR(c,h)}catch(L){hn(p,p.return,L)}}break;case 27:h===null&&g&4&&Y$(p);case 26:case 5:Tl(c,p),h===null&&g&4&&K$(p),g&512&&tm(p,p.return);break;case 12:Tl(c,p);break;case 13:Tl(c,p),g&4&&tD(c,p),g&64&&(c=p.memoizedState,c!==null&&(c=c.dehydrated,c!==null&&(p=Cq.bind(null,p),zq(c,p))));break;case 22:if(g=p.memoizedState!==null||ka,!g){h=h!==null&&h.memoizedState!==null||Hn,_=ka;var C=Hn;ka=g,(Hn=h)&&!C?El(c,p,(p.subtreeFlags&8772)!==0):Tl(c,p),ka=_,Hn=C}break;case 30:break;default:Tl(c,p)}}function Z$(c){var h=c.alternate;h!==null&&(c.alternate=null,Z$(h)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(h=c.stateNode,h!==null&&fl(h)),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}var En=null,Dr=!1;function Na(c,h,p){for(p=p.child;p!==null;)eD(c,h,p),p=p.sibling}function eD(c,h,p){if(gt&&typeof gt.onCommitFiberUnmount=="function")try{gt.onCommitFiberUnmount(Wt,p)}catch{}switch(p.tag){case 26:Hn||To(p,h),Na(c,h,p),p.memoizedState?p.memoizedState.count--:p.stateNode&&(p=p.stateNode,p.parentNode.removeChild(p));break;case 27:Hn||To(p,h);var g=En,_=Dr;$l(p.type)&&(En=p.stateNode,Dr=!1),Na(c,h,p),um(p.stateNode),En=g,Dr=_;break;case 5:Hn||To(p,h);case 6:if(g=En,_=Dr,En=null,Na(c,h,p),En=g,Dr=_,En!==null)if(Dr)try{(En.nodeType===9?En.body:En.nodeName==="HTML"?En.ownerDocument.body:En).removeChild(p.stateNode)}catch(C){hn(p,h,C)}else try{En.removeChild(p.stateNode)}catch(C){hn(p,h,C)}break;case 18:En!==null&&(Dr?(c=En,zD(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,p.stateNode),bm(c)):zD(En,p.stateNode));break;case 4:g=En,_=Dr,En=p.stateNode.containerInfo,Dr=!0,Na(c,h,p),En=g,Dr=_;break;case 0:case 11:case 14:case 15:Hn||Cl(2,p,h),Hn||Cl(4,p,h),Na(c,h,p);break;case 1:Hn||(To(p,h),g=p.stateNode,typeof g.componentWillUnmount=="function"&&q$(p,h,g)),Na(c,h,p);break;case 21:Na(c,h,p);break;case 22:Hn=(g=Hn)||p.memoizedState!==null,Na(c,h,p),Hn=g;break;default:Na(c,h,p)}}function tD(c,h){if(h.memoizedState===null&&(c=h.alternate,c!==null&&(c=c.memoizedState,c!==null&&(c=c.dehydrated,c!==null))))try{bm(c)}catch(p){hn(h,h.return,p)}}function gq(c){switch(c.tag){case 13:case 19:var h=c.stateNode;return h===null&&(h=c.stateNode=new Q$),h;case 22:return c=c.stateNode,h=c._retryCache,h===null&&(h=c._retryCache=new Q$),h;default:throw Error(s(435,c.tag))}}function qS(c,h){var p=gq(c);h.forEach(function(g){var _=Tq.bind(null,c,g);p.has(g)||(p.add(g),g.then(_,_))})}function Jr(c,h){var p=h.deletions;if(p!==null)for(var g=0;g<p.length;g++){var _=p[g],C=c,L=h,B=L;e:for(;B!==null;){switch(B.tag){case 27:if($l(B.type)){En=B.stateNode,Dr=!1;break e}break;case 5:En=B.stateNode,Dr=!1;break e;case 3:case 4:En=B.stateNode.containerInfo,Dr=!0;break e}B=B.return}if(En===null)throw Error(s(160));eD(C,L,_),En=null,Dr=!1,C=_.alternate,C!==null&&(C.return=null),_.return=null}if(h.subtreeFlags&13878)for(h=h.child;h!==null;)nD(h,c),h=h.sibling}var zi=null;function nD(c,h){var p=c.alternate,g=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:Jr(h,c),Zr(c),g&4&&(Cl(3,c,c.return),em(3,c),Cl(5,c,c.return));break;case 1:Jr(h,c),Zr(c),g&512&&(Hn||p===null||To(p,p.return)),g&64&&ka&&(c=c.updateQueue,c!==null&&(g=c.callbacks,g!==null&&(p=c.shared.hiddenCallbacks,c.shared.hiddenCallbacks=p===null?g:p.concat(g))));break;case 26:var _=zi;if(Jr(h,c),Zr(c),g&512&&(Hn||p===null||To(p,p.return)),g&4){var C=p!==null?p.memoizedState:null;if(g=c.memoizedState,p===null)if(g===null)if(c.stateNode===null){e:{g=c.type,p=c.memoizedProps,_=_.ownerDocument||_;t:switch(g){case"title":C=_.getElementsByTagName("title")[0],(!C||C[qc]||C[ds]||C.namespaceURI==="http://www.w3.org/2000/svg"||C.hasAttribute("itemprop"))&&(C=_.createElement(g),_.head.insertBefore(C,_.querySelector("head > title"))),Hs(C,g,p),C[ds]=c,Wn(C),g=C;break e;case"link":var L=YD("link","href",_).get(g+(p.href||""));if(L){for(var B=0;B<L.length;B++)if(C=L[B],C.getAttribute("href")===(p.href==null||p.href===""?null:p.href)&&C.getAttribute("rel")===(p.rel==null?null:p.rel)&&C.getAttribute("title")===(p.title==null?null:p.title)&&C.getAttribute("crossorigin")===(p.crossOrigin==null?null:p.crossOrigin)){L.splice(B,1);break t}}C=_.createElement(g),Hs(C,g,p),_.head.appendChild(C);break;case"meta":if(L=YD("meta","content",_).get(g+(p.content||""))){for(B=0;B<L.length;B++)if(C=L[B],C.getAttribute("content")===(p.content==null?null:""+p.content)&&C.getAttribute("name")===(p.name==null?null:p.name)&&C.getAttribute("property")===(p.property==null?null:p.property)&&C.getAttribute("http-equiv")===(p.httpEquiv==null?null:p.httpEquiv)&&C.getAttribute("charset")===(p.charSet==null?null:p.charSet)){L.splice(B,1);break t}}C=_.createElement(g),Hs(C,g,p),_.head.appendChild(C);break;default:throw Error(s(468,g))}C[ds]=c,Wn(C),g=C}c.stateNode=g}else QD(_,c.type,c.stateNode);else c.stateNode=XD(_,g,c.memoizedProps);else C!==g?(C===null?p.stateNode!==null&&(p=p.stateNode,p.parentNode.removeChild(p)):C.count--,g===null?QD(_,c.type,c.stateNode):XD(_,g,c.memoizedProps)):g===null&&c.stateNode!==null&&jS(c,c.memoizedProps,p.memoizedProps)}break;case 27:Jr(h,c),Zr(c),g&512&&(Hn||p===null||To(p,p.return)),p!==null&&g&4&&jS(c,c.memoizedProps,p.memoizedProps);break;case 5:if(Jr(h,c),Zr(c),g&512&&(Hn||p===null||To(p,p.return)),c.flags&32){_=c.stateNode;try{di(_,"")}catch(ge){hn(c,c.return,ge)}}g&4&&c.stateNode!=null&&(_=c.memoizedProps,jS(c,_,p!==null?p.memoizedProps:_)),g&1024&&(HS=!0);break;case 6:if(Jr(h,c),Zr(c),g&4){if(c.stateNode===null)throw Error(s(162));g=c.memoizedProps,p=c.stateNode;try{p.nodeValue=g}catch(ge){hn(c,c.return,ge)}}break;case 3:if(qb=null,_=zi,zi=Gb(h.containerInfo),Jr(h,c),zi=_,Zr(c),g&4&&p!==null&&p.memoizedState.isDehydrated)try{bm(h.containerInfo)}catch(ge){hn(c,c.return,ge)}HS&&(HS=!1,sD(c));break;case 4:g=zi,zi=Gb(c.stateNode.containerInfo),Jr(h,c),Zr(c),zi=g;break;case 12:Jr(h,c),Zr(c);break;case 13:Jr(h,c),Zr(c),c.child.flags&8192&&c.memoizedState!==null!=(p!==null&&p.memoizedState!==null)&&(ZS=xt()),g&4&&(g=c.updateQueue,g!==null&&(c.updateQueue=null,qS(c,g)));break;case 22:_=c.memoizedState!==null;var q=p!==null&&p.memoizedState!==null,fe=ka,_e=Hn;if(ka=fe||_,Hn=_e||q,Jr(h,c),Hn=_e,ka=fe,Zr(c),g&8192)e:for(h=c.stateNode,h._visibility=_?h._visibility&-2:h._visibility|1,_&&(p===null||q||ka||Hn||xu(c)),p=null,h=c;;){if(h.tag===5||h.tag===26){if(p===null){q=p=h;try{if(C=q.stateNode,_)L=C.style,typeof L.setProperty=="function"?L.setProperty("display","none","important"):L.display="none";else{B=q.stateNode;var Ee=q.memoizedProps.style,me=Ee!=null&&Ee.hasOwnProperty("display")?Ee.display:null;B.style.display=me==null||typeof me=="boolean"?"":(""+me).trim()}}catch(ge){hn(q,q.return,ge)}}}else if(h.tag===6){if(p===null){q=h;try{q.stateNode.nodeValue=_?"":q.memoizedProps}catch(ge){hn(q,q.return,ge)}}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===c)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===c)break e;for(;h.sibling===null;){if(h.return===null||h.return===c)break e;p===h&&(p=null),h=h.return}p===h&&(p=null),h.sibling.return=h.return,h=h.sibling}g&4&&(g=c.updateQueue,g!==null&&(p=g.retryQueue,p!==null&&(g.retryQueue=null,qS(c,p))));break;case 19:Jr(h,c),Zr(c),g&4&&(g=c.updateQueue,g!==null&&(c.updateQueue=null,qS(c,g)));break;case 30:break;case 21:break;default:Jr(h,c),Zr(c)}}function Zr(c){var h=c.flags;if(h&2){try{for(var p,g=c.return;g!==null;){if(X$(g)){p=g;break}g=g.return}if(p==null)throw Error(s(160));switch(p.tag){case 27:var _=p.stateNode,C=WS(c);$b(c,C,_);break;case 5:var L=p.stateNode;p.flags&32&&(di(L,""),p.flags&=-33);var B=WS(c);$b(c,B,L);break;case 3:case 4:var q=p.stateNode.containerInfo,fe=WS(c);GS(c,fe,q);break;default:throw Error(s(161))}}catch(_e){hn(c,c.return,_e)}c.flags&=-3}h&4096&&(c.flags&=-4097)}function sD(c){if(c.subtreeFlags&1024)for(c=c.child;c!==null;){var h=c;sD(h),h.tag===5&&h.flags&1024&&h.stateNode.reset(),c=c.sibling}}function Tl(c,h){if(h.subtreeFlags&8772)for(h=h.child;h!==null;)J$(c,h.alternate,h),h=h.sibling}function xu(c){for(c=c.child;c!==null;){var h=c;switch(h.tag){case 0:case 11:case 14:case 15:Cl(4,h,h.return),xu(h);break;case 1:To(h,h.return);var p=h.stateNode;typeof p.componentWillUnmount=="function"&&q$(h,h.return,p),xu(h);break;case 27:um(h.stateNode);case 26:case 5:To(h,h.return),xu(h);break;case 22:h.memoizedState===null&&xu(h);break;case 30:xu(h);break;default:xu(h)}c=c.sibling}}function El(c,h,p){for(p=p&&(h.subtreeFlags&8772)!==0,h=h.child;h!==null;){var g=h.alternate,_=c,C=h,L=C.flags;switch(C.tag){case 0:case 11:case 15:El(_,C,p),em(4,C);break;case 1:if(El(_,C,p),g=C,_=g.stateNode,typeof _.componentDidMount=="function")try{_.componentDidMount()}catch(fe){hn(g,g.return,fe)}if(g=C,_=g.updateQueue,_!==null){var B=g.stateNode;try{var q=_.shared.hiddenCallbacks;if(q!==null)for(_.shared.hiddenCallbacks=null,_=0;_<q.length;_++)$R(q[_],B)}catch(fe){hn(g,g.return,fe)}}p&&L&64&&H$(C),tm(C,C.return);break;case 27:Y$(C);case 26:case 5:El(_,C,p),p&&g===null&&L&4&&K$(C),tm(C,C.return);break;case 12:El(_,C,p);break;case 13:El(_,C,p),p&&L&4&&tD(_,C);break;case 22:C.memoizedState===null&&El(_,C,p),tm(C,C.return);break;case 30:break;default:El(_,C,p)}h=h.sibling}}function KS(c,h){var p=null;c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(p=c.memoizedState.cachePool.pool),c=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(c=h.memoizedState.cachePool.pool),c!==p&&(c!=null&&c.refCount++,p!=null&&Up(p))}function XS(c,h){c=null,h.alternate!==null&&(c=h.alternate.memoizedState.cache),h=h.memoizedState.cache,h!==c&&(h.refCount++,c!=null&&Up(c))}function Eo(c,h,p,g){if(h.subtreeFlags&10256)for(h=h.child;h!==null;)rD(c,h,p,g),h=h.sibling}function rD(c,h,p,g){var _=h.flags;switch(h.tag){case 0:case 11:case 15:Eo(c,h,p,g),_&2048&&em(9,h);break;case 1:Eo(c,h,p,g);break;case 3:Eo(c,h,p,g),_&2048&&(c=null,h.alternate!==null&&(c=h.alternate.memoizedState.cache),h=h.memoizedState.cache,h!==c&&(h.refCount++,c!=null&&Up(c)));break;case 12:if(_&2048){Eo(c,h,p,g),c=h.stateNode;try{var C=h.memoizedProps,L=C.id,B=C.onPostCommit;typeof B=="function"&&B(L,h.alternate===null?"mount":"update",c.passiveEffectDuration,-0)}catch(q){hn(h,h.return,q)}}else Eo(c,h,p,g);break;case 13:Eo(c,h,p,g);break;case 23:break;case 22:C=h.stateNode,L=h.alternate,h.memoizedState!==null?C._visibility&2?Eo(c,h,p,g):nm(c,h):C._visibility&2?Eo(c,h,p,g):(C._visibility|=2,md(c,h,p,g,(h.subtreeFlags&10256)!==0)),_&2048&&KS(L,h);break;case 24:Eo(c,h,p,g),_&2048&&XS(h.alternate,h);break;default:Eo(c,h,p,g)}}function md(c,h,p,g,_){for(_=_&&(h.subtreeFlags&10256)!==0,h=h.child;h!==null;){var C=c,L=h,B=p,q=g,fe=L.flags;switch(L.tag){case 0:case 11:case 15:md(C,L,B,q,_),em(8,L);break;case 23:break;case 22:var _e=L.stateNode;L.memoizedState!==null?_e._visibility&2?md(C,L,B,q,_):nm(C,L):(_e._visibility|=2,md(C,L,B,q,_)),_&&fe&2048&&KS(L.alternate,L);break;case 24:md(C,L,B,q,_),_&&fe&2048&&XS(L.alternate,L);break;default:md(C,L,B,q,_)}h=h.sibling}}function nm(c,h){if(h.subtreeFlags&10256)for(h=h.child;h!==null;){var p=c,g=h,_=g.flags;switch(g.tag){case 22:nm(p,g),_&2048&&KS(g.alternate,g);break;case 24:nm(p,g),_&2048&&XS(g.alternate,g);break;default:nm(p,g)}h=h.sibling}}var sm=8192;function gd(c){if(c.subtreeFlags&sm)for(c=c.child;c!==null;)iD(c),c=c.sibling}function iD(c){switch(c.tag){case 26:gd(c),c.flags&sm&&c.memoizedState!==null&&t8(zi,c.memoizedState,c.memoizedProps);break;case 5:gd(c);break;case 3:case 4:var h=zi;zi=Gb(c.stateNode.containerInfo),gd(c),zi=h;break;case 22:c.memoizedState===null&&(h=c.alternate,h!==null&&h.memoizedState!==null?(h=sm,sm=16777216,gd(c),sm=h):gd(c));break;default:gd(c)}}function oD(c){var h=c.alternate;if(h!==null&&(c=h.child,c!==null)){h.child=null;do h=c.sibling,c.sibling=null,c=h;while(c!==null)}}function rm(c){var h=c.deletions;if((c.flags&16)!==0){if(h!==null)for(var p=0;p<h.length;p++){var g=h[p];Is=g,lD(g,c)}oD(c)}if(c.subtreeFlags&10256)for(c=c.child;c!==null;)aD(c),c=c.sibling}function aD(c){switch(c.tag){case 0:case 11:case 15:rm(c),c.flags&2048&&Cl(9,c,c.return);break;case 3:rm(c);break;case 12:rm(c);break;case 22:var h=c.stateNode;c.memoizedState!==null&&h._visibility&2&&(c.return===null||c.return.tag!==13)?(h._visibility&=-3,Db(c)):rm(c);break;default:rm(c)}}function Db(c){var h=c.deletions;if((c.flags&16)!==0){if(h!==null)for(var p=0;p<h.length;p++){var g=h[p];Is=g,lD(g,c)}oD(c)}for(c=c.child;c!==null;){switch(h=c,h.tag){case 0:case 11:case 15:Cl(8,h,h.return),Db(h);break;case 22:p=h.stateNode,p._visibility&2&&(p._visibility&=-3,Db(h));break;default:Db(h)}c=c.sibling}}function lD(c,h){for(;Is!==null;){var p=Is;switch(p.tag){case 0:case 11:case 15:Cl(8,p,h);break;case 23:case 22:if(p.memoizedState!==null&&p.memoizedState.cachePool!==null){var g=p.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:Up(p.memoizedState.cache)}if(g=p.child,g!==null)g.return=p,Is=g;else e:for(p=c;Is!==null;){g=Is;var _=g.sibling,C=g.return;if(Z$(g),g===p){Is=null;break e}if(_!==null){_.return=C,Is=_;break e}Is=C}}}var yq={getCacheForType:function(c){var h=ir(ms),p=h.data.get(c);return p===void 0&&(p=c(),h.data.set(c,p)),p}},bq=typeof WeakMap=="function"?WeakMap:Map,Zt=0,mn=null,vt=null,Pt=0,en=0,ei=null,Il=!1,yd=!1,YS=!1,Aa=0,Pn=0,kl=0,vu=0,QS=0,wi=0,bd=0,im=null,Or=null,JS=!1,ZS=0,Ob=1/0,Pb=null,Nl=null,Gs=0,Al=null,xd=null,vd=0,eC=0,tC=null,cD=null,om=0,nC=null;function ti(){if((Zt&2)!==0&&Pt!==0)return Pt&-Pt;if(G.T!==null){var c=ad;return c!==0?c:cC()}return hl()}function uD(){wi===0&&(wi=(Pt&536870912)===0||Gt?mp():536870912);var c=vi.current;return c!==null&&(c.flags|=32),wi}function ni(c,h,p){(c===mn&&(en===2||en===9)||c.cancelPendingCommit!==null)&&(wd(c,0),Rl(c,Pt,wi,!1)),la(c,p),((Zt&2)===0||c!==mn)&&(c===mn&&((Zt&2)===0&&(vu|=p),Pn===4&&Rl(c,Pt,wi,!1)),Io(c))}function hD(c,h,p){if((Zt&6)!==0)throw Error(s(327));var g=!p&&(h&124)===0&&(h&c.expiredLanes)===0||Hc(c,h),_=g?wq(c,h):iC(c,h,!0),C=g;do{if(_===0){yd&&!g&&Rl(c,h,0,!1);break}else{if(p=c.current.alternate,C&&!xq(p)){_=iC(c,h,!1),C=!1;continue}if(_===2){if(C=h,c.errorRecoveryDisabledLanes&C)var L=0;else L=c.pendingLanes&-536870913,L=L!==0?L:L&536870912?536870912:0;if(L!==0){h=L;e:{var B=c;_=im;var q=B.current.memoizedState.isDehydrated;if(q&&(wd(B,L).flags|=256),L=iC(B,L,!1),L!==2){if(YS&&!q){B.errorRecoveryDisabledLanes|=C,vu|=C,_=4;break e}C=Or,Or=_,C!==null&&(Or===null?Or=C:Or.push.apply(Or,C))}_=L}if(C=!1,_!==2)continue}}if(_===1){wd(c,0),Rl(c,h,0,!0);break}e:{switch(g=c,C=_,C){case 0:case 1:throw Error(s(345));case 4:if((h&4194048)!==h)break;case 6:Rl(g,h,wi,!Il);break e;case 2:Or=null;break;case 3:case 5:break;default:throw Error(s(329))}if((h&62914560)===h&&(_=ZS+300-xt(),10<_)){if(Rl(g,h,wi,!Il),Fh(g,0,!0)!==0)break e;g.timeoutHandle=UD(dD.bind(null,g,p,Or,Pb,JS,h,wi,vu,bd,Il,C,2,-0,0),_);break e}dD(g,p,Or,Pb,JS,h,wi,vu,bd,Il,C,0,-0,0)}}break}while(!0);Io(c)}function dD(c,h,p,g,_,C,L,B,q,fe,_e,Ee,me,ge){if(c.timeoutHandle=-1,Ee=h.subtreeFlags,(Ee&8192||(Ee&16785408)===16785408)&&(fm={stylesheets:null,count:0,unsuspend:e8},iD(h),Ee=n8(),Ee!==null)){c.cancelPendingCommit=Ee(xD.bind(null,c,h,C,p,g,_,L,B,q,_e,1,me,ge)),Rl(c,C,L,!fe);return}xD(c,h,C,p,g,_,L,B,q)}function xq(c){for(var h=c;;){var p=h.tag;if((p===0||p===11||p===15)&&h.flags&16384&&(p=h.updateQueue,p!==null&&(p=p.stores,p!==null)))for(var g=0;g<p.length;g++){var _=p[g],C=_.getSnapshot;_=_.value;try{if(!Yr(C(),_))return!1}catch{return!1}}if(p=h.child,h.subtreeFlags&16384&&p!==null)p.return=h,h=p;else{if(h===c)break;for(;h.sibling===null;){if(h.return===null||h.return===c)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function Rl(c,h,p,g){h&=~QS,h&=~vu,c.suspendedLanes|=h,c.pingedLanes&=~h,g&&(c.warmLanes|=h),g=c.expirationTimes;for(var _=h;0<_;){var C=31-Dn(_),L=1<<C;g[C]=-1,_&=~L}p!==0&&ho(c,p,h)}function Mb(){return(Zt&6)===0?(am(0),!1):!0}function sC(){if(vt!==null){if(en===0)var c=vt.return;else c=vt,_a=pu=null,vS(c),fd=null,Qp=0,c=vt;for(;c!==null;)G$(c.alternate,c),c=c.return;vt=null}}function wd(c,h){var p=c.timeoutHandle;p!==-1&&(c.timeoutHandle=-1,Lq(p)),p=c.cancelPendingCommit,p!==null&&(c.cancelPendingCommit=null,p()),sC(),mn=c,vt=p=xa(c.current,null),Pt=h,en=0,ei=null,Il=!1,yd=Hc(c,h),YS=!1,bd=wi=QS=vu=kl=Pn=0,Or=im=null,JS=!1,(h&8)!==0&&(h|=h&32);var g=c.entangledLanes;if(g!==0)for(c=c.entanglements,g&=h;0<g;){var _=31-Dn(g),C=1<<_;h|=c[_],g&=~C}return Aa=h,rb(),p}function fD(c,h){pt=null,G.H=Sb,h===zp||h===fb?(h=AR(),en=3):h===IR?(h=AR(),en=4):en=h===R$?8:h!==null&&typeof h=="object"&&typeof h.then=="function"?6:1,ei=h,vt===null&&(Pn=1,kb(c,gi(h,c.current)))}function pD(){var c=G.H;return G.H=Sb,c===null?Sb:c}function mD(){var c=G.A;return G.A=yq,c}function rC(){Pn=4,Il||(Pt&4194048)!==Pt&&vi.current!==null||(yd=!0),(kl&134217727)===0&&(vu&134217727)===0||mn===null||Rl(mn,Pt,wi,!1)}function iC(c,h,p){var g=Zt;Zt|=2;var _=pD(),C=mD();(mn!==c||Pt!==h)&&(Pb=null,wd(c,h)),h=!1;var L=Pn;e:do try{if(en!==0&&vt!==null){var B=vt,q=ei;switch(en){case 8:sC(),L=6;break e;case 3:case 2:case 9:case 6:vi.current===null&&(h=!0);var fe=en;if(en=0,ei=null,_d(c,B,q,fe),p&&yd){L=0;break e}break;default:fe=en,en=0,ei=null,_d(c,B,q,fe)}}vq(),L=Pn;break}catch(_e){fD(c,_e)}while(!0);return h&&c.shellSuspendCounter++,_a=pu=null,Zt=g,G.H=_,G.A=C,vt===null&&(mn=null,Pt=0,rb()),L}function vq(){for(;vt!==null;)gD(vt)}function wq(c,h){var p=Zt;Zt|=2;var g=pD(),_=mD();mn!==c||Pt!==h?(Pb=null,Ob=xt()+500,wd(c,h)):yd=Hc(c,h);e:do try{if(en!==0&&vt!==null){h=vt;var C=ei;t:switch(en){case 1:en=0,ei=null,_d(c,h,C,1);break;case 2:case 9:if(kR(C)){en=0,ei=null,yD(h);break}h=function(){en!==2&&en!==9||mn!==c||(en=7),Io(c)},C.then(h,h);break e;case 3:en=7;break e;case 4:en=5;break e;case 7:kR(C)?(en=0,ei=null,yD(h)):(en=0,ei=null,_d(c,h,C,7));break;case 5:var L=null;switch(vt.tag){case 26:L=vt.memoizedState;case 5:case 27:var B=vt;if(!L||JD(L)){en=0,ei=null;var q=B.sibling;if(q!==null)vt=q;else{var fe=B.return;fe!==null?(vt=fe,Lb(fe)):vt=null}break t}}en=0,ei=null,_d(c,h,C,5);break;case 6:en=0,ei=null,_d(c,h,C,6);break;case 8:sC(),Pn=6;break e;default:throw Error(s(462))}}_q();break}catch(_e){fD(c,_e)}while(!0);return _a=pu=null,G.H=g,G.A=_,Zt=p,vt!==null?0:(mn=null,Pt=0,rb(),Pn)}function _q(){for(;vt!==null&&!Ft();)gD(vt)}function gD(c){var h=j$(c.alternate,c,Aa);c.memoizedProps=c.pendingProps,h===null?Lb(c):vt=h}function yD(c){var h=c,p=h.alternate;switch(h.tag){case 15:case 0:h=L$(p,h,h.pendingProps,h.type,void 0,Pt);break;case 11:h=L$(p,h,h.pendingProps,h.type.render,h.ref,Pt);break;case 5:vS(h);default:G$(p,h),h=vt=bR(h,Aa),h=j$(p,h,Aa)}c.memoizedProps=c.pendingProps,h===null?Lb(c):vt=h}function _d(c,h,p,g){_a=pu=null,vS(h),fd=null,Qp=0;var _=h.return;try{if(hq(c,_,h,p,Pt)){Pn=1,kb(c,gi(p,c.current)),vt=null;return}}catch(C){if(_!==null)throw vt=_,C;Pn=1,kb(c,gi(p,c.current)),vt=null;return}h.flags&32768?(Gt||g===1?c=!0:yd||(Pt&536870912)!==0?c=!1:(Il=c=!0,(g===2||g===9||g===3||g===6)&&(g=vi.current,g!==null&&g.tag===13&&(g.flags|=16384))),bD(h,c)):Lb(h)}function Lb(c){var h=c;do{if((h.flags&32768)!==0){bD(h,Il);return}c=h.return;var p=fq(h.alternate,h,Aa);if(p!==null){vt=p;return}if(h=h.sibling,h!==null){vt=h;return}vt=h=c}while(h!==null);Pn===0&&(Pn=5)}function bD(c,h){do{var p=pq(c.alternate,c);if(p!==null){p.flags&=32767,vt=p;return}if(p=c.return,p!==null&&(p.flags|=32768,p.subtreeFlags=0,p.deletions=null),!h&&(c=c.sibling,c!==null)){vt=c;return}vt=c=p}while(c!==null);Pn=6,vt=null}function xD(c,h,p,g,_,C,L,B,q){c.cancelPendingCommit=null;do Fb();while(Gs!==0);if((Zt&6)!==0)throw Error(s(327));if(h!==null){if(h===c.current)throw Error(s(177));if(C=h.lanes|h.childLanes,C|=X1,yp(c,p,C,L,B,q),c===mn&&(vt=mn=null,Pt=0),xd=h,Al=c,vd=p,eC=C,tC=_,cD=g,(h.subtreeFlags&10256)!==0||(h.flags&10256)!==0?(c.callbackNode=null,c.callbackPriority=0,Eq(rr,function(){return CD(),null})):(c.callbackNode=null,c.callbackPriority=0),g=(h.flags&13878)!==0,(h.subtreeFlags&13878)!==0||g){g=G.T,G.T=null,_=K.p,K.p=2,L=Zt,Zt|=4;try{mq(c,h,p)}finally{Zt=L,K.p=_,G.T=g}}Gs=1,vD(),wD(),_D()}}function vD(){if(Gs===1){Gs=0;var c=Al,h=xd,p=(h.flags&13878)!==0;if((h.subtreeFlags&13878)!==0||p){p=G.T,G.T=null;var g=K.p;K.p=2;var _=Zt;Zt|=4;try{nD(h,c);var C=yC,L=lR(c.containerInfo),B=C.focusedElem,q=C.selectionRange;if(L!==B&&B&&B.ownerDocument&&aR(B.ownerDocument.documentElement,B)){if(q!==null&&W1(B)){var fe=q.start,_e=q.end;if(_e===void 0&&(_e=fe),"selectionStart"in B)B.selectionStart=fe,B.selectionEnd=Math.min(_e,B.value.length);else{var Ee=B.ownerDocument||document,me=Ee&&Ee.defaultView||window;if(me.getSelection){var ge=me.getSelection(),nt=B.textContent.length,Ye=Math.min(q.start,nt),ln=q.end===void 0?Ye:Math.min(q.end,nt);!ge.extend&&Ye>ln&&(L=ln,ln=Ye,Ye=L);var le=oR(B,Ye),Z=oR(B,ln);if(le&&Z&&(ge.rangeCount!==1||ge.anchorNode!==le.node||ge.anchorOffset!==le.offset||ge.focusNode!==Z.node||ge.focusOffset!==Z.offset)){var he=Ee.createRange();he.setStart(le.node,le.offset),ge.removeAllRanges(),Ye>ln?(ge.addRange(he),ge.extend(Z.node,Z.offset)):(he.setEnd(Z.node,Z.offset),ge.addRange(he))}}}}for(Ee=[],ge=B;ge=ge.parentNode;)ge.nodeType===1&&Ee.push({element:ge,left:ge.scrollLeft,top:ge.scrollTop});for(typeof B.focus=="function"&&B.focus(),B=0;B<Ee.length;B++){var Ce=Ee[B];Ce.element.scrollLeft=Ce.left,Ce.element.scrollTop=Ce.top}}Yb=!!gC,yC=gC=null}finally{Zt=_,K.p=g,G.T=p}}c.current=h,Gs=2}}function wD(){if(Gs===2){Gs=0;var c=Al,h=xd,p=(h.flags&8772)!==0;if((h.subtreeFlags&8772)!==0||p){p=G.T,G.T=null;var g=K.p;K.p=2;var _=Zt;Zt|=4;try{J$(c,h.alternate,h)}finally{Zt=_,K.p=g,G.T=p}}Gs=3}}function _D(){if(Gs===4||Gs===3){Gs=0,$t();var c=Al,h=xd,p=vd,g=cD;(h.subtreeFlags&10256)!==0||(h.flags&10256)!==0?Gs=5:(Gs=0,xd=Al=null,SD(c,c.pendingLanes));var _=c.pendingLanes;if(_===0&&(Nl=null),Vh(p),h=h.stateNode,gt&&typeof gt.onCommitFiberRoot=="function")try{gt.onCommitFiberRoot(Wt,h,void 0,(h.current.flags&128)===128)}catch{}if(g!==null){h=G.T,_=K.p,K.p=2,G.T=null;try{for(var C=c.onRecoverableError,L=0;L<g.length;L++){var B=g[L];C(B.value,{componentStack:B.stack})}}finally{G.T=h,K.p=_}}(vd&3)!==0&&Fb(),Io(c),_=c.pendingLanes,(p&4194090)!==0&&(_&42)!==0?c===nC?om++:(om=0,nC=c):om=0,am(0)}}function SD(c,h){(c.pooledCacheLanes&=h)===0&&(h=c.pooledCache,h!=null&&(c.pooledCache=null,Up(h)))}function Fb(c){return vD(),wD(),_D(),CD()}function CD(){if(Gs!==5)return!1;var c=Al,h=eC;eC=0;var p=Vh(vd),g=G.T,_=K.p;try{K.p=32>p?32:p,G.T=null,p=tC,tC=null;var C=Al,L=vd;if(Gs=0,xd=Al=null,vd=0,(Zt&6)!==0)throw Error(s(331));var B=Zt;if(Zt|=4,aD(C.current),rD(C,C.current,L,p),Zt=B,am(0,!1),gt&&typeof gt.onPostCommitFiberRoot=="function")try{gt.onPostCommitFiberRoot(Wt,C)}catch{}return!0}finally{K.p=_,G.T=g,SD(c,h)}}function TD(c,h,p){h=gi(p,h),h=OS(c.stateNode,h,2),c=vl(c,h,2),c!==null&&(la(c,2),Io(c))}function hn(c,h,p){if(c.tag===3)TD(c,c,p);else for(;h!==null;){if(h.tag===3){TD(h,c,p);break}else if(h.tag===1){var g=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(Nl===null||!Nl.has(g))){c=gi(p,c),p=N$(2),g=vl(h,p,2),g!==null&&(A$(p,g,h,c),la(g,2),Io(g));break}}h=h.return}}function oC(c,h,p){var g=c.pingCache;if(g===null){g=c.pingCache=new bq;var _=new Set;g.set(h,_)}else _=g.get(h),_===void 0&&(_=new Set,g.set(h,_));_.has(p)||(YS=!0,_.add(p),c=Sq.bind(null,c,h,p),h.then(c,c))}function Sq(c,h,p){var g=c.pingCache;g!==null&&g.delete(h),c.pingedLanes|=c.suspendedLanes&p,c.warmLanes&=~p,mn===c&&(Pt&p)===p&&(Pn===4||Pn===3&&(Pt&62914560)===Pt&&300>xt()-ZS?(Zt&2)===0&&wd(c,0):QS|=p,bd===Pt&&(bd=0)),Io(c)}function ED(c,h){h===0&&(h=gp()),c=sd(c,h),c!==null&&(la(c,h),Io(c))}function Cq(c){var h=c.memoizedState,p=0;h!==null&&(p=h.retryLane),ED(c,p)}function Tq(c,h){var p=0;switch(c.tag){case 13:var g=c.stateNode,_=c.memoizedState;_!==null&&(p=_.retryLane);break;case 19:g=c.stateNode;break;case 22:g=c.stateNode._retryCache;break;default:throw Error(s(314))}g!==null&&g.delete(h),ED(c,p)}function Eq(c,h){return kt(c,h)}var Vb=null,Sd=null,aC=!1,Ub=!1,lC=!1,wu=0;function Io(c){c!==Sd&&c.next===null&&(Sd===null?Vb=Sd=c:Sd=Sd.next=c),Ub=!0,aC||(aC=!0,kq())}function am(c,h){if(!lC&&Ub){lC=!0;do for(var p=!1,g=Vb;g!==null;){if(c!==0){var _=g.pendingLanes;if(_===0)var C=0;else{var L=g.suspendedLanes,B=g.pingedLanes;C=(1<<31-Dn(42|c)+1)-1,C&=_&~(L&~B),C=C&201326741?C&201326741|1:C?C|2:0}C!==0&&(p=!0,AD(g,C))}else C=Pt,C=Fh(g,g===mn?C:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(C&3)===0||Hc(g,C)||(p=!0,AD(g,C));g=g.next}while(p);lC=!1}}function Iq(){ID()}function ID(){Ub=aC=!1;var c=0;wu!==0&&(Mq()&&(c=wu),wu=0);for(var h=xt(),p=null,g=Vb;g!==null;){var _=g.next,C=kD(g,h);C===0?(g.next=null,p===null?Vb=_:p.next=_,_===null&&(Sd=p)):(p=g,(c!==0||(C&3)!==0)&&(Ub=!0)),g=_}am(c)}function kD(c,h){for(var p=c.suspendedLanes,g=c.pingedLanes,_=c.expirationTimes,C=c.pendingLanes&-62914561;0<C;){var L=31-Dn(C),B=1<<L,q=_[L];q===-1?((B&p)===0||(B&g)!==0)&&(_[L]=pp(B,h)):q<=h&&(c.expiredLanes|=B),C&=~B}if(h=mn,p=Pt,p=Fh(c,c===h?p:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),g=c.callbackNode,p===0||c===h&&(en===2||en===9)||c.cancelPendingCommit!==null)return g!==null&&g!==null&&jt(g),c.callbackNode=null,c.callbackPriority=0;if((p&3)===0||Hc(c,p)){if(h=p&-p,h===c.callbackPriority)return h;switch(g!==null&&jt(g),Vh(p)){case 2:case 8:p=wn;break;case 32:p=rr;break;case 268435456:p=Ar;break;default:p=rr}return g=ND.bind(null,c),p=kt(p,g),c.callbackPriority=h,c.callbackNode=p,h}return g!==null&&g!==null&&jt(g),c.callbackPriority=2,c.callbackNode=null,2}function ND(c,h){if(Gs!==0&&Gs!==5)return c.callbackNode=null,c.callbackPriority=0,null;var p=c.callbackNode;if(Fb()&&c.callbackNode!==p)return null;var g=Pt;return g=Fh(c,c===mn?g:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),g===0?null:(hD(c,g,h),kD(c,xt()),c.callbackNode!=null&&c.callbackNode===p?ND.bind(null,c):null)}function AD(c,h){if(Fb())return null;hD(c,h,!0)}function kq(){Fq(function(){(Zt&6)!==0?kt(br,Iq):ID()})}function cC(){return wu===0&&(wu=mp()),wu}function RD(c){return c==null||typeof c=="symbol"||typeof c=="boolean"?null:typeof c=="function"?c:Gh(""+c)}function $D(c,h){var p=h.ownerDocument.createElement("input");return p.name=h.name,p.value=h.value,c.id&&p.setAttribute("form",c.id),h.parentNode.insertBefore(p,h),c=new FormData(c),p.parentNode.removeChild(p),c}function Nq(c,h,p,g,_){if(h==="submit"&&p&&p.stateNode===_){var C=RD((_[Yn]||null).action),L=g.submitter;L&&(h=(h=L[Yn]||null)?RD(h.formAction):L.getAttribute("formAction"),h!==null&&(C=h,L=null));var B=new Hh("action","action",null,g,_);c.push({event:B,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(wu!==0){var q=L?$D(_,L):new FormData(_);NS(p,{pending:!0,data:q,method:_.method,action:C},null,q)}}else typeof C=="function"&&(B.preventDefault(),q=L?$D(_,L):new FormData(_),NS(p,{pending:!0,data:q,method:_.method,action:C},C,q))},currentTarget:_}]})}}for(var uC=0;uC<K1.length;uC++){var hC=K1[uC],Aq=hC.toLowerCase(),Rq=hC[0].toUpperCase()+hC.slice(1);Bi(Aq,"on"+Rq)}Bi(hR,"onAnimationEnd"),Bi(dR,"onAnimationIteration"),Bi(fR,"onAnimationStart"),Bi("dblclick","onDoubleClick"),Bi("focusin","onFocus"),Bi("focusout","onBlur"),Bi(KH,"onTransitionRun"),Bi(XH,"onTransitionStart"),Bi(YH,"onTransitionCancel"),Bi(pR,"onTransitionEnd"),ua("onMouseEnter",["mouseout","mouseover"]),ua("onMouseLeave",["mouseout","mouseover"]),ua("onPointerEnter",["pointerout","pointerover"]),ua("onPointerLeave",["pointerout","pointerover"]),Vi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Vi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Vi("onBeforeInput",["compositionend","keypress","textInput","paste"]),Vi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Vi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Vi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lm="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$q=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(lm));function DD(c,h){h=(h&4)!==0;for(var p=0;p<c.length;p++){var g=c[p],_=g.event;g=g.listeners;e:{var C=void 0;if(h)for(var L=g.length-1;0<=L;L--){var B=g[L],q=B.instance,fe=B.currentTarget;if(B=B.listener,q!==C&&_.isPropagationStopped())break e;C=B,_.currentTarget=fe;try{C(_)}catch(_e){Ib(_e)}_.currentTarget=null,C=q}else for(L=0;L<g.length;L++){if(B=g[L],q=B.instance,fe=B.currentTarget,B=B.listener,q!==C&&_.isPropagationStopped())break e;C=B,_.currentTarget=fe;try{C(_)}catch(_e){Ib(_e)}_.currentTarget=null,C=q}}}}function wt(c,h){var p=h[xp];p===void 0&&(p=h[xp]=new Set);var g=c+"__bubble";p.has(g)||(OD(h,c,2,!1),p.add(g))}function dC(c,h,p){var g=0;h&&(g|=4),OD(p,c,g,h)}var Bb="_reactListening"+Math.random().toString(36).slice(2);function fC(c){if(!c[Bb]){c[Bb]=!0,vp.forEach(function(p){p!=="selectionchange"&&($q.has(p)||dC(p,!1,c),dC(p,!0,c))});var h=c.nodeType===9?c:c.ownerDocument;h===null||h[Bb]||(h[Bb]=!0,dC("selectionchange",!1,h))}}function OD(c,h,p,g){switch(rO(h)){case 2:var _=i8;break;case 8:_=o8;break;default:_=IC}p=_.bind(null,h,p,c),_=void 0,!pi||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(_=!0),g?_!==void 0?c.addEventListener(h,p,{capture:!0,passive:_}):c.addEventListener(h,p,!0):_!==void 0?c.addEventListener(h,p,{passive:_}):c.addEventListener(h,p,!1)}function pC(c,h,p,g,_){var C=g;if((h&1)===0&&(h&2)===0&&g!==null)e:for(;;){if(g===null)return;var L=g.tag;if(L===3||L===4){var B=g.stateNode.containerInfo;if(B===_)break;if(L===4)for(L=g.return;L!==null;){var q=L.tag;if((q===3||q===4)&&L.stateNode.containerInfo===_)return;L=L.return}for(;B!==null;){if(L=ca(B),L===null)return;if(q=L.tag,q===5||q===6||q===26||q===27){g=C=L;continue e}B=B.parentNode}}g=g.return}j0(function(){var fe=C,_e=fi(p),Ee=[];e:{var me=mR.get(c);if(me!==void 0){var ge=Hh,nt=c;switch(c){case"keypress":if(bo(p)===0)break e;case"keydown":case"keyup":ge=Jh;break;case"focusin":nt="focus",ge=Xh;break;case"focusout":nt="blur",ge=Xh;break;case"beforeblur":case"afterblur":ge=Xh;break;case"click":if(p.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ge=mi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ge=U1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ge=Q0;break;case hR:case dR:case fR:ge=Yh;break;case pR:ge=Z0;break;case"scroll":case"scrollend":ge=W0;break;case"wheel":ge=Zh;break;case"copy":case"cut":case"paste":ge=Qh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ge=$p;break;case"toggle":case"beforetoggle":ge=tb}var Ye=(h&4)!==0,ln=!Ye&&(c==="scroll"||c==="scrollend"),le=Ye?me!==null?me+"Capture":null:me;Ye=[];for(var Z=fe,he;Z!==null;){var Ce=Z;if(he=Ce.stateNode,Ce=Ce.tag,Ce!==5&&Ce!==26&&Ce!==27||he===null||le===null||(Ce=eu(Z,le),Ce!=null&&Ye.push(cm(Z,Ce,he))),ln)break;Z=Z.return}0<Ye.length&&(me=new ge(me,nt,null,p,_e),Ee.push({event:me,listeners:Ye}))}}if((h&7)===0){e:{if(me=c==="mouseover"||c==="pointerover",ge=c==="mouseout"||c==="pointerout",me&&p!==fa&&(nt=p.relatedTarget||p.fromElement)&&(ca(nt)||nt[hi]))break e;if((ge||me)&&(me=_e.window===_e?_e:(me=_e.ownerDocument)?me.defaultView||me.parentWindow:window,ge?(nt=p.relatedTarget||p.toElement,ge=fe,nt=nt?ca(nt):null,nt!==null&&(ln=i(nt),Ye=nt.tag,nt!==ln||Ye!==5&&Ye!==27&&Ye!==6)&&(nt=null)):(ge=null,nt=fe),ge!==nt)){if(Ye=mi,Ce="onMouseLeave",le="onMouseEnter",Z="mouse",(c==="pointerout"||c==="pointerover")&&(Ye=$p,Ce="onPointerLeave",le="onPointerEnter",Z="pointer"),ln=ge==null?me:po(ge),he=nt==null?me:po(nt),me=new Ye(Ce,Z+"leave",ge,p,_e),me.target=ln,me.relatedTarget=he,Ce=null,ca(_e)===fe&&(Ye=new Ye(le,Z+"enter",nt,p,_e),Ye.target=he,Ye.relatedTarget=ln,Ce=Ye),ln=Ce,ge&&nt)t:{for(Ye=ge,le=nt,Z=0,he=Ye;he;he=Cd(he))Z++;for(he=0,Ce=le;Ce;Ce=Cd(Ce))he++;for(;0<Z-he;)Ye=Cd(Ye),Z--;for(;0<he-Z;)le=Cd(le),he--;for(;Z--;){if(Ye===le||le!==null&&Ye===le.alternate)break t;Ye=Cd(Ye),le=Cd(le)}Ye=null}else Ye=null;ge!==null&&PD(Ee,me,ge,Ye,!1),nt!==null&&ln!==null&&PD(Ee,ln,nt,Ye,!0)}}e:{if(me=fe?po(fe):window,ge=me.nodeName&&me.nodeName.toLowerCase(),ge==="select"||ge==="input"&&me.type==="file")var Be=eR;else if(ps(me))if(tR)Be=GH;else{Be=jH;var yt=zH}else ge=me.nodeName,!ge||ge.toLowerCase()!=="input"||me.type!=="checkbox"&&me.type!=="radio"?fe&&Tp(fe.elementType)&&(Be=eR):Be=WH;if(Be&&(Be=Be(c,fe))){ba(Ee,Be,p,_e);break e}yt&&yt(c,me,fe),c==="focusout"&&fe&&me.type==="number"&&fe.memoizedProps.value!=null&&ml(me,"number",me.value)}switch(yt=fe?po(fe):window,c){case"focusin":(ps(yt)||yt.contentEditable==="true")&&(ed=yt,G1=fe,Pp=null);break;case"focusout":Pp=G1=ed=null;break;case"mousedown":H1=!0;break;case"contextmenu":case"mouseup":case"dragend":H1=!1,cR(Ee,p,_e);break;case"selectionchange":if(qH)break;case"keydown":case"keyup":cR(Ee,p,_e)}var We;if(wo)e:{switch(c){case"compositionstart":var Je="onCompositionStart";break e;case"compositionend":Je="onCompositionEnd";break e;case"compositionupdate":Je="onCompositionUpdate";break e}Je=void 0}else Dt?be(c,p)&&(Je="onCompositionEnd"):c==="keydown"&&p.keyCode===229&&(Je="onCompositionStart");Je&&(M&&p.locale!=="ko"&&(Dt||Je!=="onCompositionStart"?Je==="onCompositionEnd"&&Dt&&(We=Ip()):(yo=_e,gl="value"in yo?yo.value:yo.textContent,Dt=!0)),yt=zb(fe,Je),0<yt.length&&(Je=new Ap(Je,c,null,p,_e),Ee.push({event:Je,listeners:yt}),We?Je.data=We:(We=Re(p),We!==null&&(Je.data=We)))),(We=N?fs(c,p):Ot(c,p))&&(Je=zb(fe,"onBeforeInput"),0<Je.length&&(yt=new Ap("onBeforeInput","beforeinput",null,p,_e),Ee.push({event:yt,listeners:Je}),yt.data=We)),Nq(Ee,c,fe,p,_e)}DD(Ee,h)})}function cm(c,h,p){return{instance:c,listener:h,currentTarget:p}}function zb(c,h){for(var p=h+"Capture",g=[];c!==null;){var _=c,C=_.stateNode;if(_=_.tag,_!==5&&_!==26&&_!==27||C===null||(_=eu(c,p),_!=null&&g.unshift(cm(c,_,C)),_=eu(c,h),_!=null&&g.push(cm(c,_,C))),c.tag===3)return g;c=c.return}return[]}function Cd(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5&&c.tag!==27);return c||null}function PD(c,h,p,g,_){for(var C=h._reactName,L=[];p!==null&&p!==g;){var B=p,q=B.alternate,fe=B.stateNode;if(B=B.tag,q!==null&&q===g)break;B!==5&&B!==26&&B!==27||fe===null||(q=fe,_?(fe=eu(p,C),fe!=null&&L.unshift(cm(p,fe,q))):_||(fe=eu(p,C),fe!=null&&L.push(cm(p,fe,q)))),p=p.return}L.length!==0&&c.push({event:h,listeners:L})}var Dq=/\r\n?/g,Oq=/\u0000|\uFFFD/g;function MD(c){return(typeof c=="string"?c:""+c).replace(Dq,`
`).replace(Oq,"")}function LD(c,h){return h=MD(h),MD(c)===h}function jb(){}function an(c,h,p,g,_,C){switch(p){case"children":typeof g=="string"?h==="body"||h==="textarea"&&g===""||di(c,g):(typeof g=="number"||typeof g=="bigint")&&h!=="body"&&di(c,""+g);break;case"className":mo(c,"class",g);break;case"tabIndex":mo(c,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":mo(c,p,g);break;case"style":Cp(c,g,C);break;case"data":if(h!=="object"){mo(c,"data",g);break}case"src":case"href":if(g===""&&(h!=="a"||p!=="href")){c.removeAttribute(p);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){c.removeAttribute(p);break}g=Gh(""+g),c.setAttribute(p,g);break;case"action":case"formAction":if(typeof g=="function"){c.setAttribute(p,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof C=="function"&&(p==="formAction"?(h!=="input"&&an(c,h,"name",_.name,_,null),an(c,h,"formEncType",_.formEncType,_,null),an(c,h,"formMethod",_.formMethod,_,null),an(c,h,"formTarget",_.formTarget,_,null)):(an(c,h,"encType",_.encType,_,null),an(c,h,"method",_.method,_,null),an(c,h,"target",_.target,_,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){c.removeAttribute(p);break}g=Gh(""+g),c.setAttribute(p,g);break;case"onClick":g!=null&&(c.onclick=jb);break;case"onScroll":g!=null&&wt("scroll",c);break;case"onScrollEnd":g!=null&&wt("scrollend",c);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(s(61));if(p=g.__html,p!=null){if(_.children!=null)throw Error(s(60));c.innerHTML=p}}break;case"multiple":c.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":c.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){c.removeAttribute("xlink:href");break}p=Gh(""+g),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",p);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?c.setAttribute(p,""+g):c.removeAttribute(p);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?c.setAttribute(p,""):c.removeAttribute(p);break;case"capture":case"download":g===!0?c.setAttribute(p,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?c.setAttribute(p,g):c.removeAttribute(p);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?c.setAttribute(p,g):c.removeAttribute(p);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?c.removeAttribute(p):c.setAttribute(p,g);break;case"popover":wt("beforetoggle",c),wt("toggle",c),pl(c,"popover",g);break;case"xlinkActuate":zs(c,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":zs(c,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":zs(c,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":zs(c,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":zs(c,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":zs(c,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":zs(c,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":zs(c,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":zs(c,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":pl(c,"is",g);break;case"innerText":case"textContent":break;default:(!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N")&&(p=F1.get(p)||p,pl(c,p,g))}}function mC(c,h,p,g,_,C){switch(p){case"style":Cp(c,g,C);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(s(61));if(p=g.__html,p!=null){if(_.children!=null)throw Error(s(60));c.innerHTML=p}}break;case"children":typeof g=="string"?di(c,g):(typeof g=="number"||typeof g=="bigint")&&di(c,""+g);break;case"onScroll":g!=null&&wt("scroll",c);break;case"onScrollEnd":g!=null&&wt("scrollend",c);break;case"onClick":g!=null&&(c.onclick=jb);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Uh.hasOwnProperty(p))e:{if(p[0]==="o"&&p[1]==="n"&&(_=p.endsWith("Capture"),h=p.slice(2,_?p.length-7:void 0),C=c[Yn]||null,C=C!=null?C[p]:null,typeof C=="function"&&c.removeEventListener(h,C,_),typeof g=="function")){typeof C!="function"&&C!==null&&(p in c?c[p]=null:c.hasAttribute(p)&&c.removeAttribute(p)),c.addEventListener(h,g,_);break e}p in c?c[p]=g:g===!0?c.setAttribute(p,""):pl(c,p,g)}}}function Hs(c,h,p){switch(h){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":wt("error",c),wt("load",c);var g=!1,_=!1,C;for(C in p)if(p.hasOwnProperty(C)){var L=p[C];if(L!=null)switch(C){case"src":g=!0;break;case"srcSet":_=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,h));default:an(c,h,C,L,p,null)}}_&&an(c,h,"srcSet",p.srcSet,p,null),g&&an(c,h,"src",p.src,p,null);return;case"input":wt("invalid",c);var B=C=L=_=null,q=null,fe=null;for(g in p)if(p.hasOwnProperty(g)){var _e=p[g];if(_e!=null)switch(g){case"name":_=_e;break;case"type":L=_e;break;case"checked":q=_e;break;case"defaultChecked":fe=_e;break;case"value":C=_e;break;case"defaultValue":B=_e;break;case"children":case"dangerouslySetInnerHTML":if(_e!=null)throw Error(s(137,h));break;default:an(c,h,g,_e,p,null)}}Qc(c,C,B,q,fe,L,_,!1),Wh(c);return;case"select":wt("invalid",c),g=L=C=null;for(_ in p)if(p.hasOwnProperty(_)&&(B=p[_],B!=null))switch(_){case"value":C=B;break;case"defaultValue":L=B;break;case"multiple":g=B;default:an(c,h,_,B,p,null)}h=C,p=L,c.multiple=!!g,h!=null?da(c,!!g,h,!1):p!=null&&da(c,!!g,p,!0);return;case"textarea":wt("invalid",c),C=_=g=null;for(L in p)if(p.hasOwnProperty(L)&&(B=p[L],B!=null))switch(L){case"value":g=B;break;case"defaultValue":_=B;break;case"children":C=B;break;case"dangerouslySetInnerHTML":if(B!=null)throw Error(s(91));break;default:an(c,h,L,B,p,null)}Jc(c,g,_,C),Wh(c);return;case"option":for(q in p)if(p.hasOwnProperty(q)&&(g=p[q],g!=null))switch(q){case"selected":c.selected=g&&typeof g!="function"&&typeof g!="symbol";break;default:an(c,h,q,g,p,null)}return;case"dialog":wt("beforetoggle",c),wt("toggle",c),wt("cancel",c),wt("close",c);break;case"iframe":case"object":wt("load",c);break;case"video":case"audio":for(g=0;g<lm.length;g++)wt(lm[g],c);break;case"image":wt("error",c),wt("load",c);break;case"details":wt("toggle",c);break;case"embed":case"source":case"link":wt("error",c),wt("load",c);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(fe in p)if(p.hasOwnProperty(fe)&&(g=p[fe],g!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,h));default:an(c,h,fe,g,p,null)}return;default:if(Tp(h)){for(_e in p)p.hasOwnProperty(_e)&&(g=p[_e],g!==void 0&&mC(c,h,_e,g,p,void 0));return}}for(B in p)p.hasOwnProperty(B)&&(g=p[B],g!=null&&an(c,h,B,g,p,null))}function Pq(c,h,p,g){switch(h){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var _=null,C=null,L=null,B=null,q=null,fe=null,_e=null;for(ge in p){var Ee=p[ge];if(p.hasOwnProperty(ge)&&Ee!=null)switch(ge){case"checked":break;case"value":break;case"defaultValue":q=Ee;default:g.hasOwnProperty(ge)||an(c,h,ge,null,g,Ee)}}for(var me in g){var ge=g[me];if(Ee=p[me],g.hasOwnProperty(me)&&(ge!=null||Ee!=null))switch(me){case"type":C=ge;break;case"name":_=ge;break;case"checked":fe=ge;break;case"defaultChecked":_e=ge;break;case"value":L=ge;break;case"defaultValue":B=ge;break;case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(s(137,h));break;default:ge!==Ee&&an(c,h,me,ge,g,Ee)}}Xr(c,L,B,q,fe,_e,C,_);return;case"select":ge=L=B=me=null;for(C in p)if(q=p[C],p.hasOwnProperty(C)&&q!=null)switch(C){case"value":break;case"multiple":ge=q;default:g.hasOwnProperty(C)||an(c,h,C,null,g,q)}for(_ in g)if(C=g[_],q=p[_],g.hasOwnProperty(_)&&(C!=null||q!=null))switch(_){case"value":me=C;break;case"defaultValue":B=C;break;case"multiple":L=C;default:C!==q&&an(c,h,_,C,g,q)}h=B,p=L,g=ge,me!=null?da(c,!!p,me,!1):!!g!=!!p&&(h!=null?da(c,!!p,h,!0):da(c,!!p,p?[]:"",!1));return;case"textarea":ge=me=null;for(B in p)if(_=p[B],p.hasOwnProperty(B)&&_!=null&&!g.hasOwnProperty(B))switch(B){case"value":break;case"children":break;default:an(c,h,B,null,g,_)}for(L in g)if(_=g[L],C=p[L],g.hasOwnProperty(L)&&(_!=null||C!=null))switch(L){case"value":me=_;break;case"defaultValue":ge=_;break;case"children":break;case"dangerouslySetInnerHTML":if(_!=null)throw Error(s(91));break;default:_!==C&&an(c,h,L,_,g,C)}rn(c,me,ge);return;case"option":for(var nt in p)if(me=p[nt],p.hasOwnProperty(nt)&&me!=null&&!g.hasOwnProperty(nt))switch(nt){case"selected":c.selected=!1;break;default:an(c,h,nt,null,g,me)}for(q in g)if(me=g[q],ge=p[q],g.hasOwnProperty(q)&&me!==ge&&(me!=null||ge!=null))switch(q){case"selected":c.selected=me&&typeof me!="function"&&typeof me!="symbol";break;default:an(c,h,q,me,g,ge)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ye in p)me=p[Ye],p.hasOwnProperty(Ye)&&me!=null&&!g.hasOwnProperty(Ye)&&an(c,h,Ye,null,g,me);for(fe in g)if(me=g[fe],ge=p[fe],g.hasOwnProperty(fe)&&me!==ge&&(me!=null||ge!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":if(me!=null)throw Error(s(137,h));break;default:an(c,h,fe,me,g,ge)}return;default:if(Tp(h)){for(var ln in p)me=p[ln],p.hasOwnProperty(ln)&&me!==void 0&&!g.hasOwnProperty(ln)&&mC(c,h,ln,void 0,g,me);for(_e in g)me=g[_e],ge=p[_e],!g.hasOwnProperty(_e)||me===ge||me===void 0&&ge===void 0||mC(c,h,_e,me,g,ge);return}}for(var le in p)me=p[le],p.hasOwnProperty(le)&&me!=null&&!g.hasOwnProperty(le)&&an(c,h,le,null,g,me);for(Ee in g)me=g[Ee],ge=p[Ee],!g.hasOwnProperty(Ee)||me===ge||me==null&&ge==null||an(c,h,Ee,me,g,ge)}var gC=null,yC=null;function Wb(c){return c.nodeType===9?c:c.ownerDocument}function FD(c){switch(c){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function VD(c,h){if(c===0)switch(h){case"svg":return 1;case"math":return 2;default:return 0}return c===1&&h==="foreignObject"?0:c}function bC(c,h){return c==="textarea"||c==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.children=="bigint"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var xC=null;function Mq(){var c=window.event;return c&&c.type==="popstate"?c===xC?!1:(xC=c,!0):(xC=null,!1)}var UD=typeof setTimeout=="function"?setTimeout:void 0,Lq=typeof clearTimeout=="function"?clearTimeout:void 0,BD=typeof Promise=="function"?Promise:void 0,Fq=typeof queueMicrotask=="function"?queueMicrotask:typeof BD<"u"?function(c){return BD.resolve(null).then(c).catch(Vq)}:UD;function Vq(c){setTimeout(function(){throw c})}function $l(c){return c==="head"}function zD(c,h){var p=h,g=0,_=0;do{var C=p.nextSibling;if(c.removeChild(p),C&&C.nodeType===8)if(p=C.data,p==="/$"){if(0<g&&8>g){p=g;var L=c.ownerDocument;if(p&1&&um(L.documentElement),p&2&&um(L.body),p&4)for(p=L.head,um(p),L=p.firstChild;L;){var B=L.nextSibling,q=L.nodeName;L[qc]||q==="SCRIPT"||q==="STYLE"||q==="LINK"&&L.rel.toLowerCase()==="stylesheet"||p.removeChild(L),L=B}}if(_===0){c.removeChild(C),bm(h);return}_--}else p==="$"||p==="$?"||p==="$!"?_++:g=p.charCodeAt(0)-48;else g=0;p=C}while(p);bm(h)}function vC(c){var h=c.firstChild;for(h&&h.nodeType===10&&(h=h.nextSibling);h;){var p=h;switch(h=h.nextSibling,p.nodeName){case"HTML":case"HEAD":case"BODY":vC(p),fl(p);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(p.rel.toLowerCase()==="stylesheet")continue}c.removeChild(p)}}function Uq(c,h,p,g){for(;c.nodeType===1;){var _=p;if(c.nodeName.toLowerCase()!==h.toLowerCase()){if(!g&&(c.nodeName!=="INPUT"||c.type!=="hidden"))break}else if(g){if(!c[qc])switch(h){case"meta":if(!c.hasAttribute("itemprop"))break;return c;case"link":if(C=c.getAttribute("rel"),C==="stylesheet"&&c.hasAttribute("data-precedence"))break;if(C!==_.rel||c.getAttribute("href")!==(_.href==null||_.href===""?null:_.href)||c.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin)||c.getAttribute("title")!==(_.title==null?null:_.title))break;return c;case"style":if(c.hasAttribute("data-precedence"))break;return c;case"script":if(C=c.getAttribute("src"),(C!==(_.src==null?null:_.src)||c.getAttribute("type")!==(_.type==null?null:_.type)||c.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin))&&C&&c.hasAttribute("async")&&!c.hasAttribute("itemprop"))break;return c;default:return c}}else if(h==="input"&&c.type==="hidden"){var C=_.name==null?null:""+_.name;if(_.type==="hidden"&&c.getAttribute("name")===C)return c}else return c;if(c=ji(c.nextSibling),c===null)break}return null}function Bq(c,h,p){if(h==="")return null;for(;c.nodeType!==3;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!p||(c=ji(c.nextSibling),c===null))return null;return c}function wC(c){return c.data==="$!"||c.data==="$?"&&c.ownerDocument.readyState==="complete"}function zq(c,h){var p=c.ownerDocument;if(c.data!=="$?"||p.readyState==="complete")h();else{var g=function(){h(),p.removeEventListener("DOMContentLoaded",g)};p.addEventListener("DOMContentLoaded",g),c._reactRetry=g}}function ji(c){for(;c!=null;c=c.nextSibling){var h=c.nodeType;if(h===1||h===3)break;if(h===8){if(h=c.data,h==="$"||h==="$!"||h==="$?"||h==="F!"||h==="F")break;if(h==="/$")return null}}return c}var _C=null;function jD(c){c=c.previousSibling;for(var h=0;c;){if(c.nodeType===8){var p=c.data;if(p==="$"||p==="$!"||p==="$?"){if(h===0)return c;h--}else p==="/$"&&h++}c=c.previousSibling}return null}function WD(c,h,p){switch(h=Wb(p),c){case"html":if(c=h.documentElement,!c)throw Error(s(452));return c;case"head":if(c=h.head,!c)throw Error(s(453));return c;case"body":if(c=h.body,!c)throw Error(s(454));return c;default:throw Error(s(451))}}function um(c){for(var h=c.attributes;h.length;)c.removeAttributeNode(h[0]);fl(c)}var _i=new Map,GD=new Set;function Gb(c){return typeof c.getRootNode=="function"?c.getRootNode():c.nodeType===9?c:c.ownerDocument}var Ra=K.d;K.d={f:jq,r:Wq,D:Gq,C:Hq,L:qq,m:Kq,X:Yq,S:Xq,M:Qq};function jq(){var c=Ra.f(),h=Mb();return c||h}function Wq(c){var h=fo(c);h!==null&&h.tag===5&&h.type==="form"?h$(h):Ra.r(c)}var Td=typeof document>"u"?null:document;function HD(c,h,p){var g=Td;if(g&&typeof h=="string"&&h){var _=Qn(h);_='link[rel="'+c+'"][href="'+_+'"]',typeof p=="string"&&(_+='[crossorigin="'+p+'"]'),GD.has(_)||(GD.add(_),c={rel:c,crossOrigin:p,href:h},g.querySelector(_)===null&&(h=g.createElement("link"),Hs(h,"link",c),Wn(h),g.head.appendChild(h)))}}function Gq(c){Ra.D(c),HD("dns-prefetch",c,null)}function Hq(c,h){Ra.C(c,h),HD("preconnect",c,h)}function qq(c,h,p){Ra.L(c,h,p);var g=Td;if(g&&c&&h){var _='link[rel="preload"][as="'+Qn(h)+'"]';h==="image"&&p&&p.imageSrcSet?(_+='[imagesrcset="'+Qn(p.imageSrcSet)+'"]',typeof p.imageSizes=="string"&&(_+='[imagesizes="'+Qn(p.imageSizes)+'"]')):_+='[href="'+Qn(c)+'"]';var C=_;switch(h){case"style":C=Ed(c);break;case"script":C=Id(c)}_i.has(C)||(c=d({rel:"preload",href:h==="image"&&p&&p.imageSrcSet?void 0:c,as:h},p),_i.set(C,c),g.querySelector(_)!==null||h==="style"&&g.querySelector(hm(C))||h==="script"&&g.querySelector(dm(C))||(h=g.createElement("link"),Hs(h,"link",c),Wn(h),g.head.appendChild(h)))}}function Kq(c,h){Ra.m(c,h);var p=Td;if(p&&c){var g=h&&typeof h.as=="string"?h.as:"script",_='link[rel="modulepreload"][as="'+Qn(g)+'"][href="'+Qn(c)+'"]',C=_;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":C=Id(c)}if(!_i.has(C)&&(c=d({rel:"modulepreload",href:c},h),_i.set(C,c),p.querySelector(_)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(p.querySelector(dm(C)))return}g=p.createElement("link"),Hs(g,"link",c),Wn(g),p.head.appendChild(g)}}}function Xq(c,h,p){Ra.S(c,h,p);var g=Td;if(g&&c){var _=xr(g).hoistableStyles,C=Ed(c);h=h||"default";var L=_.get(C);if(!L){var B={loading:0,preload:null};if(L=g.querySelector(hm(C)))B.loading=5;else{c=d({rel:"stylesheet",href:c,"data-precedence":h},p),(p=_i.get(C))&&SC(c,p);var q=L=g.createElement("link");Wn(q),Hs(q,"link",c),q._p=new Promise(function(fe,_e){q.onload=fe,q.onerror=_e}),q.addEventListener("load",function(){B.loading|=1}),q.addEventListener("error",function(){B.loading|=2}),B.loading|=4,Hb(L,h,g)}L={type:"stylesheet",instance:L,count:1,state:B},_.set(C,L)}}}function Yq(c,h){Ra.X(c,h);var p=Td;if(p&&c){var g=xr(p).hoistableScripts,_=Id(c),C=g.get(_);C||(C=p.querySelector(dm(_)),C||(c=d({src:c,async:!0},h),(h=_i.get(_))&&CC(c,h),C=p.createElement("script"),Wn(C),Hs(C,"link",c),p.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},g.set(_,C))}}function Qq(c,h){Ra.M(c,h);var p=Td;if(p&&c){var g=xr(p).hoistableScripts,_=Id(c),C=g.get(_);C||(C=p.querySelector(dm(_)),C||(c=d({src:c,async:!0,type:"module"},h),(h=_i.get(_))&&CC(c,h),C=p.createElement("script"),Wn(C),Hs(C,"link",c),p.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},g.set(_,C))}}function qD(c,h,p,g){var _=(_=Se.current)?Gb(_):null;if(!_)throw Error(s(446));switch(c){case"meta":case"title":return null;case"style":return typeof p.precedence=="string"&&typeof p.href=="string"?(h=Ed(p.href),p=xr(_).hoistableStyles,g=p.get(h),g||(g={type:"style",instance:null,count:0,state:null},p.set(h,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(p.rel==="stylesheet"&&typeof p.href=="string"&&typeof p.precedence=="string"){c=Ed(p.href);var C=xr(_).hoistableStyles,L=C.get(c);if(L||(_=_.ownerDocument||_,L={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},C.set(c,L),(C=_.querySelector(hm(c)))&&!C._p&&(L.instance=C,L.state.loading=5),_i.has(c)||(p={rel:"preload",as:"style",href:p.href,crossOrigin:p.crossOrigin,integrity:p.integrity,media:p.media,hrefLang:p.hrefLang,referrerPolicy:p.referrerPolicy},_i.set(c,p),C||Jq(_,c,p,L.state))),h&&g===null)throw Error(s(528,""));return L}if(h&&g!==null)throw Error(s(529,""));return null;case"script":return h=p.async,p=p.src,typeof p=="string"&&h&&typeof h!="function"&&typeof h!="symbol"?(h=Id(p),p=xr(_).hoistableScripts,g=p.get(h),g||(g={type:"script",instance:null,count:0,state:null},p.set(h,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,c))}}function Ed(c){return'href="'+Qn(c)+'"'}function hm(c){return'link[rel="stylesheet"]['+c+"]"}function KD(c){return d({},c,{"data-precedence":c.precedence,precedence:null})}function Jq(c,h,p,g){c.querySelector('link[rel="preload"][as="style"]['+h+"]")?g.loading=1:(h=c.createElement("link"),g.preload=h,h.addEventListener("load",function(){return g.loading|=1}),h.addEventListener("error",function(){return g.loading|=2}),Hs(h,"link",p),Wn(h),c.head.appendChild(h))}function Id(c){return'[src="'+Qn(c)+'"]'}function dm(c){return"script[async]"+c}function XD(c,h,p){if(h.count++,h.instance===null)switch(h.type){case"style":var g=c.querySelector('style[data-href~="'+Qn(p.href)+'"]');if(g)return h.instance=g,Wn(g),g;var _=d({},p,{"data-href":p.href,"data-precedence":p.precedence,href:null,precedence:null});return g=(c.ownerDocument||c).createElement("style"),Wn(g),Hs(g,"style",_),Hb(g,p.precedence,c),h.instance=g;case"stylesheet":_=Ed(p.href);var C=c.querySelector(hm(_));if(C)return h.state.loading|=4,h.instance=C,Wn(C),C;g=KD(p),(_=_i.get(_))&&SC(g,_),C=(c.ownerDocument||c).createElement("link"),Wn(C);var L=C;return L._p=new Promise(function(B,q){L.onload=B,L.onerror=q}),Hs(C,"link",g),h.state.loading|=4,Hb(C,p.precedence,c),h.instance=C;case"script":return C=Id(p.src),(_=c.querySelector(dm(C)))?(h.instance=_,Wn(_),_):(g=p,(_=_i.get(C))&&(g=d({},p),CC(g,_)),c=c.ownerDocument||c,_=c.createElement("script"),Wn(_),Hs(_,"link",g),c.head.appendChild(_),h.instance=_);case"void":return null;default:throw Error(s(443,h.type))}else h.type==="stylesheet"&&(h.state.loading&4)===0&&(g=h.instance,h.state.loading|=4,Hb(g,p.precedence,c));return h.instance}function Hb(c,h,p){for(var g=p.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),_=g.length?g[g.length-1]:null,C=_,L=0;L<g.length;L++){var B=g[L];if(B.dataset.precedence===h)C=B;else if(C!==_)break}C?C.parentNode.insertBefore(c,C.nextSibling):(h=p.nodeType===9?p.head:p,h.insertBefore(c,h.firstChild))}function SC(c,h){c.crossOrigin==null&&(c.crossOrigin=h.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=h.referrerPolicy),c.title==null&&(c.title=h.title)}function CC(c,h){c.crossOrigin==null&&(c.crossOrigin=h.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=h.referrerPolicy),c.integrity==null&&(c.integrity=h.integrity)}var qb=null;function YD(c,h,p){if(qb===null){var g=new Map,_=qb=new Map;_.set(p,g)}else _=qb,g=_.get(p),g||(g=new Map,_.set(p,g));if(g.has(c))return g;for(g.set(c,null),p=p.getElementsByTagName(c),_=0;_<p.length;_++){var C=p[_];if(!(C[qc]||C[ds]||c==="link"&&C.getAttribute("rel")==="stylesheet")&&C.namespaceURI!=="http://www.w3.org/2000/svg"){var L=C.getAttribute(h)||"";L=c+L;var B=g.get(L);B?B.push(C):g.set(L,[C])}}return g}function QD(c,h,p){c=c.ownerDocument||c,c.head.insertBefore(p,h==="title"?c.querySelector("head > title"):null)}function Zq(c,h,p){if(p===1||h.itemProp!=null)return!1;switch(c){case"meta":case"title":return!0;case"style":if(typeof h.precedence!="string"||typeof h.href!="string"||h.href==="")break;return!0;case"link":if(typeof h.rel!="string"||typeof h.href!="string"||h.href===""||h.onLoad||h.onError)break;switch(h.rel){case"stylesheet":return c=h.disabled,typeof h.precedence=="string"&&c==null;default:return!0}case"script":if(h.async&&typeof h.async!="function"&&typeof h.async!="symbol"&&!h.onLoad&&!h.onError&&h.src&&typeof h.src=="string")return!0}return!1}function JD(c){return!(c.type==="stylesheet"&&(c.state.loading&3)===0)}var fm=null;function e8(){}function t8(c,h,p){if(fm===null)throw Error(s(475));var g=fm;if(h.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(h.state.loading&4)===0){if(h.instance===null){var _=Ed(p.href),C=c.querySelector(hm(_));if(C){c=C._p,c!==null&&typeof c=="object"&&typeof c.then=="function"&&(g.count++,g=Kb.bind(g),c.then(g,g)),h.state.loading|=4,h.instance=C,Wn(C);return}C=c.ownerDocument||c,p=KD(p),(_=_i.get(_))&&SC(p,_),C=C.createElement("link"),Wn(C);var L=C;L._p=new Promise(function(B,q){L.onload=B,L.onerror=q}),Hs(C,"link",p),h.instance=C}g.stylesheets===null&&(g.stylesheets=new Map),g.stylesheets.set(h,c),(c=h.state.preload)&&(h.state.loading&3)===0&&(g.count++,h=Kb.bind(g),c.addEventListener("load",h),c.addEventListener("error",h))}}function n8(){if(fm===null)throw Error(s(475));var c=fm;return c.stylesheets&&c.count===0&&TC(c,c.stylesheets),0<c.count?function(h){var p=setTimeout(function(){if(c.stylesheets&&TC(c,c.stylesheets),c.unsuspend){var g=c.unsuspend;c.unsuspend=null,g()}},6e4);return c.unsuspend=h,function(){c.unsuspend=null,clearTimeout(p)}}:null}function Kb(){if(this.count--,this.count===0){if(this.stylesheets)TC(this,this.stylesheets);else if(this.unsuspend){var c=this.unsuspend;this.unsuspend=null,c()}}}var Xb=null;function TC(c,h){c.stylesheets=null,c.unsuspend!==null&&(c.count++,Xb=new Map,h.forEach(s8,c),Xb=null,Kb.call(c))}function s8(c,h){if(!(h.state.loading&4)){var p=Xb.get(c);if(p)var g=p.get(null);else{p=new Map,Xb.set(c,p);for(var _=c.querySelectorAll("link[data-precedence],style[data-precedence]"),C=0;C<_.length;C++){var L=_[C];(L.nodeName==="LINK"||L.getAttribute("media")!=="not all")&&(p.set(L.dataset.precedence,L),g=L)}g&&p.set(null,g)}_=h.instance,L=_.getAttribute("data-precedence"),C=p.get(L)||g,C===g&&p.set(null,_),p.set(L,_),this.count++,g=Kb.bind(this),_.addEventListener("load",g),_.addEventListener("error",g),C?C.parentNode.insertBefore(_,C.nextSibling):(c=c.nodeType===9?c.head:c,c.insertBefore(_,c.firstChild)),h.state.loading|=4}}var pm={$$typeof:I,Provider:null,Consumer:null,_currentValue:J,_currentValue2:J,_threadCount:0};function r8(c,h,p,g,_,C,L,B){this.tag=1,this.containerInfo=c,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=aa(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=aa(0),this.hiddenUpdates=aa(null),this.identifierPrefix=g,this.onUncaughtError=_,this.onCaughtError=C,this.onRecoverableError=L,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=B,this.incompleteTransitions=new Map}function ZD(c,h,p,g,_,C,L,B,q,fe,_e,Ee){return c=new r8(c,h,p,L,B,q,fe,Ee),h=1,C===!0&&(h|=24),C=Qr(3,null,null,h),c.current=C,C.stateNode=c,h=oS(),h.refCount++,c.pooledCache=h,h.refCount++,C.memoizedState={element:g,isDehydrated:p,cache:h},uS(C),c}function eO(c){return c?(c=rd,c):rd}function tO(c,h,p,g,_,C){_=eO(_),g.context===null?g.context=_:g.pendingContext=_,g=xl(h),g.payload={element:p},C=C===void 0?null:C,C!==null&&(g.callback=C),p=vl(c,g,h),p!==null&&(ni(p,c,h),Wp(p,c,h))}function nO(c,h){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var p=c.retryLane;c.retryLane=p!==0&&p<h?p:h}}function EC(c,h){nO(c,h),(c=c.alternate)&&nO(c,h)}function sO(c){if(c.tag===13){var h=sd(c,67108864);h!==null&&ni(h,c,67108864),EC(c,67108864)}}var Yb=!0;function i8(c,h,p,g){var _=G.T;G.T=null;var C=K.p;try{K.p=2,IC(c,h,p,g)}finally{K.p=C,G.T=_}}function o8(c,h,p,g){var _=G.T;G.T=null;var C=K.p;try{K.p=8,IC(c,h,p,g)}finally{K.p=C,G.T=_}}function IC(c,h,p,g){if(Yb){var _=kC(g);if(_===null)pC(c,h,g,Qb,p),iO(c,g);else if(l8(_,c,h,p,g))g.stopPropagation();else if(iO(c,g),h&4&&-1<a8.indexOf(c)){for(;_!==null;){var C=fo(_);if(C!==null)switch(C.tag){case 3:if(C=C.stateNode,C.current.memoizedState.isDehydrated){var L=Kr(C.pendingLanes);if(L!==0){var B=C;for(B.pendingLanes|=2,B.entangledLanes|=2;L;){var q=1<<31-Dn(L);B.entanglements[1]|=q,L&=~q}Io(C),(Zt&6)===0&&(Ob=xt()+500,am(0))}}break;case 13:B=sd(C,2),B!==null&&ni(B,C,2),Mb(),EC(C,2)}if(C=kC(g),C===null&&pC(c,h,g,Qb,p),C===_)break;_=C}_!==null&&g.stopPropagation()}else pC(c,h,g,null,p)}}function kC(c){return c=fi(c),NC(c)}var Qb=null;function NC(c){if(Qb=null,c=ca(c),c!==null){var h=i(c);if(h===null)c=null;else{var p=h.tag;if(p===13){if(c=o(h),c!==null)return c;c=null}else if(p===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;c=null}else h!==c&&(c=null)}}return Qb=c,null}function rO(c){switch(c){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Jt()){case br:return 2;case wn:return 8;case rr:case Us:return 32;case Ar:return 268435456;default:return 32}default:return 32}}var AC=!1,Dl=null,Ol=null,Pl=null,mm=new Map,gm=new Map,Ml=[],a8="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function iO(c,h){switch(c){case"focusin":case"focusout":Dl=null;break;case"dragenter":case"dragleave":Ol=null;break;case"mouseover":case"mouseout":Pl=null;break;case"pointerover":case"pointerout":mm.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":gm.delete(h.pointerId)}}function ym(c,h,p,g,_,C){return c===null||c.nativeEvent!==C?(c={blockedOn:h,domEventName:p,eventSystemFlags:g,nativeEvent:C,targetContainers:[_]},h!==null&&(h=fo(h),h!==null&&sO(h)),c):(c.eventSystemFlags|=g,h=c.targetContainers,_!==null&&h.indexOf(_)===-1&&h.push(_),c)}function l8(c,h,p,g,_){switch(h){case"focusin":return Dl=ym(Dl,c,h,p,g,_),!0;case"dragenter":return Ol=ym(Ol,c,h,p,g,_),!0;case"mouseover":return Pl=ym(Pl,c,h,p,g,_),!0;case"pointerover":var C=_.pointerId;return mm.set(C,ym(mm.get(C)||null,c,h,p,g,_)),!0;case"gotpointercapture":return C=_.pointerId,gm.set(C,ym(gm.get(C)||null,c,h,p,g,_)),!0}return!1}function oO(c){var h=ca(c.target);if(h!==null){var p=i(h);if(p!==null){if(h=p.tag,h===13){if(h=o(p),h!==null){c.blockedOn=h,M0(c.priority,function(){if(p.tag===13){var g=ti();g=ul(g);var _=sd(p,g);_!==null&&ni(_,p,g),EC(p,g)}});return}}else if(h===3&&p.stateNode.current.memoizedState.isDehydrated){c.blockedOn=p.tag===3?p.stateNode.containerInfo:null;return}}}c.blockedOn=null}function Jb(c){if(c.blockedOn!==null)return!1;for(var h=c.targetContainers;0<h.length;){var p=kC(c.nativeEvent);if(p===null){p=c.nativeEvent;var g=new p.constructor(p.type,p);fa=g,p.target.dispatchEvent(g),fa=null}else return h=fo(p),h!==null&&sO(h),c.blockedOn=p,!1;h.shift()}return!0}function aO(c,h,p){Jb(c)&&p.delete(h)}function c8(){AC=!1,Dl!==null&&Jb(Dl)&&(Dl=null),Ol!==null&&Jb(Ol)&&(Ol=null),Pl!==null&&Jb(Pl)&&(Pl=null),mm.forEach(aO),gm.forEach(aO)}function Zb(c,h){c.blockedOn===h&&(c.blockedOn=null,AC||(AC=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,c8)))}var ex=null;function lO(c){ex!==c&&(ex=c,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){ex===c&&(ex=null);for(var h=0;h<c.length;h+=3){var p=c[h],g=c[h+1],_=c[h+2];if(typeof g!="function"){if(NC(g||p)===null)continue;break}var C=fo(p);C!==null&&(c.splice(h,3),h-=3,NS(C,{pending:!0,data:_,method:p.method,action:g},g,_))}}))}function bm(c){function h(q){return Zb(q,c)}Dl!==null&&Zb(Dl,c),Ol!==null&&Zb(Ol,c),Pl!==null&&Zb(Pl,c),mm.forEach(h),gm.forEach(h);for(var p=0;p<Ml.length;p++){var g=Ml[p];g.blockedOn===c&&(g.blockedOn=null)}for(;0<Ml.length&&(p=Ml[0],p.blockedOn===null);)oO(p),p.blockedOn===null&&Ml.shift();if(p=(c.ownerDocument||c).$$reactFormReplay,p!=null)for(g=0;g<p.length;g+=3){var _=p[g],C=p[g+1],L=_[Yn]||null;if(typeof C=="function")L||lO(p);else if(L){var B=null;if(C&&C.hasAttribute("formAction")){if(_=C,L=C[Yn]||null)B=L.formAction;else if(NC(_)!==null)continue}else B=L.action;typeof B=="function"?p[g+1]=B:(p.splice(g,3),g-=3),lO(p)}}}function RC(c){this._internalRoot=c}tx.prototype.render=RC.prototype.render=function(c){var h=this._internalRoot;if(h===null)throw Error(s(409));var p=h.current,g=ti();tO(p,g,c,h,null,null)},tx.prototype.unmount=RC.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var h=c.containerInfo;tO(c.current,2,null,c,null,null),Mb(),h[hi]=null}};function tx(c){this._internalRoot=c}tx.prototype.unstable_scheduleHydration=function(c){if(c){var h=hl();c={blockedOn:null,target:c,priority:h};for(var p=0;p<Ml.length&&h!==0&&h<Ml[p].priority;p++);Ml.splice(p,0,c),p===0&&oO(c)}};var cO=e.version;if(cO!=="19.1.0")throw Error(s(527,cO,"19.1.0"));K.findDOMNode=function(c){var h=c._reactInternals;if(h===void 0)throw typeof c.render=="function"?Error(s(188)):(c=Object.keys(c).join(","),Error(s(268,c)));return c=l(h),c=c!==null?u(c):null,c=c===null?null:c.stateNode,c};var u8={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:G,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var nx=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nx.isDisabled&&nx.supportsFiber)try{Wt=nx.inject(u8),gt=nx}catch{}}return vm.createRoot=function(c,h){if(!r(c))throw Error(s(299));var p=!1,g="",_=T$,C=E$,L=I$,B=null;return h!=null&&(h.unstable_strictMode===!0&&(p=!0),h.identifierPrefix!==void 0&&(g=h.identifierPrefix),h.onUncaughtError!==void 0&&(_=h.onUncaughtError),h.onCaughtError!==void 0&&(C=h.onCaughtError),h.onRecoverableError!==void 0&&(L=h.onRecoverableError),h.unstable_transitionCallbacks!==void 0&&(B=h.unstable_transitionCallbacks)),h=ZD(c,1,!1,null,null,p,g,_,C,L,B,null),c[hi]=h.current,fC(c),new RC(h)},vm.hydrateRoot=function(c,h,p){if(!r(c))throw Error(s(299));var g=!1,_="",C=T$,L=E$,B=I$,q=null,fe=null;return p!=null&&(p.unstable_strictMode===!0&&(g=!0),p.identifierPrefix!==void 0&&(_=p.identifierPrefix),p.onUncaughtError!==void 0&&(C=p.onUncaughtError),p.onCaughtError!==void 0&&(L=p.onCaughtError),p.onRecoverableError!==void 0&&(B=p.onRecoverableError),p.unstable_transitionCallbacks!==void 0&&(q=p.unstable_transitionCallbacks),p.formState!==void 0&&(fe=p.formState)),h=ZD(c,1,!0,h,p??null,g,_,C,L,B,q,fe),h.context=eO(null),p=h.current,g=ti(),g=ul(g),_=xl(g),_.callback=null,vl(p,_,g),p=g,h.current.lanes=p,la(h,p),Io(h),c[hi]=h.current,fC(c),new tx(h)},vm.version="19.1.0",vm}var xO;function w8(){if(xO)return OC.exports;xO=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),OC.exports=v8(),OC.exports}var _8=w8();/**
 * react-router v7.7.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var vO="popstate";function S8(n={}){function e(s,r){let{pathname:i,search:o,hash:a}=s.location;return OT("",{pathname:i,search:o,hash:a},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(s,r){return typeof r=="string"?r:fg(r)}return T8(e,t,null,n)}function Rn(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Ko(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function C8(){return Math.random().toString(36).substring(2,10)}function wO(n,e){return{usr:n.state,key:n.key,idx:e}}function OT(n,e,t=null,s){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?Ff(e):e,state:t,key:e&&e.key||s||C8()}}function fg({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function Ff(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let s=n.indexOf("?");s>=0&&(e.search=n.substring(s),n=n.substring(0,s)),n&&(e.pathname=n)}return e}function T8(n,e,t,s={}){let{window:r=document.defaultView,v5Compat:i=!1}=s,o=r.history,a="POP",l=null,u=d();u==null&&(u=0,o.replaceState({...o.state,idx:u},""));function d(){return(o.state||{idx:null}).idx}function f(){a="POP";let v=d(),S=v==null?null:v-u;u=v,l&&l({action:a,location:w.location,delta:S})}function m(v,S){a="PUSH";let T=OT(w.location,v,S);u=d()+1;let I=wO(T,u),k=w.createHref(T);try{o.pushState(I,"",k)}catch(O){if(O instanceof DOMException&&O.name==="DataCloneError")throw O;r.location.assign(k)}i&&l&&l({action:a,location:w.location,delta:1})}function y(v,S){a="REPLACE";let T=OT(w.location,v,S);u=d();let I=wO(T,u),k=w.createHref(T);o.replaceState(I,"",k),i&&l&&l({action:a,location:w.location,delta:0})}function b(v){return E8(v)}let w={get action(){return a},get location(){return n(r,o)},listen(v){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(vO,f),l=v,()=>{r.removeEventListener(vO,f),l=null}},createHref(v){return e(r,v)},createURL:b,encodeLocation(v){let S=b(v);return{pathname:S.pathname,search:S.search,hash:S.hash}},push:m,replace:y,go(v){return o.go(v)}};return w}function E8(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Rn(t,"No window.location.(origin|href) available to create URL");let s=typeof n=="string"?n:fg(n);return s=s.replace(/ $/,"%20"),!e&&s.startsWith("//")&&(s=t+s),new URL(s,t)}function v3(n,e,t="/"){return I8(n,e,t,!1)}function I8(n,e,t,s){let r=typeof e=="string"?Ff(e):e,i=Ga(r.pathname||"/",t);if(i==null)return null;let o=w3(n);k8(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let u=V8(i);a=L8(o[l],u,s)}return a}function w3(n,e=[],t=[],s=""){let r=(i,o,a)=>{let l={relativePath:a===void 0?i.path||"":a,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};l.relativePath.startsWith("/")&&(Rn(l.relativePath.startsWith(s),`Absolute route path "${l.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(s.length));let u=za([s,l.relativePath]),d=t.concat(l);i.children&&i.children.length>0&&(Rn(i.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${u}".`),w3(i.children,e,d,u)),!(i.path==null&&!i.index)&&e.push({path:u,score:P8(u,i.index),routesMeta:d})};return n.forEach((i,o)=>{if(i.path===""||!i.path?.includes("?"))r(i,o);else for(let a of _3(i.path))r(i,o,a)}),e}function _3(n){let e=n.split("/");if(e.length===0)return[];let[t,...s]=e,r=t.endsWith("?"),i=t.replace(/\?$/,"");if(s.length===0)return r?[i,""]:[i];let o=_3(s.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),r&&a.push(...o),a.map(l=>n.startsWith("/")&&l===""?"/":l)}function k8(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:M8(e.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}var N8=/^:[\w-]+$/,A8=3,R8=2,$8=1,D8=10,O8=-2,_O=n=>n==="*";function P8(n,e){let t=n.split("/"),s=t.length;return t.some(_O)&&(s+=O8),e&&(s+=R8),t.filter(r=>!_O(r)).reduce((r,i)=>r+(N8.test(i)?A8:i===""?$8:D8),s)}function M8(n,e){return n.length===e.length&&n.slice(0,-1).every((s,r)=>s===e[r])?n[n.length-1]-e[e.length-1]:0}function L8(n,e,t=!1){let{routesMeta:s}=n,r={},i="/",o=[];for(let a=0;a<s.length;++a){let l=s[a],u=a===s.length-1,d=i==="/"?e:e.slice(i.length)||"/",f=nv({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},d),m=l.route;if(!f&&u&&t&&!s[s.length-1].route.index&&(f=nv({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},d)),!f)return null;Object.assign(r,f.params),o.push({params:r,pathname:za([i,f.pathname]),pathnameBase:j8(za([i,f.pathnameBase])),route:m}),f.pathnameBase!=="/"&&(i=za([i,f.pathnameBase]))}return o}function nv(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,s]=F8(n.path,n.caseSensitive,n.end),r=e.match(t);if(!r)return null;let i=r[0],o=i.replace(/(.)\/+$/,"$1"),a=r.slice(1);return{params:s.reduce((u,{paramName:d,isOptional:f},m)=>{if(d==="*"){let b=a[m]||"";o=i.slice(0,i.length-b.length).replace(/(.)\/+$/,"$1")}const y=a[m];return f&&!y?u[d]=void 0:u[d]=(y||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:o,pattern:n}}function F8(n,e=!1,t=!0){Ko(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let s=[],r="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(s.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(s.push({paramName:"*"}),r+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":n!==""&&n!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),s]}function V8(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ko(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Ga(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=n.charAt(t);return s&&s!=="/"?null:n.slice(t)||"/"}function U8(n,e="/"){let{pathname:t,search:s="",hash:r=""}=typeof n=="string"?Ff(n):n;return{pathname:t?t.startsWith("/")?t:B8(t,e):e,search:W8(s),hash:G8(r)}}function B8(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function FC(n,e,t,s){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function z8(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function S3(n){let e=z8(n);return e.map((t,s)=>s===e.length-1?t.pathname:t.pathnameBase)}function C3(n,e,t,s=!1){let r;typeof n=="string"?r=Ff(n):(r={...n},Rn(!r.pathname||!r.pathname.includes("?"),FC("?","pathname","search",r)),Rn(!r.pathname||!r.pathname.includes("#"),FC("#","pathname","hash",r)),Rn(!r.search||!r.search.includes("#"),FC("#","search","hash",r)));let i=n===""||r.pathname==="",o=i?"/":r.pathname,a;if(o==null)a=t;else{let f=e.length-1;if(!s&&o.startsWith("..")){let m=o.split("/");for(;m[0]==="..";)m.shift(),f-=1;r.pathname=m.join("/")}a=f>=0?e[f]:"/"}let l=U8(r,a),u=o&&o!=="/"&&o.endsWith("/"),d=(i||o===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(u||d)&&(l.pathname+="/"),l}var za=n=>n.join("/").replace(/\/\/+/g,"/"),j8=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),W8=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,G8=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function H8(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var T3=["POST","PUT","PATCH","DELETE"];new Set(T3);var q8=["GET",...T3];new Set(q8);var Vf=te.createContext(null);Vf.displayName="DataRouter";var _w=te.createContext(null);_w.displayName="DataRouterState";te.createContext(!1);var E3=te.createContext({isTransitioning:!1});E3.displayName="ViewTransition";var K8=te.createContext(new Map);K8.displayName="Fetchers";var X8=te.createContext(null);X8.displayName="Await";var ta=te.createContext(null);ta.displayName="Navigation";var Yg=te.createContext(null);Yg.displayName="Location";var na=te.createContext({outlet:null,matches:[],isDataRoute:!1});na.displayName="Route";var yI=te.createContext(null);yI.displayName="RouteError";function Y8(n,{relative:e}={}){Rn(Qg(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:s}=te.useContext(ta),{hash:r,pathname:i,search:o}=Jg(n,{relative:e}),a=i;return t!=="/"&&(a=i==="/"?t:za([t,i])),s.createHref({pathname:a,search:o,hash:r})}function Qg(){return te.useContext(Yg)!=null}function wh(){return Rn(Qg(),"useLocation() may be used only in the context of a <Router> component."),te.useContext(Yg).location}var I3="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function k3(n){te.useContext(ta).static||te.useLayoutEffect(n)}function Ec(){let{isDataRoute:n}=te.useContext(na);return n?h9():Q8()}function Q8(){Rn(Qg(),"useNavigate() may be used only in the context of a <Router> component.");let n=te.useContext(Vf),{basename:e,navigator:t}=te.useContext(ta),{matches:s}=te.useContext(na),{pathname:r}=wh(),i=JSON.stringify(S3(s)),o=te.useRef(!1);return k3(()=>{o.current=!0}),te.useCallback((l,u={})=>{if(Ko(o.current,I3),!o.current)return;if(typeof l=="number"){t.go(l);return}let d=C3(l,JSON.parse(i),r,u.relative==="path");n==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:za([e,d.pathname])),(u.replace?t.replace:t.push)(d,u.state,u)},[e,t,i,r,n])}var J8=te.createContext(null);function Z8(n){let e=te.useContext(na).outlet;return e&&te.createElement(J8.Provider,{value:n},e)}function Jg(n,{relative:e}={}){let{matches:t}=te.useContext(na),{pathname:s}=wh(),r=JSON.stringify(S3(t));return te.useMemo(()=>C3(n,JSON.parse(r),s,e==="path"),[n,r,s,e])}function e9(n,e){return N3(n,e)}function N3(n,e,t,s){Rn(Qg(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=te.useContext(ta),{matches:i}=te.useContext(na),o=i[i.length-1],a=o?o.params:{},l=o?o.pathname:"/",u=o?o.pathnameBase:"/",d=o&&o.route;{let S=d&&d.path||"";A3(l,!d||S.endsWith("*")||S.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${l}" (under <Route path="${S}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${S}"> to <Route path="${S==="/"?"*":`${S}/*`}">.`)}let f=wh(),m;if(e){let S=typeof e=="string"?Ff(e):e;Rn(u==="/"||S.pathname?.startsWith(u),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${S.pathname}" was given in the \`location\` prop.`),m=S}else m=f;let y=m.pathname||"/",b=y;if(u!=="/"){let S=u.replace(/^\//,"").split("/");b="/"+y.replace(/^\//,"").split("/").slice(S.length).join("/")}let w=v3(n,{pathname:b});Ko(d||w!=null,`No routes matched location "${m.pathname}${m.search}${m.hash}" `),Ko(w==null||w[w.length-1].route.element!==void 0||w[w.length-1].route.Component!==void 0||w[w.length-1].route.lazy!==void 0,`Matched leaf route at location "${m.pathname}${m.search}${m.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let v=i9(w&&w.map(S=>Object.assign({},S,{params:Object.assign({},a,S.params),pathname:za([u,r.encodeLocation?r.encodeLocation(S.pathname).pathname:S.pathname]),pathnameBase:S.pathnameBase==="/"?u:za([u,r.encodeLocation?r.encodeLocation(S.pathnameBase).pathname:S.pathnameBase])})),i,t,s);return e&&v?te.createElement(Yg.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...m},navigationType:"POP"}},v):v}function t9(){let n=u9(),e=H8(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:s},i={padding:"2px 4px",backgroundColor:s},o=null;return console.error("Error handled by React Router default ErrorBoundary:",n),o=te.createElement(te.Fragment,null,te.createElement("p",null," Hey developer "),te.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",te.createElement("code",{style:i},"ErrorBoundary")," or"," ",te.createElement("code",{style:i},"errorElement")," prop on your route.")),te.createElement(te.Fragment,null,te.createElement("h2",null,"Unexpected Application Error!"),te.createElement("h3",{style:{fontStyle:"italic"}},e),t?te.createElement("pre",{style:r},t):null,o)}var n9=te.createElement(t9,null),s9=class extends te.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){console.error("React Router caught the following error during render",n,e)}render(){return this.state.error!==void 0?te.createElement(na.Provider,{value:this.props.routeContext},te.createElement(yI.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function r9({routeContext:n,match:e,children:t}){let s=te.useContext(Vf);return s&&s.static&&s.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=e.route.id),te.createElement(na.Provider,{value:n},t)}function i9(n,e=[],t=null,s=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let r=n,i=t?.errors;if(i!=null){let l=r.findIndex(u=>u.route.id&&i?.[u.route.id]!==void 0);Rn(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(i).join(",")}`),r=r.slice(0,Math.min(r.length,l+1))}let o=!1,a=-1;if(t)for(let l=0;l<r.length;l++){let u=r[l];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(a=l),u.route.id){let{loaderData:d,errors:f}=t,m=u.route.loader&&!d.hasOwnProperty(u.route.id)&&(!f||f[u.route.id]===void 0);if(u.route.lazy||m){o=!0,a>=0?r=r.slice(0,a+1):r=[r[0]];break}}}return r.reduceRight((l,u,d)=>{let f,m=!1,y=null,b=null;t&&(f=i&&u.route.id?i[u.route.id]:void 0,y=u.route.errorElement||n9,o&&(a<0&&d===0?(A3("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),m=!0,b=null):a===d&&(m=!0,b=u.route.hydrateFallbackElement||null)));let w=e.concat(r.slice(0,d+1)),v=()=>{let S;return f?S=y:m?S=b:u.route.Component?S=te.createElement(u.route.Component,null):u.route.element?S=u.route.element:S=l,te.createElement(r9,{match:u,routeContext:{outlet:l,matches:w,isDataRoute:t!=null},children:S})};return t&&(u.route.ErrorBoundary||u.route.errorElement||d===0)?te.createElement(s9,{location:t.location,revalidation:t.revalidation,component:y,error:f,children:v(),routeContext:{outlet:null,matches:w,isDataRoute:!0}}):v()},null)}function bI(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function o9(n){let e=te.useContext(Vf);return Rn(e,bI(n)),e}function a9(n){let e=te.useContext(_w);return Rn(e,bI(n)),e}function l9(n){let e=te.useContext(na);return Rn(e,bI(n)),e}function xI(n){let e=l9(n),t=e.matches[e.matches.length-1];return Rn(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function c9(){return xI("useRouteId")}function u9(){let n=te.useContext(yI),e=a9("useRouteError"),t=xI("useRouteError");return n!==void 0?n:e.errors?.[t]}function h9(){let{router:n}=o9("useNavigate"),e=xI("useNavigate"),t=te.useRef(!1);return k3(()=>{t.current=!0}),te.useCallback(async(r,i={})=>{Ko(t.current,I3),t.current&&(typeof r=="number"?n.navigate(r):await n.navigate(r,{fromRouteId:e,...i}))},[n,e])}var SO={};function A3(n,e,t){!e&&!SO[n]&&(SO[n]=!0,Ko(!1,t))}te.memo(d9);function d9({routes:n,future:e,state:t}){return N3(n,void 0,t,e)}function f9(n){return Z8(n.context)}function ys(n){Rn(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function p9({basename:n="/",children:e=null,location:t,navigationType:s="POP",navigator:r,static:i=!1}){Rn(!Qg(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=n.replace(/^\/*/,"/"),a=te.useMemo(()=>({basename:o,navigator:r,static:i,future:{}}),[o,r,i]);typeof t=="string"&&(t=Ff(t));let{pathname:l="/",search:u="",hash:d="",state:f=null,key:m="default"}=t,y=te.useMemo(()=>{let b=Ga(l,o);return b==null?null:{location:{pathname:b,search:u,hash:d,state:f,key:m},navigationType:s}},[o,l,u,d,f,m,s]);return Ko(y!=null,`<Router basename="${o}"> is not able to match the URL "${l}${u}${d}" because it does not start with the basename, so the <Router> won't render anything.`),y==null?null:te.createElement(ta.Provider,{value:a},te.createElement(Yg.Provider,{children:e,value:y}))}function m9({children:n,location:e}){return e9(PT(n),e)}function PT(n,e=[]){let t=[];return te.Children.forEach(n,(s,r)=>{if(!te.isValidElement(s))return;let i=[...e,r];if(s.type===te.Fragment){t.push.apply(t,PT(s.props.children,i));return}Rn(s.type===ys,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Rn(!s.props.index||!s.props.children,"An index route cannot have child routes.");let o={id:s.props.id||i.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(o.children=PT(s.props.children,i)),t.push(o)}),t}var Dx="get",Ox="application/x-www-form-urlencoded";function Sw(n){return n!=null&&typeof n.tagName=="string"}function g9(n){return Sw(n)&&n.tagName.toLowerCase()==="button"}function y9(n){return Sw(n)&&n.tagName.toLowerCase()==="form"}function b9(n){return Sw(n)&&n.tagName.toLowerCase()==="input"}function x9(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function v9(n,e){return n.button===0&&(!e||e==="_self")&&!x9(n)}var sx=null;function w9(){if(sx===null)try{new FormData(document.createElement("form"),0),sx=!1}catch{sx=!0}return sx}var _9=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function VC(n){return n!=null&&!_9.has(n)?(Ko(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Ox}"`),null):n}function S9(n,e){let t,s,r,i,o;if(y9(n)){let a=n.getAttribute("action");s=a?Ga(a,e):null,t=n.getAttribute("method")||Dx,r=VC(n.getAttribute("enctype"))||Ox,i=new FormData(n)}else if(g9(n)||b9(n)&&(n.type==="submit"||n.type==="image")){let a=n.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=n.getAttribute("formaction")||a.getAttribute("action");if(s=l?Ga(l,e):null,t=n.getAttribute("formmethod")||a.getAttribute("method")||Dx,r=VC(n.getAttribute("formenctype"))||VC(a.getAttribute("enctype"))||Ox,i=new FormData(a,n),!w9()){let{name:u,type:d,value:f}=n;if(d==="image"){let m=u?`${u}.`:"";i.append(`${m}x`,"0"),i.append(`${m}y`,"0")}else u&&i.append(u,f)}}else{if(Sw(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Dx,s=null,r=Ox,o=n}return i&&r==="text/plain"&&(o=i,i=void 0),{action:s,method:t.toLowerCase(),encType:r,formData:i,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function vI(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function C9(n,e,t){let s=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return s.pathname==="/"?s.pathname=`_root.${t}`:e&&Ga(s.pathname,e)==="/"?s.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:s.pathname=`${s.pathname.replace(/\/$/,"")}.${t}`,s}async function T9(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function E9(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function I9(n,e,t){let s=await Promise.all(n.map(async r=>{let i=e.routes[r.route.id];if(i){let o=await T9(i,t);return o.links?o.links():[]}return[]}));return R9(s.flat(1).filter(E9).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function CO(n,e,t,s,r,i){let o=(l,u)=>t[u]?l.route.id!==t[u].route.id:!0,a=(l,u)=>t[u].pathname!==l.pathname||t[u].route.path?.endsWith("*")&&t[u].params["*"]!==l.params["*"];return i==="assets"?e.filter((l,u)=>o(l,u)||a(l,u)):i==="data"?e.filter((l,u)=>{let d=s.routes[l.route.id];if(!d||!d.hasLoader)return!1;if(o(l,u)||a(l,u))return!0;if(l.route.shouldRevalidate){let f=l.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof f=="boolean")return f}return!0}):[]}function k9(n,e,{includeHydrateFallback:t}={}){return N9(n.map(s=>{let r=e.routes[s.route.id];if(!r)return[];let i=[r.module];return r.clientActionModule&&(i=i.concat(r.clientActionModule)),r.clientLoaderModule&&(i=i.concat(r.clientLoaderModule)),t&&r.hydrateFallbackModule&&(i=i.concat(r.hydrateFallbackModule)),r.imports&&(i=i.concat(r.imports)),i}).flat(1))}function N9(n){return[...new Set(n)]}function A9(n){let e={},t=Object.keys(n).sort();for(let s of t)e[s]=n[s];return e}function R9(n,e){let t=new Set;return new Set(e),n.reduce((s,r)=>{let i=JSON.stringify(A9(r));return t.has(i)||(t.add(i),s.push({key:i,link:r})),s},[])}function R3(){let n=te.useContext(Vf);return vI(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function $9(){let n=te.useContext(_w);return vI(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var wI=te.createContext(void 0);wI.displayName="FrameworkContext";function $3(){let n=te.useContext(wI);return vI(n,"You must render this element inside a <HydratedRouter> element"),n}function D9(n,e){let t=te.useContext(wI),[s,r]=te.useState(!1),[i,o]=te.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:u,onMouseLeave:d,onTouchStart:f}=e,m=te.useRef(null);te.useEffect(()=>{if(n==="render"&&o(!0),n==="viewport"){let w=S=>{S.forEach(T=>{o(T.isIntersecting)})},v=new IntersectionObserver(w,{threshold:.5});return m.current&&v.observe(m.current),()=>{v.disconnect()}}},[n]),te.useEffect(()=>{if(s){let w=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(w)}}},[s]);let y=()=>{r(!0)},b=()=>{r(!1),o(!1)};return t?n!=="intent"?[i,m,{}]:[i,m,{onFocus:wm(a,y),onBlur:wm(l,b),onMouseEnter:wm(u,y),onMouseLeave:wm(d,b),onTouchStart:wm(f,y)}]:[!1,m,{}]}function wm(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function O9({page:n,...e}){let{router:t}=R3(),s=te.useMemo(()=>v3(t.routes,n,t.basename),[t.routes,n,t.basename]);return s?te.createElement(M9,{page:n,matches:s,...e}):null}function P9(n){let{manifest:e,routeModules:t}=$3(),[s,r]=te.useState([]);return te.useEffect(()=>{let i=!1;return I9(n,e,t).then(o=>{i||r(o)}),()=>{i=!0}},[n,e,t]),s}function M9({page:n,matches:e,...t}){let s=wh(),{manifest:r,routeModules:i}=$3(),{basename:o}=R3(),{loaderData:a,matches:l}=$9(),u=te.useMemo(()=>CO(n,e,l,r,s,"data"),[n,e,l,r,s]),d=te.useMemo(()=>CO(n,e,l,r,s,"assets"),[n,e,l,r,s]),f=te.useMemo(()=>{if(n===s.pathname+s.search+s.hash)return[];let b=new Set,w=!1;if(e.forEach(S=>{let T=r.routes[S.route.id];!T||!T.hasLoader||(!u.some(I=>I.route.id===S.route.id)&&S.route.id in a&&i[S.route.id]?.shouldRevalidate||T.hasClientLoader?w=!0:b.add(S.route.id))}),b.size===0)return[];let v=C9(n,o,"data");return w&&b.size>0&&v.searchParams.set("_routes",e.filter(S=>b.has(S.route.id)).map(S=>S.route.id).join(",")),[v.pathname+v.search]},[o,a,s,r,u,e,n,i]),m=te.useMemo(()=>k9(d,r),[d,r]),y=P9(d);return te.createElement(te.Fragment,null,f.map(b=>te.createElement("link",{key:b,rel:"prefetch",as:"fetch",href:b,...t})),m.map(b=>te.createElement("link",{key:b,rel:"modulepreload",href:b,...t})),y.map(({key:b,link:w})=>te.createElement("link",{key:b,...w})))}function L9(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var D3=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{D3&&(window.__reactRouterVersion="7.7.1")}catch{}function F9({basename:n,children:e,window:t}){let s=te.useRef();s.current==null&&(s.current=S8({window:t,v5Compat:!0}));let r=s.current,[i,o]=te.useState({action:r.action,location:r.location}),a=te.useCallback(l=>{te.startTransition(()=>o(l))},[o]);return te.useLayoutEffect(()=>r.listen(a),[r,a]),te.createElement(p9,{basename:n,children:e,location:i.location,navigationType:i.action,navigator:r})}var O3=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,nn=te.forwardRef(function({onClick:e,discover:t="render",prefetch:s="none",relative:r,reloadDocument:i,replace:o,state:a,target:l,to:u,preventScrollReset:d,viewTransition:f,...m},y){let{basename:b}=te.useContext(ta),w=typeof u=="string"&&O3.test(u),v,S=!1;if(typeof u=="string"&&w&&(v=u,D3))try{let $=new URL(window.location.href),R=u.startsWith("//")?new URL($.protocol+u):new URL(u),A=Ga(R.pathname,b);R.origin===$.origin&&A!=null?u=A+R.search+R.hash:S=!0}catch{Ko(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let T=Y8(u,{relative:r}),[I,k,O]=D9(s,m),V=B9(u,{replace:o,state:a,target:l,preventScrollReset:d,relative:r,viewTransition:f});function P($){e&&e($),$.defaultPrevented||V($)}let D=te.createElement("a",{...m,...O,href:v||T,onClick:S||i?e:P,ref:L9(y,k),target:l,"data-discover":!w&&t==="render"?"true":void 0});return I&&!w?te.createElement(te.Fragment,null,D,te.createElement(O9,{page:T})):D});nn.displayName="Link";var P3=te.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:s="",end:r=!1,style:i,to:o,viewTransition:a,children:l,...u},d){let f=Jg(o,{relative:u.relative}),m=wh(),y=te.useContext(_w),{navigator:b,basename:w}=te.useContext(ta),v=y!=null&&H9(f)&&a===!0,S=b.encodeLocation?b.encodeLocation(f).pathname:f.pathname,T=m.pathname,I=y&&y.navigation&&y.navigation.location?y.navigation.location.pathname:null;t||(T=T.toLowerCase(),I=I?I.toLowerCase():null,S=S.toLowerCase()),I&&w&&(I=Ga(I,w)||I);const k=S!=="/"&&S.endsWith("/")?S.length-1:S.length;let O=T===S||!r&&T.startsWith(S)&&T.charAt(k)==="/",V=I!=null&&(I===S||!r&&I.startsWith(S)&&I.charAt(S.length)==="/"),P={isActive:O,isPending:V,isTransitioning:v},D=O?e:void 0,$;typeof s=="function"?$=s(P):$=[s,O?"active":null,V?"pending":null,v?"transitioning":null].filter(Boolean).join(" ");let R=typeof i=="function"?i(P):i;return te.createElement(nn,{...u,"aria-current":D,className:$,ref:d,style:R,to:o,viewTransition:a},typeof l=="function"?l(P):l)});P3.displayName="NavLink";var V9=te.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:s,replace:r,state:i,method:o=Dx,action:a,onSubmit:l,relative:u,preventScrollReset:d,viewTransition:f,...m},y)=>{let b=W9(),w=G9(a,{relative:u}),v=o.toLowerCase()==="get"?"get":"post",S=typeof a=="string"&&O3.test(a),T=I=>{if(l&&l(I),I.defaultPrevented)return;I.preventDefault();let k=I.nativeEvent.submitter,O=k?.getAttribute("formmethod")||o;b(k||I.currentTarget,{fetcherKey:e,method:O,navigate:t,replace:r,state:i,relative:u,preventScrollReset:d,viewTransition:f})};return te.createElement("form",{ref:y,method:v,action:w,onSubmit:s?l:T,...m,"data-discover":!S&&n==="render"?"true":void 0})});V9.displayName="Form";function U9(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function M3(n){let e=te.useContext(Vf);return Rn(e,U9(n)),e}function B9(n,{target:e,replace:t,state:s,preventScrollReset:r,relative:i,viewTransition:o}={}){let a=Ec(),l=wh(),u=Jg(n,{relative:i});return te.useCallback(d=>{if(v9(d,e)){d.preventDefault();let f=t!==void 0?t:fg(l)===fg(u);a(n,{replace:f,state:s,preventScrollReset:r,relative:i,viewTransition:o})}},[l,a,u,t,s,e,n,r,i,o])}var z9=0,j9=()=>`__${String(++z9)}__`;function W9(){let{router:n}=M3("useSubmit"),{basename:e}=te.useContext(ta),t=c9();return te.useCallback(async(s,r={})=>{let{action:i,method:o,encType:a,formData:l,body:u}=S9(s,e);if(r.navigate===!1){let d=r.fetcherKey||j9();await n.fetch(d,t,r.action||i,{preventScrollReset:r.preventScrollReset,formData:l,body:u,formMethod:r.method||o,formEncType:r.encType||a,flushSync:r.flushSync})}else await n.navigate(r.action||i,{preventScrollReset:r.preventScrollReset,formData:l,body:u,formMethod:r.method||o,formEncType:r.encType||a,replace:r.replace,state:r.state,fromRouteId:t,flushSync:r.flushSync,viewTransition:r.viewTransition})},[n,e,t])}function G9(n,{relative:e}={}){let{basename:t}=te.useContext(ta),s=te.useContext(na);Rn(s,"useFormAction must be used inside a RouteContext");let[r]=s.matches.slice(-1),i={...Jg(n||".",{relative:e})},o=wh();if(n==null){i.search=o.search;let a=new URLSearchParams(i.search),l=a.getAll("index");if(l.some(d=>d==="")){a.delete("index"),l.filter(f=>f).forEach(f=>a.append("index",f));let d=a.toString();i.search=d?`?${d}`:""}}return(!n||n===".")&&r.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(i.pathname=i.pathname==="/"?t:za([t,i.pathname])),fg(i)}function H9(n,{relative:e}={}){let t=te.useContext(E3);Rn(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=M3("useViewTransitionState"),r=Jg(n,{relative:e});if(!t.isTransitioning)return!1;let i=Ga(t.currentLocation.pathname,s)||t.currentLocation.pathname,o=Ga(t.nextLocation.pathname,s)||t.nextLocation.pathname;return nv(r.pathname,o)!=null||nv(r.pathname,i)!=null}const L3=te.createContext();function F3({children:n}){const[e,t]=te.useState(()=>{const s=localStorage.getItem("darkMode");return s?JSON.parse(s):!1});return te.useEffect(()=>{document.documentElement.classList.toggle("dark",e),localStorage.setItem("darkMode",JSON.stringify(e))},[e]),E.jsx(L3.Provider,{value:{darkMode:e,setDarkMode:t},children:n})}function _I(){return te.useContext(L3)}const q9="modulepreload",K9=function(n){return"/StudiQ/"+n},TO={},Zg=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){let u=function(d){return Promise.all(d.map(f=>Promise.resolve(f).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};var o=u;document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");r=u(t.map(d=>{if(d=K9(d),d in TO)return;TO[d]=!0;const f=d.endsWith(".css"),m=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${m}`))return;const y=document.createElement("link");if(y.rel=f?"stylesheet":q9,f||(y.as="script"),y.crossOrigin="",y.href=d,l&&y.setAttribute("nonce",l),document.head.appendChild(y),f)return new Promise((b,w)=>{y.addEventListener("load",b),y.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return r.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},X9=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Zg(async()=>{const{default:s}=await Promise.resolve().then(()=>Uf);return{default:s}},[]).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class SI extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Y9 extends SI{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class EO extends SI{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class IO extends SI{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var MT;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(MT||(MT={}));var Q9=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(d){try{u(s.next(d))}catch(f){o(f)}}function l(d){try{u(s.throw(d))}catch(f){o(f)}}function u(d){d.done?i(d.value):r(d.value).then(a,l)}u((s=s.apply(n,e||[])).next())})};class J9{constructor(e,{headers:t={},customFetch:s,region:r=MT.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=X9(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Q9(this,void 0,void 0,function*(){try{const{headers:r,method:i,body:o}=t;let a={},{region:l}=t;l||(l=this.region);const u=new URL(`${this.url}/${e}`);l&&l!=="any"&&(a["x-region"]=l,u.searchParams.set("forceFunctionRegion",l));let d;o&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",d=o):typeof o=="string"?(a["Content-Type"]="text/plain",d=o):typeof FormData<"u"&&o instanceof FormData?d=o:(a["Content-Type"]="application/json",d=JSON.stringify(o)));const f=yield this.fetch(u.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),r),body:d}).catch(w=>{throw new Y9(w)}),m=f.headers.get("x-relay-error");if(m&&m==="true")throw new EO(f);if(!f.ok)throw new IO(f);let y=((s=f.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),b;return y==="application/json"?b=yield f.json():y==="application/octet-stream"?b=yield f.blob():y==="text/event-stream"?b=f:y==="multipart/form-data"?b=yield f.formData():b=yield f.text(),{data:b,error:null,response:f}}catch(r){return{data:null,error:r,response:r instanceof IO||r instanceof EO?r.context:void 0}}})}}var Ns={},kd={},Nd={},Ad={},Rd={},$d={},Z9=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},gf=Z9();const e7=gf.fetch,V3=gf.fetch.bind(gf),U3=gf.Headers,t7=gf.Request,n7=gf.Response,Uf=Object.freeze(Object.defineProperty({__proto__:null,Headers:U3,Request:t7,Response:n7,default:V3,fetch:e7},Symbol.toStringTag,{value:"Module"})),s7=x3(Uf);var rx={},kO;function B3(){if(kO)return rx;kO=1,Object.defineProperty(rx,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return rx.default=n,rx}var NO;function z3(){if(NO)return $d;NO=1;var n=$d&&$d.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty($d,"__esModule",{value:!0});const e=n(s7),t=n(B3());class s{constructor(i){this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=i.headers,this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=i.shouldThrowOnError,this.signal=i.signal,this.isMaybeSingle=i.isMaybeSingle,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,o){return this.headers=Object.assign({},this.headers),this.headers[i]=o,this}then(i,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let l=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{var d,f,m;let y=null,b=null,w=null,v=u.status,S=u.statusText;if(u.ok){if(this.method!=="HEAD"){const O=await u.text();O===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?b=O:b=JSON.parse(O))}const I=(d=this.headers.Prefer)===null||d===void 0?void 0:d.match(/count=(exact|planned|estimated)/),k=(f=u.headers.get("content-range"))===null||f===void 0?void 0:f.split("/");I&&k&&k.length>1&&(w=parseInt(k[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(b)&&(b.length>1?(y={code:"PGRST116",details:`Results contain ${b.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},b=null,w=null,v=406,S="Not Acceptable"):b.length===1?b=b[0]:b=null)}else{const I=await u.text();try{y=JSON.parse(I),Array.isArray(y)&&u.status===404&&(b=[],y=null,v=200,S="OK")}catch{u.status===404&&I===""?(v=204,S="No Content"):y={message:I}}if(y&&this.isMaybeSingle&&(!((m=y?.details)===null||m===void 0)&&m.includes("0 rows"))&&(y=null,v=200,S="OK"),y&&this.shouldThrowOnError)throw new t.default(y)}return{error:y,data:b,count:w,status:v,statusText:S}});return this.shouldThrowOnError||(l=l.catch(u=>{var d,f,m;return{error:{message:`${(d=u?.name)!==null&&d!==void 0?d:"FetchError"}: ${u?.message}`,details:`${(f=u?.stack)!==null&&f!==void 0?f:""}`,hint:"",code:`${(m=u?.code)!==null&&m!==void 0?m:""}`},data:null,count:null,status:0,statusText:""}})),l.then(i,o)}returns(){return this}overrideTypes(){return this}}return $d.default=s,$d}var AO;function j3(){if(AO)return Rd;AO=1;var n=Rd&&Rd.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Rd,"__esModule",{value:!0});const e=n(z3());class t extends e.default{select(r){let i=!1;const o=(r??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(r,{ascending:i=!0,nullsFirst:o,foreignTable:a,referencedTable:l=a}={}){const u=l?`${l}.order`:"order",d=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${d?`${d},`:""}${r}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(r,{foreignTable:i,referencedTable:o=i}={}){const a=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(a,`${r}`),this}range(r,i,{foreignTable:o,referencedTable:a=o}={}){const l=typeof a>"u"?"offset":`${a}.offset`,u=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${r}`),this.url.searchParams.set(u,`${i-r+1}`),this}abortSignal(r){return this.signal=r,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:r=!1,verbose:i=!1,settings:o=!1,buffers:a=!1,wal:l=!1,format:u="text"}={}){var d;const f=[r?"analyze":null,i?"verbose":null,o?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),m=(d=this.headers.Accept)!==null&&d!==void 0?d:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${u}; for="${m}"; options=${f};`,u==="json"?this:this}rollback(){var r;return((r=this.headers.Prefer)!==null&&r!==void 0?r:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return Rd.default=t,Rd}var RO;function CI(){if(RO)return Ad;RO=1;var n=Ad&&Ad.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ad,"__esModule",{value:!0});const e=n(j3());class t extends e.default{eq(r,i){return this.url.searchParams.append(r,`eq.${i}`),this}neq(r,i){return this.url.searchParams.append(r,`neq.${i}`),this}gt(r,i){return this.url.searchParams.append(r,`gt.${i}`),this}gte(r,i){return this.url.searchParams.append(r,`gte.${i}`),this}lt(r,i){return this.url.searchParams.append(r,`lt.${i}`),this}lte(r,i){return this.url.searchParams.append(r,`lte.${i}`),this}like(r,i){return this.url.searchParams.append(r,`like.${i}`),this}likeAllOf(r,i){return this.url.searchParams.append(r,`like(all).{${i.join(",")}}`),this}likeAnyOf(r,i){return this.url.searchParams.append(r,`like(any).{${i.join(",")}}`),this}ilike(r,i){return this.url.searchParams.append(r,`ilike.${i}`),this}ilikeAllOf(r,i){return this.url.searchParams.append(r,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(r,i){return this.url.searchParams.append(r,`ilike(any).{${i.join(",")}}`),this}is(r,i){return this.url.searchParams.append(r,`is.${i}`),this}in(r,i){const o=Array.from(new Set(i)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(r,`in.(${o})`),this}contains(r,i){return typeof i=="string"?this.url.searchParams.append(r,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(r,`cs.{${i.join(",")}}`):this.url.searchParams.append(r,`cs.${JSON.stringify(i)}`),this}containedBy(r,i){return typeof i=="string"?this.url.searchParams.append(r,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(r,`cd.{${i.join(",")}}`):this.url.searchParams.append(r,`cd.${JSON.stringify(i)}`),this}rangeGt(r,i){return this.url.searchParams.append(r,`sr.${i}`),this}rangeGte(r,i){return this.url.searchParams.append(r,`nxl.${i}`),this}rangeLt(r,i){return this.url.searchParams.append(r,`sl.${i}`),this}rangeLte(r,i){return this.url.searchParams.append(r,`nxr.${i}`),this}rangeAdjacent(r,i){return this.url.searchParams.append(r,`adj.${i}`),this}overlaps(r,i){return typeof i=="string"?this.url.searchParams.append(r,`ov.${i}`):this.url.searchParams.append(r,`ov.{${i.join(",")}}`),this}textSearch(r,i,{config:o,type:a}={}){let l="";a==="plain"?l="pl":a==="phrase"?l="ph":a==="websearch"&&(l="w");const u=o===void 0?"":`(${o})`;return this.url.searchParams.append(r,`${l}fts${u}.${i}`),this}match(r){return Object.entries(r).forEach(([i,o])=>{this.url.searchParams.append(i,`eq.${o}`)}),this}not(r,i,o){return this.url.searchParams.append(r,`not.${i}.${o}`),this}or(r,{foreignTable:i,referencedTable:o=i}={}){const a=o?`${o}.or`:"or";return this.url.searchParams.append(a,`(${r})`),this}filter(r,i,o){return this.url.searchParams.append(r,`${i}.${o}`),this}}return Ad.default=t,Ad}var $O;function W3(){if($O)return Nd;$O=1;var n=Nd&&Nd.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Nd,"__esModule",{value:!0});const e=n(CI());class t{constructor(r,{headers:i={},schema:o,fetch:a}){this.url=r,this.headers=i,this.schema=o,this.fetch=a}select(r,{head:i=!1,count:o}={}){const a=i?"HEAD":"GET";let l=!1;const u=(r??"*").split("").map(d=>/\s/.test(d)&&!l?"":(d==='"'&&(l=!l),d)).join("");return this.url.searchParams.set("select",u),o&&(this.headers.Prefer=`count=${o}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(r,{count:i,defaultToNull:o=!0}={}){const a="POST",l=[];if(this.headers.Prefer&&l.push(this.headers.Prefer),i&&l.push(`count=${i}`),o||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(r)){const u=r.reduce((d,f)=>d.concat(Object.keys(f)),[]);if(u.length>0){const d=[...new Set(u)].map(f=>`"${f}"`);this.url.searchParams.set("columns",d.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}upsert(r,{onConflict:i,ignoreDuplicates:o=!1,count:a,defaultToNull:l=!0}={}){const u="POST",d=[`resolution=${o?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&d.push(this.headers.Prefer),a&&d.push(`count=${a}`),l||d.push("missing=default"),this.headers.Prefer=d.join(","),Array.isArray(r)){const f=r.reduce((m,y)=>m.concat(Object.keys(y)),[]);if(f.length>0){const m=[...new Set(f)].map(y=>`"${y}"`);this.url.searchParams.set("columns",m.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}update(r,{count:i}={}){const o="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),this.headers.Prefer=a.join(","),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}delete({count:r}={}){const i="DELETE",o=[];return r&&o.push(`count=${r}`),this.headers.Prefer&&o.unshift(this.headers.Prefer),this.headers.Prefer=o.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return Nd.default=t,Nd}var _m={},Sm={},DO;function r7(){return DO||(DO=1,Object.defineProperty(Sm,"__esModule",{value:!0}),Sm.version=void 0,Sm.version="0.0.0-automated"),Sm}var OO;function i7(){if(OO)return _m;OO=1,Object.defineProperty(_m,"__esModule",{value:!0}),_m.DEFAULT_HEADERS=void 0;const n=r7();return _m.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${n.version}`},_m}var PO;function o7(){if(PO)return kd;PO=1;var n=kd&&kd.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(kd,"__esModule",{value:!0});const e=n(W3()),t=n(CI()),s=i7();class r{constructor(o,{headers:a={},schema:l,fetch:u}={}){this.url=o,this.headers=Object.assign(Object.assign({},s.DEFAULT_HEADERS),a),this.schemaName=l,this.fetch=u}from(o){const a=new URL(`${this.url}/${o}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new r(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,a={},{head:l=!1,get:u=!1,count:d}={}){let f;const m=new URL(`${this.url}/rpc/${o}`);let y;l||u?(f=l?"HEAD":"GET",Object.entries(a).filter(([w,v])=>v!==void 0).map(([w,v])=>[w,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([w,v])=>{m.searchParams.append(w,v)})):(f="POST",y=a);const b=Object.assign({},this.headers);return d&&(b.Prefer=`count=${d}`),new t.default({method:f,url:m,headers:b,schema:this.schemaName,body:y,fetch:this.fetch,allowEmpty:!1})}}return kd.default=r,kd}var MO;function a7(){if(MO)return Ns;MO=1;var n=Ns&&Ns.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Ns,"__esModule",{value:!0}),Ns.PostgrestError=Ns.PostgrestBuilder=Ns.PostgrestTransformBuilder=Ns.PostgrestFilterBuilder=Ns.PostgrestQueryBuilder=Ns.PostgrestClient=void 0;const e=n(o7());Ns.PostgrestClient=e.default;const t=n(W3());Ns.PostgrestQueryBuilder=t.default;const s=n(CI());Ns.PostgrestFilterBuilder=s.default;const r=n(j3());Ns.PostgrestTransformBuilder=r.default;const i=n(z3());Ns.PostgrestBuilder=i.default;const o=n(B3());return Ns.PostgrestError=o.default,Ns.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:s.default,PostgrestTransformBuilder:r.default,PostgrestBuilder:i.default,PostgrestError:o.default},Ns}var l7=a7();const c7=vw(l7),{PostgrestClient:u7,PostgrestQueryBuilder:dOe,PostgrestFilterBuilder:fOe,PostgrestTransformBuilder:pOe,PostgrestBuilder:mOe,PostgrestError:gOe}=c7;function h7(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const d7=h7(),f7="2.11.15",p7=`realtime-js/${f7}`,m7="1.0.0",G3=1e4,g7=1e3;var Km;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Km||(Km={}));var lr;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(lr||(lr={}));var qi;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(qi||(qi={}));var LT;(function(n){n.websocket="websocket"})(LT||(LT={}));var Ru;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Ru||(Ru={}));class y7{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const r=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=s.decode(e.slice(o,o+r));o=o+r;const l=s.decode(e.slice(o,o+i));o=o+i;const u=JSON.parse(s.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:l,payload:u}}}class H3{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var gn;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(gn||(gn={}));const LO=(n,e,t={})=>{var s;const r=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((i,o)=>(i[o]=b7(o,n,e,r),i),{})},b7=(n,e,t,s)=>{const r=e.find(a=>a.name===n),i=r?.type,o=t[n];return i&&!s.includes(i)?q3(i,o):FT(o)},q3=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return _7(e,t)}switch(n){case gn.bool:return x7(e);case gn.float4:case gn.float8:case gn.int2:case gn.int4:case gn.int8:case gn.numeric:case gn.oid:return v7(e);case gn.json:case gn.jsonb:return w7(e);case gn.timestamp:return S7(e);case gn.abstime:case gn.date:case gn.daterange:case gn.int4range:case gn.int8range:case gn.money:case gn.reltime:case gn.text:case gn.time:case gn.timestamptz:case gn.timetz:case gn.tsrange:case gn.tstzrange:return FT(e);default:return FT(e)}},FT=n=>n,x7=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},v7=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},w7=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},_7=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,s=n[t];if(n[0]==="{"&&s==="}"){let i;const o=n.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>q3(e,a))}return n},S7=n=>typeof n=="string"?n.replace(" ","T"):n,K3=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class UC{constructor(e,t,s={},r=G3){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var FO;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(FO||(FO={}));class Xm{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},r=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Xm.syncState(this.state,r,i,o),this.pendingDiffs.forEach(l=>{this.state=Xm.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(s.diff,{},r=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(r):(this.state=Xm.syncDiff(this.state,r,i,o),a())}),this.onJoin((r,i,o)=>{this.channel._trigger("presence",{event:"join",key:r,currentPresences:i,newPresences:o})}),this.onLeave((r,i,o)=>{this.channel._trigger("presence",{event:"leave",key:r,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,r){const i=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(i,(u,d)=>{o[u]||(l[u]=d)}),this.map(o,(u,d)=>{const f=i[u];if(f){const m=d.map(v=>v.presence_ref),y=f.map(v=>v.presence_ref),b=d.filter(v=>y.indexOf(v.presence_ref)<0),w=f.filter(v=>m.indexOf(v.presence_ref)<0);b.length>0&&(a[u]=b),w.length>0&&(l[u]=w)}else a[u]=d}),this.syncDiff(i,{joins:a,leaves:l},s,r)}static syncDiff(e,t,s,r){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(i,(a,l)=>{var u;const d=(u=e[a])!==null&&u!==void 0?u:[];if(e[a]=this.cloneDeep(l),d.length>0){const f=e[a].map(y=>y.presence_ref),m=d.filter(y=>f.indexOf(y.presence_ref)<0);e[a].unshift(...m)}s(a,d,l)}),this.map(o,(a,l)=>{let u=e[a];if(!u)return;const d=l.map(f=>f.presence_ref);u=u.filter(f=>d.indexOf(f.presence_ref)<0),e[a]=u,r(a,u,l),u.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const r=e[s];return"metas"in r?t[s]=r.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var VO;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(VO||(VO={}));var UO;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(UO||(UO={}));var Oa;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Oa||(Oa={}));class TI{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=lr.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new UC(this,qi.join,this.params,this.timeout),this.rejoinTimer=new H3(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=lr.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(r=>r.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=lr.closed,this.socket._remove(this)}),this._onError(r=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,r),this.state=lr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=lr.errored,this.rejoinTimer.scheduleTimeout())}),this._on(qi.reply,{},(r,i)=>{this._trigger(this._replyEventName(i),r)}),this.presence=new Xm(this),this.broadcastEndpointURL=K3(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,r;if(this.socket.isConnected()||this.socket.connect(),this.state==lr.closed){const{config:{broadcast:i,presence:o,private:a}}=this.params;this._onError(d=>e?.(Oa.CHANNEL_ERROR,d)),this._onClose(()=>e?.(Oa.CLOSED));const l={},u={broadcast:i,presence:o,postgres_changes:(r=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(d=>d.filter))!==null&&r!==void 0?r:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:u},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:d})=>{var f;if(this.socket.setAuth(),d===void 0){e?.(Oa.SUBSCRIBED);return}else{const m=this.bindings.postgres_changes,y=(f=m?.length)!==null&&f!==void 0?f:0,b=[];for(let w=0;w<y;w++){const v=m[w],{filter:{event:S,schema:T,table:I,filter:k}}=v,O=d&&d[w];if(O&&O.event===S&&O.schema===T&&O.table===I&&O.filter===k)b.push(Object.assign(Object.assign({},v),{id:O.id}));else{this.unsubscribe(),this.state=lr.errored,e?.(Oa.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=b,e&&e(Oa.SUBSCRIBED);return}}).receive("error",d=>{this.state=lr.errored,e?.(Oa.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(d).join(", ")||"error")))}).receive("timeout",()=>{e?.(Oa.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,r;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((r=u.body)===null||r===void 0?void 0:r.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=lr.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(qi.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(r=>{s=new UC(this,qi.leave,{},e),s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,s){const r=new AbortController,i=setTimeout(()=>r.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(i),o}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new UC(this,e,t,s);return this._canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:u,join:d}=qi;if(s&&[a,l,u,d].indexOf(o)>=0&&s!==this._joinRef())return;let m=this._onMessage(o,t,s);if(t&&!m)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(r=this.bindings.postgres_changes)===null||r===void 0||r.filter(y=>{var b,w,v;return((b=y.filter)===null||b===void 0?void 0:b.event)==="*"||((v=(w=y.filter)===null||w===void 0?void 0:w.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===o}).map(y=>y.callback(m,s)):(i=this.bindings[o])===null||i===void 0||i.filter(y=>{var b,w,v,S,T,I;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in y){const k=y.id,O=(b=y.filter)===null||b===void 0?void 0:b.event;return k&&((w=t.ids)===null||w===void 0?void 0:w.includes(k))&&(O==="*"||O?.toLocaleLowerCase()===((v=t.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const k=(T=(S=y?.filter)===null||S===void 0?void 0:S.event)===null||T===void 0?void 0:T.toLocaleLowerCase();return k==="*"||k===((I=t?.event)===null||I===void 0?void 0:I.toLocaleLowerCase())}else return y.type.toLocaleLowerCase()===o}).map(y=>{if(typeof m=="object"&&"ids"in m){const b=m.data,{schema:w,table:v,commit_timestamp:S,type:T,errors:I}=b;m=Object.assign(Object.assign({},{schema:w,table:v,commit_timestamp:S,eventType:T,new:{},old:{},errors:I}),this._getPayloadRecords(b))}y.callback(m,s)})}_isClosed(){return this.state===lr.closed}_isJoined(){return this.state===lr.joined}_isJoining(){return this.state===lr.joining}_isLeaving(){return this.state===lr.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const r=e.toLocaleLowerCase(),i={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(i):this.bindings[r]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(r=>{var i;return!(((i=r.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&TI.isEqual(r.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(qi.close,{},e)}_onError(e){this._on(qi.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=lr.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=LO(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=LO(e.columns,e.old_record)),t}}const BO=()=>{},C7=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class T7{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=G3,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=BO,this.ref=0,this.logger=BO,this.conn=null,this.sendBuffer=[],this.serializer=new y7,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...a)=>Zg(async()=>{const{default:l}=await Promise.resolve().then(()=>Uf);return{default:l}},void 0).then(({default:l})=>l(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${LT.websocket}`,this.httpEndpoint=K3(e),t?.transport?this.transport=t.transport:this.transport=null,t?.params&&(this.params=t.params),t?.timeout&&(this.timeout=t.timeout),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const r=(s=t?.params)===null||s===void 0?void 0:s.apikey;if(r&&(this.accessTokenValue=r,this.apiKey=r),this.reconnectAfterMs=t?.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t?.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t?.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new H3(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t?.fetch),t?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=t?.worker||!1,this.workerUrl=t?.workerUrl}this.accessToken=t?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=d7),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:m7}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(s=>s.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Km.connecting:return Ru.Connecting;case Km.open:return Ru.Open;case Km.closing:return Ru.Closing;default:return Ru.Closed}}isConnected(){return this.connectionState()===Ru.Open}channel(e,t={config:{}}){const s=`realtime:${e}`,r=this.getChannels().find(i=>i.topic===s);if(r)return r;{const i=new TI(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:s,payload:r,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${s} (${i})`,r),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{const r={access_token:t,version:p7};t&&s.updateJoinPayload(r),s.joinedOnce&&s._isJoined()&&s._push(qi.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(g7,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:r,payload:i,ref:o}=t;s==="phoenix"&&r==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${s} ${r} ${o&&"("+o+")"||""}`,i),Array.from(this.channels).filter(a=>a._isMember(s)).forEach(a=>a._trigger(r,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(qi.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return`${e}${s}${r}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([C7],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class EI extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function As(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class E7 extends EI{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class VT extends EI{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var I7=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(d){try{u(s.next(d))}catch(f){o(f)}}function l(d){try{u(s.throw(d))}catch(f){o(f)}}function u(d){d.done?i(d.value):r(d.value).then(a,l)}u((s=s.apply(n,e||[])).next())})};const X3=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Zg(async()=>{const{default:s}=await Promise.resolve().then(()=>Uf);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},k7=()=>I7(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Zg(()=>Promise.resolve().then(()=>Uf),void 0)).Response:Response}),UT=n=>{if(Array.isArray(n))return n.map(t=>UT(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,s])=>{const r=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[r]=UT(s)}),e};var _h=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(d){try{u(s.next(d))}catch(f){o(f)}}function l(d){try{u(s.throw(d))}catch(f){o(f)}}function u(d){d.done?i(d.value):r(d.value).then(a,l)}u((s=s.apply(n,e||[])).next())})};const BC=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),N7=(n,e,t)=>_h(void 0,void 0,void 0,function*(){const s=yield k7();n instanceof s&&!t?.noResolveJson?n.json().then(r=>{e(new E7(BC(r),n.status||500))}).catch(r=>{e(new VT(BC(r),r))}):e(new VT(BC(n),n))}),A7=(n,e,t,s)=>{const r={method:n,headers:e?.headers||{}};return n==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json"},e?.headers),s&&(r.body=JSON.stringify(s)),Object.assign(Object.assign({},r),t))};function ey(n,e,t,s,r,i){return _h(this,void 0,void 0,function*(){return new Promise((o,a)=>{n(t,A7(e,s,r,i)).then(l=>{if(!l.ok)throw l;return s?.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>N7(l,a,s))})})}function sv(n,e,t,s){return _h(this,void 0,void 0,function*(){return ey(n,"GET",e,t,s)})}function zl(n,e,t,s,r){return _h(this,void 0,void 0,function*(){return ey(n,"POST",e,s,r,t)})}function R7(n,e,t,s,r){return _h(this,void 0,void 0,function*(){return ey(n,"PUT",e,s,r,t)})}function $7(n,e,t,s){return _h(this,void 0,void 0,function*(){return ey(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function Y3(n,e,t,s,r){return _h(this,void 0,void 0,function*(){return ey(n,"DELETE",e,s,r,t)})}var Pr=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(d){try{u(s.next(d))}catch(f){o(f)}}function l(d){try{u(s.throw(d))}catch(f){o(f)}}function u(d){d.done?i(d.value):r(d.value).then(a,l)}u((s=s.apply(n,e||[])).next())})};const D7={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},zO={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class O7{constructor(e,t={},s,r){this.url=e,this.headers=t,this.bucketId=s,this.fetch=X3(r)}uploadOrUpdate(e,t,s,r){return Pr(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},zO),r);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=s,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),r?.headers&&(a=Object.assign(Object.assign({},a),r.headers));const u=this._removeEmptyFolders(t),d=this._getFinalPath(u),f=yield this.fetch(`${this.url}/object/${d}`,Object.assign({method:e,body:i,headers:a},o?.duplex?{duplex:o.duplex}:{})),m=yield f.json();return f.ok?{data:{path:u,id:m.Id,fullPath:m.Key},error:null}:{data:null,error:m}}catch(i){if(As(i))return{data:null,error:i};throw i}})}upload(e,t,s){return Pr(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,r){return Pr(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let l;const u=Object.assign({upsert:zO.upsert},r),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&s instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",s)):typeof FormData<"u"&&s instanceof FormData?(l=s,l.append("cacheControl",u.cacheControl)):(l=s,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType);const f=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:d}),m=yield f.json();return f.ok?{data:{path:i,fullPath:m.Key},error:null}:{data:null,error:m}}catch(l){if(As(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return Pr(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const r=Object.assign({},this.headers);t?.upsert&&(r["x-upsert"]="true");const i=yield zl(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new EI("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(s){if(As(s))return{data:null,error:s};throw s}})}update(e,t,s){return Pr(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return Pr(this,void 0,void 0,function*(){try{return{data:yield zl(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(As(r))return{data:null,error:r};throw r}})}copy(e,t,s){return Pr(this,void 0,void 0,function*(){try{return{data:{path:(yield zl(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(As(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,s){return Pr(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),i=yield zl(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},s?.transform?{transform:s.transform}:{}),{headers:this.headers});const o=s?.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(r){if(As(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,s){return Pr(this,void 0,void 0,function*(){try{const r=yield zl(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s?.download?`&download=${s.download===!0?"":s.download}`:"";return{data:r.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(r){if(As(r))return{data:null,error:r};throw r}})}download(e,t){return Pr(this,void 0,void 0,function*(){const r=typeof t?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(t?.transform||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield sv(this.fetch,`${this.url}/${r}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(As(a))return{data:null,error:a};throw a}})}info(e){return Pr(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield sv(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:UT(s),error:null}}catch(s){if(As(s))return{data:null,error:s};throw s}})}exists(e){return Pr(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield $7(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(As(s)&&s instanceof VT){const r=s.originalError;if([400,404].includes(r?.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),r=[],i=t?.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&r.push(i);const a=typeof t?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(t?.transform||{});l!==""&&r.push(l);let u=r.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${s}${u}`)}}}remove(e){return Pr(this,void 0,void 0,function*(){try{return{data:yield Y3(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(As(t))return{data:null,error:t};throw t}})}list(e,t,s){return Pr(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},D7),t),{prefix:e||""});return{data:yield zl(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(As(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const P7="2.7.1",M7={"X-Client-Info":`storage-js/${P7}`};var Dd=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(d){try{u(s.next(d))}catch(f){o(f)}}function l(d){try{u(s.throw(d))}catch(f){o(f)}}function u(d){d.done?i(d.value):r(d.value).then(a,l)}u((s=s.apply(n,e||[])).next())})};class L7{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},M7),t),this.fetch=X3(s)}listBuckets(){return Dd(this,void 0,void 0,function*(){try{return{data:yield sv(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(As(e))return{data:null,error:e};throw e}})}getBucket(e){return Dd(this,void 0,void 0,function*(){try{return{data:yield sv(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(As(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Dd(this,void 0,void 0,function*(){try{return{data:yield zl(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(As(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return Dd(this,void 0,void 0,function*(){try{return{data:yield R7(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(As(s))return{data:null,error:s};throw s}})}emptyBucket(e){return Dd(this,void 0,void 0,function*(){try{return{data:yield zl(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(As(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Dd(this,void 0,void 0,function*(){try{return{data:yield Y3(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(As(t))return{data:null,error:t};throw t}})}}class F7 extends L7{constructor(e,t={},s){super(e,t,s)}from(e){return new O7(this.url,this.headers,e,this.fetch)}}const V7="2.52.1";let Om="";typeof Deno<"u"?Om="deno":typeof document<"u"?Om="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Om="react-native":Om="node";const U7={"X-Client-Info":`supabase-js-${Om}/${V7}`},B7={headers:U7},z7={schema:"public"},j7={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},W7={};var G7=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(d){try{u(s.next(d))}catch(f){o(f)}}function l(d){try{u(s.throw(d))}catch(f){o(f)}}function u(d){d.done?i(d.value):r(d.value).then(a,l)}u((s=s.apply(n,e||[])).next())})};const H7=n=>{let e;return n?e=n:typeof fetch>"u"?e=V3:e=fetch,(...t)=>e(...t)},q7=()=>typeof Headers>"u"?U3:Headers,K7=(n,e,t)=>{const s=H7(t),r=q7();return(i,o)=>G7(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:n;let u=new r(o?.headers);return u.has("apikey")||u.set("apikey",n),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),s(i,Object.assign(Object.assign({},o),{headers:u}))})};var X7=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(d){try{u(s.next(d))}catch(f){o(f)}}function l(d){try{u(s.throw(d))}catch(f){o(f)}}function u(d){d.done?i(d.value):r(d.value).then(a,l)}u((s=s.apply(n,e||[])).next())})};function Y7(n){return n.endsWith("/")?n:n+"/"}function Q7(n,e){var t,s;const{db:r,auth:i,realtime:o,global:a}=n,{db:l,auth:u,realtime:d,global:f}=e,m={db:Object.assign(Object.assign({},l),r),auth:Object.assign(Object.assign({},u),i),realtime:Object.assign(Object.assign({},d),o),global:Object.assign(Object.assign(Object.assign({},f),a),{headers:Object.assign(Object.assign({},(t=f?.headers)!==null&&t!==void 0?t:{}),(s=a?.headers)!==null&&s!==void 0?s:{})}),accessToken:()=>X7(this,void 0,void 0,function*(){return""})};return n.accessToken?m.accessToken=n.accessToken:delete m.accessToken,m}const Q3="2.71.1",jd=30*1e3,BT=3,zC=BT*jd,J7="http://localhost:9999",Z7="supabase.auth.token",eK={"X-Client-Info":`gotrue-js/${Q3}`},zT="X-Supabase-Api-Version",J3={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},tK=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,nK=600*1e3;class II extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function at(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class sK extends II{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function rK(n){return at(n)&&n.name==="AuthApiError"}class Z3 extends II{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ic extends II{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class Bl extends Ic{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function iK(n){return at(n)&&n.name==="AuthSessionMissingError"}class ix extends Ic{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ox extends Ic{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ax extends Ic{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function oK(n){return at(n)&&n.name==="AuthImplicitGrantRedirectError"}class jO extends Ic{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class jT extends Ic{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function jC(n){return at(n)&&n.name==="AuthRetryableFetchError"}class WO extends Ic{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class WT extends Ic{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const rv="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),GO=` 	
\r=`.split(""),aK=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<GO.length;e+=1)n[GO[e].charCodeAt(0)]=-2;for(let e=0;e<rv.length;e+=1)n[rv[e].charCodeAt(0)]=e;return n})();function HO(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(rv[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(rv[s]),e.queuedBits-=6}}function e4(n,e,t){const s=aK[n];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function qO(n){const e=[],t=o=>{e.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},i=o=>{uK(o,s,t)};for(let o=0;o<n.length;o+=1)e4(n.charCodeAt(o),r,i);return e.join("")}function lK(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function cK(n,e){for(let t=0;t<n.length;t+=1){let s=n.charCodeAt(t);if(s>55295&&s<=56319){const r=(s-55296)*1024&65535;s=(n.charCodeAt(t+1)-56320&65535|r)+65536,t+=1}lK(s,e)}}function uK(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let s=1;s<6;s+=1)if((n>>7-s&1)===0){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function hK(n){const e=[],t={queue:0,queuedBits:0},s=r=>{e.push(r)};for(let r=0;r<n.length;r+=1)e4(n.charCodeAt(r),t,s);return new Uint8Array(e)}function dK(n){const e=[];return cK(n,t=>e.push(t)),new Uint8Array(e)}function fK(n){const e=[],t={queue:0,queuedBits:0},s=r=>{e.push(r)};return n.forEach(r=>HO(r,t,s)),HO(null,t,s),e.join("")}function pK(n){return Math.round(Date.now()/1e3)+n}function mK(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const Gi=()=>typeof window<"u"&&typeof document<"u",_u={tested:!1,writable:!1},t4=()=>{if(!Gi())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(_u.tested)return _u.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),_u.tested=!0,_u.writable=!0}catch{_u.tested=!0,_u.writable=!1}return _u.writable};function gK(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((r,i)=>{e[i]=r})}catch{}return t.searchParams.forEach((s,r)=>{e[r]=s}),e}const n4=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Zg(async()=>{const{default:s}=await Promise.resolve().then(()=>Uf);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},yK=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Wd=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Su=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Fl=async(n,e)=>{await n.removeItem(e)};let s4=class r4{constructor(){this.promise=new r4.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}};s4.promiseConstructor=Promise;function WC(n){const e=n.split(".");if(e.length!==3)throw new WT("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!tK.test(e[s]))throw new WT("JWT not in base64url format");return{header:JSON.parse(qO(e[0])),payload:JSON.parse(qO(e[1])),signature:hK(e[2]),raw:{header:e[0],payload:e[1]}}}async function bK(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function xK(n,e){return new Promise((s,r)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await n(i);if(!e(i,null,o)){s(o);return}}catch(o){if(!e(i,o)){r(o);return}}})()})}function vK(n){return("0"+n.toString(16)).substr(-2)}function wK(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let r="";for(let i=0;i<56;i++)r+=t.charAt(Math.floor(Math.random()*s));return r}return crypto.getRandomValues(e),Array.from(e,vK).join("")}async function _K(n){const t=new TextEncoder().encode(n),s=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(s);return Array.from(r).map(i=>String.fromCharCode(i)).join("")}async function SK(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await _K(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Od(n,e,t=!1){const s=wK();let r=s;t&&(r+="/PASSWORD_RECOVERY"),await Wd(n,`${e}-code-verifier`,r);const i=await SK(s);return[i,s===i?"plain":"s256"]}const CK=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function TK(n){const e=n.headers.get(zT);if(!e||!e.match(CK))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function EK(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function IK(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const kK=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Pd(n){if(!kK.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function GC(){const n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const s=t.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function KO(n){return JSON.parse(JSON.stringify(n))}var NK=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};const Eu=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),AK=[502,503,504];async function XO(n){var e;if(!yK(n))throw new jT(Eu(n),0);if(AK.includes(n.status))throw new jT(Eu(n),n.status);let t;try{t=await n.json()}catch(i){throw new Z3(Eu(i),i)}let s;const r=TK(n);if(r&&r.getTime()>=J3["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new WO(Eu(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new Bl}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new WO(Eu(t),n.status,t.weak_password.reasons);throw new sK(Eu(t),n.status||500,s)}const RK=(n,e,t,s)=>{const r={method:n,headers:e?.headers||{}};return n==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),r.body=JSON.stringify(s),Object.assign(Object.assign({},r),t))};async function _t(n,e,t,s){var r;const i=Object.assign({},s?.headers);i[zT]||(i[zT]=J3["2024-01-01"].name),s?.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const o=(r=s?.query)!==null&&r!==void 0?r:{};s?.redirectTo&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await $K(n,e,t+a,{headers:i,noResolveJson:s?.noResolveJson},{},s?.body);return s?.xform?s?.xform(l):{data:Object.assign({},l),error:null}}async function $K(n,e,t,s,r,i){const o=RK(e,s,r,i);let a;try{a=await n(t,Object.assign({},o))}catch(l){throw console.error(l),new jT(Eu(l),0)}if(a.ok||await XO(a),s?.noResolveJson)return a;try{return await a.json()}catch(l){await XO(l)}}function $a(n){var e;let t=null;MK(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=pK(n.expires_in)));const s=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:s},error:null}}function YO(n){const e=$a(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=n.weak_password),e}function Wl(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function DK(n){return{data:n,error:null}}function OK(n){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:r,verification_type:i}=n,o=NK(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:s,redirect_to:r,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function PK(n){return n}function MK(n){return n.access_token&&n.refresh_token&&n.expires_in}const HC=["global","local","others"];var LK=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class FK{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=n4(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=HC[0]){if(HC.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${HC.join(", ")}`);try{return await _t(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(at(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await _t(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Wl})}catch(s){if(at(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=LK(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=s?.newEmail,delete r.newEmail),await _t(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:OK,redirectTo:t?.redirectTo})}catch(t){if(at(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await _t(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Wl})}catch(t){if(at(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,r,i,o,a,l;try{const u={nextPage:null,lastPage:0,total:0},d=await _t(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(r=e?.perPage)===null||r===void 0?void 0:r.toString())!==null&&i!==void 0?i:""},xform:PK});if(d.error)throw d.error;const f=await d.json(),m=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,y=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return y.length>0&&(y.forEach(b=>{const w=parseInt(b.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(b.split(";")[1].split("=")[1]);u[`${v}Page`]=w}),u.total=parseInt(m)),{data:Object.assign(Object.assign({},f),u),error:null}}catch(u){if(at(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){Pd(e);try{return await _t(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Wl})}catch(t){if(at(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Pd(e);try{return await _t(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Wl})}catch(s){if(at(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){Pd(e);try{return await _t(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Wl})}catch(s){if(at(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){Pd(e.userId);try{const{data:t,error:s}=await _t(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:r=>({data:{factors:r},error:null})});return{data:t,error:s}}catch(t){if(at(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Pd(e.userId),Pd(e.id);try{return{data:await _t(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(at(t))return{data:null,error:t};throw t}}}function QO(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function VK(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Md={debug:!!(globalThis&&t4()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class i4 extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class UK extends i4{}async function BK(n,e,t){Md.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),Md.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async r=>{if(r){Md.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,r.name);try{return await t()}finally{Md.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,r.name)}}else{if(e===0)throw Md.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new UK(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Md.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}VK();const zK={url:J7,storageKey:Z7,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:eK,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function JO(n,e,t){return await t()}const Ld={};class pg{constructor(e){var t,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=pg.nextInstanceID,pg.nextInstanceID+=1,this.instanceID>0&&Gi()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},zK),e);if(this.logDebugMessages=!!r.debug,typeof r.debug=="function"&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new FK({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=n4(r.fetch),this.lock=r.lock||JO,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:Gi()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=BK:this.lock=JO,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:t4()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=QO(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=QO(this.memoryStorage)),Gi()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=Ld[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Ld[this.storageKey]=Object.assign(Object.assign({},Ld[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Ld[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Ld[this.storageKey]=Object.assign(Object.assign({},Ld[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Q3}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=gK(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),Gi()&&this.detectSessionInUrl&&s!=="none"){const{data:r,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),oK(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=r;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return at(t)?{error:t}:{error:new Z3("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,r;try{const i=await _t(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(r=e?.options)===null||r===void 0?void 0:r.captchaToken}},xform:$a}),{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(i){if(at(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,r;try{let i;if("email"in e){const{email:d,password:f,options:m}=e;let y=null,b=null;this.flowType==="pkce"&&([y,b]=await Od(this.storage,this.storageKey)),i=await _t(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:m?.emailRedirectTo,body:{email:d,password:f,data:(t=m?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:m?.captchaToken},code_challenge:y,code_challenge_method:b},xform:$a})}else if("phone"in e){const{phone:d,password:f,options:m}=e;i=await _t(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:f,data:(s=m?.data)!==null&&s!==void 0?s:{},channel:(r=m?.channel)!==null&&r!==void 0?r:"sms",gotrue_meta_security:{captcha_token:m?.captchaToken}},xform:$a})}else throw new ox("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(i){if(at(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:a}=e;t=await _t(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:YO})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=await _t(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:YO})}else throw new ox("You must provide either an email or phone number and a password");const{data:s,error:r}=t;return r?{data:{user:null,session:null},error:r}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new ix}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r})}catch(t){if(at(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,r,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(r=e.options)===null||r===void 0?void 0:r.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,s,r,i,o,a,l,u,d,f,m,y;let b,w;if("message"in e)b=e.message,w=e.signature;else{const{chain:v,wallet:S,statement:T,options:I}=e;let k;if(Gi())if(typeof S=="object")k=S;else{const V=window;if("solana"in V&&typeof V.solana=="object"&&("signIn"in V.solana&&typeof V.solana.signIn=="function"||"signMessage"in V.solana&&typeof V.solana.signMessage=="function"))k=V.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof S!="object"||!I?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");k=S}const O=new URL((t=I?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in k&&k.signIn){const V=await k.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},I?.signInWithSolana),{version:"1",domain:O.host,uri:O.href}),T?{statement:T}:null));let P;if(Array.isArray(V)&&V[0]&&typeof V[0]=="object")P=V[0];else if(V&&typeof V=="object"&&"signedMessage"in V&&"signature"in V)P=V;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in P&&"signature"in P&&(typeof P.signedMessage=="string"||P.signedMessage instanceof Uint8Array)&&P.signature instanceof Uint8Array)b=typeof P.signedMessage=="string"?P.signedMessage:new TextDecoder().decode(P.signedMessage),w=P.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in k)||typeof k.signMessage!="function"||!("publicKey"in k)||typeof k!="object"||!k.publicKey||!("toBase58"in k.publicKey)||typeof k.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");b=[`${O.host} wants you to sign in with your Solana account:`,k.publicKey.toBase58(),...T?["",T,""]:[""],"Version: 1",`URI: ${O.href}`,`Issued At: ${(r=(s=I?.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&r!==void 0?r:new Date().toISOString()}`,...!((i=I?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${I.signInWithSolana.notBefore}`]:[],...!((o=I?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${I.signInWithSolana.expirationTime}`]:[],...!((a=I?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${I.signInWithSolana.chainId}`]:[],...!((l=I?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${I.signInWithSolana.nonce}`]:[],...!((u=I?.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${I.signInWithSolana.requestId}`]:[],...!((f=(d=I?.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||f===void 0)&&f.length?["Resources",...I.signInWithSolana.resources.map(P=>`- ${P}`)]:[]].join(`
`);const V=await k.signMessage(new TextEncoder().encode(b),"utf8");if(!V||!(V instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");w=V}}try{const{data:v,error:S}=await _t(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:b,signature:fK(w)},!((m=e.options)===null||m===void 0)&&m.captchaToken?{gotrue_meta_security:{captcha_token:(y=e.options)===null||y===void 0?void 0:y.captchaToken}}:null),xform:$a});if(S)throw S;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new ix}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:S})}catch(v){if(at(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(e){const t=await Su(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(t??"").split("/");try{const{data:i,error:o}=await _t(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:$a});if(await Fl(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new ix}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:r??null}),error:o})}catch(i){if(at(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:r,access_token:i,nonce:o}=e,a=await _t(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:$a}),{data:l,error:u}=a;return u?{data:{user:null,session:null},error:u}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new ix}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:u})}catch(t){if(at(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,r,i,o;try{if("email"in e){const{email:a,options:l}=e;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await Od(this.storage,this.storageKey));const{error:f}=await _t(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l?.data)!==null&&t!==void 0?t:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:f}}if("phone"in e){const{phone:a,options:l}=e,{data:u,error:d}=await _t(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(r=l?.data)!==null&&r!==void 0?r:{},create_user:(i=l?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(o=l?.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u?.message_id},error:d}}throw new ox("You must provide either an email or phone number.")}catch(a){if(at(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,s;try{let r,i;"options"in e&&(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:a}=await _t(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:r,xform:$a});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,u=o.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(r){if(at(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithSSO(e){var t,s,r;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await Od(this.storage,this.storageKey)),await _t(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((r=e?.options)===null||r===void 0)&&r.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:DK})}catch(i){if(at(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new Bl;const{error:r}=await _t(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}})}catch(e){if(at(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:r,options:i}=e,{error:o}=await _t(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:s,type:r,options:i}=e,{data:o,error:a}=await _t(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return{data:{user:null,session:null,messageId:o?.message_id},error:a}}throw new ox("You must provide either an email or phone number and a type")}catch(t){if(at(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch{}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const r=[...this.pendingInLock];await Promise.all(r),this.pendingInLock.splice(0,r.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Su(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<zC:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const o=await Su(this.userStorage,this.storageKey+"-user");o?.user?e.user=o.user:e.user=GC()}if(this.storage.isServer&&e.user){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,u,d)=>(!o&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,u,d))})}return{data:{session:e},error:null}}const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await _t(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Wl}):await this._useSession(async t=>{var s,r,i;const{data:o,error:a}=t;if(a)throw a;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Bl}:await _t(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0,xform:Wl})})}catch(t){if(at(t))return iK(t)&&(await this._removeSession(),await Fl(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:r,error:i}=s;if(i)throw i;if(!r.session)throw new Bl;const o=r.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Od(this.storage,this.storageKey));const{data:u,error:d}=await _t(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:Wl});if(d)throw d;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(s){if(at(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Bl;const t=Date.now()/1e3;let s=t,r=!0,i=null;const{payload:o}=WC(e.access_token);if(o.exp&&(s=o.exp,r=s<=t),r){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(at(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!e?.refresh_token)throw new Bl;const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(at(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!Gi())throw new ax("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ax(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new jO("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ax("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new jO("No code detected.");const{data:T,error:I}=await this._exchangeCodeForSession(e.code);if(I)throw I;const k=new URL(window.location.href);return k.searchParams.delete("code"),window.history.replaceState(window.history.state,"",k.toString()),{data:{session:T.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:r,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:u}=e;if(!i||!a||!o||!u)throw new ax("No session defined in URL");const d=Math.round(Date.now()/1e3),f=parseInt(a);let m=d+f;l&&(m=parseInt(l));const y=m-d;y*1e3<=jd&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${y}s, should have been closer to ${f}s`);const b=m-f;d-b>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",b,m,d):d-b<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",b,m,d);const{data:w,error:v}=await this._getUser(i);if(v)throw v;const S={provider_token:s,provider_refresh_token:r,access_token:i,expires_in:f,expires_at:m,refresh_token:o,token_type:u,user:w.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:S,redirectType:e.type},error:null}}catch(s){if(at(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Su(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:r,error:i}=t;if(i)return{error:i};const o=(s=r.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(rK(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Fl(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=mK(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,r;try{const{data:{session:i},error:o}=t;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,r=null;this.flowType==="pkce"&&([s,r]=await Od(this.storage,this.storageKey,!0));try{return await _t(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(at(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(at(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:r}=await this._useSession(async i=>{var o,a,l,u,d;const{data:f,error:m}=i;if(m)throw m;const y=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await _t(this.fetch,"GET",y,{headers:this.headers,jwt:(d=(u=f.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(r)throw r;return Gi()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s?.url),{data:{provider:e.provider,url:s?.url},error:null}}catch(s){if(at(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,r;const{data:i,error:o}=t;if(o)throw o;return await _t(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(r=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&r!==void 0?r:void 0})})}catch(t){if(at(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await xK(async r=>(r>0&&await bK(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await _t(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:$a})),(r,i)=>{const o=200*Math.pow(2,r);return i&&jC(i)&&Date.now()+o-s<jd})}catch(s){if(this._debug(t,"error",s),at(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),Gi()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const r=await Su(this.storage,this.storageKey);if(r&&this.userStorage){let o=await Su(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:r.user},await Wd(this.userStorage,this.storageKey+"-user",o)),r.user=(e=o?.user)!==null&&e!==void 0?e:GC()}else if(r&&!r.user&&!r.user){const o=await Su(this.storage,this.storageKey+"-user");o&&o?.user?(r.user=o.user,await Fl(this.storage,this.storageKey+"-user"),await Wd(this.storage,this.storageKey,r)):r.user=GC()}if(this._debug(s,"session from storage",r),!this._isValidSession(r)){this._debug(s,"session is not valid"),r!==null&&await this._removeSession();return}const i=((t=r.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<zC;if(this._debug(s,`session has${i?"":" not"} expired with margin of ${zC}s`),i){if(this.autoRefreshToken&&r.refresh_token){const{error:o}=await this._callRefreshToken(r.refresh_token);o&&(console.error(o),jC(o)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(r.user&&r.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(r.access_token);!a&&o?.user?(r.user=o.user,await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(s,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(s,"error",r),console.error(r);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new Bl;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new s4;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Bl;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={session:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(r,"error",i),at(i)){const o={session:null,error:i};return jC(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,s=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&t.user&&await Wd(this.userStorage,this.storageKey+"-user",{user:t.user});const r=Object.assign({},t);delete r.user;const i=KO(r);await Wd(this.storage,this.storageKey,i)}else{const r=KO(t);await Wd(this.storage,this.storageKey,r)}}async _removeSession(){this._debug("#_removeSession()"),await Fl(this.storage,this.storageKey),await Fl(this.storage,this.storageKey+"-code-verifier"),await Fl(this.storage,this.storageKey+"-user"),this.userStorage&&await Fl(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Gi()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),jd);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((s.expires_at*1e3-e)/jd);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${jd}ms, refresh threshold is ${BT} ticks`),r<=BT&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof i4)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Gi()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const r=[`provider=${encodeURIComponent(t)}`];if(s?.redirectTo&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s?.scopes&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,o]=await Od(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});r.push(a.toString())}if(s?.queryParams){const i=new URLSearchParams(s.queryParams);r.push(i.toString())}return s?.skipBrowserRedirect&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:r,error:i}=t;return i?{data:null,error:i}:await _t(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=r?.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(at(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,r;const{data:i,error:o}=t;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:u}=await _t(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((r=l?.totp)===null||r===void 0)&&r.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(at(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:a}=await _t(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=r?.session)===null||s===void 0?void 0:s.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(at(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:i}=t;return i?{data:null,error:i}:await _t(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=r?.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(at(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=e?.factors||[],r=s.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=s.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:s,totp:r,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:r},error:i}=e;if(i)return{data:null,error:i};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=WC(r.access_token);let a=null;o.aal&&(a=o.aal);let l=a;((s=(t=r.user.factors)===null||t===void 0?void 0:t.filter(f=>f.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(l="aal2");const d=o.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:d},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(a=>a.kid===e);if(s)return s;const r=Date.now();if(s=this.jwks.keys.find(a=>a.kid===e),s&&this.jwks_cached_at+nK>r)return s;const{data:i,error:o}=await _t(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=r,s=i.keys.find(a=>a.kid===e),!s)?null:s}async getClaims(e,t={}){try{let s=e;if(!s){const{data:y,error:b}=await this.getSession();if(b||!y.session)return{data:null,error:b};s=y.session.access_token}const{header:r,payload:i,signature:o,raw:{header:a,payload:l}}=WC(s);t?.allowExpired||EK(i.exp);const u=!r.alg||r.alg.startsWith("HS")||!r.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(r.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!u){const{error:y}=await this.getUser(s);if(y)throw y;return{data:{claims:i,header:r,signature:o},error:null}}const d=IK(r.alg),f=await crypto.subtle.importKey("jwk",u,d,!0,["verify"]);if(!await crypto.subtle.verify(d,f,o,dK(`${a}.${l}`)))throw new WT("Invalid JWT signature");return{data:{claims:i,header:r,signature:o},error:null}}catch(s){if(at(s))return{data:null,error:s};throw s}}}pg.nextInstanceID=0;const jK=pg;class WK extends jK{constructor(e){super(e)}}var GK=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(d){try{u(s.next(d))}catch(f){o(f)}}function l(d){try{u(s.throw(d))}catch(f){o(f)}}function u(d){d.done?i(d.value):r(d.value).then(a,l)}u((s=s.apply(n,e||[])).next())})};class HK{constructor(e,t,s){var r,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=Y7(e),l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const u=`sb-${l.hostname.split(".")[0]}-auth-token`,d={db:z7,realtime:W7,auth:Object.assign(Object.assign({},j7),{storageKey:u}),global:B7},f=Q7(s??{},d);this.storageKey=(r=f.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(i=f.global.headers)!==null&&i!==void 0?i:{},f.accessToken?(this.accessToken=f.accessToken,this.auth=new Proxy({},{get:(m,y)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(y)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=f.auth)!==null&&o!==void 0?o:{},this.headers,f.global.fetch),this.fetch=K7(t,this._getAccessToken.bind(this),f.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},f.realtime)),this.rest=new u7(new URL("rest/v1",l).href,{headers:this.headers,schema:f.db.schema,fetch:this.fetch}),f.accessToken||this._listenForAuthEvents()}get functions(){return new J9(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new F7(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return GK(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,storageKey:i,flowType:o,lock:a,debug:l},u,d){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new WK({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),u),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,flowType:o,lock:a,debug:l,fetch:d,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new T7(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s?.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const qK=(n,e,t)=>new HK(n,e,t);function KK(){if(typeof window<"u"||typeof process>"u"||process.version===void 0||process.version===null)return!1;const n=process.version.match(/^v(\d+)\./);return n?parseInt(n[1],10)<=18:!1}KK()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const XK="https://wbabgfxwtqjvriibspxk.supabase.co",YK="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndiYWJnZnh3dHFqdnJpaWJzcHhrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2Mjg0MjgsImV4cCI6MjA2OTIwNDQyOH0.JgPQOW16dTBlPge5t_seKH-vWWSV4HGsBmI2xIvt1C4",Ei=qK(XK,YK),o4=te.createContext();function QK({children:n}){const[e,t]=te.useState(null);te.useEffect(()=>{(async()=>{const{data:l}=await Ei.auth.getSession();t(l?.session?.user||null)})();const{data:a}=Ei.auth.onAuthStateChange((l,u)=>{t(u?.user||null)});return()=>{a?.subscription.unsubscribe()}},[]);const s=async(o,a)=>await Ei.auth.signUp({email:o,password:a}),r=async(o,a)=>await Ei.auth.signInWithPassword({email:o,password:a}),i=async()=>await Ei.auth.signOut();return E.jsx(o4.Provider,{value:{user:e,signup:s,login:r,logout:i},children:n})}const JK=()=>{};var ZO={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a4={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ae=function(n,e){if(!n)throw Bf(e)},Bf=function(n){return new Error("Firebase Database ("+a4.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l4=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},ZK=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const r=n[t++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=n[t++];e[s++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=n[t++],o=n[t++],a=n[t++],l=((r&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[s++]=String.fromCharCode((r&15)<<12|(i&63)<<6|o&63)}}return e.join("")},kI={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){const i=n[r],o=r+1<n.length,a=o?n[r+1]:0,l=r+2<n.length,u=l?n[r+2]:0,d=i>>2,f=(i&3)<<4|a>>4;let m=(a&15)<<2|u>>6,y=u&63;l||(y=64,o||(m=64)),s.push(t[d],t[f],t[m],t[y])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(l4(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):ZK(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<n.length;){const i=t[n.charAt(r++)],a=r<n.length?t[n.charAt(r)]:0;++r;const u=r<n.length?t[n.charAt(r)]:64;++r;const f=r<n.length?t[n.charAt(r)]:64;if(++r,i==null||a==null||u==null||f==null)throw new eX;const m=i<<2|a>>4;if(s.push(m),u!==64){const y=a<<4&240|u>>2;if(s.push(y),f!==64){const b=u<<6&192|f;s.push(b)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class eX extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const c4=function(n){const e=l4(n);return kI.encodeByteArray(e,!0)},iv=function(n){return c4(n).replace(/\./g,"")},ov=function(n){try{return kI.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tX(n){return u4(void 0,n)}function u4(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!nX(t)||(n[t]=u4(n[t],e[t]));return n}function nX(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sX(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rX=()=>sX().__FIREBASE_DEFAULTS__,iX=()=>{if(typeof process>"u"||typeof ZO>"u")return;const n=ZO.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},oX=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&ov(n[1]);return e&&JSON.parse(e)},Cw=()=>{try{return JK()||rX()||iX()||oX()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},h4=n=>Cw()?.emulatorHosts?.[n],d4=n=>{const e=h4(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},f4=()=>Cw()?.config,p4=n=>Cw()?.[`_${n}`];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tw{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kc(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function NI(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m4(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",r=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[iv(JSON.stringify(t)),iv(JSON.stringify(o)),""].join(".")}const Ym={};function aX(){const n={prod:[],emulator:[]};for(const e of Object.keys(Ym))Ym[e]?n.emulator.push(e):n.prod.push(e);return n}function lX(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let eP=!1;function AI(n,e){if(typeof window>"u"||typeof document>"u"||!kc(window.location.host)||Ym[n]===e||Ym[n]||eP)return;Ym[n]=e;function t(m){return`__firebase__banner__${m}`}const s="__firebase__banner",i=aX().prod.length>0;function o(){const m=document.getElementById(s);m&&m.remove()}function a(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function l(m,y){m.setAttribute("width","24"),m.setAttribute("id",y),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function u(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{eP=!0,o()},m}function d(m,y){m.setAttribute("id",y),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function f(){const m=lX(s),y=t("text"),b=document.getElementById(y)||document.createElement("span"),w=t("learnmore"),v=document.getElementById(w)||document.createElement("a"),S=t("preprendIcon"),T=document.getElementById(S)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const I=m.element;a(I),d(v,w);const k=u();l(T,S),I.append(T,b,v,k),document.body.appendChild(I)}i?(b.innerText="Preview backend disconnected.",T.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(T.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,b.innerText="Preview backend running in this workspace."),b.setAttribute("id",y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mr(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function RI(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(mr())}function cX(){const n=Cw()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function uX(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function hX(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function g4(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function dX(){const n=mr();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function fX(){return a4.NODE_ADMIN===!0}function pX(){return!cX()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function mX(){try{return typeof indexedDB=="object"}catch{return!1}}function gX(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{e(r.error?.message||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yX="FirebaseError";class nl extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=yX,Object.setPrototypeOf(this,nl.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ty.prototype.create)}}class ty{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],o=i?bX(i,s):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new nl(r,a,s)}}function bX(n,e){return n.replace(xX,(t,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const xX=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mg(n){return JSON.parse(n)}function Os(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y4=function(n){let e={},t={},s={},r="";try{const i=n.split(".");e=mg(ov(i[0])||""),t=mg(ov(i[1])||""),r=i[2],s=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:s,signature:r}},vX=function(n){const e=y4(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},wX=function(n){const e=y4(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sa(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function yf(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function GT(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function av(n,e,t){const s={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(s[r]=e.call(t,n[r],r,n));return s}function cc(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const r of t){if(!s.includes(r))return!1;const i=n[r],o=e[r];if(tP(i)&&tP(o)){if(!cc(i,o))return!1}else if(i!==o)return!1}for(const r of s)if(!t.includes(r))return!1;return!0}function tP(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zf(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function Pm(n){const e={};return n.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[r,i]=s.split("=");e[decodeURIComponent(r)]=decodeURIComponent(i)}}),e}function Mm(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _X{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const s=this.W_;if(typeof e=="string")for(let f=0;f<16;f++)s[f]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let f=0;f<16;f++)s[f]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let f=16;f<80;f++){const m=s[f-3]^s[f-8]^s[f-14]^s[f-16];s[f]=(m<<1|m>>>31)&4294967295}let r=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],u,d;for(let f=0;f<80;f++){f<40?f<20?(u=a^i&(o^a),d=1518500249):(u=i^o^a,d=1859775393):f<60?(u=i&o|a&(i|o),d=2400959708):(u=i^o^a,d=3395469782);const m=(r<<5|r>>>27)+u+l+d+s[f]&4294967295;l=a,a=o,o=(i<<30|i>>>2)&4294967295,i=r,r=m}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const s=t-this.blockSize;let r=0;const i=this.buf_;let o=this.inbuf_;for(;r<t;){if(o===0)for(;r<=s;)this.compress_(e,r),r+=this.blockSize;if(typeof e=="string"){for(;r<t;)if(i[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<t;)if(i[o]=e[r],++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=t&255,t/=256;this.compress_(this.buf_);let s=0;for(let r=0;r<5;r++)for(let i=24;i>=0;i-=8)e[s]=this.chain_[r]>>i&255,++s;return e}}function SX(n,e){const t=new CX(n,e);return t.subscribe.bind(t)}class CX{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let r;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");TX(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:s},r.next===void 0&&(r.next=qC),r.error===void 0&&(r.error=qC),r.complete===void 0&&(r.complete=qC);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function TX(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function qC(){}function $I(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EX=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);if(r>=55296&&r<=56319){const i=r-55296;s++,Ae(s<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(s)-56320;r=65536+(i<<10)+o}r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):r<65536?(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},Ew=function(n){let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kn(n){return n&&n._delegate?n._delegate:n}class uc{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iu="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let IX=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new Tw;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),s=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(NX(e))try{this.getOrInitializeService({instanceIdentifier:Iu})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:r});s.resolve(i)}catch{}}}}clearInstance(e=Iu){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Iu){return this.instances.has(e)}getOptions(e=Iu){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);s===a&&o.resolve(r)}return r}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(s)??new Set;r.add(e),this.onInitCallbacks.set(s,r);const i=this.instances.get(s);return i&&e(i,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const r of s)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:kX(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Iu){return this.component?this.component.multipleInstances?e:Iu:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function kX(n){return n===Iu?void 0:n}function NX(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AX{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new IX(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var St;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(St||(St={}));const RX={debug:St.DEBUG,verbose:St.VERBOSE,info:St.INFO,warn:St.WARN,error:St.ERROR,silent:St.SILENT},$X=St.INFO,DX={[St.DEBUG]:"log",[St.VERBOSE]:"log",[St.INFO]:"info",[St.WARN]:"warn",[St.ERROR]:"error"},OX=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),r=DX[e];if(r)console[r](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let Iw=class{constructor(e){this.name=e,this._logLevel=$X,this._logHandler=OX,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in St))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?RX[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,St.DEBUG,...e),this._logHandler(this,St.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,St.VERBOSE,...e),this._logHandler(this,St.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,St.INFO,...e),this._logHandler(this,St.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,St.WARN,...e),this._logHandler(this,St.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,St.ERROR,...e),this._logHandler(this,St.ERROR,...e)}};const PX=(n,e)=>e.some(t=>n instanceof t);let nP,sP;function MX(){return nP||(nP=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function LX(){return sP||(sP=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const b4=new WeakMap,HT=new WeakMap,x4=new WeakMap,KC=new WeakMap,DI=new WeakMap;function FX(n){const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Zl(n.result)),r()},o=()=>{s(n.error),r()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&b4.set(t,n)}).catch(()=>{}),DI.set(e,n),e}function VX(n){if(HT.has(n))return;const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});HT.set(n,e)}let qT={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return HT.get(n);if(e==="objectStoreNames")return n.objectStoreNames||x4.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Zl(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function UX(n){qT=n(qT)}function BX(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(XC(this),e,...t);return x4.set(s,e.sort?e.sort():[e]),Zl(s)}:LX().includes(n)?function(...e){return n.apply(XC(this),e),Zl(b4.get(this))}:function(...e){return Zl(n.apply(XC(this),e))}}function zX(n){return typeof n=="function"?BX(n):(n instanceof IDBTransaction&&VX(n),PX(n,MX())?new Proxy(n,qT):n)}function Zl(n){if(n instanceof IDBRequest)return FX(n);if(KC.has(n))return KC.get(n);const e=zX(n);return e!==n&&(KC.set(n,e),DI.set(e,n)),e}const XC=n=>DI.get(n);function jX(n,e,{blocked:t,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(n,e),a=Zl(o);return s&&o.addEventListener("upgradeneeded",l=>{s(Zl(o.result),l.oldVersion,l.newVersion,Zl(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),r&&l.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const WX=["get","getKey","getAll","getAllKeys","count"],GX=["put","add","delete","clear"],YC=new Map;function rP(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(YC.get(e))return YC.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,r=GX.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(r||WX.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,r?"readwrite":"readonly");let u=l.store;return s&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),r&&l.done]))[0]};return YC.set(e,i),i}UX(n=>({...n,get:(e,t,s)=>rP(e,t)||n.get(e,t,s),has:(e,t)=>!!rP(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HX{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(qX(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function qX(n){return n.getComponent()?.type==="VERSION"}const KT="@firebase/app",iP="0.14.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ha=new Iw("@firebase/app"),KX="@firebase/app-compat",XX="@firebase/analytics-compat",YX="@firebase/analytics",QX="@firebase/app-check-compat",JX="@firebase/app-check",ZX="@firebase/auth",eY="@firebase/auth-compat",tY="@firebase/database",nY="@firebase/data-connect",sY="@firebase/database-compat",rY="@firebase/functions",iY="@firebase/functions-compat",oY="@firebase/installations",aY="@firebase/installations-compat",lY="@firebase/messaging",cY="@firebase/messaging-compat",uY="@firebase/performance",hY="@firebase/performance-compat",dY="@firebase/remote-config",fY="@firebase/remote-config-compat",pY="@firebase/storage",mY="@firebase/storage-compat",gY="@firebase/firestore",yY="@firebase/ai",bY="@firebase/firestore-compat",xY="firebase",vY="12.0.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XT="[DEFAULT]",wY={[KT]:"fire-core",[KX]:"fire-core-compat",[YX]:"fire-analytics",[XX]:"fire-analytics-compat",[JX]:"fire-app-check",[QX]:"fire-app-check-compat",[ZX]:"fire-auth",[eY]:"fire-auth-compat",[tY]:"fire-rtdb",[nY]:"fire-data-connect",[sY]:"fire-rtdb-compat",[rY]:"fire-fn",[iY]:"fire-fn-compat",[oY]:"fire-iid",[aY]:"fire-iid-compat",[lY]:"fire-fcm",[cY]:"fire-fcm-compat",[uY]:"fire-perf",[hY]:"fire-perf-compat",[dY]:"fire-rc",[fY]:"fire-rc-compat",[pY]:"fire-gcs",[mY]:"fire-gcs-compat",[gY]:"fire-fst",[bY]:"fire-fst-compat",[yY]:"fire-vertex","fire-js":"fire-js",[xY]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lv=new Map,_Y=new Map,YT=new Map;function oP(n,e){try{n.container.addComponent(e)}catch(t){Ha.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Qu(n){const e=n.name;if(YT.has(e))return Ha.debug(`There were multiple attempts to register component ${e}.`),!1;YT.set(e,n);for(const t of lv.values())oP(t,n);for(const t of _Y.values())oP(t,n);return!0}function kw(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Fr(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SY={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ec=new ty("app","Firebase",SY);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CY{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new uc("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ec.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sh=vY;function v4(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:XT,automaticDataCollectionEnabled:!0,...e},r=s.name;if(typeof r!="string"||!r)throw ec.create("bad-app-name",{appName:String(r)});if(t||(t=f4()),!t)throw ec.create("no-options");const i=lv.get(r);if(i){if(cc(t,i.options)&&cc(s,i.config))return i;throw ec.create("duplicate-app",{appName:r})}const o=new AX(r);for(const l of YT.values())o.addComponent(l);const a=new CY(t,s,o);return lv.set(r,a),a}function OI(n=XT){const e=lv.get(n);if(!e&&n===XT&&f4())return v4();if(!e)throw ec.create("no-app",{appName:n});return e}function Po(n,e,t){let s=wY[n]??n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),i=e.match(/\s|\//);if(r||i){const o=[`Unable to register library "${s}" with version "${e}":`];r&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ha.warn(o.join(" "));return}Qu(new uc(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TY="firebase-heartbeat-database",EY=1,gg="firebase-heartbeat-store";let QC=null;function w4(){return QC||(QC=jX(TY,EY,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(gg)}catch(t){console.warn(t)}}}}).catch(n=>{throw ec.create("idb-open",{originalErrorMessage:n.message})})),QC}async function IY(n){try{const t=(await w4()).transaction(gg),s=await t.objectStore(gg).get(_4(n));return await t.done,s}catch(e){if(e instanceof nl)Ha.warn(e.message);else{const t=ec.create("idb-get",{originalErrorMessage:e?.message});Ha.warn(t.message)}}}async function aP(n,e){try{const s=(await w4()).transaction(gg,"readwrite");await s.objectStore(gg).put(e,_4(n)),await s.done}catch(t){if(t instanceof nl)Ha.warn(t.message);else{const s=ec.create("idb-set",{originalErrorMessage:t?.message});Ha.warn(s.message)}}}function _4(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kY=1024,NY=30;class AY{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new $Y(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=lP();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(r=>r.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:t}),this._heartbeatsCache.heartbeats.length>NY){const r=DY(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ha.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=lP(),{heartbeatsToSend:t,unsentEntries:s}=RY(this._heartbeatsCache.heartbeats),r=iv(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return Ha.warn(e),""}}}function lP(){return new Date().toISOString().substring(0,10)}function RY(n,e=kY){const t=[];let s=n.slice();for(const r of n){const i=t.find(o=>o.agent===r.agent);if(i){if(i.dates.push(r.date),cP(t)>e){i.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),cP(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class $Y{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return mX()?gX().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await IY(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return aP(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return aP(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function cP(n){return iv(JSON.stringify({version:2,heartbeats:n})).length}function DY(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OY(n){Qu(new uc("platform-logger",e=>new HX(e),"PRIVATE")),Qu(new uc("heartbeat",e=>new AY(e),"PRIVATE")),Po(KT,iP,n),Po(KT,iP,"esm2020"),Po("fire-js","")}OY("");var uP=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var tc,S4;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(P,D){function $(){}$.prototype=D.prototype,P.D=D.prototype,P.prototype=new $,P.prototype.constructor=P,P.C=function(R,A,U){for(var F=Array(arguments.length-2),ne=2;ne<arguments.length;ne++)F[ne-2]=arguments[ne];return D.prototype[A].apply(R,F)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(s,t),s.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(P,D,$){$||($=0);var R=Array(16);if(typeof D=="string")for(var A=0;16>A;++A)R[A]=D.charCodeAt($++)|D.charCodeAt($++)<<8|D.charCodeAt($++)<<16|D.charCodeAt($++)<<24;else for(A=0;16>A;++A)R[A]=D[$++]|D[$++]<<8|D[$++]<<16|D[$++]<<24;D=P.g[0],$=P.g[1],A=P.g[2];var U=P.g[3],F=D+(U^$&(A^U))+R[0]+3614090360&4294967295;D=$+(F<<7&4294967295|F>>>25),F=U+(A^D&($^A))+R[1]+3905402710&4294967295,U=D+(F<<12&4294967295|F>>>20),F=A+($^U&(D^$))+R[2]+606105819&4294967295,A=U+(F<<17&4294967295|F>>>15),F=$+(D^A&(U^D))+R[3]+3250441966&4294967295,$=A+(F<<22&4294967295|F>>>10),F=D+(U^$&(A^U))+R[4]+4118548399&4294967295,D=$+(F<<7&4294967295|F>>>25),F=U+(A^D&($^A))+R[5]+1200080426&4294967295,U=D+(F<<12&4294967295|F>>>20),F=A+($^U&(D^$))+R[6]+2821735955&4294967295,A=U+(F<<17&4294967295|F>>>15),F=$+(D^A&(U^D))+R[7]+4249261313&4294967295,$=A+(F<<22&4294967295|F>>>10),F=D+(U^$&(A^U))+R[8]+1770035416&4294967295,D=$+(F<<7&4294967295|F>>>25),F=U+(A^D&($^A))+R[9]+2336552879&4294967295,U=D+(F<<12&4294967295|F>>>20),F=A+($^U&(D^$))+R[10]+4294925233&4294967295,A=U+(F<<17&4294967295|F>>>15),F=$+(D^A&(U^D))+R[11]+2304563134&4294967295,$=A+(F<<22&4294967295|F>>>10),F=D+(U^$&(A^U))+R[12]+1804603682&4294967295,D=$+(F<<7&4294967295|F>>>25),F=U+(A^D&($^A))+R[13]+4254626195&4294967295,U=D+(F<<12&4294967295|F>>>20),F=A+($^U&(D^$))+R[14]+2792965006&4294967295,A=U+(F<<17&4294967295|F>>>15),F=$+(D^A&(U^D))+R[15]+1236535329&4294967295,$=A+(F<<22&4294967295|F>>>10),F=D+(A^U&($^A))+R[1]+4129170786&4294967295,D=$+(F<<5&4294967295|F>>>27),F=U+($^A&(D^$))+R[6]+3225465664&4294967295,U=D+(F<<9&4294967295|F>>>23),F=A+(D^$&(U^D))+R[11]+643717713&4294967295,A=U+(F<<14&4294967295|F>>>18),F=$+(U^D&(A^U))+R[0]+3921069994&4294967295,$=A+(F<<20&4294967295|F>>>12),F=D+(A^U&($^A))+R[5]+3593408605&4294967295,D=$+(F<<5&4294967295|F>>>27),F=U+($^A&(D^$))+R[10]+38016083&4294967295,U=D+(F<<9&4294967295|F>>>23),F=A+(D^$&(U^D))+R[15]+3634488961&4294967295,A=U+(F<<14&4294967295|F>>>18),F=$+(U^D&(A^U))+R[4]+3889429448&4294967295,$=A+(F<<20&4294967295|F>>>12),F=D+(A^U&($^A))+R[9]+568446438&4294967295,D=$+(F<<5&4294967295|F>>>27),F=U+($^A&(D^$))+R[14]+3275163606&4294967295,U=D+(F<<9&4294967295|F>>>23),F=A+(D^$&(U^D))+R[3]+4107603335&4294967295,A=U+(F<<14&4294967295|F>>>18),F=$+(U^D&(A^U))+R[8]+1163531501&4294967295,$=A+(F<<20&4294967295|F>>>12),F=D+(A^U&($^A))+R[13]+2850285829&4294967295,D=$+(F<<5&4294967295|F>>>27),F=U+($^A&(D^$))+R[2]+4243563512&4294967295,U=D+(F<<9&4294967295|F>>>23),F=A+(D^$&(U^D))+R[7]+1735328473&4294967295,A=U+(F<<14&4294967295|F>>>18),F=$+(U^D&(A^U))+R[12]+2368359562&4294967295,$=A+(F<<20&4294967295|F>>>12),F=D+($^A^U)+R[5]+4294588738&4294967295,D=$+(F<<4&4294967295|F>>>28),F=U+(D^$^A)+R[8]+2272392833&4294967295,U=D+(F<<11&4294967295|F>>>21),F=A+(U^D^$)+R[11]+1839030562&4294967295,A=U+(F<<16&4294967295|F>>>16),F=$+(A^U^D)+R[14]+4259657740&4294967295,$=A+(F<<23&4294967295|F>>>9),F=D+($^A^U)+R[1]+2763975236&4294967295,D=$+(F<<4&4294967295|F>>>28),F=U+(D^$^A)+R[4]+1272893353&4294967295,U=D+(F<<11&4294967295|F>>>21),F=A+(U^D^$)+R[7]+4139469664&4294967295,A=U+(F<<16&4294967295|F>>>16),F=$+(A^U^D)+R[10]+3200236656&4294967295,$=A+(F<<23&4294967295|F>>>9),F=D+($^A^U)+R[13]+681279174&4294967295,D=$+(F<<4&4294967295|F>>>28),F=U+(D^$^A)+R[0]+3936430074&4294967295,U=D+(F<<11&4294967295|F>>>21),F=A+(U^D^$)+R[3]+3572445317&4294967295,A=U+(F<<16&4294967295|F>>>16),F=$+(A^U^D)+R[6]+76029189&4294967295,$=A+(F<<23&4294967295|F>>>9),F=D+($^A^U)+R[9]+3654602809&4294967295,D=$+(F<<4&4294967295|F>>>28),F=U+(D^$^A)+R[12]+3873151461&4294967295,U=D+(F<<11&4294967295|F>>>21),F=A+(U^D^$)+R[15]+530742520&4294967295,A=U+(F<<16&4294967295|F>>>16),F=$+(A^U^D)+R[2]+3299628645&4294967295,$=A+(F<<23&4294967295|F>>>9),F=D+(A^($|~U))+R[0]+4096336452&4294967295,D=$+(F<<6&4294967295|F>>>26),F=U+($^(D|~A))+R[7]+1126891415&4294967295,U=D+(F<<10&4294967295|F>>>22),F=A+(D^(U|~$))+R[14]+2878612391&4294967295,A=U+(F<<15&4294967295|F>>>17),F=$+(U^(A|~D))+R[5]+4237533241&4294967295,$=A+(F<<21&4294967295|F>>>11),F=D+(A^($|~U))+R[12]+1700485571&4294967295,D=$+(F<<6&4294967295|F>>>26),F=U+($^(D|~A))+R[3]+2399980690&4294967295,U=D+(F<<10&4294967295|F>>>22),F=A+(D^(U|~$))+R[10]+4293915773&4294967295,A=U+(F<<15&4294967295|F>>>17),F=$+(U^(A|~D))+R[1]+2240044497&4294967295,$=A+(F<<21&4294967295|F>>>11),F=D+(A^($|~U))+R[8]+1873313359&4294967295,D=$+(F<<6&4294967295|F>>>26),F=U+($^(D|~A))+R[15]+4264355552&4294967295,U=D+(F<<10&4294967295|F>>>22),F=A+(D^(U|~$))+R[6]+2734768916&4294967295,A=U+(F<<15&4294967295|F>>>17),F=$+(U^(A|~D))+R[13]+1309151649&4294967295,$=A+(F<<21&4294967295|F>>>11),F=D+(A^($|~U))+R[4]+4149444226&4294967295,D=$+(F<<6&4294967295|F>>>26),F=U+($^(D|~A))+R[11]+3174756917&4294967295,U=D+(F<<10&4294967295|F>>>22),F=A+(D^(U|~$))+R[2]+718787259&4294967295,A=U+(F<<15&4294967295|F>>>17),F=$+(U^(A|~D))+R[9]+3951481745&4294967295,P.g[0]=P.g[0]+D&4294967295,P.g[1]=P.g[1]+(A+(F<<21&4294967295|F>>>11))&4294967295,P.g[2]=P.g[2]+A&4294967295,P.g[3]=P.g[3]+U&4294967295}s.prototype.u=function(P,D){D===void 0&&(D=P.length);for(var $=D-this.blockSize,R=this.B,A=this.h,U=0;U<D;){if(A==0)for(;U<=$;)r(this,P,U),U+=this.blockSize;if(typeof P=="string"){for(;U<D;)if(R[A++]=P.charCodeAt(U++),A==this.blockSize){r(this,R),A=0;break}}else for(;U<D;)if(R[A++]=P[U++],A==this.blockSize){r(this,R),A=0;break}}this.h=A,this.o+=D},s.prototype.v=function(){var P=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);P[0]=128;for(var D=1;D<P.length-8;++D)P[D]=0;var $=8*this.o;for(D=P.length-8;D<P.length;++D)P[D]=$&255,$/=256;for(this.u(P),P=Array(16),D=$=0;4>D;++D)for(var R=0;32>R;R+=8)P[$++]=this.g[D]>>>R&255;return P};function i(P,D){var $=a;return Object.prototype.hasOwnProperty.call($,P)?$[P]:$[P]=D(P)}function o(P,D){this.h=D;for(var $=[],R=!0,A=P.length-1;0<=A;A--){var U=P[A]|0;R&&U==D||($[A]=U,R=!1)}this.g=$}var a={};function l(P){return-128<=P&&128>P?i(P,function(D){return new o([D|0],0>D?-1:0)}):new o([P|0],0>P?-1:0)}function u(P){if(isNaN(P)||!isFinite(P))return f;if(0>P)return v(u(-P));for(var D=[],$=1,R=0;P>=$;R++)D[R]=P/$|0,$*=4294967296;return new o(D,0)}function d(P,D){if(P.length==0)throw Error("number format error: empty string");if(D=D||10,2>D||36<D)throw Error("radix out of range: "+D);if(P.charAt(0)=="-")return v(d(P.substring(1),D));if(0<=P.indexOf("-"))throw Error('number format error: interior "-" character');for(var $=u(Math.pow(D,8)),R=f,A=0;A<P.length;A+=8){var U=Math.min(8,P.length-A),F=parseInt(P.substring(A,A+U),D);8>U?(U=u(Math.pow(D,U)),R=R.j(U).add(u(F))):(R=R.j($),R=R.add(u(F)))}return R}var f=l(0),m=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(w(this))return-v(this).m();for(var P=0,D=1,$=0;$<this.g.length;$++){var R=this.i($);P+=(0<=R?R:4294967296+R)*D,D*=4294967296}return P},n.toString=function(P){if(P=P||10,2>P||36<P)throw Error("radix out of range: "+P);if(b(this))return"0";if(w(this))return"-"+v(this).toString(P);for(var D=u(Math.pow(P,6)),$=this,R="";;){var A=k($,D).g;$=S($,A.j(D));var U=((0<$.g.length?$.g[0]:$.h)>>>0).toString(P);if($=A,b($))return U+R;for(;6>U.length;)U="0"+U;R=U+R}},n.i=function(P){return 0>P?0:P<this.g.length?this.g[P]:this.h};function b(P){if(P.h!=0)return!1;for(var D=0;D<P.g.length;D++)if(P.g[D]!=0)return!1;return!0}function w(P){return P.h==-1}n.l=function(P){return P=S(this,P),w(P)?-1:b(P)?0:1};function v(P){for(var D=P.g.length,$=[],R=0;R<D;R++)$[R]=~P.g[R];return new o($,~P.h).add(m)}n.abs=function(){return w(this)?v(this):this},n.add=function(P){for(var D=Math.max(this.g.length,P.g.length),$=[],R=0,A=0;A<=D;A++){var U=R+(this.i(A)&65535)+(P.i(A)&65535),F=(U>>>16)+(this.i(A)>>>16)+(P.i(A)>>>16);R=F>>>16,U&=65535,F&=65535,$[A]=F<<16|U}return new o($,$[$.length-1]&-2147483648?-1:0)};function S(P,D){return P.add(v(D))}n.j=function(P){if(b(this)||b(P))return f;if(w(this))return w(P)?v(this).j(v(P)):v(v(this).j(P));if(w(P))return v(this.j(v(P)));if(0>this.l(y)&&0>P.l(y))return u(this.m()*P.m());for(var D=this.g.length+P.g.length,$=[],R=0;R<2*D;R++)$[R]=0;for(R=0;R<this.g.length;R++)for(var A=0;A<P.g.length;A++){var U=this.i(R)>>>16,F=this.i(R)&65535,ne=P.i(A)>>>16,Q=P.i(A)&65535;$[2*R+2*A]+=F*Q,T($,2*R+2*A),$[2*R+2*A+1]+=U*Q,T($,2*R+2*A+1),$[2*R+2*A+1]+=F*ne,T($,2*R+2*A+1),$[2*R+2*A+2]+=U*ne,T($,2*R+2*A+2)}for(R=0;R<D;R++)$[R]=$[2*R+1]<<16|$[2*R];for(R=D;R<2*D;R++)$[R]=0;return new o($,0)};function T(P,D){for(;(P[D]&65535)!=P[D];)P[D+1]+=P[D]>>>16,P[D]&=65535,D++}function I(P,D){this.g=P,this.h=D}function k(P,D){if(b(D))throw Error("division by zero");if(b(P))return new I(f,f);if(w(P))return D=k(v(P),D),new I(v(D.g),v(D.h));if(w(D))return D=k(P,v(D)),new I(v(D.g),D.h);if(30<P.g.length){if(w(P)||w(D))throw Error("slowDivide_ only works with positive integers.");for(var $=m,R=D;0>=R.l(P);)$=O($),R=O(R);var A=V($,1),U=V(R,1);for(R=V(R,2),$=V($,2);!b(R);){var F=U.add(R);0>=F.l(P)&&(A=A.add($),U=F),R=V(R,1),$=V($,1)}return D=S(P,A.j(D)),new I(A,D)}for(A=f;0<=P.l(D);){for($=Math.max(1,Math.floor(P.m()/D.m())),R=Math.ceil(Math.log($)/Math.LN2),R=48>=R?1:Math.pow(2,R-48),U=u($),F=U.j(D);w(F)||0<F.l(P);)$-=R,U=u($),F=U.j(D);b(U)&&(U=m),A=A.add(U),P=S(P,F)}return new I(A,P)}n.A=function(P){return k(this,P).h},n.and=function(P){for(var D=Math.max(this.g.length,P.g.length),$=[],R=0;R<D;R++)$[R]=this.i(R)&P.i(R);return new o($,this.h&P.h)},n.or=function(P){for(var D=Math.max(this.g.length,P.g.length),$=[],R=0;R<D;R++)$[R]=this.i(R)|P.i(R);return new o($,this.h|P.h)},n.xor=function(P){for(var D=Math.max(this.g.length,P.g.length),$=[],R=0;R<D;R++)$[R]=this.i(R)^P.i(R);return new o($,this.h^P.h)};function O(P){for(var D=P.g.length+1,$=[],R=0;R<D;R++)$[R]=P.i(R)<<1|P.i(R-1)>>>31;return new o($,P.h)}function V(P,D){var $=D>>5;D%=32;for(var R=P.g.length-$,A=[],U=0;U<R;U++)A[U]=0<D?P.i(U+$)>>>D|P.i(U+$+1)<<32-D:P.i(U+$);return new o(A,P.h)}s.prototype.digest=s.prototype.v,s.prototype.reset=s.prototype.s,s.prototype.update=s.prototype.u,S4=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=d,tc=o}).apply(typeof uP<"u"?uP:typeof self<"u"?self:typeof window<"u"?window:{});var lx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var C4,Lm,T4,Px,QT,E4,I4,k4;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(x,N,M){return x==Array.prototype||x==Object.prototype||(x[N]=M.value),x};function t(x){x=[typeof globalThis=="object"&&globalThis,x,typeof window=="object"&&window,typeof self=="object"&&self,typeof lx=="object"&&lx];for(var N=0;N<x.length;++N){var M=x[N];if(M&&M.Math==Math)return M}throw Error("Cannot find global object")}var s=t(this);function r(x,N){if(N)e:{var M=s;x=x.split(".");for(var W=0;W<x.length-1;W++){var ue=x[W];if(!(ue in M))break e;M=M[ue]}x=x[x.length-1],W=M[x],N=N(W),N!=W&&N!=null&&e(M,x,{configurable:!0,writable:!0,value:N})}}function i(x,N){x instanceof String&&(x+="");var M=0,W=!1,ue={next:function(){if(!W&&M<x.length){var be=M++;return{value:N(be,x[be]),done:!1}}return W=!0,{done:!0,value:void 0}}};return ue[Symbol.iterator]=function(){return ue},ue}r("Array.prototype.values",function(x){return x||function(){return i(this,function(N,M){return M})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(x){var N=typeof x;return N=N!="object"?N:x?Array.isArray(x)?"array":N:"null",N=="array"||N=="object"&&typeof x.length=="number"}function u(x){var N=typeof x;return N=="object"&&x!=null||N=="function"}function d(x,N,M){return x.call.apply(x.bind,arguments)}function f(x,N,M){if(!x)throw Error();if(2<arguments.length){var W=Array.prototype.slice.call(arguments,2);return function(){var ue=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(ue,W),x.apply(N,ue)}}return function(){return x.apply(N,arguments)}}function m(x,N,M){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,m.apply(null,arguments)}function y(x,N){var M=Array.prototype.slice.call(arguments,1);return function(){var W=M.slice();return W.push.apply(W,arguments),x.apply(this,W)}}function b(x,N){function M(){}M.prototype=N.prototype,x.aa=N.prototype,x.prototype=new M,x.prototype.constructor=x,x.Qb=function(W,ue,be){for(var Re=Array(arguments.length-2),Dt=2;Dt<arguments.length;Dt++)Re[Dt-2]=arguments[Dt];return N.prototype[ue].apply(W,Re)}}function w(x){const N=x.length;if(0<N){const M=Array(N);for(let W=0;W<N;W++)M[W]=x[W];return M}return[]}function v(x,N){for(let M=1;M<arguments.length;M++){const W=arguments[M];if(l(W)){const ue=x.length||0,be=W.length||0;x.length=ue+be;for(let Re=0;Re<be;Re++)x[ue+Re]=W[Re]}else x.push(W)}}class S{constructor(N,M){this.i=N,this.j=M,this.h=0,this.g=null}get(){let N;return 0<this.h?(this.h--,N=this.g,this.g=N.next,N.next=null):N=this.i(),N}}function T(x){return/^[\s\xa0]*$/.test(x)}function I(){var x=a.navigator;return x&&(x=x.userAgent)?x:""}function k(x){return k[" "](x),x}k[" "]=function(){};var O=I().indexOf("Gecko")!=-1&&!(I().toLowerCase().indexOf("webkit")!=-1&&I().indexOf("Edge")==-1)&&!(I().indexOf("Trident")!=-1||I().indexOf("MSIE")!=-1)&&I().indexOf("Edge")==-1;function V(x,N,M){for(const W in x)N.call(M,x[W],W,x)}function P(x,N){for(const M in x)N.call(void 0,x[M],M,x)}function D(x){const N={};for(const M in x)N[M]=x[M];return N}const $="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function R(x,N){let M,W;for(let ue=1;ue<arguments.length;ue++){W=arguments[ue];for(M in W)x[M]=W[M];for(let be=0;be<$.length;be++)M=$[be],Object.prototype.hasOwnProperty.call(W,M)&&(x[M]=W[M])}}function A(x){var N=1;x=x.split(":");const M=[];for(;0<N&&x.length;)M.push(x.shift()),N--;return x.length&&M.push(x.join(":")),M}function U(x){a.setTimeout(()=>{throw x},0)}function F(){var x=ce;let N=null;return x.g&&(N=x.g,x.g=x.g.next,x.g||(x.h=null),N.next=null),N}class ne{constructor(){this.h=this.g=null}add(N,M){const W=Q.get();W.set(N,M),this.h?this.h.next=W:this.g=W,this.h=W}}var Q=new S(()=>new G,x=>x.reset());class G{constructor(){this.next=this.g=this.h=null}set(N,M){this.h=N,this.g=M,this.next=null}reset(){this.next=this.g=this.h=null}}let K,J=!1,ce=new ne,z=()=>{const x=a.Promise.resolve(void 0);K=()=>{x.then(X)}};var X=()=>{for(var x;x=F();){try{x.h.call(x.g)}catch(M){U(M)}var N=Q;N.j(x),100>N.h&&(N.h++,x.next=N.g,N.g=x)}J=!1};function ie(){this.s=this.s,this.C=this.C}ie.prototype.s=!1,ie.prototype.ma=function(){this.s||(this.s=!0,this.N())},ie.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function se(x,N){this.type=x,this.g=this.target=N,this.defaultPrevented=!1}se.prototype.h=function(){this.defaultPrevented=!0};var ve=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var x=!1,N=Object.defineProperty({},"passive",{get:function(){x=!0}});try{const M=()=>{};a.addEventListener("test",M,N),a.removeEventListener("test",M,N)}catch{}return x}();function we(x,N){if(se.call(this,x?x.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,x){var M=this.type=x.type,W=x.changedTouches&&x.changedTouches.length?x.changedTouches[0]:null;if(this.target=x.target||x.srcElement,this.g=N,N=x.relatedTarget){if(O){e:{try{k(N.nodeName);var ue=!0;break e}catch{}ue=!1}ue||(N=null)}}else M=="mouseover"?N=x.fromElement:M=="mouseout"&&(N=x.toElement);this.relatedTarget=N,W?(this.clientX=W.clientX!==void 0?W.clientX:W.pageX,this.clientY=W.clientY!==void 0?W.clientY:W.pageY,this.screenX=W.screenX||0,this.screenY=W.screenY||0):(this.clientX=x.clientX!==void 0?x.clientX:x.pageX,this.clientY=x.clientY!==void 0?x.clientY:x.pageY,this.screenX=x.screenX||0,this.screenY=x.screenY||0),this.button=x.button,this.key=x.key||"",this.ctrlKey=x.ctrlKey,this.altKey=x.altKey,this.shiftKey=x.shiftKey,this.metaKey=x.metaKey,this.pointerId=x.pointerId||0,this.pointerType=typeof x.pointerType=="string"?x.pointerType:Se[x.pointerType]||"",this.state=x.state,this.i=x,x.defaultPrevented&&we.aa.h.call(this)}}b(we,se);var Se={2:"touch",3:"pen",4:"mouse"};we.prototype.h=function(){we.aa.h.call(this);var x=this.i;x.preventDefault?x.preventDefault():x.returnValue=!1};var Oe="closure_listenable_"+(1e6*Math.random()|0),De=0;function Ue(x,N,M,W,ue){this.listener=x,this.proxy=null,this.src=N,this.type=M,this.capture=!!W,this.ha=ue,this.key=++De,this.da=this.fa=!1}function Ke(x){x.da=!0,x.listener=null,x.proxy=null,x.src=null,x.ha=null}function Xe(x){this.src=x,this.g={},this.h=0}Xe.prototype.add=function(x,N,M,W,ue){var be=x.toString();x=this.g[be],x||(x=this.g[be]=[],this.h++);var Re=kt(x,N,W,ue);return-1<Re?(N=x[Re],M||(N.fa=!1)):(N=new Ue(N,this.src,be,!!W,ue),N.fa=M,x.push(N)),N};function mt(x,N){var M=N.type;if(M in x.g){var W=x.g[M],ue=Array.prototype.indexOf.call(W,N,void 0),be;(be=0<=ue)&&Array.prototype.splice.call(W,ue,1),be&&(Ke(N),x.g[M].length==0&&(delete x.g[M],x.h--))}}function kt(x,N,M,W){for(var ue=0;ue<x.length;++ue){var be=x[ue];if(!be.da&&be.listener==N&&be.capture==!!M&&be.ha==W)return ue}return-1}var jt="closure_lm_"+(1e6*Math.random()|0),Ft={};function $t(x,N,M,W,ue){if(Array.isArray(N)){for(var be=0;be<N.length;be++)$t(x,N[be],M,W,ue);return null}return M=Rr(M),x&&x[Oe]?x.K(N,M,u(W)?!!W.capture:!1,ue):xt(x,N,M,!1,W,ue)}function xt(x,N,M,W,ue,be){if(!N)throw Error("Invalid event type");var Re=u(ue)?!!ue.capture:!!ue,Dt=Ar(x);if(Dt||(x[jt]=Dt=new Xe(x)),M=Dt.add(N,M,W,Re,be),M.proxy)return M;if(W=Jt(),M.proxy=W,W.src=x,W.listener=M,x.addEventListener)ve||(ue=Re),ue===void 0&&(ue=!1),x.addEventListener(N.toString(),W,ue);else if(x.attachEvent)x.attachEvent(rr(N.toString()),W);else if(x.addListener&&x.removeListener)x.addListener(W);else throw Error("addEventListener and attachEvent are unavailable.");return M}function Jt(){function x(M){return N.call(x.src,x.listener,M)}const N=Us;return x}function br(x,N,M,W,ue){if(Array.isArray(N))for(var be=0;be<N.length;be++)br(x,N[be],M,W,ue);else W=u(W)?!!W.capture:!!W,M=Rr(M),x&&x[Oe]?(x=x.i,N=String(N).toString(),N in x.g&&(be=x.g[N],M=kt(be,M,W,ue),-1<M&&(Ke(be[M]),Array.prototype.splice.call(be,M,1),be.length==0&&(delete x.g[N],x.h--)))):x&&(x=Ar(x))&&(N=x.g[N.toString()],x=-1,N&&(x=kt(N,M,W,ue)),(M=-1<x?N[x]:null)&&wn(M))}function wn(x){if(typeof x!="number"&&x&&!x.da){var N=x.src;if(N&&N[Oe])mt(N.i,x);else{var M=x.type,W=x.proxy;N.removeEventListener?N.removeEventListener(M,W,x.capture):N.detachEvent?N.detachEvent(rr(M),W):N.addListener&&N.removeListener&&N.removeListener(W),(M=Ar(N))?(mt(M,x),M.h==0&&(M.src=null,N[jt]=null)):Ke(x)}}}function rr(x){return x in Ft?Ft[x]:Ft[x]="on"+x}function Us(x,N){if(x.da)x=!0;else{N=new we(N,this);var M=x.listener,W=x.ha||x.src;x.fa&&wn(x),x=M.call(W,N)}return x}function Ar(x){return x=x[jt],x instanceof Xe?x:null}var Bs="__closure_events_fn_"+(1e9*Math.random()>>>0);function Rr(x){return typeof x=="function"?x:(x[Bs]||(x[Bs]=function(N){return x.handleEvent(N)}),x[Bs])}function Wt(){ie.call(this),this.i=new Xe(this),this.M=this,this.F=null}b(Wt,ie),Wt.prototype[Oe]=!0,Wt.prototype.removeEventListener=function(x,N,M,W){br(this,x,N,M,W)};function gt(x,N){var M,W=x.F;if(W)for(M=[];W;W=W.F)M.push(W);if(x=x.M,W=N.type||N,typeof N=="string")N=new se(N,x);else if(N instanceof se)N.target=N.target||x;else{var ue=N;N=new se(W,x),R(N,ue)}if(ue=!0,M)for(var be=M.length-1;0<=be;be--){var Re=N.g=M[be];ue=$n(Re,W,!0,N)&&ue}if(Re=N.g=x,ue=$n(Re,W,!0,N)&&ue,ue=$n(Re,W,!1,N)&&ue,M)for(be=0;be<M.length;be++)Re=N.g=M[be],ue=$n(Re,W,!1,N)&&ue}Wt.prototype.N=function(){if(Wt.aa.N.call(this),this.i){var x=this.i,N;for(N in x.g){for(var M=x.g[N],W=0;W<M.length;W++)Ke(M[W]);delete x.g[N],x.h--}}this.F=null},Wt.prototype.K=function(x,N,M,W){return this.i.add(String(x),N,!1,M,W)},Wt.prototype.L=function(x,N,M,W){return this.i.add(String(x),N,!0,M,W)};function $n(x,N,M,W){if(N=x.i.g[String(N)],!N)return!0;N=N.concat();for(var ue=!0,be=0;be<N.length;++be){var Re=N[be];if(Re&&!Re.da&&Re.capture==M){var Dt=Re.listener,fs=Re.ha||Re.src;Re.fa&&mt(x.i,Re),ue=Dt.call(fs,W)!==!1&&ue}}return ue&&!W.defaultPrevented}function Dn(x,N,M){if(typeof x=="function")M&&(x=m(x,M));else if(x&&typeof x.handleEvent=="function")x=m(x.handleEvent,x);else throw Error("Invalid listener argument");return 2147483647<Number(N)?-1:a.setTimeout(x,N||0)}function cl(x){x.g=Dn(()=>{x.g=null,x.i&&(x.i=!1,cl(x))},x.l);const N=x.h;x.h=null,x.m.apply(null,N)}class Gc extends ie{constructor(N,M){super(),this.m=N,this.l=M,this.h=null,this.i=!1,this.g=null}j(N){this.h=arguments,this.g?this.i=!0:cl(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ia(x){ie.call(this),this.h=x,this.g={}}b(ia,ie);var ui=[];function oa(x){V(x.g,function(N,M){this.g.hasOwnProperty(M)&&wn(N)},x),x.g={}}ia.prototype.N=function(){ia.aa.N.call(this),oa(this)},ia.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Kr=a.JSON.stringify,Fh=a.JSON.parse,Hc=class{stringify(x){return a.JSON.stringify(x,void 0)}parse(x){return a.JSON.parse(x,void 0)}};function pp(){}pp.prototype.h=null;function mp(x){return x.h||(x.h=x.i())}function gp(){}var aa={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function la(){se.call(this,"d")}b(la,se);function yp(){se.call(this,"c")}b(yp,se);var ho={},bp=null;function ul(){return bp=bp||new Wt}ho.La="serverreachability";function Vh(x){se.call(this,ho.La,x)}b(Vh,se);function hl(x){const N=ul();gt(N,new Vh(N))}ho.STAT_EVENT="statevent";function M0(x,N){se.call(this,ho.STAT_EVENT,x),this.stat=N}b(M0,se);function Tn(x){const N=ul();gt(N,new M0(N,x))}ho.Ma="timingevent";function ds(x,N){se.call(this,ho.Ma,x),this.size=N}b(ds,se);function Yn(x,N){if(typeof x!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){x()},N)}function hi(){this.g=!0}hi.prototype.xa=function(){this.g=!1};function xp(x,N,M,W,ue,be){x.info(function(){if(x.g)if(be)for(var Re="",Dt=be.split("&"),fs=0;fs<Dt.length;fs++){var Ot=Dt[fs].split("=");if(1<Ot.length){var Ts=Ot[0];Ot=Ot[1];var ps=Ts.split("_");Re=2<=ps.length&&ps[1]=="type"?Re+(Ts+"="+Ot+"&"):Re+(Ts+"=redacted&")}}else Re=null;else Re=be;return"XMLHTTP REQ ("+W+") [attempt "+ue+"]: "+N+`
`+M+`
`+Re})}function P1(x,N,M,W,ue,be,Re){x.info(function(){return"XMLHTTP RESP ("+W+") [ attempt "+ue+"]: "+N+`
`+M+`
`+be+" "+Re})}function dl(x,N,M,W){x.info(function(){return"XMLHTTP TEXT ("+N+"): "+qc(x,M)+(W?" "+W:"")})}function L0(x,N){x.info(function(){return"TIMEOUT: "+N})}hi.prototype.info=function(){};function qc(x,N){if(!x.g)return N;if(!N)return null;try{var M=JSON.parse(N);if(M){for(x=0;x<M.length;x++)if(Array.isArray(M[x])){var W=M[x];if(!(2>W.length)){var ue=W[1];if(Array.isArray(ue)&&!(1>ue.length)){var be=ue[0];if(be!="noop"&&be!="stop"&&be!="close")for(var Re=1;Re<ue.length;Re++)ue[Re]=""}}}}return Kr(M)}catch{return N}}var fl={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ca={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},fo;function po(){}b(po,pp),po.prototype.g=function(){return new XMLHttpRequest},po.prototype.i=function(){return{}},fo=new po;function xr(x,N,M,W){this.j=x,this.i=N,this.l=M,this.R=W||1,this.U=new ia(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Wn}function Wn(){this.i=null,this.g="",this.h=!1}var vp={},Uh={};function Vi(x,N,M){x.L=1,x.v=Jc(Xr(N)),x.m=M,x.P=!0,ua(x,null)}function ua(x,N){x.F=Date.now(),Kc(x),x.A=Xr(x.v);var M=x.A,W=x.R;Array.isArray(W)||(W=[String(W)]),Ep(M.i,"t",W),x.C=0,M=x.j.J,x.h=new Wn,x.g=Z0(x.j,M?N:null,!x.m),0<x.O&&(x.M=new Gc(m(x.Y,x,x.g),x.O)),N=x.U,M=x.g,W=x.ca;var ue="readystatechange";Array.isArray(ue)||(ue&&(ui[0]=ue.toString()),ue=ui);for(var be=0;be<ue.length;be++){var Re=$t(M,ue[be],W||N.handleEvent,!1,N.h||N);if(!Re)break;N.g[Re.key]=Re}N=x.H?D(x.H):{},x.m?(x.u||(x.u="POST"),N["Content-Type"]="application/x-www-form-urlencoded",x.g.ea(x.A,x.u,x.m,N)):(x.u="GET",x.g.ea(x.A,x.u,null,N)),hl(),xp(x.i,x.u,x.A,x.l,x.R,x.m)}xr.prototype.ca=function(x){x=x.target;const N=this.M;N&&mi(x)==3?N.j():this.Y(x)},xr.prototype.Y=function(x){try{if(x==this.g)e:{const ps=mi(this.g);var N=this.g.Ba();const ba=this.g.Z();if(!(3>ps)&&(ps!=3||this.g&&(this.h.h||this.g.oa()||G0(this.g)))){this.J||ps!=4||N==7||(N==8||0>=ba?hl(3):hl(2)),pl(this);var M=this.g.Z();this.X=M;t:if(F0(this)){var W=G0(this.g);x="";var ue=W.length,be=mi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){zs(this),mo(this);var Re="";break t}this.h.i=new a.TextDecoder}for(N=0;N<ue;N++)this.h.h=!0,x+=this.h.i.decode(W[N],{stream:!(be&&N==ue-1)});W.length=0,this.h.g+=x,this.C=0,Re=this.h.g}else Re=this.g.oa();if(this.o=M==200,P1(this.i,this.u,this.A,this.l,this.R,ps,M),this.o){if(this.T&&!this.K){t:{if(this.g){var Dt,fs=this.g;if((Dt=fs.g?fs.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!T(Dt)){var Ot=Dt;break t}}Ot=null}if(M=Ot)dl(this.i,this.l,M,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Xc(this,M);else{this.o=!1,this.s=3,Tn(12),zs(this),mo(this);break e}}if(this.P){M=!0;let js;for(;!this.J&&this.C<Re.length;)if(js=V0(this,Re),js==Uh){ps==4&&(this.s=4,Tn(14),M=!1),dl(this.i,this.l,null,"[Incomplete Response]");break}else if(js==vp){this.s=4,Tn(15),dl(this.i,this.l,Re,"[Invalid Chunk]"),M=!1;break}else dl(this.i,this.l,js,null),Xc(this,js);if(F0(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ps!=4||Re.length!=0||this.h.h||(this.s=1,Tn(16),M=!1),this.o=this.o&&M,!M)dl(this.i,this.l,Re,"[Invalid Chunked Response]"),zs(this),mo(this);else if(0<Re.length&&!this.W){this.W=!0;var Ts=this.j;Ts.g==this&&Ts.ba&&!Ts.M&&(Ts.j.info("Great, no buffering proxy detected. Bytes received: "+Re.length),ou(Ts),Ts.M=!0,Tn(11))}}else dl(this.i,this.l,Re,null),Xc(this,Re);ps==4&&zs(this),this.o&&!this.J&&(ps==4?Y0(this.j,this):(this.o=!1,Kc(this)))}else U1(this.g),M==400&&0<Re.indexOf("Unknown SID")?(this.s=3,Tn(12)):(this.s=0,Tn(13)),zs(this),mo(this)}}}catch{}finally{}};function F0(x){return x.g?x.u=="GET"&&x.L!=2&&x.j.Ca:!1}function V0(x,N){var M=x.C,W=N.indexOf(`
`,M);return W==-1?Uh:(M=Number(N.substring(M,W)),isNaN(M)?vp:(W+=1,W+M>N.length?Uh:(N=N.slice(W,W+M),x.C=W+M,N)))}xr.prototype.cancel=function(){this.J=!0,zs(this)};function Kc(x){x.S=Date.now()+x.I,U0(x,x.I)}function U0(x,N){if(x.B!=null)throw Error("WatchDog timer not null");x.B=Yn(m(x.ba,x),N)}function pl(x){x.B&&(a.clearTimeout(x.B),x.B=null)}xr.prototype.ba=function(){this.B=null;const x=Date.now();0<=x-this.S?(L0(this.i,this.A),this.L!=2&&(hl(),Tn(17)),zs(this),this.s=2,mo(this)):U0(this,this.S-x)};function mo(x){x.j.G==0||x.J||Y0(x.j,x)}function zs(x){pl(x);var N=x.M;N&&typeof N.ma=="function"&&N.ma(),x.M=null,oa(x.U),x.g&&(N=x.g,x.g=null,N.abort(),N.ma())}function Xc(x,N){try{var M=x.j;if(M.G!=0&&(M.g==x||wp(M.h,x))){if(!x.K&&wp(M.h,x)&&M.G==3){try{var W=M.Da.g.parse(N)}catch{W=null}if(Array.isArray(W)&&W.length==3){var ue=W;if(ue[0]==0){e:if(!M.u){if(M.g)if(M.g.F+3e3<x.F)Jh(M),Yh(M);else break e;Rp(M),Tn(18)}}else M.za=ue[1],0<M.za-M.T&&37500>ue[2]&&M.F&&M.v==0&&!M.C&&(M.C=Yn(m(M.Za,M),6e3));if(1>=zh(M.h)&&M.ca){try{M.ca()}catch{}M.ca=void 0}}else ya(M,11)}else if((x.K||M.g==x)&&Jh(M),!T(N))for(ue=M.Da.g.parse(N),N=0;N<ue.length;N++){let Ot=ue[N];if(M.T=Ot[0],Ot=Ot[1],M.G==2)if(Ot[0]=="c"){M.K=Ot[1],M.ia=Ot[2];const Ts=Ot[3];Ts!=null&&(M.la=Ts,M.j.info("VER="+M.la));const ps=Ot[4];ps!=null&&(M.Aa=ps,M.j.info("SVER="+M.Aa));const ba=Ot[5];ba!=null&&typeof ba=="number"&&0<ba&&(W=1.5*ba,M.L=W,M.j.info("backChannelRequestTimeoutMs_="+W)),W=M;const js=x.g;if(js){const _o=js.g?js.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(_o){var be=W.h;be.g||_o.indexOf("spdy")==-1&&_o.indexOf("quic")==-1&&_o.indexOf("h2")==-1||(be.j=be.l,be.g=new Set,be.h&&(jh(be,be.h),be.h=null))}if(W.D){const Dp=js.g?js.g.getResponseHeader("X-HTTP-Session-Id"):null;Dp&&(W.ya=Dp,rn(W.I,W.D,Dp))}}M.G=3,M.l&&M.l.ua(),M.ba&&(M.R=Date.now()-x.F,M.j.info("Handshake RTT: "+M.R+"ms")),W=M;var Re=x;if(W.qa=J0(W,W.J?W.ia:null,W.W),Re.K){vr(W.h,Re);var Dt=Re,fs=W.L;fs&&(Dt.I=fs),Dt.B&&(pl(Dt),Kc(Dt)),W.g=Re}else K0(W);0<M.i.length&&Qh(M)}else Ot[0]!="stop"&&Ot[0]!="close"||ya(M,7);else M.G==3&&(Ot[0]=="stop"||Ot[0]=="close"?Ot[0]=="stop"?ya(M,7):Np(M):Ot[0]!="noop"&&M.l&&M.l.ta(Ot),M.v=0)}}hl(4)}catch{}}var B0=class{constructor(x,N){this.g=x,this.map=N}};function ha(x){this.l=x||10,a.PerformanceNavigationTiming?(x=a.performance.getEntriesByType("navigation"),x=0<x.length&&(x[0].nextHopProtocol=="hq"||x[0].nextHopProtocol=="h2")):x=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=x?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Bh(x){return x.h?!0:x.g?x.g.size>=x.j:!1}function zh(x){return x.h?1:x.g?x.g.size:0}function wp(x,N){return x.h?x.h==N:x.g?x.g.has(N):!1}function jh(x,N){x.g?x.g.add(N):x.h=N}function vr(x,N){x.h&&x.h==N?x.h=null:x.g&&x.g.has(N)&&x.g.delete(N)}ha.prototype.cancel=function(){if(this.i=_p(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const x of this.g.values())x.cancel();this.g.clear()}};function _p(x){if(x.h!=null)return x.i.concat(x.h.D);if(x.g!=null&&x.g.size!==0){let N=x.i;for(const M of x.g.values())N=N.concat(M.D);return N}return w(x.i)}function M1(x){if(x.V&&typeof x.V=="function")return x.V();if(typeof Map<"u"&&x instanceof Map||typeof Set<"u"&&x instanceof Set)return Array.from(x.values());if(typeof x=="string")return x.split("");if(l(x)){for(var N=[],M=x.length,W=0;W<M;W++)N.push(x[W]);return N}N=[],M=0;for(W in x)N[M++]=x[W];return N}function Wh(x){if(x.na&&typeof x.na=="function")return x.na();if(!x.V||typeof x.V!="function"){if(typeof Map<"u"&&x instanceof Map)return Array.from(x.keys());if(!(typeof Set<"u"&&x instanceof Set)){if(l(x)||typeof x=="string"){var N=[];x=x.length;for(var M=0;M<x;M++)N.push(M);return N}N=[],M=0;for(const W in x)N[M++]=W;return N}}}function Sp(x,N){if(x.forEach&&typeof x.forEach=="function")x.forEach(N,void 0);else if(l(x)||typeof x=="string")Array.prototype.forEach.call(x,N,void 0);else for(var M=Wh(x),W=M1(x),ue=W.length,be=0;be<ue;be++)N.call(void 0,W[be],M&&M[be],x)}var Yc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function L1(x,N){if(x){x=x.split("&");for(var M=0;M<x.length;M++){var W=x[M].indexOf("="),ue=null;if(0<=W){var be=x[M].substring(0,W);ue=x[M].substring(W+1)}else be=x[M];N(be,ue?decodeURIComponent(ue.replace(/\+/g," ")):"")}}}function Qn(x){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,x instanceof Qn){this.h=x.h,Qc(this,x.j),this.o=x.o,this.g=x.g,ml(this,x.s),this.l=x.l;var N=x.i,M=new fa;M.i=N.i,N.g&&(M.g=new Map(N.g),M.h=N.h),da(this,M),this.m=x.m}else x&&(N=String(x).match(Yc))?(this.h=!1,Qc(this,N[1]||"",!0),this.o=di(N[2]||""),this.g=di(N[3]||"",!0),ml(this,N[4]),this.l=di(N[5]||"",!0),da(this,N[6]||"",!0),this.m=di(N[7]||"")):(this.h=!1,this.i=new fa(null,this.h))}Qn.prototype.toString=function(){var x=[],N=this.j;N&&x.push(Zc(N,Cp,!0),":");var M=this.g;return(M||N=="file")&&(x.push("//"),(N=this.o)&&x.push(Zc(N,Cp,!0),"@"),x.push(encodeURIComponent(String(M)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),M=this.s,M!=null&&x.push(":",String(M))),(M=this.l)&&(this.g&&M.charAt(0)!="/"&&x.push("/"),x.push(Zc(M,M.charAt(0)=="/"?F1:Tp,!0))),(M=this.i.toString())&&x.push("?",M),(M=this.m)&&x.push("#",Zc(M,Gh)),x.join("")};function Xr(x){return new Qn(x)}function Qc(x,N,M){x.j=M?di(N,!0):N,x.j&&(x.j=x.j.replace(/:$/,""))}function ml(x,N){if(N){if(N=Number(N),isNaN(N)||0>N)throw Error("Bad port number "+N);x.s=N}else x.s=null}function da(x,N,M){N instanceof fa?(x.i=N,j0(x.i,x.h)):(M||(N=Zc(N,V1)),x.i=new fa(N,x.h))}function rn(x,N,M){x.i.set(N,M)}function Jc(x){return rn(x,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),x}function di(x,N){return x?N?decodeURI(x.replace(/%25/g,"%2525")):decodeURIComponent(x):""}function Zc(x,N,M){return typeof x=="string"?(x=encodeURI(x).replace(N,z0),M&&(x=x.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),x):null}function z0(x){return x=x.charCodeAt(0),"%"+(x>>4&15).toString(16)+(x&15).toString(16)}var Cp=/[#\/\?@]/g,Tp=/[#\?:]/g,F1=/[#\?]/g,V1=/[#\?@]/g,Gh=/#/g;function fa(x,N){this.h=this.g=null,this.i=x||null,this.j=!!N}function fi(x){x.g||(x.g=new Map,x.h=0,x.i&&L1(x.i,function(N,M){x.add(decodeURIComponent(N.replace(/\+/g," ")),M)}))}n=fa.prototype,n.add=function(x,N){fi(this),this.i=null,x=go(this,x);var M=this.g.get(x);return M||this.g.set(x,M=[]),M.push(N),this.h+=1,this};function pa(x,N){fi(x),N=go(x,N),x.g.has(N)&&(x.i=null,x.h-=x.g.get(N).length,x.g.delete(N))}function ma(x,N){return fi(x),N=go(x,N),x.g.has(N)}n.forEach=function(x,N){fi(this),this.g.forEach(function(M,W){M.forEach(function(ue){x.call(N,ue,W,this)},this)},this)},n.na=function(){fi(this);const x=Array.from(this.g.values()),N=Array.from(this.g.keys()),M=[];for(let W=0;W<N.length;W++){const ue=x[W];for(let be=0;be<ue.length;be++)M.push(N[W])}return M},n.V=function(x){fi(this);let N=[];if(typeof x=="string")ma(this,x)&&(N=N.concat(this.g.get(go(this,x))));else{x=Array.from(this.g.values());for(let M=0;M<x.length;M++)N=N.concat(x[M])}return N},n.set=function(x,N){return fi(this),this.i=null,x=go(this,x),ma(this,x)&&(this.h-=this.g.get(x).length),this.g.set(x,[N]),this.h+=1,this},n.get=function(x,N){return x?(x=this.V(x),0<x.length?String(x[0]):N):N};function Ep(x,N,M){pa(x,N),0<M.length&&(x.i=null,x.g.set(go(x,N),w(M)),x.h+=M.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const x=[],N=Array.from(this.g.keys());for(var M=0;M<N.length;M++){var W=N[M];const be=encodeURIComponent(String(W)),Re=this.V(W);for(W=0;W<Re.length;W++){var ue=be;Re[W]!==""&&(ue+="="+encodeURIComponent(String(Re[W]))),x.push(ue)}}return this.i=x.join("&")};function go(x,N){return N=String(N),x.j&&(N=N.toLowerCase()),N}function j0(x,N){N&&!x.j&&(fi(x),x.i=null,x.g.forEach(function(M,W){var ue=W.toLowerCase();W!=ue&&(pa(this,W),Ep(this,ue,M))},x)),x.j=N}function eu(x,N){const M=new hi;if(a.Image){const W=new Image;W.onload=y(pi,M,"TestLoadImage: loaded",!0,N,W),W.onerror=y(pi,M,"TestLoadImage: error",!1,N,W),W.onabort=y(pi,M,"TestLoadImage: abort",!1,N,W),W.ontimeout=y(pi,M,"TestLoadImage: timeout",!1,N,W),a.setTimeout(function(){W.ontimeout&&W.ontimeout()},1e4),W.src=x}else N(!1)}function Ui(x,N){const M=new hi,W=new AbortController,ue=setTimeout(()=>{W.abort(),pi(M,"TestPingServer: timeout",!1,N)},1e4);fetch(x,{signal:W.signal}).then(be=>{clearTimeout(ue),be.ok?pi(M,"TestPingServer: ok",!0,N):pi(M,"TestPingServer: server error",!1,N)}).catch(()=>{clearTimeout(ue),pi(M,"TestPingServer: error",!1,N)})}function pi(x,N,M,W,ue){try{ue&&(ue.onload=null,ue.onerror=null,ue.onabort=null,ue.ontimeout=null),W(M)}catch{}}function tu(){this.g=new Hc}function yo(x,N,M){const W=M||"";try{Sp(x,function(ue,be){let Re=ue;u(ue)&&(Re=Kr(ue)),N.push(W+be+"="+encodeURIComponent(Re))})}catch(ue){throw N.push(W+"type="+encodeURIComponent("_badmap")),ue}}function gl(x){this.l=x.Ub||null,this.j=x.eb||!1}b(gl,pp),gl.prototype.g=function(){return new ga(this.l,this.j)},gl.prototype.i=function(x){return function(){return x}}({});function ga(x,N){Wt.call(this),this.D=x,this.o=N,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}b(ga,Wt),n=ga.prototype,n.open=function(x,N){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=x,this.A=N,this.readyState=1,xo(this)},n.send=function(x){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const N={headers:this.u,method:this.B,credentials:this.m,cache:void 0};x&&(N.body=x),(this.D||a).fetch(new Request(this.A,N)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,bo(this)),this.readyState=0},n.Sa=function(x){if(this.g&&(this.l=x,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=x.headers,this.readyState=2,xo(this)),this.g&&(this.readyState=3,xo(this),this.g)))if(this.responseType==="arraybuffer")x.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in x){if(this.j=x.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ip(this)}else x.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ip(x){x.j.read().then(x.Pa.bind(x)).catch(x.ga.bind(x))}n.Pa=function(x){if(this.g){if(this.o&&x.value)this.response.push(x.value);else if(!this.o){var N=x.value?x.value:new Uint8Array(0);(N=this.v.decode(N,{stream:!x.done}))&&(this.response=this.responseText+=N)}x.done?bo(this):xo(this),this.readyState==3&&Ip(this)}},n.Ra=function(x){this.g&&(this.response=this.responseText=x,bo(this))},n.Qa=function(x){this.g&&(this.response=x,bo(this))},n.ga=function(){this.g&&bo(this)};function bo(x){x.readyState=4,x.l=null,x.j=null,x.v=null,xo(x)}n.setRequestHeader=function(x,N){this.u.append(x,N)},n.getResponseHeader=function(x){return this.h&&this.h.get(x.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const x=[],N=this.h.entries();for(var M=N.next();!M.done;)M=M.value,x.push(M[0]+": "+M[1]),M=N.next();return x.join(`\r
`)};function xo(x){x.onreadystatechange&&x.onreadystatechange.call(x)}Object.defineProperty(ga.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(x){this.m=x?"include":"same-origin"}});function kp(x){let N="";return V(x,function(M,W){N+=W,N+=":",N+=M,N+=`\r
`}),N}function Cs(x,N,M){e:{for(W in M){var W=!1;break e}W=!0}W||(M=kp(M),typeof x=="string"?M!=null&&encodeURIComponent(String(M)):rn(x,N,M))}function Kt(x){Wt.call(this),this.headers=new Map,this.o=x||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}b(Kt,Wt);var Hh=/^https?$/i,nu=["POST","PUT"];n=Kt.prototype,n.Ha=function(x){this.J=x},n.ea=function(x,N,M,W){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+x);N=N?N.toUpperCase():"GET",this.D=x,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():fo.g(),this.v=this.o?mp(this.o):mp(fo),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(N,String(x),!0),this.B=!1}catch(be){W0(this,be);return}if(x=M||"",M=new Map(this.headers),W)if(Object.getPrototypeOf(W)===Object.prototype)for(var ue in W)M.set(ue,W[ue]);else if(typeof W.keys=="function"&&typeof W.get=="function")for(const be of W.keys())M.set(be,W.get(be));else throw Error("Unknown input type for opt_headers: "+String(W));W=Array.from(M.keys()).find(be=>be.toLowerCase()=="content-type"),ue=a.FormData&&x instanceof a.FormData,!(0<=Array.prototype.indexOf.call(nu,N,void 0))||W||ue||M.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[be,Re]of M)this.g.setRequestHeader(be,Re);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{su(this),this.u=!0,this.g.send(x),this.u=!1}catch(be){W0(this,be)}};function W0(x,N){x.h=!1,x.g&&(x.j=!0,x.g.abort(),x.j=!1),x.l=N,x.m=5,qh(x),vo(x)}function qh(x){x.A||(x.A=!0,gt(x,"complete"),gt(x,"error"))}n.abort=function(x){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=x||7,gt(this,"complete"),gt(this,"abort"),vo(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),vo(this,!0)),Kt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Kh(this):this.bb())},n.bb=function(){Kh(this)};function Kh(x){if(x.h&&typeof o<"u"&&(!x.v[1]||mi(x)!=4||x.Z()!=2)){if(x.u&&mi(x)==4)Dn(x.Ea,0,x);else if(gt(x,"readystatechange"),mi(x)==4){x.h=!1;try{const Re=x.Z();e:switch(Re){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var N=!0;break e;default:N=!1}var M;if(!(M=N)){var W;if(W=Re===0){var ue=String(x.D).match(Yc)[1]||null;!ue&&a.self&&a.self.location&&(ue=a.self.location.protocol.slice(0,-1)),W=!Hh.test(ue?ue.toLowerCase():"")}M=W}if(M)gt(x,"complete"),gt(x,"success");else{x.m=6;try{var be=2<mi(x)?x.g.statusText:""}catch{be=""}x.l=be+" ["+x.Z()+"]",qh(x)}}finally{vo(x)}}}}function vo(x,N){if(x.g){su(x);const M=x.g,W=x.v[0]?()=>{}:null;x.g=null,x.v=null,N||gt(x,"ready");try{M.onreadystatechange=W}catch{}}}function su(x){x.I&&(a.clearTimeout(x.I),x.I=null)}n.isActive=function(){return!!this.g};function mi(x){return x.g?x.g.readyState:0}n.Z=function(){try{return 2<mi(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(x){if(this.g){var N=this.g.responseText;return x&&N.indexOf(x)==0&&(N=N.substring(x.length)),Fh(N)}};function G0(x){try{if(!x.g)return null;if("response"in x.g)return x.g.response;switch(x.H){case"":case"text":return x.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in x.g)return x.g.mozResponseArrayBuffer}return null}catch{return null}}function U1(x){const N={};x=(x.g&&2<=mi(x)&&x.g.getAllResponseHeaders()||"").split(`\r
`);for(let W=0;W<x.length;W++){if(T(x[W]))continue;var M=A(x[W]);const ue=M[0];if(M=M[1],typeof M!="string")continue;M=M.trim();const be=N[ue]||[];N[ue]=be,be.push(M)}P(N,function(W){return W.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ru(x,N,M){return M&&M.internalChannelParams&&M.internalChannelParams[x]||N}function Xh(x){this.Aa=0,this.i=[],this.j=new hi,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ru("failFast",!1,x),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ru("baseRetryDelayMs",5e3,x),this.cb=ru("retryDelaySeedMs",1e4,x),this.Wa=ru("forwardChannelMaxRetries",2,x),this.wa=ru("forwardChannelRequestTimeoutMs",2e4,x),this.pa=x&&x.xmlHttpFactory||void 0,this.Xa=x&&x.Tb||void 0,this.Ca=x&&x.useFetchStreams||!1,this.L=void 0,this.J=x&&x.supportsCrossDomainXhr||!1,this.K="",this.h=new ha(x&&x.concurrentRequestLimit),this.Da=new tu,this.P=x&&x.fastHandshake||!1,this.O=x&&x.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=x&&x.Rb||!1,x&&x.xa&&this.j.xa(),x&&x.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&x&&x.detectBufferingProxy||!1,this.ja=void 0,x&&x.longPollingTimeout&&0<x.longPollingTimeout&&(this.ja=x.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Xh.prototype,n.la=8,n.G=1,n.connect=function(x,N,M,W){Tn(0),this.W=x,this.H=N||{},M&&W!==void 0&&(this.H.OSID=M,this.H.OAID=W),this.F=this.X,this.I=J0(this,null,this.W),Qh(this)};function Np(x){if(H0(x),x.G==3){var N=x.U++,M=Xr(x.I);if(rn(M,"SID",x.K),rn(M,"RID",N),rn(M,"TYPE","terminate"),iu(x,M),N=new xr(x,x.j,N),N.L=2,N.v=Jc(Xr(M)),M=!1,a.navigator&&a.navigator.sendBeacon)try{M=a.navigator.sendBeacon(N.v.toString(),"")}catch{}!M&&a.Image&&(new Image().src=N.v,M=!0),M||(N.g=Z0(N.j,null),N.g.ea(N.v)),N.F=Date.now(),Kc(N)}Q0(x)}function Yh(x){x.g&&(ou(x),x.g.cancel(),x.g=null)}function H0(x){Yh(x),x.u&&(a.clearTimeout(x.u),x.u=null),Jh(x),x.h.cancel(),x.s&&(typeof x.s=="number"&&a.clearTimeout(x.s),x.s=null)}function Qh(x){if(!Bh(x.h)&&!x.s){x.s=!0;var N=x.Ga;K||z(),J||(K(),J=!0),ce.add(N,x),x.B=0}}function B1(x,N){return zh(x.h)>=x.h.j-(x.s?1:0)?!1:x.s?(x.i=N.D.concat(x.i),!0):x.G==1||x.G==2||x.B>=(x.Va?0:x.Wa)?!1:(x.s=Yn(m(x.Ga,x,N),$p(x,x.B)),x.B++,!0)}n.Ga=function(x){if(this.s)if(this.s=null,this.G==1){if(!x){this.U=Math.floor(1e5*Math.random()),x=this.U++;const ue=new xr(this,this.j,x);let be=this.o;if(this.S&&(be?(be=D(be),R(be,this.S)):be=this.S),this.m!==null||this.O||(ue.H=be,be=null),this.P)e:{for(var N=0,M=0;M<this.i.length;M++){t:{var W=this.i[M];if("__data__"in W.map&&(W=W.map.__data__,typeof W=="string")){W=W.length;break t}W=void 0}if(W===void 0)break;if(N+=W,4096<N){N=M;break e}if(N===4096||M===this.i.length-1){N=M+1;break e}}N=1e3}else N=1e3;N=q0(this,ue,N),M=Xr(this.I),rn(M,"RID",x),rn(M,"CVER",22),this.D&&rn(M,"X-HTTP-Session-Id",this.D),iu(this,M),be&&(this.O?N="headers="+encodeURIComponent(String(kp(be)))+"&"+N:this.m&&Cs(M,this.m,be)),jh(this.h,ue),this.Ua&&rn(M,"TYPE","init"),this.P?(rn(M,"$req",N),rn(M,"SID","null"),ue.T=!0,Vi(ue,M,null)):Vi(ue,M,N),this.G=2}}else this.G==3&&(x?Ap(this,x):this.i.length==0||Bh(this.h)||Ap(this))};function Ap(x,N){var M;N?M=N.l:M=x.U++;const W=Xr(x.I);rn(W,"SID",x.K),rn(W,"RID",M),rn(W,"AID",x.T),iu(x,W),x.m&&x.o&&Cs(W,x.m,x.o),M=new xr(x,x.j,M,x.B+1),x.m===null&&(M.H=x.o),N&&(x.i=N.D.concat(x.i)),N=q0(x,M,1e3),M.I=Math.round(.5*x.wa)+Math.round(.5*x.wa*Math.random()),jh(x.h,M),Vi(M,W,N)}function iu(x,N){x.H&&V(x.H,function(M,W){rn(N,W,M)}),x.l&&Sp({},function(M,W){rn(N,W,M)})}function q0(x,N,M){M=Math.min(x.i.length,M);var W=x.l?m(x.l.Na,x.l,x):null;e:{var ue=x.i;let be=-1;for(;;){const Re=["count="+M];be==-1?0<M?(be=ue[0].g,Re.push("ofs="+be)):be=0:Re.push("ofs="+be);let Dt=!0;for(let fs=0;fs<M;fs++){let Ot=ue[fs].g;const Ts=ue[fs].map;if(Ot-=be,0>Ot)be=Math.max(0,ue[fs].g-100),Dt=!1;else try{yo(Ts,Re,"req"+Ot+"_")}catch{W&&W(Ts)}}if(Dt){W=Re.join("&");break e}}}return x=x.i.splice(0,M),N.D=x,W}function K0(x){if(!x.g&&!x.u){x.Y=1;var N=x.Fa;K||z(),J||(K(),J=!0),ce.add(N,x),x.v=0}}function Rp(x){return x.g||x.u||3<=x.v?!1:(x.Y++,x.u=Yn(m(x.Fa,x),$p(x,x.v)),x.v++,!0)}n.Fa=function(){if(this.u=null,X0(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var x=2*this.R;this.j.info("BP detection timer enabled: "+x),this.A=Yn(m(this.ab,this),x)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Tn(10),Yh(this),X0(this))};function ou(x){x.A!=null&&(a.clearTimeout(x.A),x.A=null)}function X0(x){x.g=new xr(x,x.j,"rpc",x.Y),x.m===null&&(x.g.H=x.o),x.g.O=0;var N=Xr(x.qa);rn(N,"RID","rpc"),rn(N,"SID",x.K),rn(N,"AID",x.T),rn(N,"CI",x.F?"0":"1"),!x.F&&x.ja&&rn(N,"TO",x.ja),rn(N,"TYPE","xmlhttp"),iu(x,N),x.m&&x.o&&Cs(N,x.m,x.o),x.L&&(x.g.I=x.L);var M=x.g;x=x.ia,M.L=1,M.v=Jc(Xr(N)),M.m=null,M.P=!0,ua(M,x)}n.Za=function(){this.C!=null&&(this.C=null,Yh(this),Rp(this),Tn(19))};function Jh(x){x.C!=null&&(a.clearTimeout(x.C),x.C=null)}function Y0(x,N){var M=null;if(x.g==N){Jh(x),ou(x),x.g=null;var W=2}else if(wp(x.h,N))M=N.D,vr(x.h,N),W=1;else return;if(x.G!=0){if(N.o)if(W==1){M=N.m?N.m.length:0,N=Date.now()-N.F;var ue=x.B;W=ul(),gt(W,new ds(W,M)),Qh(x)}else K0(x);else if(ue=N.s,ue==3||ue==0&&0<N.X||!(W==1&&B1(x,N)||W==2&&Rp(x)))switch(M&&0<M.length&&(N=x.h,N.i=N.i.concat(M)),ue){case 1:ya(x,5);break;case 4:ya(x,10);break;case 3:ya(x,6);break;default:ya(x,2)}}}function $p(x,N){let M=x.Ta+Math.floor(Math.random()*x.cb);return x.isActive()||(M*=2),M*N}function ya(x,N){if(x.j.info("Error code "+N),N==2){var M=m(x.fb,x),W=x.Xa;const ue=!W;W=new Qn(W||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Qc(W,"https"),Jc(W),ue?eu(W.toString(),M):Ui(W.toString(),M)}else Tn(2);x.G=0,x.l&&x.l.sa(N),Q0(x),H0(x)}n.fb=function(x){x?(this.j.info("Successfully pinged google.com"),Tn(2)):(this.j.info("Failed to ping google.com"),Tn(1))};function Q0(x){if(x.G=0,x.ka=[],x.l){const N=_p(x.h);(N.length!=0||x.i.length!=0)&&(v(x.ka,N),v(x.ka,x.i),x.h.i.length=0,w(x.i),x.i.length=0),x.l.ra()}}function J0(x,N,M){var W=M instanceof Qn?Xr(M):new Qn(M);if(W.g!="")N&&(W.g=N+"."+W.g),ml(W,W.s);else{var ue=a.location;W=ue.protocol,N=N?N+"."+ue.hostname:ue.hostname,ue=+ue.port;var be=new Qn(null);W&&Qc(be,W),N&&(be.g=N),ue&&ml(be,ue),M&&(be.l=M),W=be}return M=x.D,N=x.ya,M&&N&&rn(W,M,N),rn(W,"VER",x.la),iu(x,W),W}function Z0(x,N,M){if(N&&!x.J)throw Error("Can't create secondary domain capable XhrIo object.");return N=x.Ca&&!x.pa?new Kt(new gl({eb:M})):new Kt(x.pa),N.Ha(x.J),N}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function eb(){}n=eb.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Zh(){}Zh.prototype.g=function(x,N){return new wr(x,N)};function wr(x,N){Wt.call(this),this.g=new Xh(N),this.l=x,this.h=N&&N.messageUrlParams||null,x=N&&N.messageHeaders||null,N&&N.clientProtocolHeaderRequired&&(x?x["X-Client-Protocol"]="webchannel":x={"X-Client-Protocol":"webchannel"}),this.g.o=x,x=N&&N.initMessageHeaders||null,N&&N.messageContentType&&(x?x["X-WebChannel-Content-Type"]=N.messageContentType:x={"X-WebChannel-Content-Type":N.messageContentType}),N&&N.va&&(x?x["X-WebChannel-Client-Profile"]=N.va:x={"X-WebChannel-Client-Profile":N.va}),this.g.S=x,(x=N&&N.Sb)&&!T(x)&&(this.g.m=x),this.v=N&&N.supportsCrossDomainXhr||!1,this.u=N&&N.sendRawJson||!1,(N=N&&N.httpSessionIdParam)&&!T(N)&&(this.g.D=N,x=this.h,x!==null&&N in x&&(x=this.h,N in x&&delete x[N])),this.j=new wo(this)}b(wr,Wt),wr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},wr.prototype.close=function(){Np(this.g)},wr.prototype.o=function(x){var N=this.g;if(typeof x=="string"){var M={};M.__data__=x,x=M}else this.u&&(M={},M.__data__=Kr(x),x=M);N.i.push(new B0(N.Ya++,x)),N.G==3&&Qh(N)},wr.prototype.N=function(){this.g.l=null,delete this.j,Np(this.g),delete this.g,wr.aa.N.call(this)};function tb(x){la.call(this),x.__headers__&&(this.headers=x.__headers__,this.statusCode=x.__status__,delete x.__headers__,delete x.__status__);var N=x.__sm__;if(N){e:{for(const M in N){x=M;break e}x=void 0}(this.i=x)&&(x=this.i,N=N!==null&&x in N?N[x]:void 0),this.data=N}else this.data=x}b(tb,la);function nb(){yp.call(this),this.status=1}b(nb,yp);function wo(x){this.g=x}b(wo,eb),wo.prototype.ua=function(){gt(this.g,"a")},wo.prototype.ta=function(x){gt(this.g,new tb(x))},wo.prototype.sa=function(x){gt(this.g,new nb)},wo.prototype.ra=function(){gt(this.g,"b")},Zh.prototype.createWebChannel=Zh.prototype.g,wr.prototype.send=wr.prototype.o,wr.prototype.open=wr.prototype.m,wr.prototype.close=wr.prototype.close,k4=function(){return new Zh},I4=function(){return ul()},E4=ho,QT={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},fl.NO_ERROR=0,fl.TIMEOUT=8,fl.HTTP_ERROR=6,Px=fl,ca.COMPLETE="complete",T4=ca,gp.EventType=aa,aa.OPEN="a",aa.CLOSE="b",aa.ERROR="c",aa.MESSAGE="d",Wt.prototype.listen=Wt.prototype.K,Lm=gp,Kt.prototype.listenOnce=Kt.prototype.L,Kt.prototype.getLastError=Kt.prototype.Ka,Kt.prototype.getLastErrorCode=Kt.prototype.Ba,Kt.prototype.getStatus=Kt.prototype.Z,Kt.prototype.getResponseJson=Kt.prototype.Oa,Kt.prototype.getResponseText=Kt.prototype.oa,Kt.prototype.send=Kt.prototype.ea,Kt.prototype.setWithCredentials=Kt.prototype.Ha,C4=Kt}).apply(typeof lx<"u"?lx:typeof self<"u"?self:typeof window<"u"?window:{});const hP="@firebase/firestore",dP="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cr{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}cr.UNAUTHENTICATED=new cr(null),cr.GOOGLE_CREDENTIALS=new cr("google-credentials-uid"),cr.FIRST_PARTY=new cr("first-party-uid"),cr.MOCK_USER=new cr("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jf="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ju=new Iw("@firebase/firestore");function Gd(){return Ju.logLevel}function Fe(n,...e){if(Ju.logLevel<=St.DEBUG){const t=e.map(PI);Ju.debug(`Firestore (${jf}): ${n}`,...t)}}function qa(n,...e){if(Ju.logLevel<=St.ERROR){const t=e.map(PI);Ju.error(`Firestore (${jf}): ${n}`,...t)}}function bf(n,...e){if(Ju.logLevel<=St.WARN){const t=e.map(PI);Ju.warn(`Firestore (${jf}): ${n}`,...t)}}function PI(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tt(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,N4(n,s,t)}function N4(n,e,t){let s=`FIRESTORE (${jf}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw qa(s),new Error(s)}function Yt(n,e,t,s){let r="Unexpected state";typeof t=="string"?r=t:s=t,n||N4(e,r,s)}function ot(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Te={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Le extends nl{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A4{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class PY{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(cr.UNAUTHENTICATED))}shutdown(){}}class MY{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class LY{constructor(e){this.t=e,this.currentUser=cr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Yt(this.o===void 0,42304);let s=this.i;const r=l=>this.i!==s?(s=this.i,t(l)):Promise.resolve();let i=new ju;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new ju,e.enqueueRetryable(()=>r(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await r(this.currentUser)})},a=l=>{Fe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(Fe("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new ju)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(s=>this.i!==e?(Fe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(Yt(typeof s.accessToken=="string",31837,{l:s}),new A4(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Yt(e===null||typeof e=="string",2055,{h:e}),new cr(e)}}class FY{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=cr.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class VY{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new FY(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(cr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class fP{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class UY{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Fr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Yt(this.o===void 0,3512);const s=i=>{i.error!=null&&Fe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,Fe("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>s(i))};const r=i=>{Fe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>r(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?r(i):Fe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new fP(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Yt(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new fP(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BY(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MI{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const r=BY(40);for(let i=0;i<r.length;++i)s.length<20&&r[i]<t&&(s+=e.charAt(r[i]%62))}return s}}function Et(n,e){return n<e?-1:n>e?1:0}function JT(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const r=n.charAt(s),i=e.charAt(s);if(r!==i)return JC(r)===JC(i)?Et(r,i):JC(r)?1:-1}return Et(n.length,e.length)}const zY=55296,jY=57343;function JC(n){const e=n.charCodeAt(0);return e>=zY&&e<=jY}function xf(n,e,t){return n.length===e.length&&n.every((s,r)=>t(s,e[r]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pP="__name__";class No{constructor(e,t,s){t===void 0?t=0:t>e.length&&tt(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&tt(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return No.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof No?e.forEach(s=>{t.push(s)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const i=No.compareSegments(e.get(r),t.get(r));if(i!==0)return i}return Et(e.length,t.length)}static compareSegments(e,t){const s=No.isNumericId(e),r=No.isNumericId(t);return s&&!r?-1:!s&&r?1:s&&r?No.extractNumericId(e).compare(No.extractNumericId(t)):JT(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return tc.fromString(e.substring(4,e.length-2))}}class xn extends No{construct(e,t,s){return new xn(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new Le(Te.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter(r=>r.length>0))}return new xn(t)}static emptyPath(){return new xn([])}}const WY=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Xs extends No{construct(e,t,s){return new Xs(e,t,s)}static isValidIdentifier(e){return WY.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Xs.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===pP}static keyField(){return new Xs([pP])}static fromServerFormat(e){const t=[];let s="",r=0;const i=()=>{if(s.length===0)throw new Le(Te.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let o=!1;for(;r<e.length;){const a=e[r];if(a==="\\"){if(r+1===e.length)throw new Le(Te.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[r+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new Le(Te.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=l,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(s+=a,r++):(i(),r++)}if(i(),o)throw new Le(Te.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Xs(t)}static emptyPath(){return new Xs([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class He{constructor(e){this.path=e}static fromPath(e){return new He(xn.fromString(e))}static fromName(e){return new He(xn.fromString(e).popFirst(5))}static empty(){return new He(xn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&xn.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return xn.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new He(new xn(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R4(n,e,t){if(!t)throw new Le(Te.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function GY(n,e,t,s){if(e===!0&&s===!0)throw new Le(Te.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function mP(n){if(!He.isDocumentKey(n))throw new Le(Te.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function gP(n){if(He.isDocumentKey(n))throw new Le(Te.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function $4(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Nw(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(s){return s.constructor?s.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":tt(12329,{type:typeof n})}function Wu(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Le(Te.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Nw(n);throw new Le(Te.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function HY(n,e){if(e<=0)throw new Le(Te.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ss(n,e){const t={typeString:n};return e&&(t.value=e),t}function ny(n,e){if(!$4(n))throw new Le(Te.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const r=e[s].typeString,i="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const o=n[s];if(r&&typeof o!==r){t=`JSON field '${s}' must be a ${r}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${s}' field to equal '${i.value}'`;break}}if(t)throw new Le(Te.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yP=-62135596800,bP=1e6;class _n{static now(){return _n.fromMillis(Date.now())}static fromDate(e){return _n.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*bP);return new _n(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Le(Te.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Le(Te.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<yP)throw new Le(Te.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Le(Te.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/bP}_compareTo(e){return this.seconds===e.seconds?Et(this.nanoseconds,e.nanoseconds):Et(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:_n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ny(e,_n._jsonSchema))return new _n(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-yP;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}_n._jsonSchemaVersion="firestore/timestamp/1.0",_n._jsonSchema={type:ss("string",_n._jsonSchemaVersion),seconds:ss("number"),nanoseconds:ss("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rt{static fromTimestamp(e){return new rt(e)}static min(){return new rt(new _n(0,0))}static max(){return new rt(new _n(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yg=-1;function qY(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=rt.fromTimestamp(s===1e9?new _n(t+1,0):new _n(t,s));return new hc(r,He.empty(),e)}function KY(n){return new hc(n.readTime,n.key,yg)}class hc{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new hc(rt.min(),He.empty(),yg)}static max(){return new hc(rt.max(),He.empty(),yg)}}function XY(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=He.comparator(n.documentKey,e.documentKey),t!==0?t:Et(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YY="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class QY{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wf(n){if(n.code!==Te.FAILED_PRECONDITION||n.message!==YY)throw n;Fe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ie{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&tt(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Ie((s,r)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(s,r)},this.catchCallback=i=>{this.wrapFailure(t,i).next(s,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Ie?t:Ie.resolve(t)}catch(t){return Ie.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Ie.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Ie.reject(t)}static resolve(e){return new Ie((t,s)=>{t(e)})}static reject(e){return new Ie((t,s)=>{s(e)})}static waitFor(e){return new Ie((t,s)=>{let r=0,i=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++i,o&&i===r&&t()},l=>s(l))}),o=!0,i===r&&t()})}static or(e){let t=Ie.resolve(!1);for(const s of e)t=t.next(r=>r?Ie.resolve(r):s());return t}static forEach(e,t){const s=[];return e.forEach((r,i)=>{s.push(t.call(this,r,i))}),this.waitFor(s)}static mapArray(e,t){return new Ie((s,r)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next(d=>{o[u]=d,++a,a===i&&s(o)},d=>r(d))}})}static doWhile(e,t){return new Ie((s,r)=>{const i=()=>{e()===!0?t().next(()=>{i()},r):s()};i()})}}function JY(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Gf(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aw{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Aw.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LI=-1;function Rw(n){return n==null}function cv(n){return n===0&&1/n==-1/0}function ZY(n){return typeof n=="number"&&Number.isInteger(n)&&!cv(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D4="";function eQ(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=xP(e)),e=tQ(n.get(t),e);return xP(e)}function tQ(n,e){let t=e;const s=n.length;for(let r=0;r<s;r++){const i=n.charAt(r);switch(i){case"\0":t+="";break;case D4:t+="";break;default:t+=i}}return t}function xP(n){return n+D4+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vP(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Nc(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function O4(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cs=class ZT{constructor(e,t){this.comparator=e,this.root=t||nc.EMPTY}insert(e,t){return new ZT(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,nc.BLACK,null,null))}remove(e){return new ZT(this.comparator,this.root.remove(e,this.comparator).copy(null,null,nc.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,s)=>(e(t,s),!1))}toString(){const e=[];return this.inorderTraversal((t,s)=>(e.push(`${t}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new cx(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new cx(this.root,e,this.comparator,!1)}getReverseIterator(){return new cx(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new cx(this.root,e,this.comparator,!0)}},cx=class{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?s(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},nc=class Da{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??Da.RED,this.left=r??Da.EMPTY,this.right=i??Da.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,i){return new Da(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,s),null):i===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Da.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Da.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Da.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Da.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw tt(43730,{key:this.key,value:this.value});if(this.right.isRed())throw tt(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw tt(27949);return e+(this.isRed()?0:1)}};nc.EMPTY=null,nc.RED=!0,nc.BLACK=!1;nc.EMPTY=new class{constructor(){this.size=0}get key(){throw tt(57766)}get value(){throw tt(16141)}get color(){throw tt(16727)}get left(){throw tt(29726)}get right(){throw tt(36894)}copy(e,t,s,r,i){return this}insert(e,t,s){return new nc(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _s{constructor(e){this.comparator=e,this.data=new cs(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,s)=>(e(t),!1))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new wP(this.data.getIterator())}getIteratorFrom(e){return new wP(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(s=>{t=t.add(s)}),t}isEqual(e){if(!(e instanceof _s)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(this.comparator(r,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new _s(this.comparator);return t.data=e,t}}class wP{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ri{constructor(e){this.fields=e,e.sort(Xs.comparator)}static empty(){return new ri([])}unionWith(e){let t=new _s(Xs.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new ri(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return xf(this.fields,e.fields,(t,s)=>t.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P4 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new P4("Invalid base64 string: "+i):i}}(e);return new Ys(t)}static fromUint8Array(e){const t=function(r){let i="";for(let o=0;o<r.length;++o)i+=String.fromCharCode(r[o]);return i}(e);return new Ys(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Et(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ys.EMPTY_BYTE_STRING=new Ys("");const nQ=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function dc(n){if(Yt(!!n,39018),typeof n=="string"){let e=0;const t=nQ.exec(n);if(Yt(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:qn(n.seconds),nanos:qn(n.nanos)}}function qn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function fc(n){return typeof n=="string"?Ys.fromBase64String(n):Ys.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M4="server_timestamp",L4="__type__",F4="__previous_value__",V4="__local_write_time__";function FI(n){return(n?.mapValue?.fields||{})[L4]?.stringValue===M4}function $w(n){const e=n.mapValue.fields[F4];return FI(e)?$w(e):e}function bg(n){const e=dc(n.mapValue.fields[V4].timestampValue);return new _n(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sQ{constructor(e,t,s,r,i,o,a,l,u,d){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=d}}const uv="(default)";class xg{constructor(e,t){this.projectId=e,this.database=t||uv}static empty(){return new xg("","")}get isDefaultDatabase(){return this.database===uv}isEqual(e){return e instanceof xg&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U4="__type__",rQ="__max__",ux={mapValue:{}},B4="__vector__",hv="value";function pc(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?FI(n)?4:oQ(n)?9007199254740991:iQ(n)?10:11:tt(28295,{value:n})}function Xo(n,e){if(n===e)return!0;const t=pc(n);if(t!==pc(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return bg(n).isEqual(bg(e));case 3:return function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const o=dc(r.timestampValue),a=dc(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(r,i){return fc(r.bytesValue).isEqual(fc(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,i){return qn(r.geoPointValue.latitude)===qn(i.geoPointValue.latitude)&&qn(r.geoPointValue.longitude)===qn(i.geoPointValue.longitude)}(n,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return qn(r.integerValue)===qn(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const o=qn(r.doubleValue),a=qn(i.doubleValue);return o===a?cv(o)===cv(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return xf(n.arrayValue.values||[],e.arrayValue.values||[],Xo);case 10:case 11:return function(r,i){const o=r.mapValue.fields||{},a=i.mapValue.fields||{};if(vP(o)!==vP(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Xo(o[l],a[l])))return!1;return!0}(n,e);default:return tt(52216,{left:n})}}function vg(n,e){return(n.values||[]).find(t=>Xo(t,e))!==void 0}function vf(n,e){if(n===e)return 0;const t=pc(n),s=pc(e);if(t!==s)return Et(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return Et(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=qn(i.integerValue||i.doubleValue),l=qn(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return _P(n.timestampValue,e.timestampValue);case 4:return _P(bg(n),bg(e));case 5:return JT(n.stringValue,e.stringValue);case 6:return function(i,o){const a=fc(i),l=fc(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const d=Et(a[u],l[u]);if(d!==0)return d}return Et(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Et(qn(i.latitude),qn(o.latitude));return a!==0?a:Et(qn(i.longitude),qn(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return SP(n.arrayValue,e.arrayValue);case 10:return function(i,o){const a=i.fields||{},l=o.fields||{},u=a[hv]?.arrayValue,d=l[hv]?.arrayValue,f=Et(u?.values?.length||0,d?.values?.length||0);return f!==0?f:SP(u,d)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===ux.mapValue&&o===ux.mapValue)return 0;if(i===ux.mapValue)return 1;if(o===ux.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},d=Object.keys(u);l.sort(),d.sort();for(let f=0;f<l.length&&f<d.length;++f){const m=JT(l[f],d[f]);if(m!==0)return m;const y=vf(a[l[f]],u[d[f]]);if(y!==0)return y}return Et(l.length,d.length)}(n.mapValue,e.mapValue);default:throw tt(23264,{he:t})}}function _P(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Et(n,e);const t=dc(n),s=dc(e),r=Et(t.seconds,s.seconds);return r!==0?r:Et(t.nanos,s.nanos)}function SP(n,e){const t=n.values||[],s=e.values||[];for(let r=0;r<t.length&&r<s.length;++r){const i=vf(t[r],s[r]);if(i)return i}return Et(t.length,s.length)}function wf(n){return eE(n)}function eE(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const s=dc(t);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return fc(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return He.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let s="[",r=!0;for(const i of t.values||[])r?r=!1:s+=",",s+=eE(i);return s+"]"}(n.arrayValue):"mapValue"in n?function(t){const s=Object.keys(t.fields||{}).sort();let r="{",i=!0;for(const o of s)i?i=!1:r+=",",r+=`${o}:${eE(t.fields[o])}`;return r+"}"}(n.mapValue):tt(61005,{value:n})}function Mx(n){switch(pc(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=$w(n);return e?16+Mx(e):16;case 5:return 2*n.stringValue.length;case 6:return fc(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(s){return(s.values||[]).reduce((r,i)=>r+Mx(i),0)}(n.arrayValue);case 10:case 11:return function(s){let r=0;return Nc(s.fields,(i,o)=>{r+=i.length+Mx(o)}),r}(n.mapValue);default:throw tt(13486,{value:n})}}function CP(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function tE(n){return!!n&&"integerValue"in n}function VI(n){return!!n&&"arrayValue"in n}function TP(n){return!!n&&"nullValue"in n}function EP(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Lx(n){return!!n&&"mapValue"in n}function iQ(n){return(n?.mapValue?.fields||{})[U4]?.stringValue===B4}function Qm(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Nc(n.mapValue.fields,(t,s)=>e.mapValue.fields[t]=Qm(s)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Qm(n.arrayValue.values[t]);return e}return{...n}}function oQ(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===rQ}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vr{constructor(e){this.value=e}static empty(){return new Vr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!Lx(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Qm(t)}setAll(e){let t=Xs.emptyPath(),s={},r=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,s,r),s={},r=[],t=a.popLast()}o?s[a.lastSegment()]=Qm(o):r.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,s,r)}delete(e){const t=this.field(e.popLast());Lx(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Xo(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];Lx(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){Nc(t,(r,i)=>e[r]=i);for(const r of s)delete e[r]}clone(){return new Vr(Qm(this.value))}}function z4(n){const e=[];return Nc(n.fields,(t,s)=>{const r=new Xs([t]);if(Lx(s)){const i=z4(s.mapValue).fields;if(i.length===0)e.push(r);else for(const o of i)e.push(r.child(o))}else e.push(r)}),new ri(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hr{constructor(e,t,s,r,i,o,a){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new hr(e,0,rt.min(),rt.min(),rt.min(),Vr.empty(),0)}static newFoundDocument(e,t,s,r){return new hr(e,1,t,rt.min(),s,r,0)}static newNoDocument(e,t){return new hr(e,2,t,rt.min(),rt.min(),Vr.empty(),0)}static newUnknownDocument(e,t){return new hr(e,3,t,rt.min(),rt.min(),Vr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(rt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Vr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Vr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=rt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof hr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new hr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dv{constructor(e,t){this.position=e,this.inclusive=t}}function IP(n,e,t){let s=0;for(let r=0;r<n.position.length;r++){const i=e[r],o=n.position[r];if(i.field.isKeyField()?s=He.comparator(He.fromName(o.referenceValue),t.key):s=vf(o,t.data.field(i.field)),i.dir==="desc"&&(s*=-1),s!==0)break}return s}function kP(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Xo(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{constructor(e,t="asc"){this.field=e,this.dir=t}}function aQ(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j4{}class ns extends j4{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new cQ(e,t,s):t==="array-contains"?new dQ(e,s):t==="in"?new fQ(e,s):t==="not-in"?new pQ(e,s):t==="array-contains-any"?new mQ(e,s):new ns(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new uQ(e,s):new hQ(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(vf(t,this.value)):t!==null&&pc(this.value)===pc(t)&&this.matchesComparison(vf(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return tt(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class io extends j4{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new io(e,t)}matches(e){return W4(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function W4(n){return n.op==="and"}function G4(n){return lQ(n)&&W4(n)}function lQ(n){for(const e of n.filters)if(e instanceof io)return!1;return!0}function nE(n){if(n instanceof ns)return n.field.canonicalString()+n.op.toString()+wf(n.value);if(G4(n))return n.filters.map(e=>nE(e)).join(",");{const e=n.filters.map(t=>nE(t)).join(",");return`${n.op}(${e})`}}function H4(n,e){return n instanceof ns?function(s,r){return r instanceof ns&&s.op===r.op&&s.field.isEqual(r.field)&&Xo(s.value,r.value)}(n,e):n instanceof io?function(s,r){return r instanceof io&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce((i,o,a)=>i&&H4(o,r.filters[a]),!0):!1}(n,e):void tt(19439)}function q4(n){return n instanceof ns?function(t){return`${t.field.canonicalString()} ${t.op} ${wf(t.value)}`}(n):n instanceof io?function(t){return t.op.toString()+" {"+t.getFilters().map(q4).join(" ,")+"}"}(n):"Filter"}class cQ extends ns{constructor(e,t,s){super(e,t,s),this.key=He.fromName(s.referenceValue)}matches(e){const t=He.comparator(e.key,this.key);return this.matchesComparison(t)}}class uQ extends ns{constructor(e,t){super(e,"in",t),this.keys=K4("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class hQ extends ns{constructor(e,t){super(e,"not-in",t),this.keys=K4("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function K4(n,e){return(e.arrayValue?.values||[]).map(t=>He.fromName(t.referenceValue))}class dQ extends ns{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return VI(t)&&vg(t.arrayValue,this.value)}}class fQ extends ns{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&vg(this.value.arrayValue,t)}}class pQ extends ns{constructor(e,t){super(e,"not-in",t)}matches(e){if(vg(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!vg(this.value.arrayValue,t)}}class mQ extends ns{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!VI(t)||!t.arrayValue.values)&&t.arrayValue.values.some(s=>vg(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gQ{constructor(e,t=null,s=[],r=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function NP(n,e=null,t=[],s=[],r=null,i=null,o=null){return new gQ(n,e,t,s,r,i,o)}function UI(n){const e=ot(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(s=>nE(s)).join(","),t+="|ob:",t+=e.orderBy.map(s=>function(i){return i.field.canonicalString()+i.dir}(s)).join(","),Rw(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(s=>wf(s)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(s=>wf(s)).join(",")),e.Te=t}return e.Te}function BI(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!aQ(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!H4(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!kP(n.startAt,e.startAt)&&kP(n.endAt,e.endAt)}function sE(n){return He.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hf{constructor(e,t=null,s=[],r=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function yQ(n,e,t,s,r,i,o,a){return new Hf(n,e,t,s,r,i,o,a)}function zI(n){return new Hf(n)}function AP(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function X4(n){return n.collectionGroup!==null}function Jm(n){const e=ot(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new _s(Xs.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new wg(i,s))}),t.has(Xs.keyField().canonicalString())||e.Ie.push(new wg(Xs.keyField(),s))}return e.Ie}function Mo(n){const e=ot(n);return e.Ee||(e.Ee=bQ(e,Jm(n))),e.Ee}function bQ(n,e){if(n.limitType==="F")return NP(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{const i=r.dir==="desc"?"asc":"desc";return new wg(r.field,i)});const t=n.endAt?new dv(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new dv(n.startAt.position,n.startAt.inclusive):null;return NP(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function rE(n,e){const t=n.filters.concat([e]);return new Hf(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function fv(n,e,t){return new Hf(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Dw(n,e){return BI(Mo(n),Mo(e))&&n.limitType===e.limitType}function Y4(n){return`${UI(Mo(n))}|lt:${n.limitType}`}function Hd(n){return`Query(target=${function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map(r=>q4(r)).join(", ")}]`),Rw(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map(r=>wf(r)).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map(r=>wf(r)).join(",")),`Target(${s})`}(Mo(n))}; limitType=${n.limitType})`}function Ow(n,e){return e.isFoundDocument()&&function(s,r){const i=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(i):He.isDocumentKey(s.path)?s.path.isEqual(i):s.path.isImmediateParentOf(i)}(n,e)&&function(s,r){for(const i of Jm(s))if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0}(n,e)&&function(s,r){for(const i of s.filters)if(!i.matches(r))return!1;return!0}(n,e)&&function(s,r){return!(s.startAt&&!function(o,a,l){const u=IP(o,a,l);return o.inclusive?u<=0:u<0}(s.startAt,Jm(s),r)||s.endAt&&!function(o,a,l){const u=IP(o,a,l);return o.inclusive?u>=0:u>0}(s.endAt,Jm(s),r))}(n,e)}function xQ(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Q4(n){return(e,t)=>{let s=!1;for(const r of Jm(n)){const i=vQ(r,e,t);if(i!==0)return i;s=s||r.field.isKeyField()}return 0}}function vQ(n,e,t){const s=n.field.isKeyField()?He.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?vf(l,u):tt(42886)}(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return tt(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ch{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[r,i]of s)if(this.equalsFn(r,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Nc(this.inner,(t,s)=>{for(const[r,i]of s)e(r,i)})}isEmpty(){return O4(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wQ=new cs(He.comparator);function Ka(){return wQ}const J4=new cs(He.comparator);function Fm(...n){let e=J4;for(const t of n)e=e.insert(t.key,t);return e}function Z4(n){let e=J4;return n.forEach((t,s)=>e=e.insert(t,s.overlayedDocument)),e}function Mu(){return Zm()}function eV(){return Zm()}function Zm(){return new Ch(n=>n.toString(),(n,e)=>n.isEqual(e))}const _Q=new cs(He.comparator),SQ=new _s(He.comparator);function It(...n){let e=SQ;for(const t of n)e=e.add(t);return e}const CQ=new _s(Et);function TQ(){return CQ}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jI(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:cv(e)?"-0":e}}function tV(n){return{integerValue:""+n}}function nV(n,e){return ZY(e)?tV(e):jI(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pw{constructor(){this._=void 0}}function EQ(n,e,t){return n instanceof _g?function(r,i){const o={fields:{[L4]:{stringValue:M4},[V4]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&FI(i)&&(i=$w(i)),i&&(o.fields[F4]=i),{mapValue:o}}(t,e):n instanceof Sg?rV(n,e):n instanceof Cg?iV(n,e):function(r,i){const o=sV(r,i),a=RP(o)+RP(r.Ae);return tE(o)&&tE(r.Ae)?tV(a):jI(r.serializer,a)}(n,e)}function IQ(n,e,t){return n instanceof Sg?rV(n,e):n instanceof Cg?iV(n,e):t}function sV(n,e){return n instanceof Tg?function(s){return tE(s)||function(i){return!!i&&"doubleValue"in i}(s)}(e)?e:{integerValue:0}:null}class _g extends Pw{}class Sg extends Pw{constructor(e){super(),this.elements=e}}function rV(n,e){const t=oV(e);for(const s of n.elements)t.some(r=>Xo(r,s))||t.push(s);return{arrayValue:{values:t}}}class Cg extends Pw{constructor(e){super(),this.elements=e}}function iV(n,e){let t=oV(e);for(const s of n.elements)t=t.filter(r=>!Xo(r,s));return{arrayValue:{values:t}}}class Tg extends Pw{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function RP(n){return qn(n.integerValue||n.doubleValue)}function oV(n){return VI(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aV{constructor(e,t){this.field=e,this.transform=t}}function kQ(n,e){return n.field.isEqual(e.field)&&function(s,r){return s instanceof Sg&&r instanceof Sg||s instanceof Cg&&r instanceof Cg?xf(s.elements,r.elements,Xo):s instanceof Tg&&r instanceof Tg?Xo(s.Ae,r.Ae):s instanceof _g&&r instanceof _g}(n.transform,e.transform)}class NQ{constructor(e,t){this.version=e,this.transformResults=t}}class Lo{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Lo}static exists(e){return new Lo(void 0,e)}static updateTime(e){return new Lo(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Fx(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Mw{}function lV(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new uV(n.key,Lo.none()):new sy(n.key,n.data,Lo.none());{const t=n.data,s=Vr.empty();let r=new _s(Xs.comparator);for(let i of e.fields)if(!r.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?s.delete(i):s.set(i,o),r=r.add(i)}return new Ac(n.key,s,new ri(r.toArray()),Lo.none())}}function AQ(n,e,t){n instanceof sy?function(r,i,o){const a=r.value.clone(),l=DP(r.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Ac?function(r,i,o){if(!Fx(r.precondition,i))return void i.convertToUnknownDocument(o.version);const a=DP(r.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(cV(r)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(r,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function eg(n,e,t,s){return n instanceof sy?function(i,o,a,l){if(!Fx(i.precondition,o))return a;const u=i.value.clone(),d=OP(i.fieldTransforms,l,o);return u.setAll(d),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,s):n instanceof Ac?function(i,o,a,l){if(!Fx(i.precondition,o))return a;const u=OP(i.fieldTransforms,l,o),d=o.data;return d.setAll(cV(i)),d.setAll(u),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,s):function(i,o,a){return Fx(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function RQ(n,e){let t=null;for(const s of n.fieldTransforms){const r=e.data.field(s.field),i=sV(s.transform,r||null);i!=null&&(t===null&&(t=Vr.empty()),t.set(s.field,i))}return t||null}function $P(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&xf(s,r,(i,o)=>kQ(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class sy extends Mw{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Ac extends Mw{constructor(e,t,s,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function cV(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}}),e}function DP(n,e,t){const s=new Map;Yt(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let r=0;r<t.length;r++){const i=n[r],o=i.transform,a=e.data.field(i.field);s.set(i.field,IQ(o,a,t[r]))}return s}function OP(n,e,t){const s=new Map;for(const r of n){const i=r.transform,o=t.data.field(r.field);s.set(r.field,EQ(i,o,e))}return s}class uV extends Mw{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class $Q extends Mw{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DQ{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&AQ(i,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=eg(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=eg(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=eV();return this.mutations.forEach(r=>{const i=e.get(r.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(r.key)?null:a;const l=lV(o,a);l!==null&&s.set(r.key,l),o.isValidDocument()||o.convertToNoDocument(rt.min())}),s}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),It())}isEqual(e){return this.batchId===e.batchId&&xf(this.mutations,e.mutations,(t,s)=>$P(t,s))&&xf(this.baseMutations,e.baseMutations,(t,s)=>$P(t,s))}}class WI{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){Yt(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let r=function(){return _Q}();const i=e.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,s[o].version);return new WI(e,t,s,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OQ{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PQ{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var es,Mt;function MQ(n){switch(n){case Te.OK:return tt(64938);case Te.CANCELLED:case Te.UNKNOWN:case Te.DEADLINE_EXCEEDED:case Te.RESOURCE_EXHAUSTED:case Te.INTERNAL:case Te.UNAVAILABLE:case Te.UNAUTHENTICATED:return!1;case Te.INVALID_ARGUMENT:case Te.NOT_FOUND:case Te.ALREADY_EXISTS:case Te.PERMISSION_DENIED:case Te.FAILED_PRECONDITION:case Te.ABORTED:case Te.OUT_OF_RANGE:case Te.UNIMPLEMENTED:case Te.DATA_LOSS:return!0;default:return tt(15467,{code:n})}}function hV(n){if(n===void 0)return qa("GRPC error has no .code"),Te.UNKNOWN;switch(n){case es.OK:return Te.OK;case es.CANCELLED:return Te.CANCELLED;case es.UNKNOWN:return Te.UNKNOWN;case es.DEADLINE_EXCEEDED:return Te.DEADLINE_EXCEEDED;case es.RESOURCE_EXHAUSTED:return Te.RESOURCE_EXHAUSTED;case es.INTERNAL:return Te.INTERNAL;case es.UNAVAILABLE:return Te.UNAVAILABLE;case es.UNAUTHENTICATED:return Te.UNAUTHENTICATED;case es.INVALID_ARGUMENT:return Te.INVALID_ARGUMENT;case es.NOT_FOUND:return Te.NOT_FOUND;case es.ALREADY_EXISTS:return Te.ALREADY_EXISTS;case es.PERMISSION_DENIED:return Te.PERMISSION_DENIED;case es.FAILED_PRECONDITION:return Te.FAILED_PRECONDITION;case es.ABORTED:return Te.ABORTED;case es.OUT_OF_RANGE:return Te.OUT_OF_RANGE;case es.UNIMPLEMENTED:return Te.UNIMPLEMENTED;case es.DATA_LOSS:return Te.DATA_LOSS;default:return tt(39323,{code:n})}}(Mt=es||(es={}))[Mt.OK=0]="OK",Mt[Mt.CANCELLED=1]="CANCELLED",Mt[Mt.UNKNOWN=2]="UNKNOWN",Mt[Mt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Mt[Mt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Mt[Mt.NOT_FOUND=5]="NOT_FOUND",Mt[Mt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Mt[Mt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Mt[Mt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Mt[Mt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Mt[Mt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Mt[Mt.ABORTED=10]="ABORTED",Mt[Mt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Mt[Mt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Mt[Mt.INTERNAL=13]="INTERNAL",Mt[Mt.UNAVAILABLE=14]="UNAVAILABLE",Mt[Mt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LQ(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FQ=new tc([4294967295,4294967295],0);function PP(n){const e=LQ().encode(n),t=new S4;return t.update(e),new Uint8Array(t.digest())}function MP(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new tc([t,s],0),new tc([r,i],0)]}class GI{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new Vm(`Invalid padding: ${t}`);if(s<0)throw new Vm(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new Vm(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new Vm(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=tc.fromNumber(this.ge)}ye(e,t,s){let r=e.add(t.multiply(tc.fromNumber(s)));return r.compare(FQ)===1&&(r=new tc([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=PP(e),[s,r]=MP(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);if(!this.we(o))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new GI(i,r,t);return s.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const t=PP(e),[s,r]=MP(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class Vm extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lw{constructor(e,t,s,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,ry.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new Lw(rt.min(),r,new cs(Et),Ka(),It())}}class ry{constructor(e,t,s,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new ry(s,t,It(),It(),It())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vx{constructor(e,t,s,r){this.be=e,this.removedTargetIds=t,this.key=s,this.De=r}}class dV{constructor(e,t){this.targetId=e,this.Ce=t}}class fV{constructor(e,t,s=Ys.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class LP{constructor(){this.ve=0,this.Fe=FP(),this.Me=Ys.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=It(),t=It(),s=It();return this.Fe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:tt(38017,{changeType:i})}}),new ry(this.Me,this.xe,e,t,s)}qe(){this.Oe=!1,this.Fe=FP()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Yt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class VQ{constructor(e){this.Ge=e,this.ze=new Map,this.je=Ka(),this.Je=hx(),this.He=hx(),this.Ye=new cs(Et)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(e.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.We(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:tt(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((s,r)=>{this.rt(r)&&t(r)})}st(e){const t=e.targetId,s=e.Ce.count,r=this.ot(t);if(r){const i=r.target;if(sE(i))if(s===0){const o=new He(i.path);this.et(t,o,hr.newNoDocument(o,rt.min()))}else Yt(s===1,20013,{expectedCount:s});else{const o=this._t(t);if(o!==s){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,u)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:i=0}=t;let o,a;try{o=fc(s).toUint8Array()}catch(l){if(l instanceof P4)return bf("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new GI(o,r,i)}catch(l){return bf(l instanceof Vm?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let r=0;return s.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),r++)}),r}Tt(e){const t=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&sE(a.target)){const l=new He(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,hr.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.qe())}});let s=It();this.He.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(s=s.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const r=new Lw(e,t,this.Ye,this.je,s);return this.je=Ka(),this.Je=hx(),this.He=hx(),this.Ye=new cs(Et),r}Xe(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,s),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new LP,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new _s(Et),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new _s(Et),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Fe("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new LP),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function hx(){return new cs(He.comparator)}function FP(){return new cs(He.comparator)}const UQ={asc:"ASCENDING",desc:"DESCENDING"},BQ={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},zQ={and:"AND",or:"OR"};class jQ{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function iE(n,e){return n.useProto3Json||Rw(e)?e:{value:e}}function pv(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function pV(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function WQ(n,e){return pv(n,e.toTimestamp())}function Fo(n){return Yt(!!n,49232),rt.fromTimestamp(function(t){const s=dc(t);return new _n(s.seconds,s.nanos)}(n))}function HI(n,e){return oE(n,e).canonicalString()}function oE(n,e){const t=function(r){return new xn(["projects",r.projectId,"databases",r.database])}(n).child("documents");return e===void 0?t:t.child(e)}function mV(n){const e=xn.fromString(n);return Yt(vV(e),10190,{key:e.toString()}),e}function aE(n,e){return HI(n.databaseId,e.path)}function ZC(n,e){const t=mV(e);if(t.get(1)!==n.databaseId.projectId)throw new Le(Te.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Le(Te.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new He(yV(t))}function gV(n,e){return HI(n.databaseId,e)}function GQ(n){const e=mV(n);return e.length===4?xn.emptyPath():yV(e)}function lE(n){return new xn(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function yV(n){return Yt(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function VP(n,e,t){return{name:aE(n,e),fields:t.value.mapValue.fields}}function HQ(n,e){let t;if("targetChange"in e){e.targetChange;const s=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:tt(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=function(u,d){return u.useProto3Json?(Yt(d===void 0||typeof d=="string",58123),Ys.fromBase64String(d||"")):(Yt(d===void 0||d instanceof Buffer||d instanceof Uint8Array,16193),Ys.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const d=u.code===void 0?Te.UNKNOWN:hV(u.code);return new Le(d,u.message||"")}(o);t=new fV(s,r,i,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=ZC(n,s.document.name),i=Fo(s.document.updateTime),o=s.document.createTime?Fo(s.document.createTime):rt.min(),a=new Vr({mapValue:{fields:s.document.fields}}),l=hr.newFoundDocument(r,i,o,a),u=s.targetIds||[],d=s.removedTargetIds||[];t=new Vx(u,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=ZC(n,s.document),i=s.readTime?Fo(s.readTime):rt.min(),o=hr.newNoDocument(r,i),a=s.removedTargetIds||[];t=new Vx([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=ZC(n,s.document),i=s.removedTargetIds||[];t=new Vx([],i,r,null)}else{if(!("filter"in e))return tt(11601,{Rt:e});{e.filter;const s=e.filter;s.targetId;const{count:r=0,unchangedNames:i}=s,o=new PQ(r,i),a=s.targetId;t=new dV(a,o)}}return t}function qQ(n,e){let t;if(e instanceof sy)t={update:VP(n,e.key,e.value)};else if(e instanceof uV)t={delete:aE(n,e.key)};else if(e instanceof Ac)t={update:VP(n,e.key,e.data),updateMask:nJ(e.fieldMask)};else{if(!(e instanceof $Q))return tt(16599,{Vt:e.type});t={verify:aE(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(s=>function(i,o){const a=o.transform;if(a instanceof _g)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Sg)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Cg)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Tg)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw tt(20930,{transform:o.transform})}(0,s))),e.precondition.isNone||(t.currentDocument=function(r,i){return i.updateTime!==void 0?{updateTime:WQ(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:tt(27497)}(n,e.precondition)),t}function KQ(n,e){return n&&n.length>0?(Yt(e!==void 0,14353),n.map(t=>function(r,i){let o=r.updateTime?Fo(r.updateTime):Fo(i);return o.isEqual(rt.min())&&(o=Fo(i)),new NQ(o,r.transformResults||[])}(t,e))):[]}function XQ(n,e){return{documents:[gV(n,e.path)]}}function YQ(n,e){const t={structuredQuery:{}},s=e.path;let r;e.collectionGroup!==null?(r=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=gV(n,r);const i=function(u){if(u.length!==0)return xV(io.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(d=>function(m){return{field:qd(m.field),direction:ZQ(m.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=iE(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:t,parent:r}}function QQ(n){let e=GQ(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let r=null;if(s>0){Yt(s===1,65062);const d=t.from[0];d.allDescendants?r=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=function(f){const m=bV(f);return m instanceof io&&G4(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(m=>function(b){return new wg(Kd(b.field),function(v){switch(v){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(b.direction))}(m))}(t.orderBy));let a=null;t.limit&&(a=function(f){let m;return m=typeof f=="object"?f.value:f,Rw(m)?null:m}(t.limit));let l=null;t.startAt&&(l=function(f){const m=!!f.before,y=f.values||[];return new dv(y,m)}(t.startAt));let u=null;return t.endAt&&(u=function(f){const m=!f.before,y=f.values||[];return new dv(y,m)}(t.endAt)),yQ(e,r,o,i,a,"F",l,u)}function JQ(n,e){const t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return tt(28987,{purpose:r})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function bV(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=Kd(t.unaryFilter.field);return ns.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=Kd(t.unaryFilter.field);return ns.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Kd(t.unaryFilter.field);return ns.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Kd(t.unaryFilter.field);return ns.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return tt(61313);default:return tt(60726)}}(n):n.fieldFilter!==void 0?function(t){return ns.create(Kd(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return tt(58110);default:return tt(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return io.create(t.compositeFilter.filters.map(s=>bV(s)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return tt(1026)}}(t.compositeFilter.op))}(n):tt(30097,{filter:n})}function ZQ(n){return UQ[n]}function eJ(n){return BQ[n]}function tJ(n){return zQ[n]}function qd(n){return{fieldPath:n.canonicalString()}}function Kd(n){return Xs.fromServerFormat(n.fieldPath)}function xV(n){return n instanceof ns?function(t){if(t.op==="=="){if(EP(t.value))return{unaryFilter:{field:qd(t.field),op:"IS_NAN"}};if(TP(t.value))return{unaryFilter:{field:qd(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(EP(t.value))return{unaryFilter:{field:qd(t.field),op:"IS_NOT_NAN"}};if(TP(t.value))return{unaryFilter:{field:qd(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:qd(t.field),op:eJ(t.op),value:t.value}}}(n):n instanceof io?function(t){const s=t.getFilters().map(r=>xV(r));return s.length===1?s[0]:{compositeFilter:{op:tJ(t.op),filters:s}}}(n):tt(54877,{filter:n})}function nJ(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function vV(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xl{constructor(e,t,s,r,i=rt.min(),o=rt.min(),a=Ys.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Xl(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Xl(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Xl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Xl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sJ{constructor(e){this.yt=e}}function rJ(n){const e=QQ({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?fv(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iJ{constructor(){this.Cn=new oJ}addToCollectionParentIndex(e,t){return this.Cn.add(t),Ie.resolve()}getCollectionParents(e,t){return Ie.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return Ie.resolve()}deleteFieldIndex(e,t){return Ie.resolve()}deleteAllFieldIndexes(e){return Ie.resolve()}createTargetIndexes(e,t){return Ie.resolve()}getDocumentsMatchingTarget(e,t){return Ie.resolve(null)}getIndexType(e,t){return Ie.resolve(0)}getFieldIndexes(e,t){return Ie.resolve([])}getNextCollectionGroupToUpdate(e){return Ie.resolve(null)}getMinOffset(e,t){return Ie.resolve(hc.min())}getMinOffsetFromCollectionGroup(e,t){return Ie.resolve(hc.min())}updateCollectionGroup(e,t,s){return Ie.resolve()}updateIndexEntries(e,t){return Ie.resolve()}}class oJ{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new _s(xn.comparator),i=!r.has(s);return this.index[t]=r.add(s),i}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new _s(xn.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UP={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},wV=41943040;class Lr{static withCacheSize(e){return new Lr(e,Lr.DEFAULT_COLLECTION_PERCENTILE,Lr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Lr.DEFAULT_COLLECTION_PERCENTILE=10,Lr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Lr.DEFAULT=new Lr(wV,Lr.DEFAULT_COLLECTION_PERCENTILE,Lr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Lr.DISABLED=new Lr(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _f{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new _f(0)}static cr(){return new _f(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BP="LruGarbageCollector",aJ=1048576;function zP([n,e],[t,s]){const r=Et(n,t);return r===0?Et(e,s):r}class lJ{constructor(e){this.Ir=e,this.buffer=new _s(zP),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();zP(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class cJ{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Fe(BP,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Gf(t)?Fe(BP,"Ignoring IndexedDB error during garbage collection: ",t):await Wf(t)}await this.Vr(3e5)})}}class uJ{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(s=>Math.floor(t/100*s))}nthSequenceNumber(e,t){if(t===0)return Ie.resolve(Aw.ce);const s=new lJ(t);return this.mr.forEachTarget(e,r=>s.Ar(r.sequenceNumber)).next(()=>this.mr.pr(e,r=>s.Ar(r))).next(()=>s.maxValue)}removeTargets(e,t,s){return this.mr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Fe("LruGarbageCollector","Garbage collection skipped; disabled"),Ie.resolve(UP)):this.getCacheSize(e).next(s=>s<this.params.cacheSizeCollectionThreshold?(Fe("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),UP):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let s,r,i,o,a,l,u;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(Fe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),r=this.params.maximumSequenceNumbersToCollect):r=f,o=Date.now(),this.nthSequenceNumber(e,r))).next(f=>(s=f,a=Date.now(),this.removeTargets(e,s,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,s))).next(f=>(u=Date.now(),Gd()<=St.DEBUG&&Fe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${r} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(u-l)+`ms
Total Duration: ${u-d}ms`),Ie.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:f})))}}function hJ(n,e){return new uJ(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dJ{constructor(){this.changes=new Ch(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,hr.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?Ie.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fJ{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pJ{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(s=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(s!==null&&eg(s.mutation,r,ri.empty(),_n.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.getLocalViewOfDocuments(e,s,It()).next(()=>s))}getLocalViewOfDocuments(e,t,s=It()){const r=Mu();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,s).next(i=>{let o=Fm();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const s=Mu();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,It()))}populateOverlays(e,t,s){const r=[];return s.forEach(i=>{t.has(i)||r.push(i)}),this.documentOverlayCache.getOverlays(e,r).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,s,r){let i=Ka();const o=Zm(),a=function(){return Zm()}();return t.forEach((l,u)=>{const d=s.get(u.key);r.has(u.key)&&(d===void 0||d.mutation instanceof Ac)?i=i.insert(u.key,u):d!==void 0?(o.set(u.key,d.mutation.getFieldMask()),eg(d.mutation,u,d.mutation.getFieldMask(),_n.now())):o.set(u.key,ri.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((u,d)=>o.set(u,d)),t.forEach((u,d)=>a.set(u,new fJ(d,o.get(u)??null))),a))}recalculateAndSaveOverlays(e,t){const s=Zm();let r=new cs((o,a)=>o-a),i=It();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=t.get(l);if(u===null)return;let d=s.get(l)||ri.empty();d=a.applyToLocalView(u,d),s.set(l,d);const f=(r.get(a.batchId)||It()).add(l);r=r.insert(a.batchId,f)})}).next(()=>{const o=[],a=r.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,d=l.value,f=eV();d.forEach(m=>{if(!i.has(m)){const y=lV(t.get(m),s.get(m));y!==null&&f.set(m,y),i=i.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return Ie.waitFor(o)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.recalculateAndSaveOverlays(e,s))}getDocumentsMatchingQuery(e,t,s,r){return function(o){return He.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):X4(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,r):this.getDocumentsMatchingCollectionQuery(e,t,s,r)}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next(i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-i.size):Ie.resolve(Mu());let a=yg,l=i;return o.next(u=>Ie.forEach(u,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(d)?Ie.resolve():this.remoteDocumentCache.getEntry(e,d).next(m=>{l=l.insert(d,m)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,l,u,It())).next(d=>({batchId:a,changes:Z4(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new He(t)).next(s=>{let r=Fm();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,s,r){const i=t.collectionGroup;let o=Fm();return this.indexManager.getCollectionParents(e,i).next(a=>Ie.forEach(a,l=>{const u=function(f,m){return new Hf(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,s,r).next(d=>{d.forEach((f,m)=>{o=o.insert(f,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,s,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,i,r))).next(o=>{i.forEach((l,u)=>{const d=u.getKey();o.get(d)===null&&(o=o.insert(d,hr.newInvalidDocument(d)))});let a=Fm();return o.forEach((l,u)=>{const d=i.get(l);d!==void 0&&eg(d.mutation,u,ri.empty(),_n.now()),Ow(t,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mJ{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return Ie.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:Fo(r.createTime)}}(t)),Ie.resolve()}getNamedQuery(e,t){return Ie.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(r){return{name:r.name,query:rJ(r.bundledQuery),readTime:Fo(r.readTime)}}(t)),Ie.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gJ{constructor(){this.overlays=new cs(He.comparator),this.qr=new Map}getOverlay(e,t){return Ie.resolve(this.overlays.get(t))}getOverlays(e,t){const s=Mu();return Ie.forEach(t,r=>this.getOverlay(e,r).next(i=>{i!==null&&s.set(r,i)})).next(()=>s)}saveOverlays(e,t,s){return s.forEach((r,i)=>{this.St(e,t,i)}),Ie.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.qr.get(s);return r!==void 0&&(r.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(s)),Ie.resolve()}getOverlaysForCollection(e,t,s){const r=Mu(),i=t.length+1,o=new He(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>s&&r.set(l.getKey(),l)}return Ie.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let i=new cs((u,d)=>u-d);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>s){let d=i.get(u.largestBatchId);d===null&&(d=Mu(),i=i.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}const a=Mu(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,d)=>a.set(u,d)),!(a.size()>=r)););return Ie.resolve(a)}St(e,t,s){const r=this.overlays.get(s.key);if(r!==null){const o=this.qr.get(r.largestBatchId).delete(s.key);this.qr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new OQ(t,s));let i=this.qr.get(t);i===void 0&&(i=It(),this.qr.set(t,i)),this.qr.set(t,i.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yJ{constructor(){this.sessionToken=Ys.EMPTY_BYTE_STRING}getSessionToken(e){return Ie.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Ie.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qI{constructor(){this.Qr=new _s($s.$r),this.Ur=new _s($s.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const s=new $s(e,t);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(e,t){e.forEach(s=>this.addReference(s,t))}removeReference(e,t){this.Gr(new $s(e,t))}zr(e,t){e.forEach(s=>this.removeReference(s,t))}jr(e){const t=new He(new xn([])),s=new $s(t,e),r=new $s(t,e+1),i=[];return this.Ur.forEachInRange([s,r],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new He(new xn([])),s=new $s(t,e),r=new $s(t,e+1);let i=It();return this.Ur.forEachInRange([s,r],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new $s(e,0),s=this.Qr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class $s{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return He.comparator(e.key,t.key)||Et(e.Yr,t.Yr)}static Kr(e,t){return Et(e.Yr,t.Yr)||He.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bJ{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new _s($s.$r)}checkEmpty(e){return Ie.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,r){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new DQ(i,t,s,r);this.mutationQueue.push(o);for(const a of r)this.Zr=this.Zr.add(new $s(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return Ie.resolve(o)}lookupMutationBatch(e,t){return Ie.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=this.ei(s),i=r<0?0:r;return Ie.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Ie.resolve(this.mutationQueue.length===0?LI:this.tr-1)}getAllMutationBatches(e){return Ie.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new $s(t,0),r=new $s(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([s,r],o=>{const a=this.Xr(o.Yr);i.push(a)}),Ie.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new _s(Et);return t.forEach(r=>{const i=new $s(r,0),o=new $s(r,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],a=>{s=s.add(a.Yr)})}),Ie.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let i=s;He.isDocumentKey(i)||(i=i.child(""));const o=new $s(new He(i),0);let a=new _s(Et);return this.Zr.forEachWhile(l=>{const u=l.key.path;return!!s.isPrefixOf(u)&&(u.length===r&&(a=a.add(l.Yr)),!0)},o),Ie.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(s=>{const r=this.Xr(s);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){Yt(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Zr;return Ie.forEach(t.mutations,r=>{const i=new $s(r.key,t.batchId);return s=s.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=s})}ir(e){}containsKey(e,t){const s=new $s(t,0),r=this.Zr.firstAfterOrEqual(s);return Ie.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Ie.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xJ{constructor(e){this.ri=e,this.docs=function(){return new cs(He.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),i=r?r.size:0,o=this.ri(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return Ie.resolve(s?s.document.mutableCopy():hr.newInvalidDocument(t))}getEntries(e,t){let s=Ka();return t.forEach(r=>{const i=this.docs.get(r);s=s.insert(r,i?i.document.mutableCopy():hr.newInvalidDocument(r))}),Ie.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let i=Ka();const o=t.path,a=new He(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:d}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||XY(KY(d),s)<=0||(r.has(d.key)||Ow(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return Ie.resolve(i)}getAllFromCollectionGroup(e,t,s,r){tt(9500)}ii(e,t){return Ie.forEach(this.docs,s=>t(s))}newChangeBuffer(e){return new vJ(this)}getSize(e){return Ie.resolve(this.size)}}class vJ extends dJ{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((s,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(s)}),Ie.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wJ{constructor(e){this.persistence=e,this.si=new Ch(t=>UI(t),BI),this.lastRemoteSnapshotVersion=rt.min(),this.highestTargetId=0,this.oi=0,this._i=new qI,this.targetCount=0,this.ai=_f.ur()}forEachTarget(e,t){return this.si.forEach((s,r)=>t(r)),Ie.resolve()}getLastRemoteSnapshotVersion(e){return Ie.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ie.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),Ie.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.oi&&(this.oi=t),Ie.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new _f(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,Ie.resolve()}updateTargetData(e,t){return this.Pr(t),Ie.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,Ie.resolve()}removeTargets(e,t,s){let r=0;const i=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=t&&s.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),Ie.waitFor(i).next(()=>r)}getTargetCount(e){return Ie.resolve(this.targetCount)}getTargetData(e,t){const s=this.si.get(t)||null;return Ie.resolve(s)}addMatchingKeys(e,t,s){return this._i.Wr(t,s),Ie.resolve()}removeMatchingKeys(e,t,s){this._i.zr(t,s);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(o=>{i.push(r.markPotentiallyOrphaned(e,o))}),Ie.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),Ie.resolve()}getMatchingKeysForTargetId(e,t){const s=this._i.Hr(t);return Ie.resolve(s)}containsKey(e,t){return Ie.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _V{constructor(e,t){this.ui={},this.overlays={},this.ci=new Aw(0),this.li=!1,this.li=!0,this.hi=new yJ,this.referenceDelegate=e(this),this.Pi=new wJ(this),this.indexManager=new iJ,this.remoteDocumentCache=function(r){return new xJ(r)}(s=>this.referenceDelegate.Ti(s)),this.serializer=new sJ(t),this.Ii=new mJ(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new gJ,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.ui[e.toKey()];return s||(s=new bJ(t,this.referenceDelegate),this.ui[e.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,s){Fe("MemoryPersistence","Starting transaction:",e);const r=new _J(this.ci.next());return this.referenceDelegate.Ei(),s(r).next(i=>this.referenceDelegate.di(r).next(()=>i)).toPromise().then(i=>(r.raiseOnCommittedEvent(),i))}Ai(e,t){return Ie.or(Object.values(this.ui).map(s=>()=>s.containsKey(e,t)))}}class _J extends QY{constructor(e){super(),this.currentSequenceNumber=e}}class KI{constructor(e){this.persistence=e,this.Ri=new qI,this.Vi=null}static mi(e){return new KI(e)}get fi(){if(this.Vi)return this.Vi;throw tt(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.fi.delete(s.toString()),Ie.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.fi.add(s.toString()),Ie.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),Ie.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(r=>this.fi.add(r.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(i=>this.fi.add(i.toString()))}).next(()=>s.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ie.forEach(this.fi,s=>{const r=He.fromPath(s);return this.gi(e,r).next(i=>{i||t.removeEntry(r,rt.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(s=>{s?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return Ie.or([()=>Ie.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class mv{constructor(e,t){this.persistence=e,this.pi=new Ch(s=>eQ(s.path),(s,r)=>s.isEqual(r)),this.garbageCollector=hJ(this,t)}static mi(e,t){return new mv(e,t)}Ei(){}di(e){return Ie.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(s=>t.next(r=>s+r))}wr(e){let t=0;return this.pr(e,s=>{t++}).next(()=>t)}pr(e,t){return Ie.forEach(this.pi,(s,r)=>this.br(e,s,r).next(i=>i?Ie.resolve():t(r)))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,o=>this.br(e,o,t).next(a=>{a||(s++,i.removeEntry(o,rt.min()))})).next(()=>i.apply(e)).next(()=>s)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),Ie.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),Ie.resolve()}removeReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),Ie.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),Ie.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Mx(e.data.value)),t}br(e,t,s){return Ie.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.pi.get(t);return Ie.resolve(r!==void 0&&r>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XI{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.Es=s,this.ds=r}static As(e,t){let s=It(),r=It();for(const i of t.docChanges)switch(i.type){case 0:s=s.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new XI(e,t.fromCache,s,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SJ{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CJ{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return pX()?8:JY(mr())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,r){const i={result:null};return this.ys(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,t,r,s).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new SJ;return this.Ss(e,t,o).next(a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)})}).next(()=>i.result)}bs(e,t,s,r){return s.documentReadCount<this.fs?(Gd()<=St.DEBUG&&Fe("QueryEngine","SDK will not create cache indexes for query:",Hd(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Ie.resolve()):(Gd()<=St.DEBUG&&Fe("QueryEngine","Query:",Hd(t),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.gs*r?(Gd()<=St.DEBUG&&Fe("QueryEngine","The SDK decides to create cache indexes for query:",Hd(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Mo(t))):Ie.resolve())}ys(e,t){if(AP(t))return Ie.resolve(null);let s=Mo(t);return this.indexManager.getIndexType(e,s).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=fv(t,null,"F"),s=Mo(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next(i=>{const o=It(...i);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,s).next(l=>{const u=this.Ds(t,a);return this.Cs(t,u,o,l.readTime)?this.ys(e,fv(t,null,"F")):this.vs(e,u,t,l)}))})))}ws(e,t,s,r){return AP(t)||r.isEqual(rt.min())?Ie.resolve(null):this.ps.getDocuments(e,s).next(i=>{const o=this.Ds(t,i);return this.Cs(t,o,s,r)?Ie.resolve(null):(Gd()<=St.DEBUG&&Fe("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Hd(t)),this.vs(e,o,t,qY(r,yg)).next(a=>a))})}Ds(e,t){let s=new _s(Q4(e));return t.forEach((r,i)=>{Ow(e,i)&&(s=s.add(i))}),s}Cs(e,t,s,r){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,s){return Gd()<=St.DEBUG&&Fe("QueryEngine","Using full collection scan to execute query:",Hd(t)),this.ps.getDocumentsMatchingQuery(e,t,hc.min(),s)}vs(e,t,s,r){return this.ps.getDocumentsMatchingQuery(e,s,r).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YI="LocalStore",TJ=3e8;class EJ{constructor(e,t,s,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new cs(Et),this.xs=new Ch(i=>UI(i),BI),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(s)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new pJ(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function IJ(n,e,t,s){return new EJ(n,e,t,s)}async function SV(n,e){const t=ot(n);return await t.persistence.runTransaction("Handle user change","readonly",s=>{let r;return t.mutationQueue.getAllMutationBatches(s).next(i=>(r=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(s))).next(i=>{const o=[],a=[];let l=It();for(const u of r){o.push(u.batchId);for(const d of u.mutations)l=l.add(d.key)}for(const u of i){a.push(u.batchId);for(const d of u.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(s,l).next(u=>({Ls:u,removedBatchIds:o,addedBatchIds:a}))})})}function kJ(n,e){const t=ot(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const r=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return function(a,l,u,d){const f=u.batch,m=f.keys();let y=Ie.resolve();return m.forEach(b=>{y=y.next(()=>d.getEntry(l,b)).next(w=>{const v=u.docVersions.get(b);Yt(v!==null,48541),w.version.compareTo(v)<0&&(f.applyToRemoteDocument(w,u),w.isValidDocument()&&(w.setReadTime(u.commitVersion),d.addEntry(w)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,s,e,i).next(()=>i.apply(s)).next(()=>t.mutationQueue.performConsistencyCheck(s)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(a){let l=It();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(s,r))})}function CV(n){const e=ot(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function NJ(n,e){const t=ot(n),s=e.snapshotVersion;let r=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});r=t.Ms;const a=[];e.targetChanges.forEach((d,f)=>{const m=r.get(f);if(!m)return;a.push(t.Pi.removeMatchingKeys(i,d.removedDocuments,f).next(()=>t.Pi.addMatchingKeys(i,d.addedDocuments,f)));let y=m.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(Ys.EMPTY_BYTE_STRING,rt.min()).withLastLimboFreeSnapshotVersion(rt.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,s)),r=r.insert(f,y),function(w,v,S){return w.resumeToken.approximateByteSize()===0||v.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=TJ?!0:S.addedDocuments.size+S.modifiedDocuments.size+S.removedDocuments.size>0}(m,y,d)&&a.push(t.Pi.updateTargetData(i,y))});let l=Ka(),u=It();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))}),a.push(AJ(i,o,e.documentUpdates).next(d=>{l=d.ks,u=d.qs})),!s.isEqual(rt.min())){const d=t.Pi.getLastRemoteSnapshotVersion(i).next(f=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,s));a.push(d)}return Ie.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,u)).next(()=>l)}).then(i=>(t.Ms=r,i))}function AJ(n,e,t){let s=It(),r=It();return t.forEach(i=>s=s.add(i)),e.getEntries(n,s).next(i=>{let o=Ka();return t.forEach((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(r=r.add(a)),l.isNoDocument()&&l.version.isEqual(rt.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):Fe(YI,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{ks:o,qs:r}})}function RJ(n,e){const t=ot(n);return t.persistence.runTransaction("Get next mutation batch","readonly",s=>(e===void 0&&(e=LI),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e)))}function $J(n,e){const t=ot(n);return t.persistence.runTransaction("Allocate target","readwrite",s=>{let r;return t.Pi.getTargetData(s,e).next(i=>i?(r=i,Ie.resolve(r)):t.Pi.allocateTargetId(s).next(o=>(r=new Xl(e,o,"TargetPurposeListen",s.currentSequenceNumber),t.Pi.addTargetData(s,r).next(()=>r))))}).then(s=>{const r=t.Ms.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(s.targetId,s),t.xs.set(e,s.targetId)),s})}async function cE(n,e,t){const s=ot(n),r=s.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",i,o=>s.persistence.referenceDelegate.removeTarget(o,r))}catch(o){if(!Gf(o))throw o;Fe(YI,`Failed to update sequence numbers for target ${e}: ${o}`)}s.Ms=s.Ms.remove(e),s.xs.delete(r.target)}function jP(n,e,t){const s=ot(n);let r=rt.min(),i=It();return s.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,d){const f=ot(l),m=f.xs.get(d);return m!==void 0?Ie.resolve(f.Ms.get(m)):f.Pi.getTargetData(u,d)}(s,o,Mo(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>s.Fs.getDocumentsMatchingQuery(o,e,t?r:rt.min(),t?i:It())).next(a=>(DJ(s,xQ(e),a),{documents:a,Qs:i})))}function DJ(n,e,t){let s=n.Os.get(e)||rt.min();t.forEach((r,i)=>{i.readTime.compareTo(s)>0&&(s=i.readTime)}),n.Os.set(e,s)}class WP{constructor(){this.activeTargetIds=TQ()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class OJ{constructor(){this.Mo=new WP,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,s){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new WP,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PJ{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GP="ConnectivityMonitor";class HP{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Fe(GP,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Fe(GP,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dx=null;function uE(){return dx===null?dx=function(){return 268435456+Math.round(2147483648*Math.random())}():dx++,"0x"+dx.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eT="RestConnection",MJ={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class LJ{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${s}/databases/${r}`,this.Wo=this.databaseId.database===uv?`project_id=${s}`:`project_id=${s}&database_id=${r}`}Go(e,t,s,r,i){const o=uE(),a=this.zo(e,t.toUriEncodedString());Fe(eT,`Sending RPC '${e}' ${o}:`,a,s);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,r,i);const{host:u}=new URL(a),d=kc(u);return this.Jo(e,a,l,s,d).then(f=>(Fe(eT,`Received RPC '${e}' ${o}: `,f),f),f=>{throw bf(eT,`RPC '${e}' ${o} failed with error: `,f,"url: ",a,"request:",s),f})}Ho(e,t,s,r,i,o){return this.Go(e,t,s,r,i)}jo(e,t,s){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+jf}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((r,i)=>e[i]=r),s&&s.headers.forEach((r,i)=>e[i]=r)}zo(e,t){const s=MJ[e];return`${this.Uo}/v1/${t}:${s}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FJ{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ar="WebChannelConnection";class VJ extends LJ{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,s,r,i){const o=uE();return new Promise((a,l)=>{const u=new C4;u.setWithCredentials(!0),u.listenOnce(T4.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Px.NO_ERROR:const f=u.getResponseJson();Fe(ar,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),a(f);break;case Px.TIMEOUT:Fe(ar,`RPC '${e}' ${o} timed out`),l(new Le(Te.DEADLINE_EXCEEDED,"Request time out"));break;case Px.HTTP_ERROR:const m=u.getStatus();if(Fe(ar,`RPC '${e}' ${o} failed with status:`,m,"response text:",u.getResponseText()),m>0){let y=u.getResponseJson();Array.isArray(y)&&(y=y[0]);const b=y?.error;if(b&&b.status&&b.message){const w=function(S){const T=S.toLowerCase().replace(/_/g,"-");return Object.values(Te).indexOf(T)>=0?T:Te.UNKNOWN}(b.status);l(new Le(w,b.message))}else l(new Le(Te.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new Le(Te.UNAVAILABLE,"Connection failed."));break;default:tt(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{Fe(ar,`RPC '${e}' ${o} completed.`)}});const d=JSON.stringify(r);Fe(ar,`RPC '${e}' ${o} sending request:`,r),u.send(t,"POST",d,s,15)})}T_(e,t,s){const r=uE(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=k4(),a=I4(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,s),l.encodeInitMessageHeaders=!0;const d=i.join("");Fe(ar,`Creating RPC '${e}' stream ${r}: ${d}`,l);const f=o.createWebChannel(d,l);this.I_(f);let m=!1,y=!1;const b=new FJ({Yo:v=>{y?Fe(ar,`Not sending because RPC '${e}' stream ${r} is closed:`,v):(m||(Fe(ar,`Opening RPC '${e}' stream ${r} transport.`),f.open(),m=!0),Fe(ar,`RPC '${e}' stream ${r} sending:`,v),f.send(v))},Zo:()=>f.close()}),w=(v,S,T)=>{v.listen(S,I=>{try{T(I)}catch(k){setTimeout(()=>{throw k},0)}})};return w(f,Lm.EventType.OPEN,()=>{y||(Fe(ar,`RPC '${e}' stream ${r} transport opened.`),b.o_())}),w(f,Lm.EventType.CLOSE,()=>{y||(y=!0,Fe(ar,`RPC '${e}' stream ${r} transport closed`),b.a_(),this.E_(f))}),w(f,Lm.EventType.ERROR,v=>{y||(y=!0,bf(ar,`RPC '${e}' stream ${r} transport errored. Name:`,v.name,"Message:",v.message),b.a_(new Le(Te.UNAVAILABLE,"The operation could not be completed")))}),w(f,Lm.EventType.MESSAGE,v=>{if(!y){const S=v.data[0];Yt(!!S,16349);const T=S,I=T?.error||T[0]?.error;if(I){Fe(ar,`RPC '${e}' stream ${r} received error:`,I);const k=I.status;let O=function(D){const $=es[D];if($!==void 0)return hV($)}(k),V=I.message;O===void 0&&(O=Te.INTERNAL,V="Unknown error status: "+k+" with message "+I.message),y=!0,b.a_(new Le(O,V)),f.close()}else Fe(ar,`RPC '${e}' stream ${r} received:`,S),b.u_(S)}}),w(a,E4.STAT_EVENT,v=>{v.stat===QT.PROXY?Fe(ar,`RPC '${e}' stream ${r} detected buffering proxy`):v.stat===QT.NOPROXY&&Fe(ar,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{b.__()},0),b}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function tT(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fw(n){return new jQ(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TV{constructor(e,t,s=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=s,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-s);r>0&&Fe("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qP="PersistentStream";class EV{constructor(e,t,s,r,i,o,a,l){this.Mi=e,this.S_=s,this.b_=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new TV(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===Te.RESOURCE_EXHAUSTED?(qa(t.toString()),qa("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===Te.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,r])=>{this.D_===t&&this.G_(s,r)},s=>{e(()=>{const r=new Le(Te.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(r)})})}G_(e,t){const s=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{s(()=>this.listener.Xo())}),this.stream.t_(()=>{s(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(r=>{s(()=>this.z_(r))}),this.stream.onMessage(r=>{s(()=>++this.F_==1?this.J_(r):this.onNext(r))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return Fe(qP,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(Fe(qP,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class UJ extends EV{constructor(e,t,s,r,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=HQ(this.serializer,e),s=function(i){if(!("targetChange"in i))return rt.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?rt.min():o.readTime?Fo(o.readTime):rt.min()}(e);return this.listener.H_(t,s)}Y_(e){const t={};t.database=lE(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=sE(l)?{documents:XQ(i,l)}:{query:YQ(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=pV(i,o.resumeToken);const u=iE(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(rt.min())>0){a.readTime=pv(i,o.snapshotVersion.toTimestamp());const u=iE(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const s=JQ(this.serializer,e);s&&(t.labels=s),this.q_(t)}Z_(e){const t={};t.database=lE(this.serializer),t.removeTarget=e,this.q_(t)}}class BJ extends EV{constructor(e,t,s,r,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Yt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Yt(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Yt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=KQ(e.writeResults,e.commitTime),s=Fo(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=lE(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(s=>qQ(this.serializer,s))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zJ{}class jJ extends zJ{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new Le(Te.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,oE(t,s),r,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===Te.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Le(Te.UNKNOWN,i.toString())})}Ho(e,t,s,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,oE(t,s),r,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Te.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Le(Te.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class WJ{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(qa(t),this.aa=!1):Fe("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zu="RemoteStore";class GJ{constructor(e,t,s,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{s.enqueueAndForget(async()=>{Th(this)&&(Fe(Zu,"Restarting streams for network reachability change."),await async function(l){const u=ot(l);u.Ea.add(4),await iy(u),u.Ra.set("Unknown"),u.Ea.delete(4),await Vw(u)}(this))})}),this.Ra=new WJ(s,r)}}async function Vw(n){if(Th(n))for(const e of n.da)await e(!0)}async function iy(n){for(const e of n.da)await e(!1)}function IV(n,e){const t=ot(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),ek(t)?ZI(t):qf(t).O_()&&JI(t,e))}function QI(n,e){const t=ot(n),s=qf(t);t.Ia.delete(e),s.O_()&&kV(t,e),t.Ia.size===0&&(s.O_()?s.L_():Th(t)&&t.Ra.set("Unknown"))}function JI(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(rt.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}qf(n).Y_(e)}function kV(n,e){n.Va.Ue(e),qf(n).Z_(e)}function ZI(n){n.Va=new VQ({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),qf(n).start(),n.Ra.ua()}function ek(n){return Th(n)&&!qf(n).x_()&&n.Ia.size>0}function Th(n){return ot(n).Ea.size===0}function NV(n){n.Va=void 0}async function HJ(n){n.Ra.set("Online")}async function qJ(n){n.Ia.forEach((e,t)=>{JI(n,e)})}async function KJ(n,e){NV(n),ek(n)?(n.Ra.ha(e),ZI(n)):n.Ra.set("Unknown")}async function XJ(n,e,t){if(n.Ra.set("Online"),e instanceof fV&&e.state===2&&e.cause)try{await async function(r,i){const o=i.cause;for(const a of i.targetIds)r.Ia.has(a)&&(await r.remoteSyncer.rejectListen(a,o),r.Ia.delete(a),r.Va.removeTarget(a))}(n,e)}catch(s){Fe(Zu,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await gv(n,s)}else if(e instanceof Vx?n.Va.Ze(e):e instanceof dV?n.Va.st(e):n.Va.tt(e),!t.isEqual(rt.min()))try{const s=await CV(n.localStore);t.compareTo(s)>=0&&await function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const d=i.Ia.get(u);d&&i.Ia.set(u,d.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{const d=i.Ia.get(l);if(!d)return;i.Ia.set(l,d.withResumeToken(Ys.EMPTY_BYTE_STRING,d.snapshotVersion)),kV(i,l);const f=new Xl(d.target,l,u,d.sequenceNumber);JI(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(s){Fe(Zu,"Failed to raise snapshot:",s),await gv(n,s)}}async function gv(n,e,t){if(!Gf(e))throw e;n.Ea.add(1),await iy(n),n.Ra.set("Offline"),t||(t=()=>CV(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Fe(Zu,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Vw(n)})}function AV(n,e){return e().catch(t=>gv(n,t,e))}async function Uw(n){const e=ot(n),t=mc(e);let s=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:LI;for(;YJ(e);)try{const r=await RJ(e.localStore,s);if(r===null){e.Ta.length===0&&t.L_();break}s=r.batchId,QJ(e,r)}catch(r){await gv(e,r)}RV(e)&&$V(e)}function YJ(n){return Th(n)&&n.Ta.length<10}function QJ(n,e){n.Ta.push(e);const t=mc(n);t.O_()&&t.X_&&t.ea(e.mutations)}function RV(n){return Th(n)&&!mc(n).x_()&&n.Ta.length>0}function $V(n){mc(n).start()}async function JJ(n){mc(n).ra()}async function ZJ(n){const e=mc(n);for(const t of n.Ta)e.ea(t.mutations)}async function eZ(n,e,t){const s=n.Ta.shift(),r=WI.from(s,e,t);await AV(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),await Uw(n)}async function tZ(n,e){e&&mc(n).X_&&await async function(s,r){if(function(o){return MQ(o)&&o!==Te.ABORTED}(r.code)){const i=s.Ta.shift();mc(s).B_(),await AV(s,()=>s.remoteSyncer.rejectFailedWrite(i.batchId,r)),await Uw(s)}}(n,e),RV(n)&&$V(n)}async function KP(n,e){const t=ot(n);t.asyncQueue.verifyOperationInProgress(),Fe(Zu,"RemoteStore received new credentials");const s=Th(t);t.Ea.add(3),await iy(t),s&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Vw(t)}async function nZ(n,e){const t=ot(n);e?(t.Ea.delete(2),await Vw(t)):e||(t.Ea.add(2),await iy(t),t.Ra.set("Unknown"))}function qf(n){return n.ma||(n.ma=function(t,s,r){const i=ot(t);return i.sa(),new UJ(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(n.datastore,n.asyncQueue,{Xo:HJ.bind(null,n),t_:qJ.bind(null,n),r_:KJ.bind(null,n),H_:XJ.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),ek(n)?ZI(n):n.Ra.set("Unknown")):(await n.ma.stop(),NV(n))})),n.ma}function mc(n){return n.fa||(n.fa=function(t,s,r){const i=ot(t);return i.sa(),new BJ(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:JJ.bind(null,n),r_:tZ.bind(null,n),ta:ZJ.bind(null,n),na:eZ.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await Uw(n)):(await n.fa.stop(),n.Ta.length>0&&(Fe(Zu,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tk{constructor(e,t,s,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new ju,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,r,i){const o=Date.now()+s,a=new tk(e,t,o,r,i);return a.start(s),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Le(Te.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function nk(n,e){if(qa("AsyncQueue",`${e}: ${n}`),Gf(n))return new Le(Te.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nf{static emptySet(e){return new nf(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||He.comparator(t.key,s.key):(t,s)=>He.comparator(t.key,s.key),this.keyedMap=Fm(),this.sortedSet=new cs(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,s)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof nf)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(!r.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new nf;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XP{constructor(){this.ga=new cs(He.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):tt(63341,{Rt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,s)=>{e.push(s)}),e}}class Sf{constructor(e,t,s,r,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,s,r,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Sf(e,t,nf.emptySet(t),o,s,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Dw(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sZ{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class rZ{constructor(){this.queries=YP(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const r=ot(t),i=r.queries;r.queries=YP(),i.forEach((o,a)=>{for(const l of a.Sa)l.onError(s)})})(this,new Le(Te.ABORTED,"Firestore shutting down"))}}function YP(){return new Ch(n=>Y4(n),Dw)}async function iZ(n,e){const t=ot(n);let s=3;const r=e.query;let i=t.queries.get(r);i?!i.ba()&&e.Da()&&(s=2):(i=new sZ,s=e.Da()?0:1);try{switch(s){case 0:i.wa=await t.onListen(r,!0);break;case 1:i.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(o){const a=nk(o,`Initialization of query '${Hd(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&sk(t)}async function oZ(n,e){const t=ot(n),s=e.query;let r=3;const i=t.queries.get(s);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?r=e.Da()?0:1:!i.ba()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function aZ(n,e){const t=ot(n);let s=!1;for(const r of e){const i=r.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(r)&&(s=!0);o.wa=r}}s&&sk(t)}function lZ(n,e,t){const s=ot(n),r=s.queries.get(e);if(r)for(const i of r.Sa)i.onError(t);s.queries.delete(e)}function sk(n){n.Ca.forEach(e=>{e.next()})}var hE,QP;(QP=hE||(hE={})).Ma="default",QP.Cache="cache";class cZ{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)r.type!==3&&s.push(r);e=new Sf(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.qa||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Sf.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==hE.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DV{constructor(e){this.key=e}}class OV{constructor(e){this.key=e}}class uZ{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=It(),this.mutatedKeys=It(),this.eu=Q4(e),this.tu=new nf(this.eu)}get nu(){return this.Ya}ru(e,t){const s=t?t.iu:new XP,r=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1;const l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,u=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((d,f)=>{const m=r.get(d),y=Ow(this.query,f)?f:null,b=!!m&&this.mutatedKeys.has(m.key),w=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let v=!1;m&&y?m.data.isEqual(y.data)?b!==w&&(s.track({type:3,doc:y}),v=!0):this.su(m,y)||(s.track({type:2,doc:y}),v=!0,(l&&this.eu(y,l)>0||u&&this.eu(y,u)<0)&&(a=!0)):!m&&y?(s.track({type:0,doc:y}),v=!0):m&&!y&&(s.track({type:1,doc:m}),v=!0,(l||u)&&(a=!0)),v&&(y?(o=o.add(y),i=w?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),s.track({type:1,doc:d})}return{tu:o,iu:s,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,r){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((d,f)=>function(y,b){const w=v=>{switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return tt(20277,{Rt:v})}};return w(y)-w(b)}(d.type,f.type)||this.eu(d.doc,f.doc)),this.ou(s),r=r??!1;const a=t&&!r?this._u():[],l=this.Xa.size===0&&this.current&&!r?1:0,u=l!==this.Za;return this.Za=l,o.length!==0||u?{snapshot:new Sf(this.query,e.tu,i,o,e.mutatedKeys,l===0,u,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new XP,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=It(),this.tu.forEach(s=>{this.uu(s.key)&&(this.Xa=this.Xa.add(s.key))});const t=[];return e.forEach(s=>{this.Xa.has(s)||t.push(new OV(s))}),this.Xa.forEach(s=>{e.has(s)||t.push(new DV(s))}),t}cu(e){this.Ya=e.Qs,this.Xa=It();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Sf.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const rk="SyncEngine";class hZ{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class dZ{constructor(e){this.key=e,this.hu=!1}}class fZ{constructor(e,t,s,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Ch(a=>Y4(a),Dw),this.Iu=new Map,this.Eu=new Set,this.du=new cs(He.comparator),this.Au=new Map,this.Ru=new qI,this.Vu={},this.mu=new Map,this.fu=_f.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function pZ(n,e,t=!0){const s=UV(n);let r;const i=s.Tu.get(e);return i?(s.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.lu()):r=await PV(s,e,t,!0),r}async function mZ(n,e){const t=UV(n);await PV(t,e,!0,!1)}async function PV(n,e,t,s){const r=await $J(n.localStore,Mo(e)),i=r.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return s&&(a=await gZ(n,e,i,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&IV(n.remoteStore,r),a}async function gZ(n,e,t,s,r){n.pu=(f,m,y)=>async function(w,v,S,T){let I=v.view.ru(S);I.Cs&&(I=await jP(w.localStore,v.query,!1).then(({documents:P})=>v.view.ru(P,I)));const k=T&&T.targetChanges.get(v.targetId),O=T&&T.targetMismatches.get(v.targetId)!=null,V=v.view.applyChanges(I,w.isPrimaryClient,k,O);return ZP(w,v.targetId,V.au),V.snapshot}(n,f,m,y);const i=await jP(n.localStore,e,!0),o=new uZ(e,i.Qs),a=o.ru(i.documents),l=ry.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",r),u=o.applyChanges(a,n.isPrimaryClient,l);ZP(n,t,u.au);const d=new hZ(e,t,o);return n.Tu.set(e,d),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function yZ(n,e,t){const s=ot(n),r=s.Tu.get(e),i=s.Iu.get(r.targetId);if(i.length>1)return s.Iu.set(r.targetId,i.filter(o=>!Dw(o,e))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await cE(s.localStore,r.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(r.targetId),t&&QI(s.remoteStore,r.targetId),dE(s,r.targetId)}).catch(Wf)):(dE(s,r.targetId),await cE(s.localStore,r.targetId,!0))}async function bZ(n,e){const t=ot(n),s=t.Tu.get(e),r=t.Iu.get(s.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),QI(t.remoteStore,s.targetId))}async function xZ(n,e,t){const s=EZ(n);try{const r=await function(o,a){const l=ot(o),u=_n.now(),d=a.reduce((y,b)=>y.add(b.key),It());let f,m;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let b=Ka(),w=It();return l.Ns.getEntries(y,d).next(v=>{b=v,b.forEach((S,T)=>{T.isValidDocument()||(w=w.add(S))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,b)).next(v=>{f=v;const S=[];for(const T of a){const I=RQ(T,f.get(T.key).overlayedDocument);I!=null&&S.push(new Ac(T.key,I,z4(I.value.mapValue),Lo.exists(!0)))}return l.mutationQueue.addMutationBatch(y,u,S,a)}).next(v=>{m=v;const S=v.applyToLocalDocumentSet(f,w);return l.documentOverlayCache.saveOverlays(y,v.batchId,S)})}).then(()=>({batchId:m.batchId,changes:Z4(f)}))}(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),function(o,a,l){let u=o.Vu[o.currentUser.toKey()];u||(u=new cs(Et)),u=u.insert(a,l),o.Vu[o.currentUser.toKey()]=u}(s,r.batchId,t),await oy(s,r.changes),await Uw(s.remoteStore)}catch(r){const i=nk(r,"Failed to persist write");t.reject(i)}}async function MV(n,e){const t=ot(n);try{const s=await NJ(t.localStore,e);e.targetChanges.forEach((r,i)=>{const o=t.Au.get(i);o&&(Yt(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?o.hu=!0:r.modifiedDocuments.size>0?Yt(o.hu,14607):r.removedDocuments.size>0&&(Yt(o.hu,42227),o.hu=!1))}),await oy(t,s,e)}catch(s){await Wf(s)}}function JP(n,e,t){const s=ot(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const r=[];s.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&r.push(a.snapshot)}),function(o,a){const l=ot(o);l.onlineState=a;let u=!1;l.queries.forEach((d,f)=>{for(const m of f.Sa)m.va(a)&&(u=!0)}),u&&sk(l)}(s.eventManager,e),r.length&&s.Pu.H_(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function vZ(n,e,t){const s=ot(n);s.sharedClientState.updateQueryState(e,"rejected",t);const r=s.Au.get(e),i=r&&r.key;if(i){let o=new cs(He.comparator);o=o.insert(i,hr.newNoDocument(i,rt.min()));const a=It().add(i),l=new Lw(rt.min(),new Map,new cs(Et),o,a);await MV(s,l),s.du=s.du.remove(i),s.Au.delete(e),ik(s)}else await cE(s.localStore,e,!1).then(()=>dE(s,e,t)).catch(Wf)}async function wZ(n,e){const t=ot(n),s=e.batch.batchId;try{const r=await kJ(t.localStore,e);FV(t,s,null),LV(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),await oy(t,r)}catch(r){await Wf(r)}}async function _Z(n,e,t){const s=ot(n);try{const r=await function(o,a){const l=ot(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let d;return l.mutationQueue.lookupMutationBatch(u,a).next(f=>(Yt(f!==null,37113),d=f.keys(),l.mutationQueue.removeMutationBatch(u,f))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,d,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,d)).next(()=>l.localDocuments.getDocuments(u,d))})}(s.localStore,e);FV(s,e,t),LV(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),await oy(s,r)}catch(r){await Wf(r)}}function LV(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function FV(n,e,t){const s=ot(n);let r=s.Vu[s.currentUser.toKey()];if(r){const i=r.get(e);i&&(t?i.reject(t):i.resolve(),r=r.remove(e)),s.Vu[s.currentUser.toKey()]=r}}function dE(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(s=>{n.Ru.containsKey(s)||VV(n,s)})}function VV(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(QI(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),ik(n))}function ZP(n,e,t){for(const s of t)s instanceof DV?(n.Ru.addReference(s.key,e),SZ(n,s)):s instanceof OV?(Fe(rk,"Document no longer in limbo: "+s.key),n.Ru.removeReference(s.key,e),n.Ru.containsKey(s.key)||VV(n,s.key)):tt(19791,{wu:s})}function SZ(n,e){const t=e.key,s=t.path.canonicalString();n.du.get(t)||n.Eu.has(s)||(Fe(rk,"New document in limbo: "+t),n.Eu.add(s),ik(n))}function ik(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new He(xn.fromString(e)),s=n.fu.next();n.Au.set(s,new dZ(t)),n.du=n.du.insert(t,s),IV(n.remoteStore,new Xl(Mo(zI(t.path)),s,"TargetPurposeLimboResolution",Aw.ce))}}async function oy(n,e,t){const s=ot(n),r=[],i=[],o=[];s.Tu.isEmpty()||(s.Tu.forEach((a,l)=>{o.push(s.pu(l,e,t).then(u=>{if((u||t)&&s.isPrimaryClient){const d=u?!u.fromCache:t?.targetChanges.get(l.targetId)?.current;s.sharedClientState.updateQueryState(l.targetId,d?"current":"not-current")}if(u){r.push(u);const d=XI.As(l.targetId,u);i.push(d)}}))}),await Promise.all(o),s.Pu.H_(r),await async function(l,u){const d=ot(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>Ie.forEach(u,m=>Ie.forEach(m.Es,y=>d.persistence.referenceDelegate.addReference(f,m.targetId,y)).next(()=>Ie.forEach(m.ds,y=>d.persistence.referenceDelegate.removeReference(f,m.targetId,y)))))}catch(f){if(!Gf(f))throw f;Fe(YI,"Failed to update sequence numbers: "+f)}for(const f of u){const m=f.targetId;if(!f.fromCache){const y=d.Ms.get(m),b=y.snapshotVersion,w=y.withLastLimboFreeSnapshotVersion(b);d.Ms=d.Ms.insert(m,w)}}}(s.localStore,i))}async function CZ(n,e){const t=ot(n);if(!t.currentUser.isEqual(e)){Fe(rk,"User change. New user:",e.toKey());const s=await SV(t.localStore,e);t.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(l=>{l.reject(new Le(Te.CANCELLED,o))})}),i.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await oy(t,s.Ls)}}function TZ(n,e){const t=ot(n),s=t.Au.get(e);if(s&&s.hu)return It().add(s.key);{let r=It();const i=t.Iu.get(e);if(!i)return r;for(const o of i){const a=t.Tu.get(o);r=r.unionWith(a.view.nu)}return r}}function UV(n){const e=ot(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=MV.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=TZ.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=vZ.bind(null,e),e.Pu.H_=aZ.bind(null,e.eventManager),e.Pu.yu=lZ.bind(null,e.eventManager),e}function EZ(n){const e=ot(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=wZ.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=_Z.bind(null,e),e}class yv{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Fw(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return IJ(this.persistence,new CJ,e.initialUser,this.serializer)}Cu(e){return new _V(KI.mi,this.serializer)}Du(e){return new OJ}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}yv.provider={build:()=>new yv};class IZ extends yv{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Yt(this.persistence.referenceDelegate instanceof mv,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new cJ(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Lr.withCacheSize(this.cacheSizeBytes):Lr.DEFAULT;return new _V(s=>mv.mi(s,t),this.serializer)}}class fE{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>JP(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=CZ.bind(null,this.syncEngine),await nZ(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new rZ}()}createDatastore(e){const t=Fw(e.databaseInfo.databaseId),s=function(i){return new VJ(i)}(e.databaseInfo);return function(i,o,a,l){return new jJ(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return function(s,r,i,o,a){return new GJ(s,r,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>JP(this.syncEngine,t,0),function(){return HP.v()?new HP:new PJ}())}createSyncEngine(e,t){return function(r,i,o,a,l,u,d){const f=new fZ(r,i,o,a,l,u);return d&&(f.gu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await async function(t){const s=ot(t);Fe(Zu,"RemoteStore shutting down."),s.Ea.add(5),await iy(s),s.Aa.shutdown(),s.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}fE.provider={build:()=>new fE};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kZ{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):qa("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gc="FirestoreClient";class NZ{constructor(e,t,s,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=r,this.user=cr.UNAUTHENTICATED,this.clientId=MI.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(s,async o=>{Fe(gc,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(s,o=>(Fe(gc,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ju;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=nk(t,"Failed to shutdown persistence");e.reject(s)}}),e.promise}}async function nT(n,e){n.asyncQueue.verifyOperationInProgress(),Fe(gc,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener(async r=>{s.isEqual(r)||(await SV(e.localStore,r),s=r)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function eM(n,e){n.asyncQueue.verifyOperationInProgress();const t=await AZ(n);Fe(gc,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(s=>KP(e.remoteStore,s)),n.setAppCheckTokenChangeListener((s,r)=>KP(e.remoteStore,r)),n._onlineComponents=e}async function AZ(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Fe(gc,"Using user provided OfflineComponentProvider");try{await nT(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(r){return r.name==="FirebaseError"?r.code===Te.FAILED_PRECONDITION||r.code===Te.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;bf("Error using user provided cache. Falling back to memory cache: "+t),await nT(n,new yv)}}else Fe(gc,"Using default OfflineComponentProvider"),await nT(n,new IZ(void 0));return n._offlineComponents}async function BV(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Fe(gc,"Using user provided OnlineComponentProvider"),await eM(n,n._uninitializedComponentsProvider._online)):(Fe(gc,"Using default OnlineComponentProvider"),await eM(n,new fE))),n._onlineComponents}function RZ(n){return BV(n).then(e=>e.syncEngine)}async function tM(n){const e=await BV(n),t=e.eventManager;return t.onListen=pZ.bind(null,e.syncEngine),t.onUnlisten=yZ.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=mZ.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=bZ.bind(null,e.syncEngine),t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zV(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nM=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jV="firestore.googleapis.com",sM=!0;class rM{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Le(Te.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=jV,this.ssl=sM}else this.host=e.host,this.ssl=e.ssl??sM;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=wV;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<aJ)throw new Le(Te.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}GY("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=zV(e.experimentalLongPollingOptions??{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new Le(Te.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new Le(Te.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new Le(Te.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(s,r){return s.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Bw{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new rM({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Le(Te.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Le(Te.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new rM(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new PY;switch(s.type){case"firstParty":return new VY(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new Le(Te.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const s=nM.get(t);s&&(Fe("ComponentProvider","Removing Datastore"),nM.delete(t),s.terminate())}(this),Promise.resolve()}}function $Z(n,e,t,s={}){n=Wu(n,Bw);const r=kc(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;r&&(NI(`https://${a}`),AI("Firestore",!0)),i.host!==jV&&i.host!==a&&bf("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:r,emulatorOptions:s};if(!cc(l,o)&&(n._setSettings(l),s.mockUserToken)){let u,d;if(typeof s.mockUserToken=="string")u=s.mockUserToken,d=cr.MOCK_USER;else{u=m4(s.mockUserToken,n._app?.options.projectId);const f=s.mockUserToken.sub||s.mockUserToken.user_id;if(!f)throw new Le(Te.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new cr(f)}n._authCredentials=new MY(new A4(u,d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rc{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new Rc(this.firestore,e,this._query)}}class rs{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new sc(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new rs(this.firestore,e,this._key)}toJSON(){return{type:rs._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(ny(t,rs._jsonSchema))return new rs(e,s||null,new He(xn.fromString(t.referencePath)))}}rs._jsonSchemaVersion="firestore/documentReference/1.0",rs._jsonSchema={type:ss("string",rs._jsonSchemaVersion),referencePath:ss("string")};class sc extends Rc{constructor(e,t,s){super(e,t,zI(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new rs(this.firestore,null,new He(e))}withConverter(e){return new sc(this.firestore,e,this._path)}}function $u(n,e,...t){if(n=kn(n),R4("collection","path",e),n instanceof Bw){const s=xn.fromString(e,...t);return gP(s),new sc(n,null,s)}{if(!(n instanceof rs||n instanceof sc))throw new Le(Te.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(xn.fromString(e,...t));return gP(s),new sc(n.firestore,null,s)}}function WV(n,e,...t){if(n=kn(n),arguments.length===1&&(e=MI.newId()),R4("doc","path",e),n instanceof Bw){const s=xn.fromString(e,...t);return mP(s),new rs(n,null,new He(s))}{if(!(n instanceof rs||n instanceof sc))throw new Le(Te.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(xn.fromString(e,...t));return mP(s),new rs(n.firestore,n instanceof sc?n.converter:null,new He(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iM="AsyncQueue";class oM{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new TV(this,"async_queue_retry"),this._c=()=>{const s=tT();s&&Fe(iM,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=tT();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=tT();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new ju;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Gf(e))throw e;Fe(iM,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(s=>{throw this.nc=s,this.rc=!1,qa("INTERNAL UNHANDLED ERROR: ",aM(s)),s}).then(s=>(this.rc=!1,s))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=tk.createAndSchedule(this,e,t,s,i=>this.hc(i));return this.tc.push(r),r}uc(){this.nc&&tt(47125,{Pc:aM(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,s)=>t.targetTimeMs-s.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function aM(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lM(n){return function(t,s){if(typeof t!="object"||t===null)return!1;const r=t;for(const i of s)if(i in r&&typeof r[i]=="function")return!0;return!1}(n,["next","error","complete"])}class Eg extends Bw{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new oM,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new oM(e),this._firestoreClient=void 0,await e}}}function DZ(n,e){const t=typeof n=="object"?n:OI(),s=typeof n=="string"?n:uv,r=kw(t,"firestore").getImmediate({identifier:s});if(!r._initialized){const i=d4("firestore");i&&$Z(r,...i)}return r}function GV(n){if(n._terminated)throw new Le(Te.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||OZ(n),n._firestoreClient}function OZ(n){const e=n._freezeSettings(),t=function(r,i,o,a){return new sQ(r,i,o,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,zV(a.experimentalLongPollingOptions),a.useFetchStreams,a.isUsingEmulator)}(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new NZ(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(r){const i=r?._online.build();return{_offline:r?._offline.build(i),_online:i}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ii{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ii(Ys.fromBase64String(e))}catch(t){throw new Le(Te.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ii(Ys.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Ii._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ny(e,Ii._jsonSchema))return Ii.fromBase64String(e.bytes)}}Ii._jsonSchemaVersion="firestore/bytes/1.0",Ii._jsonSchema={type:ss("string",Ii._jsonSchemaVersion),bytes:ss("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zw{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Le(Te.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Xs(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ay{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vo{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Le(Te.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Le(Te.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Et(this._lat,e._lat)||Et(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Vo._jsonSchemaVersion}}static fromJSON(e){if(ny(e,Vo._jsonSchema))return new Vo(e.latitude,e.longitude)}}Vo._jsonSchemaVersion="firestore/geoPoint/1.0",Vo._jsonSchema={type:ss("string",Vo._jsonSchemaVersion),latitude:ss("number"),longitude:ss("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uo{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(s,r){if(s.length!==r.length)return!1;for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Uo._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ny(e,Uo._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new Uo(e.vectorValues);throw new Le(Te.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Uo._jsonSchemaVersion="firestore/vectorValue/1.0",Uo._jsonSchema={type:ss("string",Uo._jsonSchemaVersion),vectorValues:ss("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PZ=/^__.*__$/;class MZ{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new Ac(e,this.data,this.fieldMask,t,this.fieldTransforms):new sy(e,this.data,t,this.fieldTransforms)}}class HV{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return new Ac(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function qV(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw tt(40011,{Ac:n})}}class ok{constructor(e,t,s,r,i,o){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new ok({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.gc(e),s}yc(e){const t=this.path?.child(e),s=this.Vc({path:t,fc:!1});return s.Rc(),s}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return bv(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(qV(this.Ac)&&PZ.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class LZ{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||Fw(e)}Cc(e,t,s,r=!1){return new ok({Ac:e,methodName:t,Dc:s,path:Xs.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ak(n){const e=n._freezeSettings(),t=Fw(n._databaseId);return new LZ(n._databaseId,!!e.ignoreUndefinedProperties,t)}function FZ(n,e,t,s,r,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,r);uk("Data must be an object, but it was:",o,s);const a=KV(s,o);let l,u;if(i.merge)l=new ri(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const f of i.mergeFields){const m=pE(e,f,t);if(!o.contains(m))throw new Le(Te.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);YV(d,m)||d.push(m)}l=new ri(d),u=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,u=o.fieldTransforms;return new MZ(new Vr(a),l,u)}class jw extends ay{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof jw}}class lk extends ay{_toFieldTransform(e){return new aV(e.path,new _g)}isEqual(e){return e instanceof lk}}class ck extends ay{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new Tg(e.serializer,nV(e.serializer,this.Fc));return new aV(e.path,t)}isEqual(e){return e instanceof ck&&this.Fc===e.Fc}}function VZ(n,e,t,s){const r=n.Cc(1,e,t);uk("Data must be an object, but it was:",r,s);const i=[],o=Vr.empty();Nc(s,(l,u)=>{const d=hk(e,l,t);u=kn(u);const f=r.yc(d);if(u instanceof jw)i.push(d);else{const m=ly(u,f);m!=null&&(i.push(d),o.set(d,m))}});const a=new ri(i);return new HV(o,a,r.fieldTransforms)}function UZ(n,e,t,s,r,i){const o=n.Cc(1,e,t),a=[pE(e,s,t)],l=[r];if(i.length%2!=0)throw new Le(Te.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)a.push(pE(e,i[m])),l.push(i[m+1]);const u=[],d=Vr.empty();for(let m=a.length-1;m>=0;--m)if(!YV(u,a[m])){const y=a[m];let b=l[m];b=kn(b);const w=o.yc(y);if(b instanceof jw)u.push(y);else{const v=ly(b,w);v!=null&&(u.push(y),d.set(y,v))}}const f=new ri(u);return new HV(d,f,o.fieldTransforms)}function BZ(n,e,t,s=!1){return ly(t,n.Cc(s?4:3,e))}function ly(n,e){if(XV(n=kn(n)))return uk("Unsupported field value:",e,n),KV(n,e);if(n instanceof ay)return function(s,r){if(!qV(r.Ac))throw r.Sc(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Sc(`${s._methodName}() is not currently supported inside arrays`);const i=s._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(s,r){const i=[];let o=0;for(const a of s){let l=ly(a,r.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(s,r){if((s=kn(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return nV(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const i=_n.fromDate(s);return{timestampValue:pv(r.serializer,i)}}if(s instanceof _n){const i=new _n(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:pv(r.serializer,i)}}if(s instanceof Vo)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Ii)return{bytesValue:pV(r.serializer,s._byteString)};if(s instanceof rs){const i=r.databaseId,o=s.firestore._databaseId;if(!o.isEqual(i))throw r.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:HI(s.firestore._databaseId||r.databaseId,s._key.path)}}if(s instanceof Uo)return function(o,a){return{mapValue:{fields:{[U4]:{stringValue:B4},[hv]:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Sc("VectorValues must only contain numeric values.");return jI(a.serializer,u)})}}}}}}(s,r);throw r.Sc(`Unsupported field value: ${Nw(s)}`)}(n,e)}function KV(n,e){const t={};return O4(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Nc(n,(s,r)=>{const i=ly(r,e.mc(s));i!=null&&(t[s]=i)}),{mapValue:{fields:t}}}function XV(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof _n||n instanceof Vo||n instanceof Ii||n instanceof rs||n instanceof ay||n instanceof Uo)}function uk(n,e,t){if(!XV(t)||!$4(t)){const s=Nw(t);throw s==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+s)}}function pE(n,e,t){if((e=kn(e))instanceof zw)return e._internalPath;if(typeof e=="string")return hk(n,e);throw bv("Field path arguments must be of type string or ",n,!1,void 0,t)}const zZ=new RegExp("[~\\*/\\[\\]]");function hk(n,e,t){if(e.search(zZ)>=0)throw bv(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new zw(...e.split("."))._internalPath}catch{throw bv(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function bv(n,e,t,s,r){const i=s&&!s.isEmpty(),o=r!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${s}`),o&&(l+=` in document ${r}`),l+=")"),new Le(Te.INVALID_ARGUMENT,a+n+l)}function YV(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QV{constructor(e,t,s,r,i){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new rs(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new jZ(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ww("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class jZ extends QV{data(){return super.data()}}function Ww(n,e){return typeof e=="string"?hk(n,e):e instanceof zw?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WZ(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Le(Te.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class dk{}class fk extends dk{}function Jd(n,e,...t){let s=[];e instanceof dk&&s.push(e),s=s.concat(t),function(i){const o=i.filter(l=>l instanceof pk).length,a=i.filter(l=>l instanceof Gw).length;if(o>1||o>0&&a>0)throw new Le(Te.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const r of s)n=r._apply(n);return n}class Gw extends fk{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new Gw(e,t,s)}_apply(e){const t=this._parse(e);return JV(e._query,t),new Rc(e.firestore,e.converter,rE(e._query,t))}_parse(e){const t=ak(e.firestore);return function(i,o,a,l,u,d,f){let m;if(u.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new Le(Te.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){dM(f,d);const b=[];for(const w of f)b.push(hM(l,i,w));m={arrayValue:{values:b}}}else m=hM(l,i,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||dM(f,d),m=BZ(a,o,f,d==="in"||d==="not-in");return ns.create(u,d,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function xv(n,e,t){const s=e,r=Ww("where",n);return Gw._create(r,s,t)}class pk extends dk{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new pk(e,t)}_parse(e){const t=this._queryConstraints.map(s=>s._parse(e)).filter(s=>s.getFilters().length>0);return t.length===1?t[0]:io.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(r,i){let o=r;const a=i.getFlattenedFilters();for(const l of a)JV(o,l),o=rE(o,l)}(e._query,t),new Rc(e.firestore,e.converter,rE(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class mk extends fk{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new mk(e,t)}_apply(e){const t=function(r,i,o){if(r.startAt!==null)throw new Le(Te.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new Le(Te.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new wg(i,o)}(e._query,this._field,this._direction);return new Rc(e.firestore,e.converter,function(r,i){const o=r.explicitOrderBy.concat([i]);return new Hf(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}function cM(n,e="asc"){const t=e,s=Ww("orderBy",n);return mk._create(s,t)}class gk extends fk{constructor(e,t,s){super(),this.type=e,this._limit=t,this._limitType=s}static _create(e,t,s){return new gk(e,t,s)}_apply(e){return new Rc(e.firestore,e.converter,fv(e._query,this._limit,this._limitType))}}function uM(n){return HY("limit",n),gk._create("limit",n,"F")}function hM(n,e,t){if(typeof(t=kn(t))=="string"){if(t==="")throw new Le(Te.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!X4(e)&&t.indexOf("/")!==-1)throw new Le(Te.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const s=e.path.child(xn.fromString(t));if(!He.isDocumentKey(s))throw new Le(Te.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return CP(n,new He(s))}if(t instanceof rs)return CP(n,t._key);throw new Le(Te.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Nw(t)}.`)}function dM(n,e){if(!Array.isArray(n)||n.length===0)throw new Le(Te.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function JV(n,e){const t=function(r,i){for(const o of r)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Le(Te.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Le(Te.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class GZ{convertValue(e,t="none"){switch(pc(e)){case 0:return null;case 1:return e.booleanValue;case 2:return qn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(fc(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw tt(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return Nc(e,(r,i)=>{s[r]=this.convertValue(i,t)}),s}convertVectorValue(e){const t=e.fields?.[hv].arrayValue?.values?.map(s=>qn(s.doubleValue));return new Uo(t)}convertGeoPoint(e){return new Vo(qn(e.latitude),qn(e.longitude))}convertArray(e,t){return(e.values||[]).map(s=>this.convertValue(s,t))}convertServerTimestamp(e,t){switch(t){case"previous":const s=$w(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(bg(e));default:return null}}convertTimestamp(e){const t=dc(e);return new _n(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=xn.fromString(e);Yt(vV(s),9688,{name:e});const r=new xg(s.get(1),s.get(3)),i=new He(s.popFirst(5));return r.isEqual(t)||qa(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HZ(n,e,t){let s;return s=n?n.toFirestore(e):e,s}class Um{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Gu extends QV{constructor(e,t,s,r,i,o){super(e,t,s,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ux(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(Ww("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(Te.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Gu._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Gu._jsonSchemaVersion="firestore/documentSnapshot/1.0",Gu._jsonSchema={type:ss("string",Gu._jsonSchemaVersion),bundleSource:ss("string","DocumentSnapshot"),bundleName:ss("string"),bundle:ss("string")};class Ux extends Gu{data(e={}){return super.data(e)}}class sf{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Um(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(s=>{e.call(t,new Ux(this._firestore,this._userDataWriter,s.key,s,new Um(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Le(Te.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(a=>{const l=new Ux(r._firestore,r._userDataWriter,a.doc.key,a.doc,new Um(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Ux(r._firestore,r._userDataWriter,a.doc.key,a.doc,new Um(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,d=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:qZ(a.type),doc:l,oldIndex:u,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Le(Te.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=sf._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=MI.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],r=[];return this.docs.forEach(i=>{i._document!==null&&(t.push(i._document),s.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),r.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function qZ(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return tt(61501,{type:n})}}sf._jsonSchemaVersion="firestore/querySnapshot/1.0",sf._jsonSchema={type:ss("string",sf._jsonSchemaVersion),bundleSource:ss("string","QuerySnapshot"),bundleName:ss("string"),bundle:ss("string")};class ZV extends GZ{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ii(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new rs(this.firestore,null,t)}}function KZ(n,e,t,...s){n=Wu(n,rs);const r=Wu(n.firestore,Eg),i=ak(r);let o;return o=typeof(e=kn(e))=="string"||e instanceof zw?UZ(i,"updateDoc",n._key,e,t,s):VZ(i,"updateDoc",n._key,e),eU(r,[o.toMutation(n._key,Lo.exists(!0))])}function XZ(n,e){const t=Wu(n.firestore,Eg),s=WV(n),r=HZ(n.converter,e);return eU(t,[FZ(ak(n.firestore),"addDoc",s._key,r,n.converter!==null,{}).toMutation(s._key,Lo.exists(!1))]).then(()=>s)}function Zd(n,...e){n=kn(n);let t={includeMetadataChanges:!1,source:"default"},s=0;typeof e[s]!="object"||lM(e[s])||(t=e[s++]);const r={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(lM(e[s])){const l=e[s];e[s]=l.next?.bind(l),e[s+1]=l.error?.bind(l),e[s+2]=l.complete?.bind(l)}let i,o,a;if(n instanceof rs)o=Wu(n.firestore,Eg),a=zI(n._key.path),i={next:l=>{e[s]&&e[s](YZ(o,n,l))},error:e[s+1],complete:e[s+2]};else{const l=Wu(n,Rc);o=Wu(l.firestore,Eg),a=l._query;const u=new ZV(o);i={next:d=>{e[s]&&e[s](new sf(o,u,l,d))},error:e[s+1],complete:e[s+2]},WZ(n._query)}return function(u,d,f,m){const y=new kZ(m),b=new cZ(d,y,f);return u.asyncQueue.enqueueAndForget(async()=>iZ(await tM(u),b)),()=>{y.Nu(),u.asyncQueue.enqueueAndForget(async()=>oZ(await tM(u),b))}}(GV(o),a,r,i)}function eU(n,e){return function(s,r){const i=new ju;return s.asyncQueue.enqueueAndForget(async()=>xZ(await RZ(s),r,i)),i.promise}(GV(n),e)}function YZ(n,e,t){const s=t.docs.get(e._key),r=new ZV(n);return new Gu(n,r,e._key,s,new Um(t.hasPendingWrites,t.fromCache),e.converter)}function QZ(){return new lk("serverTimestamp")}function fM(n){return new ck("increment",n)}(function(e,t=!0){(function(r){jf=r})(Sh),Qu(new uc("firestore",(s,{instanceIdentifier:r,options:i})=>{const o=s.getProvider("app").getImmediate(),a=new Eg(new LY(s.getProvider("auth-internal")),new UY(o,s.getProvider("app-check-internal")),function(u,d){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new Le(Te.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xg(u.options.projectId,d)}(o,r),o);return i={useFetchStreams:t,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Po(hP,dP,e),Po(hP,dP,"esm2020")})();var pM={};const mM="@firebase/database",gM="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tU="";function JZ(n){tU=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZZ{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Os(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:mg(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eee{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return sa(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nU=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new ZZ(e)}}catch{}return new eee},Lu=nU("localStorage"),tee=nU("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rf=new Iw("@firebase/database"),nee=function(){let n=1;return function(){return n++}}(),sU=function(n){const e=EX(n),t=new _X;t.update(e);const s=t.digest();return kI.encodeByteArray(s)},cy=function(...n){let e="";for(let t=0;t<n.length;t++){const s=n[t];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=cy.apply(null,s):typeof s=="object"?e+=Os(s):e+=s,e+=" "}return e};let tg=null,yM=!0;const see=function(n,e){Ae(!0,"Can't turn on custom loggers persistently."),rf.logLevel=St.VERBOSE,tg=rf.log.bind(rf)},qs=function(...n){if(yM===!0&&(yM=!1,tg===null&&tee.get("logging_enabled")===!0&&see()),tg){const e=cy.apply(null,n);tg(e)}},uy=function(n){return function(...e){qs(n,...e)}},mE=function(...n){const e="FIREBASE INTERNAL ERROR: "+cy(...n);rf.error(e)},Xa=function(...n){const e=`FIREBASE FATAL ERROR: ${cy(...n)}`;throw rf.error(e),new Error(e)},Wr=function(...n){const e="FIREBASE WARNING: "+cy(...n);rf.warn(e)},ree=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Wr("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},yk=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},iee=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Cf="[MIN_NAME]",eh="[MAX_NAME]",Eh=function(n,e){if(n===e)return 0;if(n===Cf||e===eh)return-1;if(e===Cf||n===eh)return 1;{const t=bM(n),s=bM(e);return t!==null?s!==null?t-s===0?n.length-e.length:t-s:-1:s!==null?1:n<e?-1:1}},oee=function(n,e){return n===e?0:n<e?-1:1},Cm=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Os(e))},bk=function(n){if(typeof n!="object"||n===null)return Os(n);const e=[];for(const s in n)e.push(s);e.sort();let t="{";for(let s=0;s<e.length;s++)s!==0&&(t+=","),t+=Os(e[s]),t+=":",t+=bk(n[e[s]]);return t+="}",t},rU=function(n,e){const t=n.length;if(t<=e)return[n];const s=[];for(let r=0;r<t;r+=e)r+e>t?s.push(n.substring(r,t)):s.push(n.substring(r,r+e));return s};function Qs(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const iU=function(n){Ae(!yk(n),"Invalid JSON number");const e=11,t=52,s=(1<<e-1)-1;let r,i,o,a,l;n===0?(i=0,o=0,r=1/n===-1/0?1:0):(r=n<0,n=Math.abs(n),n>=Math.pow(2,1-s)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),s),i=a+s,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(i=0,o=Math.round(n/Math.pow(2,1-s-t))));const u=[];for(l=t;l;l-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(r?1:0),u.reverse();const d=u.join("");let f="";for(l=0;l<64;l+=8){let m=parseInt(d.substr(l,8),2).toString(16);m.length===1&&(m="0"+m),f=f+m}return f.toLowerCase()},aee=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},lee=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function cee(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const s=new Error(n+" at "+e._path.toString()+": "+t);return s.code=n.toUpperCase(),s}const uee=new RegExp("^-?(0*)\\d{1,10}$"),hee=-2147483648,dee=2147483647,bM=function(n){if(uee.test(n)){const e=Number(n);if(e>=hee&&e<=dee)return e}return null},Kf=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw Wr("Exception was thrown by user callback.",t),e},Math.floor(0))}},fee=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ng=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pee{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Fr(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(s=>this.appCheck=s)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){Wr(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mee{constructor(e,t,s){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(qs("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Wr(e)}}class Bx{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Bx.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xk="5",oU="v",aU="s",lU="r",cU="f",uU=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,hU="ls",dU="p",gE="ac",fU="websocket",pU="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mU{constructor(e,t,s,r,i=!1,o="",a=!1,l=!1,u=null){this.secure=t,this.namespace=s,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Lu.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Lu.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function gee(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function gU(n,e,t){Ae(typeof e=="string","typeof type must == string"),Ae(typeof t=="object","typeof params must == object");let s;if(e===fU)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===pU)s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);gee(n)&&(t.ns=n.namespace);const r=[];return Qs(t,(i,o)=>{r.push(i+"="+o)}),s+r.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yee{constructor(){this.counters_={}}incrementCounter(e,t=1){sa(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return tX(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sT={},rT={};function vk(n){const e=n.toString();return sT[e]||(sT[e]=new yee),sT[e]}function bee(n,e){const t=n.toString();return rT[t]||(rT[t]=e()),rT[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xee{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<s.length;++r)s[r]&&Kf(()=>{this.onMessage_(s[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xM="start",vee="close",wee="pLPCommand",_ee="pRTLPCB",yU="id",bU="pw",xU="ser",See="cb",Cee="seg",Tee="ts",Eee="d",Iee="dframe",vU=1870,wU=30,kee=vU-wU,Nee=25e3,Aee=3e4;class ef{constructor(e,t,s,r,i,o,a){this.connId=e,this.repoInfo=t,this.applicationId=s,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=uy(e),this.stats_=vk(t),this.urlFn=l=>(this.appCheckToken&&(l[gE]=this.appCheckToken),gU(t,pU,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new xee(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Aee)),iee(()=>{if(this.isClosed_)return;this.scriptTagHolder=new wk((...i)=>{const[o,a,l,u,d]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===xM)this.id=a,this.password=l;else if(o===vee)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const s={};s[xM]="t",s[xU]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[See]=this.scriptTagHolder.uniqueCallbackIdentifier),s[oU]=xk,this.transportSessionId&&(s[aU]=this.transportSessionId),this.lastSessionId&&(s[hU]=this.lastSessionId),this.applicationId&&(s[dU]=this.applicationId),this.appCheckToken&&(s[gE]=this.appCheckToken),typeof location<"u"&&location.hostname&&uU.test(location.hostname)&&(s[lU]=cU);const r=this.urlFn(s);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){ef.forceAllow_=!0}static forceDisallow(){ef.forceDisallow_=!0}static isAvailable(){return ef.forceAllow_?!0:!ef.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!aee()&&!lee()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Os(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=c4(t),r=rU(s,kee);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const s={};s[Iee]="t",s[yU]=e,s[bU]=t,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Os(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class wk{constructor(e,t,s,r){this.onDisconnect=s,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=nee(),window[wee+this.uniqueCallbackIdentifier]=e,window[_ee+this.uniqueCallbackIdentifier]=t,this.myIFrame=wk.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){qs("frame writing exception"),a.stack&&qs(a.stack),qs(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||qs("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[yU]=this.myID,e[bU]=this.myPW,e[xU]=this.currentSerial;let t=this.urlFn(e),s="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+wU+s.length<=vU;){const o=this.pendingSegs.shift();s=s+"&"+Cee+r+"="+o.seg+"&"+Tee+r+"="+o.ts+"&"+Eee+r+"="+o.d,r++}return t=t+s,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,s){this.pendingSegs.push({seg:e,ts:t,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const s=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(s,Math.floor(Nee)),i=()=>{clearTimeout(r),s()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const r=s.readyState;(!r||r==="loaded"||r==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),t())},s.onerror=()=>{qs("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ree=16384,$ee=45e3;let vv=null;typeof MozWebSocket<"u"?vv=MozWebSocket:typeof WebSocket<"u"&&(vv=WebSocket);class Yi{constructor(e,t,s,r,i,o,a){this.connId=e,this.applicationId=s,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=uy(this.connId),this.stats_=vk(t),this.connURL=Yi.connectionURL_(t,o,a,r,s),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,s,r,i){const o={};return o[oU]=xk,typeof location<"u"&&location.hostname&&uU.test(location.hostname)&&(o[lU]=cU),t&&(o[aU]=t),s&&(o[hU]=s),r&&(o[gE]=r),i&&(o[dU]=i),gU(e,fU,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Lu.set("previous_websocket_failure",!0);try{let s;fX(),this.mySock=new vv(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){Yi.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(t);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&vv!==null&&!Yi.forceDisallow_}static previouslyFailed(){return Lu.isInMemoryStorage||Lu.get("previous_websocket_failure")===!0}markConnectionHealthy(){Lu.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const s=mg(t);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Ae(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const s=this.extractFrameCount_(t);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const t=Os(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=rU(t,Ree);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor($ee))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Yi.responsesRequiredToBeHealthy=2;Yi.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ig{static get ALL_TRANSPORTS(){return[ef,Yi]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Yi&&Yi.isAvailable();let s=t&&!Yi.previouslyFailed();if(e.webSocketOnly&&(t||Wr("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Yi];else{const r=this.transports_=[];for(const i of Ig.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i);Ig.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Ig.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dee=6e4,Oee=5e3,Pee=10*1024,Mee=100*1024,iT="t",vM="d",Lee="s",wM="r",Fee="e",_M="o",SM="a",CM="n",TM="p",Vee="h";class Uee{constructor(e,t,s,r,i,o,a,l,u,d){this.id=e,this.repoInfo_=t,this.applicationId_=s,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=u,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=uy("c:"+this.id+":"),this.transportManager_=new Ig(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,s)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=ng(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Mee?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Pee?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(iT in e){const t=e[iT];t===SM?this.upgradeIfSecondaryHealthy_():t===wM?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===_M&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Cm("t",e),s=Cm("d",e);if(t==="c")this.onSecondaryControl_(s);else if(t==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:TM,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:SM,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:CM,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Cm("t",e),s=Cm("d",e);t==="c"?this.onControl_(s):t==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Cm(iT,e);if(vM in e){const s=e[vM];if(t===Vee){const r={...s};this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===CM){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Lee?this.onConnectionShutdown_(s):t===wM?this.onReset_(s):t===Fee?mE("Server Error: "+s):t===_M?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):mE("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,s=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),xk!==s&&Wr("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,s),ng(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Dee))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ng(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Oee))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:TM,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Lu.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _U{put(e,t,s,r){}merge(e,t,s,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,s){}onDisconnectMerge(e,t,s){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SU{constructor(e){this.allowedEvents_=e,this.listeners_={},Ae(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let r=0;r<s.length;r++)s[r].callback.apply(s[r].context,t)}}on(e,t,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:s});const r=this.getInitialEvent(e);r&&t.apply(s,r)}off(e,t,s){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!s||s===r[i].context)){r.splice(i,1);return}}validateEventType_(e){Ae(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wv extends SU{static getInstance(){return new wv}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!RI()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return Ae(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EM=32,IM=768;class un{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let s=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[s]=this.pieces_[r],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function Ht(){return new un("")}function Ct(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function yc(n){return n.pieces_.length-n.pieceNum_}function bn(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new un(n.pieces_,e)}function _k(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Bee(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function kg(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function CU(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new un(e,0)}function Mn(n,e){const t=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)t.push(n.pieces_[s]);if(e instanceof un)for(let s=e.pieceNum_;s<e.pieces_.length;s++)t.push(e.pieces_[s]);else{const s=e.split("/");for(let r=0;r<s.length;r++)s[r].length>0&&t.push(s[r])}return new un(t,0)}function Tt(n){return n.pieceNum_>=n.pieces_.length}function Br(n,e){const t=Ct(n),s=Ct(e);if(t===null)return e;if(t===s)return Br(bn(n),bn(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function zee(n,e){const t=kg(n,0),s=kg(e,0);for(let r=0;r<t.length&&r<s.length;r++){const i=Eh(t[r],s[r]);if(i!==0)return i}return t.length===s.length?0:t.length<s.length?-1:1}function Sk(n,e){if(yc(n)!==yc(e))return!1;for(let t=n.pieceNum_,s=e.pieceNum_;t<=n.pieces_.length;t++,s++)if(n.pieces_[t]!==e.pieces_[s])return!1;return!0}function Ni(n,e){let t=n.pieceNum_,s=e.pieceNum_;if(yc(n)>yc(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[s])return!1;++t,++s}return!0}class jee{constructor(e,t){this.errorPrefix_=t,this.parts_=kg(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=Ew(this.parts_[s]);TU(this)}}function Wee(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Ew(e),TU(n)}function Gee(n){const e=n.parts_.pop();n.byteLength_-=Ew(e),n.parts_.length>0&&(n.byteLength_-=1)}function TU(n){if(n.byteLength_>IM)throw new Error(n.errorPrefix_+"has a key path longer than "+IM+" bytes ("+n.byteLength_+").");if(n.parts_.length>EM)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+EM+") or object contains a cycle "+ku(n))}function ku(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ck extends SU{static getInstance(){return new Ck}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}getInitialEvent(e){return Ae(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tm=1e3,Hee=300*1e3,kM=30*1e3,qee=1.3,Kee=3e4,Xee="server_kill",NM=3;class ja extends _U{constructor(e,t,s,r,i,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=ja.nextPersistentConnectionId_++,this.log_=uy("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Tm,this.maxReconnectDelay_=Hee,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Ck.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&wv.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,s){const r=++this.requestNumber_,i={r,a:e,b:t};this.log_(Os(i)),Ae(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),s&&(this.requestCBHash_[r]=s)}get(e){this.initConnection_();const t=new Tw,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,s,r){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),Ae(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Ae(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:r,hashFn:t,query:e,tag:s};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(s)})}sendListen_(e){const t=e.query,s=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+s+" for "+r);const i={p:s},o="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const l=a.d,u=a.s;ja.warnOnListenWarnings_(l,t),(this.listens.get(s)&&this.listens.get(s).get(r))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(s,r),e.onComplete&&e.onComplete(u,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&sa(e,"w")){const s=yf(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();Wr(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||wX(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=kM)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=vX(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(t,s,r=>{const i=r.s,o=r.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,s=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,s)})}unlisten(e,t){const s=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),Ae(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,e._queryObject,t)}sendUnlisten_(e,t,s,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e},o="n";r&&(i.q=s,i.t=r),this.sendRequest(o,i)}onDisconnectPut(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:s})}onDisconnectMerge(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:s})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,s,r){const i={p:t,d:s};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{r&&setTimeout(()=>{r(o.s,o.d)},Math.floor(0))})}put(e,t,s,r){this.putInternal("p",e,t,s,r)}merge(e,t,s,r){this.putInternal("m",e,t,s,r)}putInternal(e,t,s,r,i){this.initConnection_();const o={p:t,d:s};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,s,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,s=>{if(s.s!=="ok"){const i=s.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Os(e));const t=e.r,s=this.requestCBHash_[t];s&&(delete this.requestCBHash_[t],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):mE("Unrecognized action received from server: "+Os(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Ae(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Tm,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Tm,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Kee&&(this.reconnectDelay_=Tm),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*qee)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+ja.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,s())},u=function(f){Ae(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(f)};this.realtime_={close:l,sendRequest:u};const d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[f,m]=await Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);o?qs("getToken() completed but was canceled"):(qs("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=m&&m.token,a=new Uee(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,s,y=>{Wr(y+" ("+this.repoInfo_.toString()+")"),this.interrupt(Xee)},i))}catch(f){this.log_("Failed to get token: "+f),o||(this.repoInfo_.nodeAdmin&&Wr(f),l())}}}interrupt(e){qs("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){qs("Resuming connection for reason: "+e),delete this.interruptReasons_[e],GT(this.interruptReasons_)&&(this.reconnectDelay_=Tm,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let s;t?s=t.map(i=>bk(i)).join("$"):s="default";const r=this.removeListen_(e,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const s=new un(e).toString();let r;if(this.listens.has(s)){const i=this.listens.get(s);r=i.get(t),i.delete(t),i.size===0&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(e,t){qs("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=NM&&(this.reconnectDelay_=kM,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){qs("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=NM&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+tU.replace(/\./g,"-")]=1,RI()?e["framework.cordova"]=1:g4()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=wv.getInstance().currentlyOnline();return GT(this.interruptReasons_)&&e}}ja.nextPersistentConnectionId_=0;ja.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bt{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new bt(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hw{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const s=new bt(Cf,e),r=new bt(Cf,t);return this.compare(s,r)!==0}minPost(){return bt.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fx;class EU extends Hw{static get __EMPTY_NODE(){return fx}static set __EMPTY_NODE(e){fx=e}compare(e,t){return Eh(e.name,t.name)}isDefinedOn(e){throw Bf("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return bt.MIN}maxPost(){return new bt(eh,fx)}makePost(e,t){return Ae(typeof e=="string","KeyIndex indexValue must always be a string."),new bt(e,fx)}toString(){return".key"}}const of=new EU;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class px{constructor(e,t,s,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?s(e.key,t):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Ds{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??Ds.RED,this.left=r??zr.EMPTY_NODE,this.right=i??zr.EMPTY_NODE}copy(e,t,s,r,i){return new Ds(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return i<0?r=r.copy(null,null,null,r.left.insert(e,t,s),null):i===0?r=r.copy(null,t,null,null,null):r=r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return zr.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let s,r;if(s=this,t(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),t(e,s.key)===0){if(s.right.isEmpty())return zr.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Ds.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Ds.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Ds.RED=!0;Ds.BLACK=!1;class Yee{copy(e,t,s,r,i){return this}insert(e,t,s){return new Ds(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class zr{constructor(e,t=zr.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new zr(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Ds.BLACK,null,null))}remove(e){return new zr(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Ds.BLACK,null,null))}get(e){let t,s=this.root_;for(;!s.isEmpty();){if(t=this.comparator_(e,s.key),t===0)return s.value;t<0?s=s.left:t>0&&(s=s.right)}return null}getPredecessorKey(e){let t,s=this.root_,r=null;for(;!s.isEmpty();)if(t=this.comparator_(e,s.key),t===0){if(s.left.isEmpty())return r?r.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else t<0?s=s.left:t>0&&(r=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new px(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new px(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new px(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new px(this.root_,null,this.comparator_,!0,e)}}zr.EMPTY_NODE=new Yee;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qee(n,e){return Eh(n.name,e.name)}function Tk(n,e){return Eh(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yE;function Jee(n){yE=n}const IU=function(n){return typeof n=="number"?"number:"+iU(n):"string:"+n},kU=function(n){if(n.isLeafNode()){const e=n.val();Ae(typeof e=="string"||typeof e=="number"||typeof e=="object"&&sa(e,".sv"),"Priority must be a string or number.")}else Ae(n===yE||n.isEmpty(),"priority of unexpected type.");Ae(n===yE||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let AM;class Rs{static set __childrenNodeConstructor(e){AM=e}static get __childrenNodeConstructor(){return AM}constructor(e,t=Rs.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Ae(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),kU(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Rs(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Rs.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Tt(e)?this:Ct(e)===".priority"?this.priorityNode_:Rs.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:Rs.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const s=Ct(e);return s===null?t:t.isEmpty()&&s!==".priority"?this:(Ae(s!==".priority"||yc(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,Rs.__childrenNodeConstructor.EMPTY_NODE.updateChild(bn(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+IU(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=iU(this.value_):e+=this.value_,this.lazyHash_=sU(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Rs.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Rs.__childrenNodeConstructor?-1:(Ae(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,s=typeof this.value_,r=Rs.VALUE_TYPE_ORDER.indexOf(t),i=Rs.VALUE_TYPE_ORDER.indexOf(s);return Ae(r>=0,"Unknown leaf type: "+t),Ae(i>=0,"Unknown leaf type: "+s),r===i?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}Rs.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let NU,AU;function Zee(n){NU=n}function ete(n){AU=n}class tte extends Hw{compare(e,t){const s=e.node.getPriority(),r=t.node.getPriority(),i=s.compareTo(r);return i===0?Eh(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return bt.MIN}maxPost(){return new bt(eh,new Rs("[PRIORITY-POST]",AU))}makePost(e,t){const s=NU(e);return new bt(t,new Rs("[PRIORITY-POST]",s))}toString(){return".priority"}}const Ln=new tte;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nte=Math.log(2);class ste{constructor(e){const t=i=>parseInt(Math.log(i)/nte,10),s=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const r=s(this.count);this.bits_=e+1&r}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const _v=function(n,e,t,s){n.sort(e);const r=function(l,u){const d=u-l;let f,m;if(d===0)return null;if(d===1)return f=n[l],m=t?t(f):f,new Ds(m,f.node,Ds.BLACK,null,null);{const y=parseInt(d/2,10)+l,b=r(l,y),w=r(y+1,u);return f=n[y],m=t?t(f):f,new Ds(m,f.node,Ds.BLACK,b,w)}},i=function(l){let u=null,d=null,f=n.length;const m=function(b,w){const v=f-b,S=f;f-=b;const T=r(v+1,S),I=n[v],k=t?t(I):I;y(new Ds(k,I.node,w,null,T))},y=function(b){u?(u.left=b,u=b):(d=b,u=b)};for(let b=0;b<l.count;++b){const w=l.nextBitIsOne(),v=Math.pow(2,l.count-(b+1));w?m(v,Ds.BLACK):(m(v,Ds.BLACK),m(v,Ds.RED))}return d},o=new ste(n.length),a=i(o);return new zr(s||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oT;const Fd={};class Fa{static get Default(){return Ae(Fd&&Ln,"ChildrenNode.ts has not been loaded"),oT=oT||new Fa({".priority":Fd},{".priority":Ln}),oT}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=yf(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof zr?t:null}hasIndex(e){return sa(this.indexSet_,e.toString())}addIndex(e,t){Ae(e!==of,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let r=!1;const i=t.getIterator(bt.Wrap);let o=i.getNext();for(;o;)r=r||e.isDefinedOn(o.node),s.push(o),o=i.getNext();let a;r?a=_v(s,e.getCompare()):a=Fd;const l=e.toString(),u={...this.indexSet_};u[l]=e;const d={...this.indexes_};return d[l]=a,new Fa(d,u)}addToIndexes(e,t){const s=av(this.indexes_,(r,i)=>{const o=yf(this.indexSet_,i);if(Ae(o,"Missing index implementation for "+i),r===Fd)if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(bt.Wrap);let u=l.getNext();for(;u;)u.name!==e.name&&a.push(u),u=l.getNext();return a.push(e),_v(a,o.getCompare())}else return Fd;else{const a=t.get(e.name);let l=r;return a&&(l=l.remove(new bt(e.name,a))),l.insert(e,e.node)}});return new Fa(s,this.indexSet_)}removeFromIndexes(e,t){const s=av(this.indexes_,r=>{if(r===Fd)return r;{const i=t.get(e.name);return i?r.remove(new bt(e.name,i)):r}});return new Fa(s,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Em;class st{static get EMPTY_NODE(){return Em||(Em=new st(new zr(Tk),null,Fa.Default))}constructor(e,t,s){this.children_=e,this.priorityNode_=t,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&kU(this.priorityNode_),this.children_.isEmpty()&&Ae(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Em}updatePriority(e){return this.children_.isEmpty()?this:new st(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Em:t}}getChild(e){const t=Ct(e);return t===null?this:this.getImmediateChild(t).getChild(bn(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(Ae(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const s=new bt(e,t);let r,i;t.isEmpty()?(r=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(s,this.children_));const o=r.isEmpty()?Em:this.priorityNode_;return new st(r,o,i)}}updateChild(e,t){const s=Ct(e);if(s===null)return t;{Ae(Ct(e)!==".priority"||yc(e)===1,".priority must be the last token in a path");const r=this.getImmediateChild(s).updateChild(bn(e),t);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let s=0,r=0,i=!0;if(this.forEachChild(Ln,(o,a)=>{t[o]=a.val(e),s++,i&&st.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1}),!e&&i&&r<2*s){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+IU(this.getPriority().val())+":"),this.forEachChild(Ln,(t,s)=>{const r=s.hash();r!==""&&(e+=":"+t+":"+r)}),this.lazyHash_=e===""?"":sU(e)}return this.lazyHash_}getPredecessorChildName(e,t,s){const r=this.resolveIndex_(s);if(r){const i=r.getPredecessorKey(new bt(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new bt(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new bt(t,this.children_.get(t)):null}forEachChild(e,t){const s=this.resolveIndex_(e);return s?s.inorderTraversal(r=>t(r.name,r.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getIteratorFrom(e,r=>r);{const r=this.children_.getIteratorFrom(e.name,bt.Wrap);let i=r.peek();for(;i!=null&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getReverseIteratorFrom(e,r=>r);{const r=this.children_.getReverseIteratorFrom(e.name,bt.Wrap);let i=r.peek();for(;i!=null&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===hy?-1:0}withIndex(e){if(e===of||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new st(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===of||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const s=this.getIterator(Ln),r=t.getIterator(Ln);let i=s.getNext(),o=r.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=s.getNext(),o=r.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===of?null:this.indexMap_.get(e.toString())}}st.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class rte extends st{constructor(){super(new zr(Tk),st.EMPTY_NODE,Fa.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return st.EMPTY_NODE}isEmpty(){return!1}}const hy=new rte;Object.defineProperties(bt,{MIN:{value:new bt(Cf,st.EMPTY_NODE)},MAX:{value:new bt(eh,hy)}});EU.__EMPTY_NODE=st.EMPTY_NODE;Rs.__childrenNodeConstructor=st;Jee(hy);ete(hy);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ite=!0;function Ks(n,e=null){if(n===null)return st.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),Ae(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new Rs(t,Ks(e))}if(!(n instanceof Array)&&ite){const t=[];let s=!1;if(Qs(n,(o,a)=>{if(o.substring(0,1)!=="."){const l=Ks(a);l.isEmpty()||(s=s||!l.getPriority().isEmpty(),t.push(new bt(o,l)))}}),t.length===0)return st.EMPTY_NODE;const i=_v(t,Qee,o=>o.name,Tk);if(s){const o=_v(t,Ln.getCompare());return new st(i,Ks(e),new Fa({".priority":o},{".priority":Ln}))}else return new st(i,Ks(e),Fa.Default)}else{let t=st.EMPTY_NODE;return Qs(n,(s,r)=>{if(sa(n,s)&&s.substring(0,1)!=="."){const i=Ks(r);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(s,i))}}),t.updatePriority(Ks(e))}}Zee(Ks);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ote extends Hw{constructor(e){super(),this.indexPath_=e,Ae(!Tt(e)&&Ct(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const s=this.extractChild(e.node),r=this.extractChild(t.node),i=s.compareTo(r);return i===0?Eh(e.name,t.name):i}makePost(e,t){const s=Ks(e),r=st.EMPTY_NODE.updateChild(this.indexPath_,s);return new bt(t,r)}maxPost(){const e=st.EMPTY_NODE.updateChild(this.indexPath_,hy);return new bt(eh,e)}toString(){return kg(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ate extends Hw{compare(e,t){const s=e.node.compareTo(t.node);return s===0?Eh(e.name,t.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return bt.MIN}maxPost(){return bt.MAX}makePost(e,t){const s=Ks(e);return new bt(t,s)}toString(){return".value"}}const lte=new ate;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RU(n){return{type:"value",snapshotNode:n}}function Tf(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Ng(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Ag(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function cte(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ek{constructor(e){this.index_=e}updateChild(e,t,s,r,i,o){Ae(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(r).equals(s.getChild(r))&&a.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(t)?o.trackChildChange(Ng(t,a)):Ae(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Tf(t,s)):o.trackChildChange(Ag(t,s,a))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(t,s).withIndex(this.index_)}updateFullNode(e,t,s){return s!=null&&(e.isLeafNode()||e.forEachChild(Ln,(r,i)=>{t.hasChild(r)||s.trackChildChange(Ng(r,i))}),t.isLeafNode()||t.forEachChild(Ln,(r,i)=>{if(e.hasChild(r)){const o=e.getImmediateChild(r);o.equals(i)||s.trackChildChange(Ag(r,i,o))}else s.trackChildChange(Tf(r,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?st.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rg{constructor(e){this.indexedFilter_=new Ek(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Rg.getStartPost_(e),this.endPost_=Rg.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&s}updateChild(e,t,s,r,i,o){return this.matches(new bt(t,s))||(s=st.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,s,r,i,o)}updateFullNode(e,t,s){t.isLeafNode()&&(t=st.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(st.EMPTY_NODE);const i=this;return t.forEachChild(Ln,(o,a)=>{i.matches(new bt(o,a))||(r=r.updateImmediateChild(o,st.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ute{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=t=>{const s=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new Rg(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,s,r,i,o){return this.rangedFilter_.matches(new bt(t,s))||(s=st.EMPTY_NODE),e.getImmediateChild(t).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,s,r,i,o):this.fullLimitUpdateChild_(e,t,s,i,o)}updateFullNode(e,t,s){let r;if(t.isLeafNode()||t.isEmpty())r=st.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=st.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(st.EMPTY_NODE);let i;this.reverse_?i=r.getReverseIterator(this.index_):i=r.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,st.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,s,r,i){let o;if(this.reverse_){const f=this.index_.getCompare();o=(m,y)=>f(y,m)}else o=this.index_.getCompare();const a=e;Ae(a.numChildren()===this.limit_,"");const l=new bt(t,s),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(l);if(a.hasChild(t)){const f=a.getImmediateChild(t);let m=r.getChildAfterChild(this.index_,u,this.reverse_);for(;m!=null&&(m.name===t||a.hasChild(m.name));)m=r.getChildAfterChild(this.index_,m,this.reverse_);const y=m==null?1:o(m,l);if(d&&!s.isEmpty()&&y>=0)return i?.trackChildChange(Ag(t,s,f)),a.updateImmediateChild(t,s);{i?.trackChildChange(Ng(t,f));const w=a.updateImmediateChild(t,st.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(i?.trackChildChange(Tf(m.name,m.node)),w.updateImmediateChild(m.name,m.node)):w}}else return s.isEmpty()?e:d&&o(u,l)>=0?(i!=null&&(i.trackChildChange(Ng(u.name,u.node)),i.trackChildChange(Tf(t,s))),a.updateImmediateChild(t,s).updateImmediateChild(u.name,st.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ik{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ln}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Ae(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Ae(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Cf}hasEnd(){return this.endSet_}getIndexEndValue(){return Ae(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Ae(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:eh}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Ae(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ln}copy(){const e=new Ik;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function hte(n){return n.loadsAllData()?new Ek(n.getIndex()):n.hasLimit()?new ute(n):new Rg(n)}function RM(n){const e={};if(n.isDefault())return e;let t;if(n.index_===Ln?t="$priority":n.index_===lte?t="$value":n.index_===of?t="$key":(Ae(n.index_ instanceof ote,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Os(t),n.startSet_){const s=n.startAfterSet_?"startAfter":"startAt";e[s]=Os(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+Os(n.indexStartName_))}if(n.endSet_){const s=n.endBeforeSet_?"endBefore":"endAt";e[s]=Os(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+Os(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function $M(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Ln&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sv extends _U{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(Ae(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,s,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=s,this.appCheckTokenProvider_=r,this.log_=uy("p:rest:"),this.listens_={}}listen(e,t,s,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=Sv.getListenId_(e,s),a={};this.listens_[o]=a;const l=RM(e._queryParams);this.restRequest_(i+".json",l,(u,d)=>{let f=d;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(i,f,!1,s),yf(this.listens_,o)===a){let m;u?u===401?m="permission_denied":m="rest_error:"+u:m="ok",r(m,null)}})}unlisten(e,t){const s=Sv.getListenId_(e,t);delete this.listens_[s]}get(e){const t=RM(e._queryParams),s=e._path.toString(),r=new Tw;return this.restRequest_(s+".json",t,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(s,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},s){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+zf(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(s&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=mg(a.responseText)}catch{Wr("Failed to parse JSON response for "+o+": "+a.responseText)}s(null,l)}else a.status!==401&&a.status!==404&&Wr("Got unsuccessful REST response for "+o+" Status: "+a.status),s(a.status);s=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dte{constructor(){this.rootNode_=st.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cv(){return{value:null,children:new Map}}function $U(n,e,t){if(Tt(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const s=Ct(e);n.children.has(s)||n.children.set(s,Cv());const r=n.children.get(s);e=bn(e),$U(r,e,t)}}function bE(n,e,t){n.value!==null?t(e,n.value):fte(n,(s,r)=>{const i=new un(e.toString()+"/"+s);bE(r,i,t)})}function fte(n,e){n.children.forEach((t,s)=>{e(s,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pte{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&Qs(this.last_,(s,r)=>{t[s]=t[s]-r}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DM=10*1e3,mte=30*1e3,gte=300*1e3;class yte{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new pte(e);const s=DM+(mte-DM)*Math.random();ng(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),t={};let s=!1;Qs(e,(r,i)=>{i>0&&sa(this.statsToReport_,r)&&(t[r]=i,s=!0)}),s&&this.server_.reportStats(t),ng(this.reportStats_.bind(this),Math.floor(Math.random()*2*gte))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qi;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Qi||(Qi={}));function kk(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Nk(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Ak(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tv{constructor(e,t,s){this.path=e,this.affectedTree=t,this.revert=s,this.type=Qi.ACK_USER_WRITE,this.source=kk()}operationForChild(e){if(Tt(this.path)){if(this.affectedTree.value!=null)return Ae(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new un(e));return new Tv(Ht(),t,this.revert)}}else return Ae(Ct(this.path)===e,"operationForChild called for unrelated child."),new Tv(bn(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $g{constructor(e,t){this.source=e,this.path=t,this.type=Qi.LISTEN_COMPLETE}operationForChild(e){return Tt(this.path)?new $g(this.source,Ht()):new $g(this.source,bn(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class th{constructor(e,t,s){this.source=e,this.path=t,this.snap=s,this.type=Qi.OVERWRITE}operationForChild(e){return Tt(this.path)?new th(this.source,Ht(),this.snap.getImmediateChild(e)):new th(this.source,bn(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Rk=class xE{constructor(e,t,s){this.source=e,this.path=t,this.children=s,this.type=Qi.MERGE}operationForChild(e){if(Tt(this.path)){const t=this.children.subtree(new un(e));return t.isEmpty()?null:t.value?new th(this.source,Ht(),t.value):new xE(this.source,Ht(),t)}else return Ae(Ct(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new xE(this.source,bn(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nh{constructor(e,t,s){this.node_=e,this.fullyInitialized_=t,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Tt(e))return this.isFullyInitialized()&&!this.filtered_;const t=Ct(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bte{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function xte(n,e,t,s){const r=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(cte(o.childName,o.snapshotNode))}),Im(n,r,"child_removed",e,s,t),Im(n,r,"child_added",e,s,t),Im(n,r,"child_moved",i,s,t),Im(n,r,"child_changed",e,s,t),Im(n,r,"value",e,s,t),r}function Im(n,e,t,s,r,i){const o=s.filter(a=>a.type===t);o.sort((a,l)=>wte(n,a,l)),o.forEach(a=>{const l=vte(n,a,i);r.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(l,n.query_))})})}function vte(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function wte(n,e,t){if(e.childName==null||t.childName==null)throw Bf("Should only compare child_ events.");const s=new bt(e.childName,e.snapshotNode),r=new bt(t.childName,t.snapshotNode);return n.index_.compare(s,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qw(n,e){return{eventCache:n,serverCache:e}}function sg(n,e,t,s){return qw(new nh(e,t,s),n.serverCache)}function DU(n,e,t,s){return qw(n.eventCache,new nh(e,t,s))}function vE(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function sh(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let aT;const _te=()=>(aT||(aT=new zr(oee)),aT);class yn{static fromObject(e){let t=new yn(null);return Qs(e,(s,r)=>{t=t.set(new un(s),r)}),t}constructor(e,t=_te()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Ht(),value:this.value};if(Tt(e))return null;{const s=Ct(e),r=this.children.get(s);if(r!==null){const i=r.findRootMostMatchingPathAndValue(bn(e),t);return i!=null?{path:Mn(new un(s),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Tt(e))return this;{const t=Ct(e),s=this.children.get(t);return s!==null?s.subtree(bn(e)):new yn(null)}}set(e,t){if(Tt(e))return new yn(t,this.children);{const s=Ct(e),i=(this.children.get(s)||new yn(null)).set(bn(e),t),o=this.children.insert(s,i);return new yn(this.value,o)}}remove(e){if(Tt(e))return this.children.isEmpty()?new yn(null):new yn(null,this.children);{const t=Ct(e),s=this.children.get(t);if(s){const r=s.remove(bn(e));let i;return r.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,r),this.value===null&&i.isEmpty()?new yn(null):new yn(this.value,i)}else return this}}get(e){if(Tt(e))return this.value;{const t=Ct(e),s=this.children.get(t);return s?s.get(bn(e)):null}}setTree(e,t){if(Tt(e))return t;{const s=Ct(e),i=(this.children.get(s)||new yn(null)).setTree(bn(e),t);let o;return i.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,i),new yn(this.value,o)}}fold(e){return this.fold_(Ht(),e)}fold_(e,t){const s={};return this.children.inorderTraversal((r,i)=>{s[r]=i.fold_(Mn(e,r),t)}),t(e,this.value,s)}findOnPath(e,t){return this.findOnPath_(e,Ht(),t)}findOnPath_(e,t,s){const r=this.value?s(t,this.value):!1;if(r)return r;if(Tt(e))return null;{const i=Ct(e),o=this.children.get(i);return o?o.findOnPath_(bn(e),Mn(t,i),s):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Ht(),t)}foreachOnPath_(e,t,s){if(Tt(e))return this;{this.value&&s(t,this.value);const r=Ct(e),i=this.children.get(r);return i?i.foreachOnPath_(bn(e),Mn(t,r),s):new yn(null)}}foreach(e){this.foreach_(Ht(),e)}foreach_(e,t){this.children.inorderTraversal((s,r)=>{r.foreach_(Mn(e,s),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,s)=>{s.value&&e(t,s.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eo{constructor(e){this.writeTree_=e}static empty(){return new eo(new yn(null))}}function rg(n,e,t){if(Tt(e))return new eo(new yn(t));{const s=n.writeTree_.findRootMostValueAndPath(e);if(s!=null){const r=s.path;let i=s.value;const o=Br(r,e);return i=i.updateChild(o,t),new eo(n.writeTree_.set(r,i))}else{const r=new yn(t),i=n.writeTree_.setTree(e,r);return new eo(i)}}}function wE(n,e,t){let s=n;return Qs(t,(r,i)=>{s=rg(s,Mn(e,r),i)}),s}function OM(n,e){if(Tt(e))return eo.empty();{const t=n.writeTree_.setTree(e,new yn(null));return new eo(t)}}function _E(n,e){return Ih(n,e)!=null}function Ih(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Br(t.path,e)):null}function PM(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Ln,(s,r)=>{e.push(new bt(s,r))}):n.writeTree_.children.inorderTraversal((s,r)=>{r.value!=null&&e.push(new bt(s,r.value))}),e}function rc(n,e){if(Tt(e))return n;{const t=Ih(n,e);return t!=null?new eo(new yn(t)):new eo(n.writeTree_.subtree(e))}}function SE(n){return n.writeTree_.isEmpty()}function Ef(n,e){return OU(Ht(),n.writeTree_,e)}function OU(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((r,i)=>{r===".priority"?(Ae(i.value!==null,"Priority writes must always be leaf nodes"),s=i.value):t=OU(Mn(n,r),i,t)}),!t.getChild(n).isEmpty()&&s!==null&&(t=t.updateChild(Mn(n,".priority"),s)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $k(n,e){return FU(e,n)}function Ste(n,e,t,s,r){Ae(s>n.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),n.allWrites.push({path:e,snap:t,writeId:s,visible:r}),r&&(n.visibleWrites=rg(n.visibleWrites,e,t)),n.lastWriteId=s}function Cte(n,e,t,s){Ae(s>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:s,visible:!0}),n.visibleWrites=wE(n.visibleWrites,e,t),n.lastWriteId=s}function Tte(n,e){for(let t=0;t<n.allWrites.length;t++){const s=n.allWrites[t];if(s.writeId===e)return s}return null}function Ete(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);Ae(t>=0,"removeWrite called with nonexistent writeId.");const s=n.allWrites[t];n.allWrites.splice(t,1);let r=s.visible,i=!1,o=n.allWrites.length-1;for(;r&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&Ite(a,s.path)?r=!1:Ni(s.path,a.path)&&(i=!0)),o--}if(r){if(i)return kte(n),!0;if(s.snap)n.visibleWrites=OM(n.visibleWrites,s.path);else{const a=s.children;Qs(a,l=>{n.visibleWrites=OM(n.visibleWrites,Mn(s.path,l))})}return!0}else return!1}function Ite(n,e){if(n.snap)return Ni(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Ni(Mn(n.path,t),e))return!0;return!1}function kte(n){n.visibleWrites=PU(n.allWrites,Nte,Ht()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function Nte(n){return n.visible}function PU(n,e,t){let s=eo.empty();for(let r=0;r<n.length;++r){const i=n[r];if(e(i)){const o=i.path;let a;if(i.snap)Ni(t,o)?(a=Br(t,o),s=rg(s,a,i.snap)):Ni(o,t)&&(a=Br(o,t),s=rg(s,Ht(),i.snap.getChild(a)));else if(i.children){if(Ni(t,o))a=Br(t,o),s=wE(s,a,i.children);else if(Ni(o,t))if(a=Br(o,t),Tt(a))s=wE(s,Ht(),i.children);else{const l=yf(i.children,Ct(a));if(l){const u=l.getChild(bn(a));s=rg(s,Ht(),u)}}}else throw Bf("WriteRecord should have .snap or .children")}}return s}function MU(n,e,t,s,r){if(!s&&!r){const i=Ih(n.visibleWrites,e);if(i!=null)return i;{const o=rc(n.visibleWrites,e);if(SE(o))return t;if(t==null&&!_E(o,Ht()))return null;{const a=t||st.EMPTY_NODE;return Ef(o,a)}}}else{const i=rc(n.visibleWrites,e);if(!r&&SE(i))return t;if(!r&&t==null&&!_E(i,Ht()))return null;{const o=function(u){return(u.visible||r)&&(!s||!~s.indexOf(u.writeId))&&(Ni(u.path,e)||Ni(e,u.path))},a=PU(n.allWrites,o,e),l=t||st.EMPTY_NODE;return Ef(a,l)}}}function Ate(n,e,t){let s=st.EMPTY_NODE;const r=Ih(n.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(Ln,(i,o)=>{s=s.updateImmediateChild(i,o)}),s;if(t){const i=rc(n.visibleWrites,e);return t.forEachChild(Ln,(o,a)=>{const l=Ef(rc(i,new un(o)),a);s=s.updateImmediateChild(o,l)}),PM(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const i=rc(n.visibleWrites,e);return PM(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function Rte(n,e,t,s,r){Ae(s||r,"Either existingEventSnap or existingServerSnap must exist");const i=Mn(e,t);if(_E(n.visibleWrites,i))return null;{const o=rc(n.visibleWrites,i);return SE(o)?r.getChild(t):Ef(o,r.getChild(t))}}function $te(n,e,t,s){const r=Mn(e,t),i=Ih(n.visibleWrites,r);if(i!=null)return i;if(s.isCompleteForChild(t)){const o=rc(n.visibleWrites,r);return Ef(o,s.getNode().getImmediateChild(t))}else return null}function Dte(n,e){return Ih(n.visibleWrites,e)}function Ote(n,e,t,s,r,i,o){let a;const l=rc(n.visibleWrites,e),u=Ih(l,Ht());if(u!=null)a=u;else if(t!=null)a=Ef(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const d=[],f=o.getCompare(),m=i?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o);let y=m.getNext();for(;y&&d.length<r;)f(y,s)!==0&&d.push(y),y=m.getNext();return d}else return[]}function Pte(){return{visibleWrites:eo.empty(),allWrites:[],lastWriteId:-1}}function Ev(n,e,t,s){return MU(n.writeTree,n.treePath,e,t,s)}function Dk(n,e){return Ate(n.writeTree,n.treePath,e)}function MM(n,e,t,s){return Rte(n.writeTree,n.treePath,e,t,s)}function Iv(n,e){return Dte(n.writeTree,Mn(n.treePath,e))}function Mte(n,e,t,s,r,i){return Ote(n.writeTree,n.treePath,e,t,s,r,i)}function Ok(n,e,t){return $te(n.writeTree,n.treePath,e,t)}function LU(n,e){return FU(Mn(n.treePath,e),n.writeTree)}function FU(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lte{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,s=e.childName;Ae(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),Ae(s!==".priority","Only non-priority child changes can be tracked.");const r=this.changeMap.get(s);if(r){const i=r.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(s,Ag(s,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(s);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(s,Ng(s,r.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(s,Tf(s,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(s,Ag(s,e.snapshotNode,r.oldSnap));else throw Bf("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fte{getCompleteChild(e){return null}getChildAfterChild(e,t,s){return null}}const VU=new Fte;class Pk{constructor(e,t,s=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=s}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new nh(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Ok(this.writes_,e,s)}}getChildAfterChild(e,t,s){const r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:sh(this.viewCache_),i=Mte(this.writes_,r,t,1,s,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vte(n){return{filter:n}}function Ute(n,e){Ae(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),Ae(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function Bte(n,e,t,s,r){const i=new Lte;let o,a;if(t.type===Qi.OVERWRITE){const u=t;u.source.fromUser?o=CE(n,e,u.path,u.snap,s,r,i):(Ae(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!Tt(u.path),o=kv(n,e,u.path,u.snap,s,r,a,i))}else if(t.type===Qi.MERGE){const u=t;u.source.fromUser?o=jte(n,e,u.path,u.children,s,r,i):(Ae(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=TE(n,e,u.path,u.children,s,r,a,i))}else if(t.type===Qi.ACK_USER_WRITE){const u=t;u.revert?o=Hte(n,e,u.path,s,r,i):o=Wte(n,e,u.path,u.affectedTree,s,r,i)}else if(t.type===Qi.LISTEN_COMPLETE)o=Gte(n,e,t.path,s,i);else throw Bf("Unknown operation type: "+t.type);const l=i.getChanges();return zte(e,o,l),{viewCache:o,changes:l}}function zte(n,e,t){const s=e.eventCache;if(s.isFullyInitialized()){const r=s.getNode().isLeafNode()||s.getNode().isEmpty(),i=vE(n);(t.length>0||!n.eventCache.isFullyInitialized()||r&&!s.getNode().equals(i)||!s.getNode().getPriority().equals(i.getPriority()))&&t.push(RU(vE(e)))}}function UU(n,e,t,s,r,i){const o=e.eventCache;if(Iv(s,t)!=null)return e;{let a,l;if(Tt(t))if(Ae(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=sh(e),d=u instanceof st?u:st.EMPTY_NODE,f=Dk(s,d);a=n.filter.updateFullNode(e.eventCache.getNode(),f,i)}else{const u=Ev(s,sh(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=Ct(t);if(u===".priority"){Ae(yc(t)===1,"Can't have a priority with additional path components");const d=o.getNode();l=e.serverCache.getNode();const f=MM(s,t,d,l);f!=null?a=n.filter.updatePriority(d,f):a=o.getNode()}else{const d=bn(t);let f;if(o.isCompleteForChild(u)){l=e.serverCache.getNode();const m=MM(s,t,o.getNode(),l);m!=null?f=o.getNode().getImmediateChild(u).updateChild(d,m):f=o.getNode().getImmediateChild(u)}else f=Ok(s,u,e.serverCache);f!=null?a=n.filter.updateChild(o.getNode(),u,f,d,r,i):a=o.getNode()}}return sg(e,a,o.isFullyInitialized()||Tt(t),n.filter.filtersNodes())}}function kv(n,e,t,s,r,i,o,a){const l=e.serverCache;let u;const d=o?n.filter:n.filter.getIndexedFilter();if(Tt(t))u=d.updateFullNode(l.getNode(),s,null);else if(d.filtersNodes()&&!l.isFiltered()){const y=l.getNode().updateChild(t,s);u=d.updateFullNode(l.getNode(),y,null)}else{const y=Ct(t);if(!l.isCompleteForPath(t)&&yc(t)>1)return e;const b=bn(t),v=l.getNode().getImmediateChild(y).updateChild(b,s);y===".priority"?u=d.updatePriority(l.getNode(),v):u=d.updateChild(l.getNode(),y,v,b,VU,null)}const f=DU(e,u,l.isFullyInitialized()||Tt(t),d.filtersNodes()),m=new Pk(r,f,i);return UU(n,f,t,r,m,a)}function CE(n,e,t,s,r,i,o){const a=e.eventCache;let l,u;const d=new Pk(r,e,i);if(Tt(t))u=n.filter.updateFullNode(e.eventCache.getNode(),s,o),l=sg(e,u,!0,n.filter.filtersNodes());else{const f=Ct(t);if(f===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),s),l=sg(e,u,a.isFullyInitialized(),a.isFiltered());else{const m=bn(t),y=a.getNode().getImmediateChild(f);let b;if(Tt(m))b=s;else{const w=d.getCompleteChild(f);w!=null?_k(m)===".priority"&&w.getChild(CU(m)).isEmpty()?b=w:b=w.updateChild(m,s):b=st.EMPTY_NODE}if(y.equals(b))l=e;else{const w=n.filter.updateChild(a.getNode(),f,b,m,d,o);l=sg(e,w,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function LM(n,e){return n.eventCache.isCompleteForChild(e)}function jte(n,e,t,s,r,i,o){let a=e;return s.foreach((l,u)=>{const d=Mn(t,l);LM(e,Ct(d))&&(a=CE(n,a,d,u,r,i,o))}),s.foreach((l,u)=>{const d=Mn(t,l);LM(e,Ct(d))||(a=CE(n,a,d,u,r,i,o))}),a}function FM(n,e,t){return t.foreach((s,r)=>{e=e.updateChild(s,r)}),e}function TE(n,e,t,s,r,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,u;Tt(t)?u=s:u=new yn(null).setTree(t,s);const d=e.serverCache.getNode();return u.children.inorderTraversal((f,m)=>{if(d.hasChild(f)){const y=e.serverCache.getNode().getImmediateChild(f),b=FM(n,y,m);l=kv(n,l,new un(f),b,r,i,o,a)}}),u.children.inorderTraversal((f,m)=>{const y=!e.serverCache.isCompleteForChild(f)&&m.value===null;if(!d.hasChild(f)&&!y){const b=e.serverCache.getNode().getImmediateChild(f),w=FM(n,b,m);l=kv(n,l,new un(f),w,r,i,o,a)}}),l}function Wte(n,e,t,s,r,i,o){if(Iv(r,t)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(s.value!=null){if(Tt(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return kv(n,e,t,l.getNode().getChild(t),r,i,a,o);if(Tt(t)){let u=new yn(null);return l.getNode().forEachChild(of,(d,f)=>{u=u.set(new un(d),f)}),TE(n,e,t,u,r,i,a,o)}else return e}else{let u=new yn(null);return s.foreach((d,f)=>{const m=Mn(t,d);l.isCompleteForPath(m)&&(u=u.set(d,l.getNode().getChild(m)))}),TE(n,e,t,u,r,i,a,o)}}function Gte(n,e,t,s,r){const i=e.serverCache,o=DU(e,i.getNode(),i.isFullyInitialized()||Tt(t),i.isFiltered());return UU(n,o,t,s,VU,r)}function Hte(n,e,t,s,r,i){let o;if(Iv(s,t)!=null)return e;{const a=new Pk(s,e,r),l=e.eventCache.getNode();let u;if(Tt(t)||Ct(t)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=Ev(s,sh(e));else{const f=e.serverCache.getNode();Ae(f instanceof st,"serverChildren would be complete if leaf node"),d=Dk(s,f)}d=d,u=n.filter.updateFullNode(l,d,i)}else{const d=Ct(t);let f=Ok(s,d,e.serverCache);f==null&&e.serverCache.isCompleteForChild(d)&&(f=l.getImmediateChild(d)),f!=null?u=n.filter.updateChild(l,d,f,bn(t),a,i):e.eventCache.getNode().hasChild(d)?u=n.filter.updateChild(l,d,st.EMPTY_NODE,bn(t),a,i):u=l,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Ev(s,sh(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||Iv(s,Ht())!=null,sg(e,u,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qte{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,r=new Ek(s.getIndex()),i=hte(s);this.processor_=Vte(i);const o=t.serverCache,a=t.eventCache,l=r.updateFullNode(st.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(st.EMPTY_NODE,a.getNode(),null),d=new nh(l,o.isFullyInitialized(),r.filtersNodes()),f=new nh(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=qw(f,d),this.eventGenerator_=new bte(this.query_)}get query(){return this.query_}}function Kte(n){return n.viewCache_.serverCache.getNode()}function Xte(n,e){const t=sh(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!Tt(e)&&!t.getImmediateChild(Ct(e)).isEmpty())?t.getChild(e):null}function VM(n){return n.eventRegistrations_.length===0}function Yte(n,e){n.eventRegistrations_.push(e)}function UM(n,e,t){const s=[];if(t){Ae(e==null,"A cancel should cancel all event registrations.");const r=n.query._path;n.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(t,r);o&&s.push(o)})}if(e){let r=[];for(let i=0;i<n.eventRegistrations_.length;++i){const o=n.eventRegistrations_[i];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=r}else n.eventRegistrations_=[];return s}function BM(n,e,t,s){e.type===Qi.MERGE&&e.source.queryId!==null&&(Ae(sh(n.viewCache_),"We should always have a full cache before handling merges"),Ae(vE(n.viewCache_),"Missing event cache, even though we have a server cache"));const r=n.viewCache_,i=Bte(n.processor_,r,e,t,s);return Ute(n.processor_,i.viewCache),Ae(i.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,BU(n,i.changes,i.viewCache.eventCache.getNode(),null)}function Qte(n,e){const t=n.viewCache_.eventCache,s=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Ln,(i,o)=>{s.push(Tf(i,o))}),t.isFullyInitialized()&&s.push(RU(t.getNode())),BU(n,s,t.getNode(),e)}function BU(n,e,t,s){const r=s?[s]:n.eventRegistrations_;return xte(n.eventGenerator_,e,t,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Nv;class Jte{constructor(){this.views=new Map}}function Zte(n){Ae(!Nv,"__referenceConstructor has already been defined"),Nv=n}function ene(){return Ae(Nv,"Reference.ts has not been loaded"),Nv}function tne(n){return n.views.size===0}function Mk(n,e,t,s){const r=e.source.queryId;if(r!==null){const i=n.views.get(r);return Ae(i!=null,"SyncTree gave us an op for an invalid query."),BM(i,e,t,s)}else{let i=[];for(const o of n.views.values())i=i.concat(BM(o,e,t,s));return i}}function nne(n,e,t,s,r){const i=e._queryIdentifier,o=n.views.get(i);if(!o){let a=Ev(t,r?s:null),l=!1;a?l=!0:s instanceof st?(a=Dk(t,s),l=!1):(a=st.EMPTY_NODE,l=!1);const u=qw(new nh(a,l,!1),new nh(s,r,!1));return new qte(e,u)}return o}function sne(n,e,t,s,r,i){const o=nne(n,e,s,r,i);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),Yte(o,t),Qte(o,t)}function rne(n,e,t,s){const r=e._queryIdentifier,i=[];let o=[];const a=bc(n);if(r==="default")for(const[l,u]of n.views.entries())o=o.concat(UM(u,t,s)),VM(u)&&(n.views.delete(l),u.query._queryParams.loadsAllData()||i.push(u.query));else{const l=n.views.get(r);l&&(o=o.concat(UM(l,t,s)),VM(l)&&(n.views.delete(r),l.query._queryParams.loadsAllData()||i.push(l.query)))}return a&&!bc(n)&&i.push(new(ene())(e._repo,e._path)),{removed:i,events:o}}function zU(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function af(n,e){let t=null;for(const s of n.views.values())t=t||Xte(s,e);return t}function jU(n,e){if(e._queryParams.loadsAllData())return Kw(n);{const s=e._queryIdentifier;return n.views.get(s)}}function WU(n,e){return jU(n,e)!=null}function bc(n){return Kw(n)!=null}function Kw(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Av;function ine(n){Ae(!Av,"__referenceConstructor has already been defined"),Av=n}function one(){return Ae(Av,"Reference.ts has not been loaded"),Av}let ane=1;class zM{constructor(e){this.listenProvider_=e,this.syncPointTree_=new yn(null),this.pendingWriteTree_=Pte(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function lne(n,e,t,s,r){return Ste(n.pendingWriteTree_,e,t,s,r),r?Xf(n,new th(kk(),e,t)):[]}function cne(n,e,t,s){Cte(n.pendingWriteTree_,e,t,s);const r=yn.fromObject(t);return Xf(n,new Rk(kk(),e,r))}function Fu(n,e,t=!1){const s=Tte(n.pendingWriteTree_,e);if(Ete(n.pendingWriteTree_,e)){let i=new yn(null);return s.snap!=null?i=i.set(Ht(),!0):Qs(s.children,o=>{i=i.set(new un(o),!0)}),Xf(n,new Tv(s.path,i,t))}else return[]}function Xw(n,e,t){return Xf(n,new th(Nk(),e,t))}function une(n,e,t){const s=yn.fromObject(t);return Xf(n,new Rk(Nk(),e,s))}function hne(n,e){return Xf(n,new $g(Nk(),e))}function dne(n,e,t){const s=Lk(n,t);if(s){const r=Fk(s),i=r.path,o=r.queryId,a=Br(i,e),l=new $g(Ak(o),a);return Vk(n,i,l)}else return[]}function EE(n,e,t,s,r=!1){const i=e._path,o=n.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||WU(o,e))){const l=rne(o,e,t,s);tne(o)&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=l.removed;if(a=l.events,!r){const d=u.findIndex(m=>m._queryParams.loadsAllData())!==-1,f=n.syncPointTree_.findOnPath(i,(m,y)=>bc(y));if(d&&!f){const m=n.syncPointTree_.subtree(i);if(!m.isEmpty()){const y=mne(m);for(let b=0;b<y.length;++b){const w=y[b],v=w.query,S=KU(n,w);n.listenProvider_.startListening(ig(v),Rv(n,v),S.hashFn,S.onComplete)}}}!f&&u.length>0&&!s&&(d?n.listenProvider_.stopListening(ig(e),null):u.forEach(m=>{const y=n.queryToTagMap.get(Yw(m));n.listenProvider_.stopListening(ig(m),y)}))}gne(n,u)}return a}function fne(n,e,t,s){const r=Lk(n,s);if(r!=null){const i=Fk(r),o=i.path,a=i.queryId,l=Br(o,e),u=new th(Ak(a),l,t);return Vk(n,o,u)}else return[]}function pne(n,e,t,s){const r=Lk(n,s);if(r){const i=Fk(r),o=i.path,a=i.queryId,l=Br(o,e),u=yn.fromObject(t),d=new Rk(Ak(a),l,u);return Vk(n,o,d)}else return[]}function jM(n,e,t,s=!1){const r=e._path;let i=null,o=!1;n.syncPointTree_.foreachOnPath(r,(m,y)=>{const b=Br(m,r);i=i||af(y,b),o=o||bc(y)});let a=n.syncPointTree_.get(r);a?(o=o||bc(a),i=i||af(a,Ht())):(a=new Jte,n.syncPointTree_=n.syncPointTree_.set(r,a));let l;i!=null?l=!0:(l=!1,i=st.EMPTY_NODE,n.syncPointTree_.subtree(r).foreachChild((y,b)=>{const w=af(b,Ht());w&&(i=i.updateImmediateChild(y,w))}));const u=WU(a,e);if(!u&&!e._queryParams.loadsAllData()){const m=Yw(e);Ae(!n.queryToTagMap.has(m),"View does not exist, but we have a tag");const y=yne();n.queryToTagMap.set(m,y),n.tagToQueryMap.set(y,m)}const d=$k(n.pendingWriteTree_,r);let f=sne(a,e,t,d,i,l);if(!u&&!o&&!s){const m=jU(a,e);f=f.concat(bne(n,e,m))}return f}function GU(n,e,t){const r=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(o,a)=>{const l=Br(o,e),u=af(a,l);if(u)return u});return MU(r,e,i,t,!0)}function Xf(n,e){return HU(e,n.syncPointTree_,null,$k(n.pendingWriteTree_,Ht()))}function HU(n,e,t,s){if(Tt(n.path))return qU(n,e,t,s);{const r=e.get(Ht());t==null&&r!=null&&(t=af(r,Ht()));let i=[];const o=Ct(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const u=t?t.getImmediateChild(o):null,d=LU(s,o);i=i.concat(HU(a,l,u,d))}return r&&(i=i.concat(Mk(r,n,s,t))),i}}function qU(n,e,t,s){const r=e.get(Ht());t==null&&r!=null&&(t=af(r,Ht()));let i=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,u=LU(s,o),d=n.operationForChild(o);d&&(i=i.concat(qU(d,a,l,u)))}),r&&(i=i.concat(Mk(r,n,s,t))),i}function KU(n,e){const t=e.query,s=Rv(n,t);return{hashFn:()=>(Kte(e)||st.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return s?dne(n,t._path,s):hne(n,t._path);{const i=cee(r,t);return EE(n,t,null,i)}}}}function Rv(n,e){const t=Yw(e);return n.queryToTagMap.get(t)}function Yw(n){return n._path.toString()+"$"+n._queryIdentifier}function Lk(n,e){return n.tagToQueryMap.get(e)}function Fk(n){const e=n.indexOf("$");return Ae(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new un(n.substr(0,e))}}function Vk(n,e,t){const s=n.syncPointTree_.get(e);Ae(s,"Missing sync point for query tag that we're tracking");const r=$k(n.pendingWriteTree_,e);return Mk(s,t,r,null)}function mne(n){return n.fold((e,t,s)=>{if(t&&bc(t))return[Kw(t)];{let r=[];return t&&(r=zU(t)),Qs(s,(i,o)=>{r=r.concat(o)}),r}})}function ig(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(one())(n._repo,n._path):n}function gne(n,e){for(let t=0;t<e.length;++t){const s=e[t];if(!s._queryParams.loadsAllData()){const r=Yw(s),i=n.queryToTagMap.get(r);n.queryToTagMap.delete(r),n.tagToQueryMap.delete(i)}}}function yne(){return ane++}function bne(n,e,t){const s=e._path,r=Rv(n,e),i=KU(n,t),o=n.listenProvider_.startListening(ig(e),r,i.hashFn,i.onComplete),a=n.syncPointTree_.subtree(s);if(r)Ae(!bc(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((u,d,f)=>{if(!Tt(u)&&d&&bc(d))return[Kw(d).query];{let m=[];return d&&(m=m.concat(zU(d).map(y=>y.query))),Qs(f,(y,b)=>{m=m.concat(b)}),m}});for(let u=0;u<l.length;++u){const d=l[u];n.listenProvider_.stopListening(ig(d),Rv(n,d))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uk{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Uk(t)}node(){return this.node_}}class Bk{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Mn(this.path_,e);return new Bk(this.syncTree_,t)}node(){return GU(this.syncTree_,this.path_)}}const xne=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},WM=function(n,e,t){if(!n||typeof n!="object")return n;if(Ae(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return vne(n[".sv"],e,t);if(typeof n[".sv"]=="object")return wne(n[".sv"],e);Ae(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},vne=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:Ae(!1,"Unexpected server value: "+n)}},wne=function(n,e,t){n.hasOwnProperty("increment")||Ae(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const s=n.increment;typeof s!="number"&&Ae(!1,"Unexpected increment value: "+s);const r=e.node();if(Ae(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return s;const o=r.getValue();return typeof o!="number"?s:o+s},XU=function(n,e,t,s){return zk(e,new Bk(t,n),s)},_ne=function(n,e,t){return zk(n,new Uk(e),t)};function zk(n,e,t){const s=n.getPriority().val(),r=WM(s,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const o=n,a=WM(o.getValue(),e,t);return a!==o.getValue()||r!==o.getPriority().val()?new Rs(a,Ks(r)):n}else{const o=n;return i=o,r!==o.getPriority().val()&&(i=i.updatePriority(new Rs(r))),o.forEachChild(Ln,(a,l)=>{const u=zk(l,e.getImmediateChild(a),t);u!==l&&(i=i.updateImmediateChild(a,u))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jk{constructor(e="",t=null,s={children:{},childCount:0}){this.name=e,this.parent=t,this.node=s}}function Wk(n,e){let t=e instanceof un?e:new un(e),s=n,r=Ct(t);for(;r!==null;){const i=yf(s.node.children,r)||{children:{},childCount:0};s=new jk(r,s,i),t=bn(t),r=Ct(t)}return s}function Yf(n){return n.node.value}function YU(n,e){n.node.value=e,IE(n)}function QU(n){return n.node.childCount>0}function Sne(n){return Yf(n)===void 0&&!QU(n)}function Qw(n,e){Qs(n.node.children,(t,s)=>{e(new jk(t,n,s))})}function JU(n,e,t,s){t&&e(n),Qw(n,r=>{JU(r,e,!0)})}function Cne(n,e,t){let s=n.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function dy(n){return new un(n.parent===null?n.name:dy(n.parent)+"/"+n.name)}function IE(n){n.parent!==null&&Tne(n.parent,n.name,n)}function Tne(n,e,t){const s=Sne(t),r=sa(n.node.children,e);s&&r?(delete n.node.children[e],n.node.childCount--,IE(n)):!s&&!r&&(n.node.children[e]=t.node,n.node.childCount++,IE(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ene=/[\[\].#$\/\u0000-\u001F\u007F]/,Ine=/[\[\].#$\u0000-\u001F\u007F]/,lT=10*1024*1024,Gk=function(n){return typeof n=="string"&&n.length!==0&&!Ene.test(n)},ZU=function(n){return typeof n=="string"&&n.length!==0&&!Ine.test(n)},kne=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),ZU(n)},Nne=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!yk(n)||n&&typeof n=="object"&&sa(n,".sv")},Hk=function(n,e,t){const s=t instanceof un?new jee(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+ku(s));if(typeof e=="function")throw new Error(n+"contains a function "+ku(s)+" with contents = "+e.toString());if(yk(e))throw new Error(n+"contains "+e.toString()+" "+ku(s));if(typeof e=="string"&&e.length>lT/3&&Ew(e)>lT)throw new Error(n+"contains a string greater than "+lT+" utf8 bytes "+ku(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,i=!1;if(Qs(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!Gk(o)))throw new Error(n+" contains an invalid key ("+o+") "+ku(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Wee(s,o),Hk(n,a,s),Gee(s)}),r&&i)throw new Error(n+' contains ".value" child '+ku(s)+" in addition to actual children.")}},Ane=function(n,e){let t,s;for(t=0;t<e.length;t++){s=e[t];const i=kg(s);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!Gk(i[o]))throw new Error(n+"contains an invalid key ("+i[o]+") in path "+s.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(zee);let r=null;for(t=0;t<e.length;t++){if(s=e[t],r!==null&&Ni(r,s))throw new Error(n+"contains a path "+r.toString()+" that is ancestor of another path "+s.toString());r=s}},Rne=function(n,e,t,s){const r=$I(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(r+" must be an object containing the children to replace.");const i=[];Qs(e,(o,a)=>{const l=new un(o);if(Hk(r,a,Mn(t,l)),_k(l)===".priority"&&!Nne(a))throw new Error(r+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(l)}),Ane(r,i)},eB=function(n,e,t,s){if(!ZU(t))throw new Error($I(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},$ne=function(n,e,t,s){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),eB(n,e,t)},Dne=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Gk(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!kne(t))throw new Error($I(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class One{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function qk(n,e){let t=null;for(let s=0;s<e.length;s++){const r=e[s],i=r.getPath();t!==null&&!Sk(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(r)}t&&n.eventLists_.push(t)}function tB(n,e,t){qk(n,t),nB(n,s=>Sk(s,e))}function Ya(n,e,t){qk(n,t),nB(n,s=>Ni(s,e)||Ni(e,s))}function nB(n,e){n.recursionDepth_++;let t=!0;for(let s=0;s<n.eventLists_.length;s++){const r=n.eventLists_[s];if(r){const i=r.path;e(i)?(Pne(n.eventLists_[s]),n.eventLists_[s]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function Pne(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const s=t.getEventRunner();tg&&qs("event: "+t.toString()),Kf(s)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mne="repo_interrupt",Lne=25;class Fne{constructor(e,t,s,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=s,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new One,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Cv(),this.transactionQueueTree_=new jk,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Vne(n,e,t){if(n.stats_=vk(n.repoInfo_),n.forceRestClient_||fee())n.server_=new Sv(n.repoInfo_,(s,r,i,o)=>{GM(n,s,r,i,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>HM(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Os(t)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new ja(n.repoInfo_,e,(s,r,i,o)=>{GM(n,s,r,i,o)},s=>{HM(n,s)},s=>{Bne(n,s)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=bee(n.repoInfo_,()=>new yte(n.stats_,n.server_)),n.infoData_=new dte,n.infoSyncTree_=new zM({startListening:(s,r,i,o)=>{let a=[];const l=n.infoData_.getNode(s._path);return l.isEmpty()||(a=Xw(n.infoSyncTree_,s._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Xk(n,"connected",!1),n.serverSyncTree_=new zM({startListening:(s,r,i,o)=>(n.server_.listen(s,i,r,(a,l)=>{const u=o(a,l);Ya(n.eventQueue_,s._path,u)}),[]),stopListening:(s,r)=>{n.server_.unlisten(s,r)}})}function Une(n){const t=n.infoData_.getNode(new un(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Kk(n){return xne({timestamp:Une(n)})}function GM(n,e,t,s,r){n.dataUpdateCount++;const i=new un(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(s){const l=av(t,u=>Ks(u));o=pne(n.serverSyncTree_,i,l,r)}else{const l=Ks(t);o=fne(n.serverSyncTree_,i,l,r)}else if(s){const l=av(t,u=>Ks(u));o=une(n.serverSyncTree_,i,l)}else{const l=Ks(t);o=Xw(n.serverSyncTree_,i,l)}let a=i;o.length>0&&(a=Dg(n,i)),Ya(n.eventQueue_,a,o)}function HM(n,e){Xk(n,"connected",e),e===!1&&jne(n)}function Bne(n,e){Qs(e,(t,s)=>{Xk(n,t,s)})}function Xk(n,e,t){const s=new un("/.info/"+e),r=Ks(t);n.infoData_.updateSnapshot(s,r);const i=Xw(n.infoSyncTree_,s,r);Ya(n.eventQueue_,s,i)}function sB(n){return n.nextWriteId_++}function zne(n,e,t,s){Yk(n,"update",{path:e.toString(),value:t});let r=!0;const i=Kk(n),o={};if(Qs(t,(a,l)=>{r=!1,o[a]=XU(Mn(e,a),Ks(l),n.serverSyncTree_,i)}),r)qs("update() called with empty data.  Don't do anything."),qM(n,s,"ok",void 0);else{const a=sB(n),l=cne(n.serverSyncTree_,e,o,a);qk(n.eventQueue_,l),n.server_.merge(e.toString(),t,(u,d)=>{const f=u==="ok";f||Wr("update at "+e+" failed: "+u);const m=Fu(n.serverSyncTree_,a,!f),y=m.length>0?Dg(n,e):e;Ya(n.eventQueue_,y,m),qM(n,s,u,d)}),Qs(t,u=>{const d=lB(n,Mn(e,u));Dg(n,d)}),Ya(n.eventQueue_,e,[])}}function jne(n){Yk(n,"onDisconnectEvents");const e=Kk(n),t=Cv();bE(n.onDisconnect_,Ht(),(r,i)=>{const o=XU(r,i,n.serverSyncTree_,e);$U(t,r,o)});let s=[];bE(t,Ht(),(r,i)=>{s=s.concat(Xw(n.serverSyncTree_,r,i));const o=lB(n,r);Dg(n,o)}),n.onDisconnect_=Cv(),Ya(n.eventQueue_,Ht(),s)}function Wne(n,e,t){let s;Ct(e._path)===".info"?s=jM(n.infoSyncTree_,e,t):s=jM(n.serverSyncTree_,e,t),tB(n.eventQueue_,e._path,s)}function Gne(n,e,t){let s;Ct(e._path)===".info"?s=EE(n.infoSyncTree_,e,t):s=EE(n.serverSyncTree_,e,t),tB(n.eventQueue_,e._path,s)}function Hne(n){n.persistentConnection_&&n.persistentConnection_.interrupt(Mne)}function Yk(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),qs(t,...e)}function qM(n,e,t,s){e&&Kf(()=>{if(t==="ok")e(null);else{const r=(t||"error").toUpperCase();let i=r;s&&(i+=": "+s);const o=new Error(i);o.code=r,e(o)}})}function rB(n,e,t){return GU(n.serverSyncTree_,e,t)||st.EMPTY_NODE}function Qk(n,e=n.transactionQueueTree_){if(e||Jw(n,e),Yf(e)){const t=oB(n,e);Ae(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&qne(n,dy(e),t)}else QU(e)&&Qw(e,t=>{Qk(n,t)})}function qne(n,e,t){const s=t.map(u=>u.currentWriteId),r=rB(n,e,s);let i=r;const o=r.hash();for(let u=0;u<t.length;u++){const d=t[u];Ae(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;const f=Br(e,d.path);i=i.updateChild(f,d.currentOutputSnapshotRaw)}const a=i.val(!0),l=e;n.server_.put(l.toString(),a,u=>{Yk(n,"transaction put response",{path:l.toString(),status:u});let d=[];if(u==="ok"){const f=[];for(let m=0;m<t.length;m++)t[m].status=2,d=d.concat(Fu(n.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&f.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();Jw(n,Wk(n.transactionQueueTree_,e)),Qk(n,n.transactionQueueTree_),Ya(n.eventQueue_,e,d);for(let m=0;m<f.length;m++)Kf(f[m])}else{if(u==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{Wr("transaction at "+l.toString()+" failed: "+u);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=u}Dg(n,e)}},o)}function Dg(n,e){const t=iB(n,e),s=dy(t),r=oB(n,t);return Kne(n,r,s),s}function Kne(n,e,t){if(e.length===0)return;const s=[];let r=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],u=Br(t,l.path);let d=!1,f;if(Ae(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)d=!0,f=l.abortReason,r=r.concat(Fu(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=Lne)d=!0,f="maxretry",r=r.concat(Fu(n.serverSyncTree_,l.currentWriteId,!0));else{const m=rB(n,l.path,o);l.currentInputSnapshot=m;const y=e[a].update(m.val());if(y!==void 0){Hk("transaction failed: Data returned ",y,l.path);let b=Ks(y);typeof y=="object"&&y!=null&&sa(y,".priority")||(b=b.updatePriority(m.getPriority()));const v=l.currentWriteId,S=Kk(n),T=_ne(b,m,S);l.currentOutputSnapshotRaw=b,l.currentOutputSnapshotResolved=T,l.currentWriteId=sB(n),o.splice(o.indexOf(v),1),r=r.concat(lne(n.serverSyncTree_,l.path,T,l.currentWriteId,l.applyLocally)),r=r.concat(Fu(n.serverSyncTree_,v,!0))}else d=!0,f="nodata",r=r.concat(Fu(n.serverSyncTree_,l.currentWriteId,!0))}Ya(n.eventQueue_,t,r),r=[],d&&(e[a].status=2,function(m){setTimeout(m,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?s.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):s.push(()=>e[a].onComplete(new Error(f),!1,null))))}Jw(n,n.transactionQueueTree_);for(let a=0;a<s.length;a++)Kf(s[a]);Qk(n,n.transactionQueueTree_)}function iB(n,e){let t,s=n.transactionQueueTree_;for(t=Ct(e);t!==null&&Yf(s)===void 0;)s=Wk(s,t),e=bn(e),t=Ct(e);return s}function oB(n,e){const t=[];return aB(n,e,t),t.sort((s,r)=>s.order-r.order),t}function aB(n,e,t){const s=Yf(e);if(s)for(let r=0;r<s.length;r++)t.push(s[r]);Qw(e,r=>{aB(n,r,t)})}function Jw(n,e){const t=Yf(e);if(t){let s=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[s]=t[r],s++);t.length=s,YU(e,t.length>0?t:void 0)}Qw(e,s=>{Jw(n,s)})}function lB(n,e){const t=dy(iB(n,e)),s=Wk(n.transactionQueueTree_,e);return Cne(s,r=>{cT(n,r)}),cT(n,s),JU(s,r=>{cT(n,r)}),t}function cT(n,e){const t=Yf(e);if(t){const s=[];let r=[],i=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(Ae(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=3,t[o].abortReason="set"):(Ae(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(Fu(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&s.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?YU(e,void 0):t.length=i+1,Ya(n.eventQueue_,dy(e),r);for(let o=0;o<s.length;o++)Kf(s[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xne(n){let e="";const t=n.split("/");for(let s=0;s<t.length;s++)if(t[s].length>0){let r=t[s];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function Yne(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const s=t.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):Wr(`Invalid query segment '${t}' in query '${n}'`)}return e}const KM=function(n,e){const t=Qne(n),s=t.namespace;t.domain==="firebase.com"&&Xa(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&t.domain!=="localhost"&&Xa("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||ree();const r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new mU(t.host,t.secure,s,r,e,"",s!==t.subdomain),path:new un(t.pathString)}},Qne=function(n){let e="",t="",s="",r="",i="",o=!0,a="https",l=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let d=n.indexOf("/");d===-1&&(d=n.length);let f=n.indexOf("?");f===-1&&(f=n.length),e=n.substring(0,Math.min(d,f)),d<f&&(r=Xne(n.substring(d,f)));const m=Yne(n.substring(Math.min(n.length,f)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(u+1),10)):u=e.length;const y=e.slice(0,u);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{const b=e.indexOf(".");s=e.substring(0,b).toLowerCase(),t=e.substring(b+1),i=s}"ns"in m&&(i=m.ns)}return{host:e,port:l,domain:t,subdomain:s,secure:o,scheme:a,pathString:r,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jne{constructor(e,t,s,r){this.eventType=e,this.eventRegistration=t,this.snapshot=s,this.prevName=r}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Os(this.snapshot.exportVal())}}class Zne{constructor(e,t,s){this.eventRegistration=e,this.error=t,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ese{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return Ae(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jk{constructor(e,t,s,r){this._repo=e,this._path=t,this._queryParams=s,this._orderByCalled=r}get key(){return Tt(this._path)?null:_k(this._path)}get ref(){return new $c(this._repo,this._path)}get _queryIdentifier(){const e=$M(this._queryParams),t=bk(e);return t==="{}"?"default":t}get _queryObject(){return $M(this._queryParams)}isEqual(e){if(e=kn(e),!(e instanceof Jk))return!1;const t=this._repo===e._repo,s=Sk(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&s&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+Bee(this._path)}}class $c extends Jk{constructor(e,t){super(e,t,new Ik,!1)}get parent(){const e=CU(this._path);return e===null?null:new $c(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class $v{constructor(e,t,s){this._node=e,this.ref=t,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new un(e),s=kE(this.ref,e);return new $v(this._node.getChild(t),s,Ln)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,r)=>e(new $v(r,kE(this.ref,s),Ln)))}hasChild(e){const t=new un(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Hu(n,e){return n=kn(n),n._checkNotDeleted("ref"),e!==void 0?kE(n._root,e):n._root}function kE(n,e){return n=kn(n),Ct(n._path)===null?$ne("child","path",e):eB("child","path",e),new $c(n._repo,Mn(n._path,e))}function NE(n,e){Rne("update",e,n._path);const t=new Tw;return zne(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}class Zk{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const s=t._queryParams.getIndex();return new Jne("value",this,new $v(e.snapshotNode,new $c(t._repo,t._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Zne(this,e,t):null}matches(e){return e instanceof Zk?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function tse(n,e,t,s,r){const i=new ese(t,void 0),o=new Zk(i);return Wne(n._repo,n,o),()=>Gne(n._repo,n,o)}function Dv(n,e,t,s){return tse(n,"value",e)}Zte($c);ine($c);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nse="FIREBASE_DATABASE_EMULATOR_HOST",AE={};let sse=!1;function rse(n,e,t,s){const r=e.lastIndexOf(":"),i=e.substring(0,r),o=kc(i);n.repoInfo_=new mU(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),s&&(n.authTokenProvider_=s)}function ise(n,e,t,s,r){let i=s||n.options.databaseURL;i===void 0&&(n.options.projectId||Xa("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),qs("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=KM(i,r),a=o.repoInfo,l;typeof process<"u"&&pM&&(l=pM[nse]),l?(i=`http://${l}?ns=${a.namespace}`,o=KM(i,r),a=o.repoInfo):o.repoInfo.secure;const u=new mee(n.name,n.options,e);Dne("Invalid Firebase Database URL",o),Tt(o.path)||Xa("Database URL must point to the root of a Firebase Database (not including a child path).");const d=ase(a,n,u,new pee(n,t));return new lse(d,n)}function ose(n,e){const t=AE[e];(!t||t[n.key]!==n)&&Xa(`Database ${e}(${n.repoInfo_}) has already been deleted.`),Hne(n),delete t[n.key]}function ase(n,e,t,s){let r=AE[e.name];r||(r={},AE[e.name]=r);let i=r[n.toURLString()];return i&&Xa("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new Fne(n,sse,t,s),r[n.toURLString()]=i,i}class lse{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Vne(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new $c(this._repo,Ht())),this._rootInternal}_delete(){return this._rootInternal!==null&&(ose(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Xa("Cannot call "+e+" on a deleted database.")}}function cse(n=OI(),e){const t=kw(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const s=d4("database");s&&use(t,...s)}return t}function use(n,e,t,s={}){n=kn(n),n._checkNotDeleted("useEmulator");const r=`${e}:${t}`,i=n._repoInternal;if(n._instanceStarted){if(r===n._repoInternal.repoInfo_.host&&cc(s,i.repoInfo_.emulatorOptions))return;Xa("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)s.mockUserToken&&Xa('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Bx(Bx.OWNER);else if(s.mockUserToken){const a=typeof s.mockUserToken=="string"?s.mockUserToken:m4(s.mockUserToken,n.app.options.projectId);o=new Bx(a)}kc(e)&&(NI(e),AI("Database",!0)),rse(i,r,s,o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hse(n){JZ(Sh),Qu(new uc("database",(e,{instanceIdentifier:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return ise(s,r,i,t)},"PUBLIC").setMultipleInstances(!0)),Po(mM,gM,n),Po(mM,gM,"esm2020")}ja.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};ja.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};hse();function cB(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const dse=cB,uB=new ty("auth","Firebase",cB());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ov=new Iw("@firebase/auth");function fse(n,...e){Ov.logLevel<=St.WARN&&Ov.warn(`Auth (${Sh}): ${n}`,...e)}function zx(n,...e){Ov.logLevel<=St.ERROR&&Ov.error(`Auth (${Sh}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $i(n,...e){throw tN(n,...e)}function to(n,...e){return tN(n,...e)}function eN(n,e,t){const s={...dse(),[e]:t};return new ty("auth","Firebase",s).create(e,{appName:n.name})}function Wa(n){return eN(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function pse(n,e,t){const s=t;if(!(e instanceof s))throw s.name!==e.constructor.name&&$i(n,"argument-error"),eN(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function tN(n,...e){if(typeof n!="string"){const t=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(t,...s)}return uB.create(n,...e)}function et(n,e,...t){if(!n)throw tN(e,...t)}function Va(n){const e="INTERNAL ASSERTION FAILED: "+n;throw zx(e),new Error(e)}function Qa(n,e){n||Va(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RE(){return typeof self<"u"&&self.location?.href||""}function mse(){return XM()==="http:"||XM()==="https:"}function XM(){return typeof self<"u"&&self.location?.protocol||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gse(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(mse()||hX()||"connection"in navigator)?navigator.onLine:!0}function yse(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fy{constructor(e,t){this.shortDelay=e,this.longDelay=t,Qa(t>e,"Short delay should be less than long delay!"),this.isMobile=RI()||g4()}get(){return gse()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nN(n,e){Qa(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hB{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Va("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Va("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Va("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bse={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xse=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],vse=new fy(3e4,6e4);function sl(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function rl(n,e,t,s,r={}){return dB(n,r,async()=>{let i={},o={};s&&(e==="GET"?o=s:i={body:JSON.stringify(s)});const a=zf({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:l,...i};return uX()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&kc(n.emulatorConfig.host)&&(u.credentials="include"),hB.fetch()(await fB(n,n.config.apiHost,t,a),u)})}async function dB(n,e,t){n._canInitEmulator=!1;const s={...bse,...e};try{const r=new _se(n),i=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw mx(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw mx(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw mx(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw mx(n,"user-disabled",o);const d=s[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw eN(n,d,u);$i(n,d)}}catch(r){if(r instanceof nl)throw r;$i(n,"network-request-failed",{message:String(r)})}}async function py(n,e,t,s,r={}){const i=await rl(n,e,t,s,r);return"mfaPendingCredential"in i&&$i(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function fB(n,e,t,s){const r=`${e}${t}?${s}`,i=n,o=i.config.emulator?nN(n.config,r):`${n.config.apiScheme}://${r}`;return xse.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function wse(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class _se{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,s)=>{this.timer=setTimeout(()=>s(to(this.auth,"network-request-failed")),vse.get())})}}function mx(n,e,t){const s={appName:n.name};t.email&&(s.email=t.email),t.phoneNumber&&(s.phoneNumber=t.phoneNumber);const r=to(n,e,s);return r.customData._tokenResponse=t,r}function YM(n){return n!==void 0&&n.enterprise!==void 0}class Sse{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return wse(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Cse(n,e){return rl(n,"GET","/v2/recaptchaConfig",sl(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tse(n,e){return rl(n,"POST","/v1/accounts:delete",e)}async function Pv(n,e){return rl(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function og(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Ese(n,e=!1){const t=kn(n),s=await t.getIdToken(e),r=sN(s);et(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const i=typeof r.firebase=="object"?r.firebase:void 0,o=i?.sign_in_provider;return{claims:r,token:s,authTime:og(uT(r.auth_time)),issuedAtTime:og(uT(r.iat)),expirationTime:og(uT(r.exp)),signInProvider:o||null,signInSecondFactor:i?.sign_in_second_factor||null}}function uT(n){return Number(n)*1e3}function sN(n){const[e,t,s]=n.split(".");if(e===void 0||t===void 0||s===void 0)return zx("JWT malformed, contained fewer than 3 sections"),null;try{const r=ov(t);return r?JSON.parse(r):(zx("Failed to decode base64 JWT payload"),null)}catch(r){return zx("Caught error parsing JWT payload as JSON",r?.toString()),null}}function QM(n){const e=sN(n);return et(e,"internal-error"),et(typeof e.exp<"u","internal-error"),et(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Og(n,e,t=!1){if(t)return e;try{return await e}catch(s){throw s instanceof nl&&Ise(s)&&n.auth.currentUser===n&&await n.auth.signOut(),s}}function Ise({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kse{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $E{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=og(this.lastLoginAt),this.creationTime=og(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mv(n){const e=n.auth,t=await n.getIdToken(),s=await Og(n,Pv(e,{idToken:t}));et(s?.users.length,e,"internal-error");const r=s.users[0];n._notifyReloadListener(r);const i=r.providerUserInfo?.length?pB(r.providerUserInfo):[],o=Ase(n.providerData,i),a=n.isAnonymous,l=!(n.email&&r.passwordHash)&&!o?.length,u=a?l:!1,d={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new $E(r.createdAt,r.lastLoginAt),isAnonymous:u};Object.assign(n,d)}async function Nse(n){const e=kn(n);await Mv(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Ase(n,e){return[...n.filter(s=>!e.some(r=>r.providerId===s.providerId)),...e]}function pB(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rse(n,e){const t=await dB(n,{},async()=>{const s=zf({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:i}=n.config,o=await fB(n,r,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:s};return n.emulatorConfig&&kc(n.emulatorConfig.host)&&(l.credentials="include"),hB.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function $se(n,e){return rl(n,"POST","/v2/accounts:revokeToken",sl(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lf{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){et(e.idToken,"internal-error"),et(typeof e.idToken<"u","internal-error"),et(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):QM(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){et(e.length!==0,"internal-error");const t=QM(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(et(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:s,refreshToken:r,expiresIn:i}=await Rse(e,t);this.updateTokensAndExpiration(s,r,Number(i))}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,t){const{refreshToken:s,accessToken:r,expirationTime:i}=t,o=new lf;return s&&(et(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),r&&(et(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),i&&(et(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new lf,this.toJSON())}_performRefresh(){return Va("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vl(n,e){et(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Ji{constructor({uid:e,auth:t,stsTokenManager:s,...r}){this.providerId="firebase",this.proactiveRefresh=new kse(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new $E(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await Og(this,this.stsTokenManager.getToken(this.auth,e));return et(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Ese(this,e)}reload(){return Nse(this)}_assign(e){this!==e&&(et(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Ji({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){et(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&await Mv(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Fr(this.auth.app))return Promise.reject(Wa(this.auth));const e=await this.getIdToken();return await Og(this,Tse(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const s=t.displayName??void 0,r=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,d=t.lastLoginAt??void 0,{uid:f,emailVerified:m,isAnonymous:y,providerData:b,stsTokenManager:w}=t;et(f&&w,e,"internal-error");const v=lf.fromJSON(this.name,w);et(typeof f=="string",e,"internal-error"),Vl(s,e.name),Vl(r,e.name),et(typeof m=="boolean",e,"internal-error"),et(typeof y=="boolean",e,"internal-error"),Vl(i,e.name),Vl(o,e.name),Vl(a,e.name),Vl(l,e.name),Vl(u,e.name),Vl(d,e.name);const S=new Ji({uid:f,auth:e,email:r,emailVerified:m,displayName:s,isAnonymous:y,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:v,createdAt:u,lastLoginAt:d});return b&&Array.isArray(b)&&(S.providerData=b.map(T=>({...T}))),l&&(S._redirectEventId=l),S}static async _fromIdTokenResponse(e,t,s=!1){const r=new lf;r.updateFromServerResponse(t);const i=new Ji({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:s});return await Mv(i),i}static async _fromGetAccountInfoResponse(e,t,s){const r=t.users[0];et(r.localId!==void 0,"internal-error");const i=r.providerUserInfo!==void 0?pB(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!i?.length,a=new lf;a.updateFromIdToken(s);const l=new Ji({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new $E(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!i?.length};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JM=new Map;function Ua(n){Qa(n instanceof Function,"Expected a class definition");let e=JM.get(n);return e?(Qa(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,JM.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mB{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}mB.type="NONE";const ZM=mB;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jx(n,e,t){return`firebase:${n}:${e}:${t}`}class cf{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:r,name:i}=this.auth;this.fullUserKey=jx(this.userKey,r.apiKey,i),this.fullPersistenceKey=jx("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Pv(this.auth,{idToken:e}).catch(()=>{});return t?Ji._fromGetAccountInfoResponse(this.auth,t,e):null}return Ji._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,s="authUser"){if(!t.length)return new cf(Ua(ZM),e,s);const r=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=r[0]||Ua(ZM);const o=jx(s,e.config.apiKey,e.name);let a=null;for(const u of t)try{const d=await u._get(o);if(d){let f;if(typeof d=="string"){const m=await Pv(e,{idToken:d}).catch(()=>{});if(!m)break;f=await Ji._fromGetAccountInfoResponse(e,m,d)}else f=Ji._fromJSON(e,d);u!==i&&(a=f),i=u;break}}catch{}const l=r.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new cf(i,e,s):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new cf(i,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eL(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(xB(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(gB(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(wB(e))return"Blackberry";if(_B(e))return"Webos";if(yB(e))return"Safari";if((e.includes("chrome/")||bB(e))&&!e.includes("edge/"))return"Chrome";if(vB(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(t);if(s?.length===2)return s[1]}return"Other"}function gB(n=mr()){return/firefox\//i.test(n)}function yB(n=mr()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function bB(n=mr()){return/crios\//i.test(n)}function xB(n=mr()){return/iemobile/i.test(n)}function vB(n=mr()){return/android/i.test(n)}function wB(n=mr()){return/blackberry/i.test(n)}function _B(n=mr()){return/webos/i.test(n)}function rN(n=mr()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Dse(n=mr()){return rN(n)&&!!window.navigator?.standalone}function Ose(){return dX()&&document.documentMode===10}function SB(n=mr()){return rN(n)||vB(n)||_B(n)||wB(n)||/windows phone/i.test(n)||xB(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CB(n,e=[]){let t;switch(n){case"Browser":t=eL(mr());break;case"Worker":t=`${eL(mr())}-${n}`;break;default:t=n}const s=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Sh}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pse{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});s.onAbort=t,this.queue.push(s);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)await s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mse(n,e={}){return rl(n,"GET","/v2/passwordPolicy",sl(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lse=6;class Fse{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Lse,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let s;for(let r=0;r<e.length;r++)s=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vse{constructor(e,t,s,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new tL(this),this.idTokenSubscription=new tL(this),this.beforeStateQueue=new Pse(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=uB,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ua(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await cf.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Pv(this,{idToken:e}),s=await Ji._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Fr(this.app)){const i=this.app.settings.authIdToken;return i?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(i).then(o,o))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let s=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=this.redirectUser?._redirectEventId,o=s?._redirectEventId,a=await this.tryRedirectSignIn(e);(!i||i===o)&&a?.user&&(s=a.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(s)}catch(i){s=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return et(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Mv(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=yse()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Fr(this.app))return Promise.reject(Wa(this));const t=e?kn(e):null;return t&&et(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&et(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Fr(this.app)?Promise.reject(Wa(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Fr(this.app)?Promise.reject(Wa(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ua(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Mse(this),t=new Fse(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ty("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(s.tenantId=this.tenantId),await $se(this,s)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const s=await this.getOrInitRedirectPersistenceManager(t);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ua(e)||this._popupRedirectResolver;et(t,this,"argument-error"),this.redirectPersistenceManager=await cf.create(this,[Ua(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,r){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(et(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,s,r);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return et(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=CB(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const s=await this._getAppCheckToken();return s&&(e["X-Firebase-AppCheck"]=s),e}async _getAppCheckToken(){if(Fr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&fse(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Dc(n){return kn(n)}class tL{constructor(e){this.auth=e,this.observer=null,this.addObserver=SX(t=>this.observer=t)}get next(){return et(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zw={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Use(n){Zw=n}function TB(n){return Zw.loadJS(n)}function Bse(){return Zw.recaptchaEnterpriseScript}function zse(){return Zw.gapiScript}function jse(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class Wse{constructor(){this.enterprise=new Gse}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Gse{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const Hse="recaptcha-enterprise",EB="NO_RECAPTCHA";class qse{constructor(e){this.type=Hse,this.auth=Dc(e)}async verify(e="verify",t=!1){async function s(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{Cse(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new Sse(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(l=>{a(l)})})}function r(i,o,a){const l=window.grecaptcha;YM(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(EB)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Wse().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{s(this.auth).then(a=>{if(!t&&YM(window.grecaptcha))r(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=Bse();l.length!==0&&(l+=a),TB(l).then(()=>{r(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function nL(n,e,t,s=!1,r=!1){const i=new qse(n);let o;if(r)o=EB;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const a={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,u=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return s?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function DE(n,e,t,s,r){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await nL(n,e,t,t==="getOobCode");return s(n,i)}else return s(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await nL(n,e,t,t==="getOobCode");return s(n,o)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kse(n,e){const t=kw(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),i=t.getOptions();if(cc(i,e??{}))return r;$i(r,"already-initialized")}return t.initialize({options:e})}function Xse(n,e){const t=e?.persistence||[],s=(Array.isArray(t)?t:[t]).map(Ua);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(s,e?.popupRedirectResolver)}function Yse(n,e,t){const s=Dc(n);et(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const r=!1,i=IB(e),{host:o,port:a}=Qse(e),l=a===null?"":`:${a}`,u={url:`${i}//${o}${l}/`},d=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!s._canInitEmulator){et(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),et(cc(u,s.config.emulator)&&cc(d,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=u,s.emulatorConfig=d,s.settings.appVerificationDisabledForTesting=!0,kc(o)?(NI(`${i}//${o}${l}`),AI("Auth",!0)):Jse()}function IB(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Qse(n){const e=IB(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const s=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const i=r[1];return{host:i,port:sL(s.substr(i.length+1))}}else{const[i,o]=s.split(":");return{host:i,port:sL(o)}}}function sL(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Jse(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iN{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Va("not implemented")}_getIdTokenResponse(e){return Va("not implemented")}_linkToIdToken(e,t){return Va("not implemented")}_getReauthenticationResolver(e){return Va("not implemented")}}async function Zse(n,e){return rl(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ere(n,e){return py(n,"POST","/v1/accounts:signInWithPassword",sl(n,e))}async function tre(n,e){return rl(n,"POST","/v1/accounts:sendOobCode",sl(n,e))}async function nre(n,e){return tre(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sre(n,e){return py(n,"POST","/v1/accounts:signInWithEmailLink",sl(n,e))}async function rre(n,e){return py(n,"POST","/v1/accounts:signInWithEmailLink",sl(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg extends iN{constructor(e,t,s,r=null){super("password",s),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Pg(e,t,"password")}static _fromEmailAndCode(e,t,s=null){return new Pg(e,t,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return DE(e,t,"signInWithPassword",ere);case"emailLink":return sre(e,{email:this._email,oobCode:this._password});default:$i(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const s={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return DE(e,s,"signUpPassword",Zse);case"emailLink":return rre(e,{idToken:t,email:this._email,oobCode:this._password});default:$i(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uf(n,e){return py(n,"POST","/v1/accounts:signInWithIdp",sl(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ire="http://localhost";class rh extends iN{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new rh(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):$i("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:r,...i}=t;if(!s||!r)return null;const o=new rh(s,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return uf(e,t)}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,uf(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,uf(e,t)}buildRequest(){const e={requestUri:ire,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=zf(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ore(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function are(n){const e=Pm(Mm(n)).link,t=e?Pm(Mm(e)).deep_link_id:null,s=Pm(Mm(n)).deep_link_id;return(s?Pm(Mm(s)).link:null)||s||t||e||n}class oN{constructor(e){const t=Pm(Mm(e)),s=t.apiKey??null,r=t.oobCode??null,i=ore(t.mode??null);et(s&&r&&i,"argument-error"),this.apiKey=s,this.operation=i,this.code=r,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=are(e);try{return new oN(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qf{constructor(){this.providerId=Qf.PROVIDER_ID}static credential(e,t){return Pg._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const s=oN.parseLink(t);return et(s,"argument-error"),Pg._fromEmailAndCode(e,s.code,s.tenantId)}}Qf.PROVIDER_ID="password";Qf.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Qf.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aN{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class my extends aN{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gl extends my{constructor(){super("facebook.com")}static credential(e){return rh._fromParams({providerId:Gl.PROVIDER_ID,signInMethod:Gl.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Gl.credentialFromTaggedObject(e)}static credentialFromError(e){return Gl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Gl.credential(e.oauthAccessToken)}catch{return null}}}Gl.FACEBOOK_SIGN_IN_METHOD="facebook.com";Gl.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ma extends my{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return rh._fromParams({providerId:Ma.PROVIDER_ID,signInMethod:Ma.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ma.credentialFromTaggedObject(e)}static credentialFromError(e){return Ma.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return Ma.credential(t,s)}catch{return null}}}Ma.GOOGLE_SIGN_IN_METHOD="google.com";Ma.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hl extends my{constructor(){super("github.com")}static credential(e){return rh._fromParams({providerId:Hl.PROVIDER_ID,signInMethod:Hl.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Hl.credentialFromTaggedObject(e)}static credentialFromError(e){return Hl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Hl.credential(e.oauthAccessToken)}catch{return null}}}Hl.GITHUB_SIGN_IN_METHOD="github.com";Hl.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ql extends my{constructor(){super("twitter.com")}static credential(e,t){return rh._fromParams({providerId:ql.PROVIDER_ID,signInMethod:ql.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ql.credentialFromTaggedObject(e)}static credentialFromError(e){return ql.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return ql.credential(t,s)}catch{return null}}}ql.TWITTER_SIGN_IN_METHOD="twitter.com";ql.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lre(n,e){return py(n,"POST","/v1/accounts:signUp",sl(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ih{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,s,r=!1){const i=await Ji._fromIdTokenResponse(e,s,r),o=rL(s);return new ih({user:i,providerId:o,_tokenResponse:s,operationType:t})}static async _forOperation(e,t,s){await e._updateTokensIfNecessary(s,!0);const r=rL(s);return new ih({user:e,providerId:r,_tokenResponse:s,operationType:t})}}function rL(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lv extends nl{constructor(e,t,s,r){super(t.code,t.message),this.operationType=s,this.user=r,Object.setPrototypeOf(this,Lv.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,r){return new Lv(e,t,s,r)}}function kB(n,e,t,s){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Lv._fromErrorAndOperation(n,i,e,s):i})}async function cre(n,e,t=!1){const s=await Og(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return ih._forOperation(n,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ure(n,e,t=!1){const{auth:s}=n;if(Fr(s.app))return Promise.reject(Wa(s));const r="reauthenticate";try{const i=await Og(n,kB(s,r,e,n),t);et(i.idToken,s,"internal-error");const o=sN(i.idToken);et(o,s,"internal-error");const{sub:a}=o;return et(n.uid===a,s,"user-mismatch"),ih._forOperation(n,r,i)}catch(i){throw i?.code==="auth/user-not-found"&&$i(s,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NB(n,e,t=!1){if(Fr(n.app))return Promise.reject(Wa(n));const s="signIn",r=await kB(n,s,e),i=await ih._fromIdTokenResponse(n,s,r);return t||await n._updateCurrentUser(i.user),i}async function hre(n,e){return NB(Dc(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AB(n){const e=Dc(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function dre(n,e,t){if(Fr(n.app))return Promise.reject(Wa(n));const s=Dc(n),o=await DE(s,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",lre).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&AB(n),l}),a=await ih._fromIdTokenResponse(s,"signIn",o);return await s._updateCurrentUser(a.user),a}function fre(n,e,t){return Fr(n.app)?Promise.reject(Wa(n)):hre(kn(n),Qf.credential(e,t)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&AB(n),s})}async function pre(n,e){const t=kn(n),r={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:i}=await nre(t.auth,r);i!==n.email&&await n.reload()}function mre(n,e,t,s){return kn(n).onIdTokenChanged(e,t,s)}function gre(n,e,t){return kn(n).beforeAuthStateChanged(e,t)}function yre(n,e,t,s){return kn(n).onAuthStateChanged(e,t,s)}function bre(n){return kn(n).signOut()}const Fv="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RB{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Fv,"1"),this.storage.removeItem(Fv),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xre=1e3,vre=10;class $B extends RB{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=SB(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),r=this.localCache[t];s!==r&&e(t,r,s)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const s=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const o=this.storage.getItem(s);!t&&this.localCache[s]===o||this.notifyListeners(s,o)},i=this.storage.getItem(s);Ose()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,vre):r()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},xre)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}$B.type="LOCAL";const wre=$B;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DB extends RB{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}DB.type="SESSION";const OB=DB;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _re(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e_{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const s=new e_(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:s,eventType:r,data:i}=t.data,o=this.handlersMap[r];if(!o?.size)return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:r});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await _re(a);t.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}e_.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lN(n="",e=10){let t="";for(let s=0;s<e;s++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sre{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,s=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=lN("",20);r.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},s);o={messageChannel:r,onMessage(f){const m=f;if(m.data.eventId===u)switch(m.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(m.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bo(){return window}function Cre(n){Bo().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PB(){return typeof Bo().WorkerGlobalScope<"u"&&typeof Bo().importScripts=="function"}async function Tre(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Ere(){return navigator?.serviceWorker?.controller||null}function Ire(){return PB()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MB="firebaseLocalStorageDb",kre=1,Vv="firebaseLocalStorage",LB="fbase_key";class gy{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function t_(n,e){return n.transaction([Vv],e?"readwrite":"readonly").objectStore(Vv)}function Nre(){const n=indexedDB.deleteDatabase(MB);return new gy(n).toPromise()}function OE(){const n=indexedDB.open(MB,kre);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(Vv,{keyPath:LB})}catch(r){t(r)}}),n.addEventListener("success",async()=>{const s=n.result;s.objectStoreNames.contains(Vv)?e(s):(s.close(),await Nre(),e(await OE()))})})}async function iL(n,e,t){const s=t_(n,!0).put({[LB]:e,value:t});return new gy(s).toPromise()}async function Are(n,e){const t=t_(n,!1).get(e),s=await new gy(t).toPromise();return s===void 0?null:s.value}function oL(n,e){const t=t_(n,!0).delete(e);return new gy(t).toPromise()}const Rre=800,$re=3;class FB{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await OE(),this.db)}async _withRetries(e){let t=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(t++>$re)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return PB()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=e_._getInstance(Ire()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await Tre(),!this.activeServiceWorker)return;this.sender=new Sre(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Ere()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await OE();return await iL(e,Fv,"1"),await oL(e,Fv),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(s=>iL(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(s=>Are(s,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>oL(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const i=t_(r,!1).getAll();return new gy(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],s=new Set;if(e.length!==0)for(const{fbase_key:r,value:i}of e)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Rre)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}FB.type="LOCAL";const Dre=FB;new fy(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VB(n,e){return e?Ua(e):(et(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cN extends iN{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return uf(e,this._buildIdpRequest())}_linkToIdToken(e,t){return uf(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return uf(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Ore(n){return NB(n.auth,new cN(n),n.bypassAuthState)}function Pre(n){const{auth:e,user:t}=n;return et(t,e,"internal-error"),ure(t,new cN(n),n.bypassAuthState)}async function Mre(n){const{auth:e,user:t}=n;return et(t,e,"internal-error"),cre(t,new cN(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UB{constructor(e,t,s,r,i=!1){this.auth=e,this.resolver=s,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:s,postBody:r,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:s,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Ore;case"linkViaPopup":case"linkViaRedirect":return Mre;case"reauthViaPopup":case"reauthViaRedirect":return Pre;default:$i(this.auth,"internal-error")}}resolve(e){Qa(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Qa(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lre=new fy(2e3,1e4);async function BB(n,e,t){if(Fr(n.app))return Promise.reject(to(n,"operation-not-supported-in-this-environment"));const s=Dc(n);pse(n,e,aN);const r=VB(s,t);return new Vu(s,"signInViaPopup",e,r).executeNotNull()}class Vu extends UB{constructor(e,t,s,r,i){super(e,t,r,i),this.provider=s,this.authWindow=null,this.pollId=null,Vu.currentPopupAction&&Vu.currentPopupAction.cancel(),Vu.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return et(e,this.auth,"internal-error"),e}async onExecution(){Qa(this.filter.length===1,"Popup operations only handle one event");const e=lN();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(to(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(to(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Vu.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(to(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Lre.get())};e()}}Vu.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fre="pendingRedirect",Wx=new Map;class Vre extends UB{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}async execute(){let e=Wx.get(this.auth._key());if(!e){try{const s=await Ure(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(t){e=()=>Promise.reject(t)}Wx.set(this.auth._key(),e)}return this.bypassAuthState||Wx.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Ure(n,e){const t=jre(e),s=zre(n);if(!await s._isAvailable())return!1;const r=await s._get(t)==="true";return await s._remove(t),r}function Bre(n,e){Wx.set(n._key(),e)}function zre(n){return Ua(n._redirectPersistence)}function jre(n){return jx(Fre,n.config.apiKey,n.name)}async function Wre(n,e,t=!1){if(Fr(n.app))return Promise.reject(Wa(n));const s=Dc(n),r=VB(s,e),o=await new Vre(s,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gre=600*1e3;class Hre{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!qre(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!zB(e)){const s=e.error.code?.split("auth/")[1]||"internal-error";t.onError(to(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Gre&&this.cachedEventUids.clear(),this.cachedEventUids.has(aL(e))}saveEventToCache(e){this.cachedEventUids.add(aL(e)),this.lastProcessedEventTime=Date.now()}}function aL(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function zB({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function qre(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return zB(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kre(n,e={}){return rl(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xre=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Yre=/^https?/;async function Qre(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Kre(n);for(const t of e)try{if(Jre(t))return}catch{}$i(n,"unauthorized-domain")}function Jre(n){const e=RE(),{protocol:t,hostname:s}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&s===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===s}if(!Yre.test(t))return!1;if(Xre.test(n))return s===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zre=new fy(3e4,6e4);function lL(){const n=Bo().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function eie(n){return new Promise((e,t)=>{function s(){lL(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{lL(),t(to(n,"network-request-failed"))},timeout:Zre.get()})}if(Bo().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Bo().gapi?.load)s();else{const r=jse("iframefcb");return Bo()[r]=()=>{gapi.load?s():t(to(n,"network-request-failed"))},TB(`${zse()}?onload=${r}`).catch(i=>t(i))}}).catch(e=>{throw Gx=null,e})}let Gx=null;function tie(n){return Gx=Gx||eie(n),Gx}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nie=new fy(5e3,15e3),sie="__/auth/iframe",rie="emulator/auth/iframe",iie={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},oie=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function aie(n){const e=n.config;et(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?nN(e,rie):`https://${n.config.authDomain}/${sie}`,s={apiKey:e.apiKey,appName:n.name,v:Sh},r=oie.get(n.config.apiHost);r&&(s.eid=r);const i=n._getFrameworks();return i.length&&(s.fw=i.join(",")),`${t}?${zf(s).slice(1)}`}async function lie(n){const e=await tie(n),t=Bo().gapi;return et(t,n,"internal-error"),e.open({where:document.body,url:aie(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:iie,dontclear:!0},s=>new Promise(async(r,i)=>{await s.restyle({setHideOnLeave:!1});const o=to(n,"network-request-failed"),a=Bo().setTimeout(()=>{i(o)},nie.get());function l(){Bo().clearTimeout(a),r(s)}s.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cie={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},uie=500,hie=600,die="_blank",fie="http://localhost";class cL{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function pie(n,e,t,s=uie,r=hie){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const l={...cie,width:s.toString(),height:r.toString(),top:i,left:o},u=mr().toLowerCase();t&&(a=bB(u)?die:t),gB(u)&&(e=e||fie,l.scrollbars="yes");const d=Object.entries(l).reduce((m,[y,b])=>`${m}${y}=${b},`,"");if(Dse(u)&&a!=="_self")return mie(e||"",a),new cL(null);const f=window.open(e||"",a,d);et(f,n,"popup-blocked");try{f.focus()}catch{}return new cL(f)}function mie(n,e){const t=document.createElement("a");t.href=n,t.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gie="__/auth/handler",yie="emulator/auth/handler",bie=encodeURIComponent("fac");async function uL(n,e,t,s,r,i){et(n.config.authDomain,n,"auth-domain-config-required"),et(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:s,v:Sh,eventId:r};if(e instanceof aN){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",GT(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,f]of Object.entries({}))o[d]=f}if(e instanceof my){const d=e.getScopes().filter(f=>f!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const l=await n._getAppCheckToken(),u=l?`#${bie}=${encodeURIComponent(l)}`:"";return`${xie(n)}?${zf(a).slice(1)}${u}`}function xie({config:n}){return n.emulator?nN(n,yie):`https://${n.authDomain}/${gie}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hT="webStorageSupport";class vie{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=OB,this._completeRedirectFn=Wre,this._overrideRedirectResult=Bre}async _openPopup(e,t,s,r){Qa(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const i=await uL(e,t,s,RE(),r);return pie(e,i,lN())}async _openRedirect(e,t,s,r){await this._originValidation(e);const i=await uL(e,t,s,RE(),r);return Cre(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:i}=this.eventManagers[t];return r?Promise.resolve(r):(Qa(i,"If manager is not set, promise should be"),i)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){const t=await lie(e),s=new Hre(e);return t.register("authEvent",r=>(et(r?.authEvent,e,"invalid-auth-event"),{status:s.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(hT,{type:hT},r=>{const i=r?.[0]?.[hT];i!==void 0&&t(!!i),$i(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Qre(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return SB()||yB()||rN()}}const wie=vie;var hL="@firebase/auth",dL="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _ie{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(s=>{e(s?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){et(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sie(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Cie(n){Qu(new uc("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=s.options;et(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:CB(n)},u=new Vse(s,r,i,l);return Xse(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),Qu(new uc("auth-internal",e=>{const t=Dc(e.getProvider("auth").getImmediate());return(s=>new _ie(s))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Po(hL,dL,Sie(n)),Po(hL,dL,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tie=300,Eie=p4("authIdTokenMaxAge")||Tie;let fL=null;const Iie=n=>async e=>{const t=e&&await e.getIdTokenResult(),s=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>Eie)return;const r=t?.token;fL!==r&&(fL=r,await fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function kie(n=OI()){const e=kw(n,"auth");if(e.isInitialized())return e.getImmediate();const t=Kse(n,{popupRedirectResolver:wie,persistence:[Dre,wre,OB]}),s=p4("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(s,location.origin);if(location.origin===i.origin){const o=Iie(i.toString());gre(t,o,()=>o(t.currentUser)),mre(t,a=>o(a))}}const r=h4("auth");return r&&Yse(t,`http://${r}`),t}function Nie(){return document.getElementsByTagName("head")?.[0]??document}Use({loadJS(n){return new Promise((e,t)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=e,s.onerror=r=>{const i=to("internal-error");i.customData=r,t(i)},s.type="text/javascript",s.charset="UTF-8",Nie().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Cie("Browser");/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Aie(n,e,t,s){function r(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(d){try{u(s.next(d))}catch(f){o(f)}}function l(d){try{u(s.throw(d))}catch(f){o(f)}}function u(d){d.done?i(d.value):r(d.value).then(a,l)}u((s=s.apply(n,[])).next())})}function Rie(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},s,r,i,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(d){return l([u,d])}}function l(u){if(s)throw new TypeError("Generator is already executing.");for(;t;)try{if(s=1,r&&(i=u[0]&2?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,r=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){t.label=u[1];break}if(u[0]===6&&t.label<i[1]){t.label=i[1],i=u;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(u);break}i[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(n,t)}catch(d){u=[6,d],r=0}finally{s=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var tf=function(){return tf=Object.assign||function(e){for(var t,s=1,r=arguments.length;s<r;s++){t=arguments[s];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},tf.apply(this,arguments)},jB=function(n){return{loading:n==null,value:n}},$ie=function(){return function(n,e){switch(e.type){case"error":return tf(tf({},n),{error:e.error,loading:!1,value:void 0});case"reset":return jB(e.defaultValue);case"value":return tf(tf({},n),{error:void 0,loading:!1,value:e.value});default:return n}}},Die=function(n){var e=n?n():void 0,t=te.useReducer($ie(),jB(e)),s=t[0],r=t[1],i=te.useCallback(function(){var l=n?n():void 0;r({type:"reset",defaultValue:l})},[n]),o=te.useCallback(function(l){r({type:"error",error:l})},[]),a=te.useCallback(function(l){r({type:"value",value:l})},[]);return te.useMemo(function(){return{error:s.error,loading:s.loading,reset:i,setError:o,setValue:a,value:s.value}},[s.error,s.loading,i,o,a,s.value])},yy=function(n,e){var t=Die(function(){return n.currentUser}),s=t.error,r=t.loading,i=t.setError,o=t.setValue,a=t.value;return te.useEffect(function(){var l=yre(n,function(u){return Aie(void 0,void 0,void 0,function(){var d;return Rie(this,function(f){switch(f.label){case 0:return[3,4];case 1:return f.trys.push([1,3,,4]),[4,e.onUserChanged(u)];case 2:return f.sent(),[3,4];case 3:return d=f.sent(),i(d),[3,4];case 4:return o(u),[2]}})})},i);return function(){l()}},[n]),[a,r,s]},Oie="firebase",Pie="12.0.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Po(Oie,Pie,"app");const Mie={apiKey:"AIzaSyArw4hta6dNfJRp48bY5Z2b47ag_R5G-mI",authDomain:"studi-2e08c.firebaseapp.com",projectId:"studi-2e08c",storageBucket:"studi-2e08c.firebasestorage.app",messagingSenderId:"414723164531",appId:"1:414723164531:web:9c553047baef7d1b681d06",measurementId:"G-FNRLSJDHG8",databaseURL:"https://studi-2e08c-default-rtdb.firebaseio.com"},uN=v4(Mie),Di=kie(uN),WB=new Ma,Kl=DZ(uN),qu=cse(uN);var GB={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},pL=zu.createContext&&zu.createContext(GB),Lie=["attr","size","title"];function Fie(n,e){if(n==null)return{};var t=Vie(n,e),s,r;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(r=0;r<i.length;r++)s=i[r],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(n,s)&&(t[s]=n[s])}return t}function Vie(n,e){if(n==null)return{};var t={};for(var s in n)if(Object.prototype.hasOwnProperty.call(n,s)){if(e.indexOf(s)>=0)continue;t[s]=n[s]}return t}function Uv(){return Uv=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},Uv.apply(this,arguments)}function mL(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,s)}return t}function Bv(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?mL(Object(t),!0).forEach(function(s){Uie(n,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):mL(Object(t)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))})}return n}function Uie(n,e,t){return e=Bie(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Bie(n){var e=zie(n,"string");return typeof e=="symbol"?e:e+""}function zie(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var s=t.call(n,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function HB(n){return n&&n.map((e,t)=>zu.createElement(e.tag,Bv({key:t},e.attr),HB(e.child)))}function qt(n){return e=>zu.createElement(jie,Uv({attr:Bv({},n.attr)},e),HB(n.child))}function jie(n){var e=t=>{var{attr:s,size:r,title:i}=n,o=Fie(n,Lie),a=r||t.size||"1em",l;return t.className&&(l=t.className),n.className&&(l=(l?l+" ":"")+n.className),zu.createElement("svg",Uv({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,s,o,{className:l,style:Bv(Bv({color:n.color||t.color},t.style),n.style),height:a,width:a,xmlns:"http://www.w3.org/2000/svg"}),i&&zu.createElement("title",null,i),n.children)};return pL!==void 0?zu.createElement(pL.Consumer,null,t=>e(t)):e(GB)}function Wie(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"22 12 18 12 15 21 9 3 6 12 2 12"},child:[]}]})(n)}function n_(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"19",y1:"12",x2:"5",y2:"12"},child:[]},{tag:"polyline",attr:{points:"12 19 5 12 12 5"},child:[]}]})(n)}function ag(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"},child:[]},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"},child:[]}]})(n)}function qB(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"18",y1:"20",x2:"18",y2:"10"},child:[]},{tag:"line",attr:{x1:"12",y1:"20",x2:"12",y2:"4"},child:[]},{tag:"line",attr:{x1:"6",y1:"20",x2:"6",y2:"14"},child:[]}]})(n)}function Gie(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"},child:[]},{tag:"path",attr:{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"},child:[]}]})(n)}function lg(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"},child:[]},{tag:"path",attr:{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"},child:[]}]})(n)}function Hie(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"},child:[]}]})(n)}function qie(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},child:[]},{tag:"polyline",attr:{points:"22 4 12 14.01 9 11.01"},child:[]}]})(n)}function gx(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"20 6 9 17 4 12"},child:[]}]})(n)}function hN(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"},child:[]},{tag:"polyline",attr:{points:"12 6 12 12 16 14"},child:[]}]})(n)}function Kie(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"},child:[]},{tag:"circle",attr:{cx:"12",cy:"12",r:"3"},child:[]}]})(n)}function Xie(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"},child:[]},{tag:"polyline",attr:{points:"14 2 14 8 20 8"},child:[]},{tag:"line",attr:{x1:"16",y1:"13",x2:"8",y2:"13"},child:[]},{tag:"line",attr:{x1:"16",y1:"17",x2:"8",y2:"17"},child:[]},{tag:"polyline",attr:{points:"10 9 9 9 8 9"},child:[]}]})(n)}function KB(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"},child:[]},{tag:"line",attr:{x1:"2",y1:"12",x2:"22",y2:"12"},child:[]},{tag:"path",attr:{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"},child:[]}]})(n)}function zv(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"},child:[]},{tag:"path",attr:{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"},child:[]},{tag:"line",attr:{x1:"12",y1:"17",x2:"12.01",y2:"17"},child:[]}]})(n)}function dN(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"},child:[]},{tag:"path",attr:{d:"M7 11V7a5 5 0 0 1 10 0v4"},child:[]}]})(n)}function Yie(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"},child:[]},{tag:"polyline",attr:{points:"10 17 15 12 10 7"},child:[]},{tag:"line",attr:{x1:"15",y1:"12",x2:"3",y2:"12"},child:[]}]})(n)}function fN(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"},child:[]},{tag:"polyline",attr:{points:"16 17 21 12 16 7"},child:[]},{tag:"line",attr:{x1:"21",y1:"12",x2:"9",y2:"12"},child:[]}]})(n)}function pN(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"},child:[]},{tag:"polyline",attr:{points:"22,6 12,13 2,6"},child:[]}]})(n)}function cg(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"},child:[]}]})(n)}function Qie(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"},child:[]}]})(n)}function Jie(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"},child:[]},{tag:"polyline",attr:{points:"17 21 17 13 7 13 7 21"},child:[]},{tag:"polyline",attr:{points:"7 3 7 8 15 8"},child:[]}]})(n)}function Zie(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"11",cy:"11",r:"8"},child:[]},{tag:"line",attr:{x1:"21",y1:"21",x2:"16.65",y2:"16.65"},child:[]}]})(n)}function XB(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"},child:[]},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"},child:[]}]})(n)}function eoe(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"},child:[]}]})(n)}function toe(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"5"},child:[]},{tag:"line",attr:{x1:"12",y1:"1",x2:"12",y2:"3"},child:[]},{tag:"line",attr:{x1:"12",y1:"21",x2:"12",y2:"23"},child:[]},{tag:"line",attr:{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"},child:[]},{tag:"line",attr:{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"},child:[]},{tag:"line",attr:{x1:"1",y1:"12",x2:"3",y2:"12"},child:[]},{tag:"line",attr:{x1:"21",y1:"12",x2:"23",y2:"12"},child:[]},{tag:"line",attr:{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"},child:[]},{tag:"line",attr:{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"},child:[]}]})(n)}function noe(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"23 6 13.5 15.5 8.5 10.5 1 18"},child:[]},{tag:"polyline",attr:{points:"17 6 23 6 23 12"},child:[]}]})(n)}function s_(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"},child:[]},{tag:"circle",attr:{cx:"12",cy:"7",r:"4"},child:[]}]})(n)}function YB(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"},child:[]},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"},child:[]},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"},child:[]},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"},child:[]}]})(n)}function soe(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"1",y1:"1",x2:"23",y2:"23"},child:[]},{tag:"path",attr:{d:"M16.72 11.06A10.94 10.94 0 0 1 19 12.55"},child:[]},{tag:"path",attr:{d:"M5 12.55a10.94 10.94 0 0 1 5.17-2.39"},child:[]},{tag:"path",attr:{d:"M10.71 5.05A16 16 0 0 1 22.58 9"},child:[]},{tag:"path",attr:{d:"M1.42 9a15.91 15.91 0 0 1 4.7-2.88"},child:[]},{tag:"path",attr:{d:"M8.53 16.11a6 6 0 0 1 6.95 0"},child:[]},{tag:"line",attr:{x1:"12",y1:"20",x2:"12.01",y2:"20"},child:[]}]})(n)}function roe(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M5 12.55a11 11 0 0 1 14.08 0"},child:[]},{tag:"path",attr:{d:"M1.42 9a16 16 0 0 1 21.16 0"},child:[]},{tag:"path",attr:{d:"M8.53 16.11a6 6 0 0 1 6.95 0"},child:[]},{tag:"line",attr:{x1:"12",y1:"20",x2:"12.01",y2:"20"},child:[]}]})(n)}function yx(n){return qt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"18",y1:"6",x2:"6",y2:"18"},child:[]},{tag:"line",attr:{x1:"6",y1:"6",x2:"18",y2:"18"},child:[]}]})(n)}function gL({question:n}){const[e]=yy(Di),t=async s=>{if(!e)return;const r=WV(Kl,"questions",n.id);if(await KZ(r,{votes:fM(s==="up"?1:-1)}),s==="up"){const i=Hu(qu,`users/${e.uid}/points`);await NE(i,{points:fM(1)})}};return E.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-teal-200 hover:shadow-md transition-all",children:E.jsxs("div",{className:"flex items-start",children:[E.jsxs("div",{className:"flex flex-col items-center mr-4",children:[E.jsx("button",{onClick:()=>t("up"),className:"text-gray-400 hover:text-teal-600",disabled:!e,children:E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),E.jsx("span",{className:"font-medium text-gray-800 my-1",children:n.votes}),E.jsx("button",{onClick:()=>t("down"),className:"text-gray-400 hover:text-teal-600",disabled:!e,children:E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),E.jsxs("div",{className:"flex-1",children:[E.jsx(nn,{to:`/question/${n.id}`,className:"text-lg font-medium text-gray-800 hover:text-teal-600",children:n.title}),E.jsxs("div",{className:"flex items-center mt-2 space-x-4",children:[E.jsx("span",{className:"text-xs px-2 py-1 bg-gray-100 rounded-full capitalize",children:n.subject}),E.jsxs("span",{className:"text-xs text-gray-500",children:[n.answers||0," ",n.answers===1?"answer":"answers"]}),n.answered&&E.jsxs("span",{className:"text-xs flex items-center text-green-600",children:[E.jsx(qie,{className:"mr-1"})," Answered"]})]}),E.jsxs("div",{className:"mt-3 flex justify-between items-center",children:[E.jsxs("div",{className:"flex items-center",children:[E.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-300 mr-2 flex items-center justify-center",children:n.userDisplayName?.charAt(0)||"A"}),E.jsx("span",{className:"text-sm text-gray-600",children:n.userDisplayName})]}),E.jsxs(nn,{to:`/question/${n.id}`,className:"text-sm text-teal-600 hover:text-teal-800 flex items-center",children:[E.jsx(cg,{className:"mr-1"})," Answer"]})]})]})]})})}function ioe(){const[n]=yy(Di),e=Ec(),{darkMode:t}=_I(),[s,r]=te.useState([]),[i,o]=te.useState([]),[a,l]=te.useState([]),[u,d]=te.useState([]),[f,m]=te.useState(null),[y,b]=te.useState([]),[w,v]=te.useState(""),[S,T]=te.useState(""),[I,k]=te.useState("all"),[O,V]=te.useState(!1);te.useEffect(()=>{const R=Jd($u(Kl,"questions"),cM("createdAt","desc"),uM(50)),A=Zd(R,U=>{const F=U.docs.map(ne=>({id:ne.id,...ne.data()}));r(F)});return()=>A()},[]),te.useEffect(()=>{const R=Jd($u(Kl,"questions"),cM("votes","desc"),uM(5)),A=Zd(R,U=>{o(U.docs.map(F=>({id:F.id,...F.data()})))});return()=>A()},[]),te.useEffect(()=>{if(n){const R=Hu(qu,`users/${n.uid}`);Dv(R,U=>{const F=U.val();if(m(F),F?.recentlyViewed){const ne=Object.keys(F.recentlyViewed),Q=Jd($u(Kl,"questions"),xv("id","in",ne));Zd(Q,G=>{l(G.docs.map(K=>({id:K.id,...K.data()})))})}if(F?.bookmarks){const ne=Object.keys(F.bookmarks),Q=Jd($u(Kl,"questions"),xv("id","in",ne));Zd(Q,G=>{d(G.docs.map(K=>({id:K.id,...K.data()})))})}});const A=Hu(qu,"users");Dv(A,U=>{const F=U.val();if(F){const ne=Object.entries(F).map(([Q,G])=>({id:Q,...G})).sort((Q,G)=>(G.points||0)-(Q.points||0)).slice(0,5);b(ne)}})}},[n]);const P=async R=>{R.preventDefault(),S.trim()&&(await XZ($u(Kl,"questions"),{title:S,subject:I,userId:n?.uid,userDisplayName:n?.displayName||"Anonymous",votes:0,answers:0,views:0,createdAt:QZ(),answered:!1,difficulty:"medium"}),T(""))},D=async()=>{try{await bre(Di),e("/login")}catch(R){console.error("Logout error:",R)}},$=s.filter(R=>(I==="all"||R.subject===I)&&R.title.toLowerCase().includes(w.toLowerCase()));return E.jsxs("div",{className:`min-h-screen transition-colors duration-300 ${t?"dark bg-gray-900":"bg-gray-50"}`,children:[E.jsx("header",{className:`sticky top-0 z-10 backdrop-blur-md ${t?"bg-black/80":"bg-white/80"} shadow-sm`,children:E.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[E.jsx(nn,{to:"/",className:"text-2xl font-bold bg-gradient-to-r from-teal-400 to-teal-600 bg-clip-text text-transparent",children:"StudiQ"}),E.jsxs("div",{className:"relative w-full max-w-xl mx-4",children:[E.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:E.jsx(Zie,{className:`${t?"text-gray-400":"text-gray-500"}`})}),E.jsx("input",{type:"text",placeholder:"Search for questions...",className:`block w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent ${t?"bg-gray-800 border-gray-700 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-800"}`,value:w,onChange:R=>v(R.target.value)})]}),E.jsx("nav",{className:"flex items-center space-x-4",children:n?E.jsxs("div",{className:"relative",children:[E.jsx("button",{onClick:()=>V(!O),className:"flex items-center space-x-2 focus:outline-none",children:E.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${t?"bg-teal-900 text-teal-300":"bg-teal-100 text-teal-800"}`,children:n.displayName?.charAt(0)||"U"})}),O&&E.jsxs("div",{className:`absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 z-20 ${t?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200"}`,children:[E.jsxs(nn,{to:"/profile",className:`block px-4 py-2 text-sm flex items-center ${t?"text-gray-200 hover:bg-gray-700":"text-gray-800 hover:bg-gray-100"}`,children:[E.jsx(s_,{className:"mr-2"})," Profile"]}),E.jsxs(nn,{to:"/settings",className:`block px-4 py-2 text-sm flex items-center ${t?"text-gray-200 hover:bg-gray-700":"text-gray-800 hover:bg-gray-100"}`,children:[E.jsx(XB,{className:"mr-2"})," Settings"]}),E.jsxs(nn,{to:"/help",className:`block px-4 py-2 text-sm flex items-center ${t?"text-gray-200 hover:bg-gray-700":"text-gray-800 hover:bg-gray-100"}`,children:[E.jsx(zv,{className:"mr-2"})," Help"]}),E.jsxs("button",{onClick:D,className:`w-full text-left px-4 py-2 text-sm flex items-center ${t?"text-red-400 hover:bg-gray-700":"text-red-600 hover:bg-gray-100"}`,children:[E.jsx(fN,{className:"mr-2"})," Sign out"]})]})]}):E.jsxs(E.Fragment,{children:[E.jsx(nn,{to:"/login",className:`px-4 py-2 rounded-lg ${t?"text-gray-300 hover:text-teal-400":"text-gray-700 hover:text-teal-600"}`,children:"Log in"}),E.jsx(nn,{to:"/signup",className:"bg-gradient-to-r from-teal-500 to-teal-600 text-white px-4 py-2 rounded-lg hover:from-teal-600 hover:to-teal-700 shadow-md",children:"Sign up"})]})})]})}),E.jsx("main",{className:"container mx-auto px-4 py-8",children:E.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[E.jsxs("div",{className:"w-full md:w-1/4 space-y-6",children:[E.jsxs("div",{className:`p-4 rounded-lg shadow-sm backdrop-blur-sm ${t?"bg-gray-800/70 border border-gray-700":"bg-white/80 border border-gray-200"}`,children:[E.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center",children:[E.jsx(Gie,{className:"mr-2 text-teal-500"}),E.jsx("span",{className:t?"text-gray-200":"text-gray-800",children:"Subjects"})]}),E.jsxs("ul",{className:"space-y-2",children:[E.jsx("li",{children:E.jsx("button",{onClick:()=>k("all"),className:`w-full text-left px-3 py-2 rounded transition-all ${I==="all"?"bg-teal-500/10 text-teal-500 border border-teal-500/30":t?"hover:bg-gray-700/50 text-gray-300":"hover:bg-gray-100 text-gray-700"}`,children:"All Subjects"})}),["math","science","history","english","coding"].map(R=>E.jsx("li",{children:E.jsx("button",{onClick:()=>k(R),className:`w-full text-left px-3 py-2 rounded transition-all ${I===R?"bg-teal-500/10 text-teal-500 border border-teal-500/30":t?"hover:bg-gray-700/50 text-gray-300":"hover:bg-gray-100 text-gray-700"}`,children:R.charAt(0).toUpperCase()+R.slice(1)})},R))]})]}),n&&E.jsxs(E.Fragment,{children:[E.jsxs("div",{className:`p-4 rounded-lg shadow-sm backdrop-blur-sm ${t?"bg-gray-800/70 border border-gray-700":"bg-white/80 border border-gray-200"}`,children:[E.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center",children:[E.jsx(Wie,{className:"mr-2 text-teal-500"}),E.jsx("span",{className:t?"text-gray-200":"text-gray-800",children:"Your Stats"})]}),E.jsxs("div",{className:"space-y-3",children:[E.jsxs("div",{className:"flex justify-between items-center",children:[E.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Points"}),E.jsx("span",{className:`font-medium ${t?"text-teal-400":"text-teal-600"}`,children:f?.points||0})]}),E.jsxs("div",{className:"flex justify-between items-center",children:[E.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Questions"}),E.jsx("span",{className:`font-medium ${t?"text-teal-400":"text-teal-600"}`,children:f?.questions||0})]}),E.jsxs("div",{className:"flex justify-between items-center",children:[E.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Answers"}),E.jsx("span",{className:`font-medium ${t?"text-teal-400":"text-teal-600"}`,children:f?.answers||0})]}),E.jsxs("div",{className:"flex justify-between items-center",children:[E.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Best Answers"}),E.jsx("span",{className:`font-medium ${t?"text-teal-400":"text-teal-600"}`,children:f?.bestAnswers||0})]})]})]}),a.length>0&&E.jsxs("div",{className:`p-4 rounded-lg shadow-sm backdrop-blur-sm ${t?"bg-gray-800/70 border border-gray-700":"bg-white/80 border border-gray-200"}`,children:[E.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center",children:[E.jsx(hN,{className:"mr-2 text-teal-500"}),E.jsx("span",{className:t?"text-gray-200":"text-gray-800",children:"Recently Viewed"})]}),E.jsx("div",{className:"space-y-3",children:a.slice(0,3).map(R=>E.jsx(nn,{to:`/question/${R.id}`,className:`block truncate text-sm ${t?"text-gray-300 hover:text-teal-400":"text-gray-700 hover:text-teal-600"}`,children:R.title},R.id))})]}),u.length>0&&E.jsxs("div",{className:`p-4 rounded-lg shadow-sm backdrop-blur-sm ${t?"bg-gray-800/70 border border-gray-700":"bg-white/80 border border-gray-200"}`,children:[E.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center",children:[E.jsx(Hie,{className:"mr-2 text-teal-500"}),E.jsx("span",{className:t?"text-gray-200":"text-gray-800",children:"Your Bookmarks"})]}),E.jsx("div",{className:"space-y-3",children:u.slice(0,3).map(R=>E.jsx(nn,{to:`/question/${R.id}`,className:`block truncate text-sm ${t?"text-gray-300 hover:text-teal-400":"text-gray-700 hover:text-teal-600"}`,children:R.title},R.id))})]})]})]}),E.jsxs("div",{className:"w-full md:w-2/4 space-y-6",children:[n&&E.jsxs("div",{className:`p-6 rounded-lg shadow-sm backdrop-blur-sm ${t?"bg-gray-800/70 border border-gray-700":"bg-white/80 border border-gray-200"}`,children:[E.jsx("h2",{className:`text-xl font-semibold mb-4 ${t?"text-gray-200":"text-gray-800"}`,children:"Ask your question"}),E.jsxs("form",{onSubmit:P,children:[E.jsx("textarea",{placeholder:"What do you need help with? Be specific...",className:`w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent ${t?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-800"}`,rows:4,value:S,onChange:R=>T(R.target.value),required:!0}),E.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[E.jsxs("select",{value:I,onChange:R=>k(R.target.value),className:`px-3 py-1 rounded-full text-sm ${t?"bg-gray-700 text-gray-200 border-gray-600":"bg-gray-100 text-gray-700 border-gray-300"} border`,children:[E.jsx("option",{value:"math",children:"Math"}),E.jsx("option",{value:"science",children:"Science"}),E.jsx("option",{value:"history",children:"History"}),E.jsx("option",{value:"english",children:"English"}),E.jsx("option",{value:"coding",children:"Coding"})]}),E.jsx("button",{type:"submit",className:"bg-gradient-to-r from-teal-500 to-teal-600 text-white px-4 py-2 rounded-lg hover:from-teal-600 hover:to-teal-700 shadow-md",children:"Post Question"})]})]})]}),E.jsxs("div",{className:`p-6 rounded-lg shadow-sm backdrop-blur-sm ${t?"bg-gray-800/70 border border-gray-700":"bg-white/80 border border-gray-200"}`,children:[E.jsxs("div",{className:"flex items-center justify-between mb-6",children:[E.jsxs("h2",{className:`text-xl font-semibold flex items-center ${t?"text-gray-200":"text-gray-800"}`,children:[E.jsx(noe,{className:"mr-2 text-teal-500"}),"Trending Questions"]}),E.jsx(nn,{to:"/trending",className:`text-sm ${t?"text-teal-400 hover:text-teal-300":"text-teal-600 hover:text-teal-800"}`,children:"View all"})]}),E.jsx("div",{className:"space-y-4",children:i.map(R=>E.jsx(gL,{question:R,darkMode:t},R.id))})]}),E.jsxs("div",{className:`p-6 rounded-lg shadow-sm backdrop-blur-sm ${t?"bg-gray-800/70 border border-gray-700":"bg-white/80 border border-gray-200"}`,children:[E.jsxs("div",{className:"flex items-center justify-between mb-6",children:[E.jsx("h2",{className:`text-xl font-semibold ${t?"text-gray-200":"text-gray-800"}`,children:"Recent Questions"}),E.jsx(nn,{to:"/questions",className:`text-sm ${t?"text-teal-400 hover:text-teal-300":"text-teal-600 hover:text-teal-800"}`,children:"View all"})]}),E.jsx("div",{className:"space-y-4",children:$.slice(0,5).map(R=>E.jsx(gL,{question:R,darkMode:t},R.id))})]})]}),E.jsxs("div",{className:"w-full md:w-1/4 space-y-6",children:[E.jsxs("div",{className:`p-4 rounded-lg shadow-sm backdrop-blur-sm ${t?"bg-gray-800/70 border border-gray-700":"bg-white/80 border border-gray-200"}`,children:[E.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center",children:[E.jsx(YB,{className:"mr-2 text-teal-500"}),E.jsx("span",{className:t?"text-gray-200":"text-gray-800",children:"Top Contributors"})]}),E.jsx("div",{className:"space-y-3",children:y.map((R,A)=>E.jsxs("div",{className:"flex items-center",children:[E.jsxs("span",{className:`w-6 text-center mr-2 font-medium ${t?"text-gray-300":"text-gray-700"}`,children:[A+1,"."]}),E.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${t?"bg-teal-900 text-teal-300":"bg-teal-100 text-teal-800"}`,children:R.displayName?.charAt(0)||"E"}),E.jsxs("div",{className:"flex-1 ml-3",children:[E.jsx("div",{className:`font-medium ${t?"text-gray-200":"text-gray-800"}`,children:R.displayName||"Expert"}),E.jsxs("div",{className:`text-xs ${t?"text-gray-400":"text-gray-500"}`,children:[R.points||0," points"]})]})]},R.id))})]}),E.jsxs("div",{className:`p-4 rounded-lg shadow-sm backdrop-blur-sm ${t?"bg-gray-800/70 border border-gray-700":"bg-white/80 border border-gray-200"}`,children:[E.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center",children:[E.jsx(qB,{className:"mr-2 text-teal-500"}),E.jsx("span",{className:t?"text-gray-200":"text-gray-800",children:"Community Stats"})]}),E.jsxs("div",{className:"space-y-3",children:[E.jsxs("div",{className:"flex justify-between items-center",children:[E.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Total Questions"}),E.jsx("span",{className:`font-medium ${t?"text-teal-400":"text-teal-600"}`,children:s.length})]}),E.jsxs("div",{className:"flex justify-between items-center",children:[E.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Active Today"}),E.jsx("span",{className:`font-medium ${t?"text-teal-400":"text-teal-600"}`,children:s.filter(R=>{const A=new Date,U=R.createdAt.toDate();return U.getDate()===A.getDate()&&U.getMonth()===A.getMonth()&&U.getFullYear()===A.getFullYear()}).length})]}),E.jsxs("div",{className:"flex justify-between items-center",children:[E.jsx("span",{className:t?"text-gray-400":"text-gray-600",children:"Answered Rate"}),E.jsx("span",{className:`font-medium ${t?"text-teal-400":"text-teal-600"}`,children:s.length>0?`${Math.round(s.filter(R=>R.answered).length/s.length*100)}%`:"0%"})]})]})]}),E.jsxs("div",{className:`p-4 rounded-lg shadow-sm backdrop-blur-sm ${t?"bg-gray-800/70 border border-gray-700":"bg-white/80 border border-gray-200"}`,children:[E.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center",children:[E.jsx(eoe,{className:"mr-2 text-teal-500"}),E.jsx("span",{className:t?"text-gray-200":"text-gray-800",children:"Featured Questions"})]}),E.jsx("div",{className:"space-y-3",children:s.filter(R=>R.featured).slice(0,3).map(R=>E.jsx(nn,{to:`/question/${R.id}`,className:`block truncate text-sm ${t?"text-gray-300 hover:text-teal-400":"text-gray-700 hover:text-teal-600"}`,children:R.title},R.id))})]}),E.jsxs("div",{className:`p-4 rounded-lg shadow-sm backdrop-blur-sm ${t?"bg-gray-800/70 border border-gray-700":"bg-white/80 border border-gray-200"}`,children:[E.jsxs("h3",{className:"font-semibold text-lg mb-4 flex items-center",children:[E.jsx(Kie,{className:"mr-2 text-teal-500"}),E.jsx("span",{className:t?"text-gray-200":"text-gray-800",children:"Most Viewed"})]}),E.jsx("div",{className:"space-y-3",children:s.sort((R,A)=>(A.views||0)-(R.views||0)).slice(0,3).map(R=>E.jsxs(nn,{to:`/question/${R.id}`,className:`block truncate text-sm ${t?"text-gray-300 hover:text-teal-400":"text-gray-700 hover:text-teal-600"}`,children:[R.title," (",R.views||0," views)"]},R.id))})]})]})]})})]})}function ooe(){const[n,e]=te.useState(""),[t,s]=te.useState(""),[r,i]=te.useState(""),[o,a]=te.useState(!1),l=Ec(),u=async f=>{f.preventDefault(),a(!0),i("");try{await fre(Di,n,t),l("/")}catch(m){i(m.message)}finally{a(!1)}},d=async()=>{try{a(!0),await BB(Di,WB),l("/")}catch(f){i(f.message)}finally{a(!1)}};return E.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center p-4",children:E.jsxs("div",{className:"max-w-md w-full p-8 rounded-xl bg-white shadow-lg",children:[E.jsxs("div",{className:"flex items-center mb-8",children:[E.jsx(nn,{to:"/",className:"mr-4 text-gray-500 hover:text-teal-500",children:E.jsx(n_,{className:"w-5 h-5"})}),E.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-teal-400 to-blue-500 bg-clip-text text-transparent",children:"Welcome Back"})]}),r&&E.jsx("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg text-sm",children:r}),E.jsxs("form",{onSubmit:u,className:"space-y-6",children:[E.jsxs("div",{children:[E.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),E.jsxs("div",{className:"relative",children:[E.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:E.jsx(pN,{className:"h-5 w-5 text-gray-400"})}),E.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:n,onChange:f=>e(f.target.value),className:"bg-white border border-gray-300 focus:ring-teal-500 focus:border-teal-500 block w-full pl-10 pr-3 py-2 rounded-lg",placeholder:"your@email.com"})]})]}),E.jsxs("div",{children:[E.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),E.jsxs("div",{className:"relative",children:[E.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:E.jsx(dN,{className:"h-5 w-5 text-gray-400"})}),E.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:t,onChange:f=>s(f.target.value),className:"bg-white border border-gray-300 focus:ring-teal-500 focus:border-teal-500 block w-full pl-10 pr-3 py-2 rounded-lg",placeholder:""})]})]}),E.jsxs("div",{className:"flex items-center justify-between",children:[E.jsxs("div",{className:"flex items-center",children:[E.jsx("input",{id:"remember-me",name:"remember-me",type:"checkbox",className:"h-4 w-4 text-teal-600 focus:ring-teal-500 border-gray-300 rounded"}),E.jsx("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-700",children:"Remember me"})]}),E.jsx("div",{className:"text-sm",children:E.jsx(nn,{to:"/forgot-password",className:"font-medium text-teal-600 hover:text-teal-500",children:"Forgot password?"})})]}),E.jsx("div",{children:E.jsx("button",{type:"submit",disabled:o,className:`w-full flex justify-center items-center py-2 px-4 border border-transparent rounded-lg shadow-sm text-white bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 ${o?"opacity-70 cursor-not-allowed":""}`,children:o?E.jsxs(E.Fragment,{children:[E.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[E.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),E.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Signing in..."]}):E.jsxs(E.Fragment,{children:[E.jsx(Yie,{className:"w-5 h-5 mr-2"}),"Sign In"]})})})]}),E.jsxs("div",{className:"mt-6",children:[E.jsxs("div",{className:"relative",children:[E.jsx("div",{className:"absolute inset-0 flex items-center",children:E.jsx("div",{className:"w-full border-t border-gray-300"})}),E.jsx("div",{className:"relative flex justify-center text-sm",children:E.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),E.jsx("div",{className:"mt-6",children:E.jsxs("button",{onClick:d,disabled:o,className:"w-full flex justify-center items-center py-2 px-4 border border-gray-300 rounded-lg shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500",children:[E.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg",alt:"Google logo",className:"h-5 w-5 mr-2"}),"Google"]})})]}),E.jsxs("div",{className:"mt-6 text-center text-sm",children:[E.jsx("span",{className:"text-gray-600",children:"Don't have an account? "}),E.jsx(nn,{to:"/signup",className:"font-medium text-teal-600 hover:text-teal-500",children:"Sign up"})]})]})})}function aoe(){const[n,e]=te.useState(""),[t,s]=te.useState(""),[r,i]=te.useState(""),[o,a]=te.useState(""),[l,u]=te.useState(!1),d=Ec(),f=async y=>{y.preventDefault(),u(!0),a("");try{const b=await dre(Di,t,r);await pre(b.user),d("/verify-email")}catch(b){a(b.message)}finally{u(!1)}},m=async()=>{try{u(!0),await BB(Di,WB),d("/")}catch(y){a(y.message)}finally{u(!1)}};return E.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center p-4",children:E.jsxs("div",{className:"max-w-md w-full p-8 rounded-xl bg-white shadow-lg",children:[E.jsxs("div",{className:"flex items-center mb-8",children:[E.jsx(nn,{to:"/",className:"mr-4 text-gray-500 hover:text-teal-500",children:E.jsx(n_,{className:"w-5 h-5"})}),E.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-teal-400 to-blue-500 bg-clip-text text-transparent",children:"Create Account"})]}),o&&E.jsx("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg text-sm",children:o}),E.jsxs("form",{onSubmit:f,className:"space-y-6",children:[E.jsxs("div",{children:[E.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),E.jsxs("div",{className:"relative",children:[E.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:E.jsx(s_,{className:"h-5 w-5 text-gray-400"})}),E.jsx("input",{id:"name",name:"name",type:"text",autoComplete:"name",required:!0,value:n,onChange:y=>e(y.target.value),className:"bg-white border border-gray-300 focus:ring-teal-500 focus:border-teal-500 block w-full pl-10 pr-3 py-2 rounded-lg",placeholder:"Your Name"})]})]}),E.jsxs("div",{children:[E.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),E.jsxs("div",{className:"relative",children:[E.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:E.jsx(pN,{className:"h-5 w-5 text-gray-400"})}),E.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:t,onChange:y=>s(y.target.value),className:"bg-white border border-gray-300 focus:ring-teal-500 focus:border-teal-500 block w-full pl-10 pr-3 py-2 rounded-lg",placeholder:"your@email.com"})]})]}),E.jsxs("div",{children:[E.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),E.jsxs("div",{className:"relative",children:[E.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:E.jsx(dN,{className:"h-5 w-5 text-gray-400"})}),E.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"new-password",required:!0,minLength:6,value:r,onChange:y=>i(y.target.value),className:"bg-white border border-gray-300 focus:ring-teal-500 focus:border-teal-500 block w-full pl-10 pr-3 py-2 rounded-lg",placeholder:""})]}),E.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Minimum 6 characters"})]}),E.jsx("div",{children:E.jsx("button",{type:"submit",disabled:l,className:`w-full flex justify-center items-center py-2 px-4 border border-transparent rounded-lg shadow-sm text-white bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 ${l?"opacity-70 cursor-not-allowed":""}`,children:l?E.jsxs(E.Fragment,{children:[E.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[E.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),E.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating account..."]}):"Sign Up"})})]}),E.jsxs("div",{className:"mt-6",children:[E.jsxs("div",{className:"relative",children:[E.jsx("div",{className:"absolute inset-0 flex items-center",children:E.jsx("div",{className:"w-full border-t border-gray-300"})}),E.jsx("div",{className:"relative flex justify-center text-sm",children:E.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or sign up with"})})]}),E.jsx("div",{className:"mt-6",children:E.jsxs("button",{onClick:m,disabled:l,className:"w-full flex justify-center items-center py-2 px-4 border border-gray-300 rounded-lg shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500",children:[E.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg",alt:"Google logo",className:"h-5 w-5 mr-2"}),"Google"]})})]}),E.jsxs("div",{className:"mt-6 text-center text-sm",children:[E.jsx("span",{className:"text-gray-600",children:"Already have an account? "}),E.jsx(nn,{to:"/login",className:"font-medium text-teal-600 hover:text-teal-500",children:"Log in"})]})]})})}var dT={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var yL;function loe(){return yL||(yL=1,function(n){(function(){var e={}.hasOwnProperty;function t(){for(var i="",o=0;o<arguments.length;o++){var a=arguments[o];a&&(i=r(i,s(a)))}return i}function s(i){if(typeof i=="string"||typeof i=="number")return i;if(typeof i!="object")return"";if(Array.isArray(i))return t.apply(null,i);if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]"))return i.toString();var o="";for(var a in i)e.call(i,a)&&i[a]&&(o=r(o,a));return o}function r(i,o){return o?i?i+" "+o:i+o:i}n.exports?(t.default=t,n.exports=t):window.classNames=t})()}(dT)),dT.exports}var coe=loe();const mN=vw(coe),uoe=["xxl","xl","lg","md","sm","xs"],hoe="xs",QB=te.createContext({prefixes:{},breakpoints:uoe,minBreakpoint:hoe}),{Consumer:wOe,Provider:_Oe}=QB;function JB(n,e){const{prefixes:t}=te.useContext(QB);return n||t[e]||e}const ZB=te.forwardRef(({bsPrefix:n,bg:e="primary",pill:t=!1,text:s,className:r,as:i="span",...o},a)=>{const l=JB(n,"badge");return E.jsx(i,{ref:a,...o,className:mN(r,l,t&&"rounded-pill",s&&`text-${s}`,e&&`bg-${e}`)})});ZB.displayName="Badge";function doe(n,e){let t=0;return te.Children.map(n,s=>te.isValidElement(s)?e(s,t++):s)}const bL=1e3;function foe(n,e,t){const s=(n-e)/(t-e)*100;return Math.round(s*bL)/bL}function xL({min:n,now:e,max:t,label:s,visuallyHidden:r,striped:i,animated:o,className:a,style:l,variant:u,bsPrefix:d,...f},m){return E.jsx("div",{ref:m,...f,role:"progressbar",className:mN(a,`${d}-bar`,{[`bg-${u}`]:u,[`${d}-bar-animated`]:o,[`${d}-bar-striped`]:o||i}),style:{width:`${foe(e,n,t)}%`,...l},"aria-valuenow":e,"aria-valuemin":n,"aria-valuemax":t,children:r?E.jsx("span",{className:"visually-hidden",children:s}):s})}const Bm=te.forwardRef(({isChild:n=!1,...e},t)=>{const s={min:0,max:100,animated:!1,visuallyHidden:!1,striped:!1,...e};if(s.bsPrefix=JB(s.bsPrefix,"progress"),n)return xL(s,t);const{min:r,now:i,max:o,label:a,visuallyHidden:l,striped:u,animated:d,bsPrefix:f,variant:m,className:y,children:b,...w}=s;return E.jsx("div",{ref:t,...w,className:mN(y,f),children:b?doe(b,v=>te.cloneElement(v,{isChild:!0})):xL({min:r,now:i,max:o,label:a,visuallyHidden:l,striped:u,animated:d,bsPrefix:f,variant:m},t)})});Bm.displayName="ProgressBar";const poe=()=>{const[n,e]=te.useState(navigator.onLine),[t,s]=te.useState(n?"All data synced":"Offline - changes will sync when back online"),[r,i]=te.useState(!1),[o,a]=te.useState("progress"),[l,u]=te.useState({name:"Rahul",xp:1250,level:3,streak:7,badges:["Fast Learner","Math Whiz","Consistent"],weeklyProgress:{math:20,science:15,language:10},leaderboardPosition:42,pendingSync:!1});te.useEffect(()=>{const m=()=>{e(!0),s("Syncing your progress..."),setTimeout(()=>{s("All data synced"),u(b=>({...b,pendingSync:!1}))},2e3)},y=()=>{e(!1),s("Offline - changes will sync when back online")};return window.addEventListener("online",m),window.addEventListener("offline",y),()=>{window.removeEventListener("online",m),window.removeEventListener("offline",y)}},[]);const d=`Great job this week, ${l.name}! You've improved ${l.weeklyProgress.math}% in Math, 
  ${l.weeklyProgress.science}% in Science, and ${l.weeklyProgress.language}% in Language. 
  Keep focusing on Algebra - you're making great progress!`,f=[{id:1,name:"Priya",xp:2450,avatar:""},{id:2,name:"Amit",xp:2100,avatar:""},{id:3,name:"Neha",xp:1950,avatar:""},{id:l.leaderboardPosition,name:l.name,xp:l.xp,avatar:"",isCurrentUser:!0},{id:44,name:"Ravi",xp:1100,avatar:""},{id:45,name:"Sanya",xp:1050,avatar:""}].sort((m,y)=>y.xp-m.xp);return E.jsxs("div",{className:"student-dashboard bg-gray-50 min-h-screen p-4 md:p-8",children:[E.jsxs("header",{className:"flex justify-between items-center mb-8",children:[E.jsxs("div",{children:[E.jsxs("h1",{className:"text-2xl font-bold",children:["Welcome back, ",l.name,"!"]}),E.jsxs("div",{className:"flex items-center mt-1 text-sm text-gray-600",children:[n?E.jsx(roe,{className:"mr-1 text-green-500"}):E.jsx(soe,{className:"mr-1 text-red-500"}),E.jsx("span",{children:t}),l.pendingSync&&E.jsx("span",{className:"ml-2 text-yellow-600",children:"(Pending sync)"})]})]}),E.jsxs("div",{className:"flex items-center space-x-4",children:[E.jsxs("div",{className:"text-center",children:[E.jsx("div",{className:"text-xs text-gray-500",children:"Level"}),E.jsx("div",{className:"text-xl font-bold",children:l.level})]}),E.jsxs("div",{className:"text-center",children:[E.jsx("div",{className:"text-xs text-gray-500",children:"XP"}),E.jsx("div",{className:"text-xl font-bold",children:l.xp})]}),E.jsxs("div",{className:"text-center",children:[E.jsx("div",{className:"text-xs text-gray-500",children:"Streak"}),E.jsxs("div",{className:"text-xl font-bold flex items-center",children:[l.streak," ",E.jsx(hN,{className:"ml-1 text-yellow-500"})]})]})]})]}),E.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:E.jsxs("button",{onClick:()=>i(!0),className:"flex items-center bg-red-500 hover:bg-red-600 text-white px-4 py-3 rounded-full shadow-lg transition-all",children:[E.jsx(zv,{className:"mr-2"}),"Struggling? Chat with AI Tutor"]})}),r&&E.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:E.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[E.jsx("h3",{className:"text-xl font-bold mb-4",children:"AI Tutor Assistance"}),E.jsx("p",{className:"mb-4",children:"What subject are you having trouble with?"}),E.jsxs("div",{className:"space-y-3",children:[E.jsxs("button",{className:"w-full bg-blue-100 hover:bg-blue-200 text-blue-800 px-4 py-2 rounded flex items-center",children:[E.jsx(lg,{className:"mr-2"})," Math Help"]}),E.jsxs("button",{className:"w-full bg-green-100 hover:bg-green-200 text-green-800 px-4 py-2 rounded flex items-center",children:[E.jsx(lg,{className:"mr-2"})," Science Help"]}),E.jsxs("button",{className:"w-full bg-purple-100 hover:bg-purple-200 text-purple-800 px-4 py-2 rounded flex items-center",children:[E.jsx(lg,{className:"mr-2"})," Language Help"]})]}),E.jsx("button",{onClick:()=>i(!1),className:"mt-4 w-full bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded",children:"Cancel"})]})}),E.jsxs("nav",{className:"flex border-b mb-6",children:[E.jsxs("button",{className:`px-4 py-2 font-medium ${o==="progress"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500"}`,onClick:()=>a("progress"),children:[E.jsx(qB,{className:"inline mr-2"}),"My Progress"]}),E.jsxs("button",{className:`px-4 py-2 font-medium ${o==="leaderboard"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500"}`,onClick:()=>a("leaderboard"),children:[E.jsx(ag,{className:"inline mr-2"}),"Leaderboard"]})]}),o==="progress"&&E.jsxs("div",{children:[E.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[E.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center",children:[E.jsx(ag,{className:"text-yellow-500 mr-2"}),"Weekly Report"]}),E.jsx("p",{className:"text-gray-700 mb-4",children:d}),E.jsxs("div",{className:"space-y-4",children:[E.jsxs("div",{children:[E.jsxs("div",{className:"flex justify-between mb-1",children:[E.jsx("span",{children:"Math"}),E.jsxs("span",{children:[l.weeklyProgress.math,"% improvement"]})]}),E.jsx(Bm,{now:l.weeklyProgress.math,variant:"success"})]}),E.jsxs("div",{children:[E.jsxs("div",{className:"flex justify-between mb-1",children:[E.jsx("span",{children:"Science"}),E.jsxs("span",{children:[l.weeklyProgress.science,"% improvement"]})]}),E.jsx(Bm,{now:l.weeklyProgress.science,variant:"info"})]}),E.jsxs("div",{children:[E.jsxs("div",{className:"flex justify-between mb-1",children:[E.jsx("span",{children:"Language"}),E.jsxs("span",{children:[l.weeklyProgress.language,"% improvement"]})]}),E.jsx(Bm,{now:l.weeklyProgress.language,variant:"warning"})]})]})]}),E.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[E.jsx("h2",{className:"text-xl font-bold mb-4",children:"Your Badges"}),E.jsx("div",{className:"flex flex-wrap gap-3",children:l.badges.map((m,y)=>E.jsxs(ZB,{pill:!0,bg:"light",className:"border border-gray-300 text-gray-800 py-2 px-4 flex items-center",children:[E.jsx(ag,{className:"text-yellow-500 mr-2"}),m]},y))})]}),E.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[E.jsx("h2",{className:"text-xl font-bold mb-4",children:"Recommended For You"}),E.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[{title:"Algebra Basics",subject:"Math",progress:65},{title:"Photosynthesis",subject:"Science",progress:30},{title:"Essay Writing",subject:"Language",progress:10}].map((m,y)=>E.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[E.jsx("h3",{className:"font-medium",children:m.title}),E.jsx("div",{className:"text-sm text-gray-500 mb-2",children:m.subject}),E.jsx(Bm,{now:m.progress,label:`${m.progress}%`})]},y))})]})]}),o==="leaderboard"&&E.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[E.jsx("h2",{className:"text-xl font-bold mb-6",children:"Class Leaderboard"}),E.jsx("div",{className:"space-y-4",children:f.slice(0,10).map((m,y)=>E.jsxs("div",{className:`flex items-center p-3 rounded-lg ${m.isCurrentUser?"bg-blue-50 border border-blue-200":"hover:bg-gray-50"}`,children:[E.jsx("div",{className:"text-2xl mr-4",children:m.avatar}),E.jsxs("div",{className:"flex-grow",children:[E.jsxs("div",{className:"font-medium",children:[m.isCurrentUser?"You":m.name,y<3&&E.jsx("span",{className:"ml-2 text-yellow-500",children:""})]}),E.jsxs("div",{className:"text-sm text-gray-500",children:["Level ",Math.floor(m.xp/500)+1]})]}),E.jsxs("div",{className:"font-bold",children:[m.xp," XP"]})]},m.id))}),l.leaderboardPosition>10&&E.jsxs("div",{className:"mt-4 text-center text-gray-500",children:["You're at position #",l.leaderboardPosition," on the full leaderboard"]})]})]})},moe=()=>({fetchContent:async()=>{const{data:e,error:t}=await Ei.from("contents").select("*");return t?(console.error("Failed to fetch content:",t),[]):e}});function goe(){const{fetchContent:n}=moe(),[e,t]=useState([]),[s,r]=useState("all"),[i,o]=useState(!0);useEffect(()=>{(async()=>{const u=await n();t(u),o(!1)})()},[]);const a=e.filter(l=>s==="all"?!0:l.type===s);return E.jsxs("div",{className:"text-gray-800 dark:text-white",children:[E.jsx("h2",{className:"text-2xl font-bold mb-4",children:" Content Library"}),E.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:["all","video","pdf","text","audio"].map(l=>E.jsx("button",{onClick:()=>r(l),className:`px-3 py-1 rounded text-sm border ${s===l?"bg-blue-600 text-white":"border-gray-300 dark:border-gray-600"}`,children:l.toUpperCase()},l))}),i?E.jsx("p",{children:"Loading content..."}):a.length===0?E.jsxs("p",{children:['No content found for "',s,'"']}):E.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:a.map(l=>E.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded shadow",children:[E.jsx("h3",{className:"font-semibold text-lg mb-1",children:l.title}),E.jsxs("p",{className:"text-sm mb-2 text-gray-600 dark:text-gray-400",children:[l.type.toUpperCase(),"  ",l.topic]}),E.jsx("a",{href:l.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 text-sm underline",children:"View / Download"})]},l.id))})]})}const yoe=()=>({fetchQuiz:async()=>{const{data:e,error:t}=await Ei.from("quizzes").select("*");return t?(console.error("Error fetching quiz:",t),[]):e.map(s=>({question:s.question,options:s.options,correct_answer:s.correct_answer}))}});var bx={},xx={},vL;function boe(){if(vL)return xx;vL=1,Object.defineProperty(xx,"__esModule",{value:!0}),xx.confetti=a;var n=["#a864fd","#29cdff","#78ff44","#ff718d","#fdff6a"];function e(l,u,d,f,m){return Array.from({length:u}).map(function(y,b){var w=document.createElement("div"),v=d[b%d.length];return w.style["background-color"]=v,w.style.width=f,w.style.height=m,w.style.position="absolute",w.style.willChange="transform, opacity",w.style.visibility="hidden",l.appendChild(w),w})}function t(l,u,d,f){var m=l*(Math.PI/180),y=u*(Math.PI/180);return{x:0,y:0,z:0,wobble:f()*10,wobbleSpeed:.1+f()*.1,velocity:d*.5+f()*d,angle2D:-m+(.5*y-f()*y),angle3D:-(Math.PI/4)+f()*(Math.PI/2),tiltAngle:f()*Math.PI,tiltAngleSpeed:.1+f()*.3}}function s(l,u,d,f){l.physics.x+=Math.cos(l.physics.angle2D)*l.physics.velocity,l.physics.y+=Math.sin(l.physics.angle2D)*l.physics.velocity,l.physics.z+=Math.sin(l.physics.angle3D)*l.physics.velocity,l.physics.wobble+=l.physics.wobbleSpeed,f?l.physics.velocity*=f:l.physics.velocity-=l.physics.velocity*d,l.physics.y+=3,l.physics.tiltAngle+=l.physics.tiltAngleSpeed;var m=l.physics,y=m.x,b=m.y,w=m.z,v=m.tiltAngle,S=m.wobble,T=y+10*Math.cos(S),I=b+10*Math.sin(S),k="translate3d("+T+"px, "+I+"px, "+w+"px) rotate3d(1, 1, 1, "+v+"rad)";l.element.style.visibility="visible",l.element.style.transform=k,l.element.style.opacity=1-u}function r(l,u,d,f,m,y){var b=void 0;return new Promise(function(w){function v(S){b||(b=S);var T=S-b,I=b===S?0:(S-b)/m;u.slice(0,Math.ceil(T/y)).forEach(function(k){s(k,I,d,f)}),S-b<m?requestAnimationFrame(v):(u.forEach(function(k){if(k.element.parentNode===l)return l.removeChild(k.element)}),w())}requestAnimationFrame(v)})}var i={angle:90,spread:45,startVelocity:45,elementCount:50,width:"10px",height:"10px",perspective:"",colors:n,duration:3e3,stagger:0,dragFriction:.1,random:Math.random};function o(l){return!l.stagger&&l.delay&&(l.stagger=l.delay),l}function a(l){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=Object.assign({},i,o(u)),f=d.elementCount,m=d.colors,y=d.width,b=d.height,w=d.perspective,v=d.angle,S=d.spread,T=d.startVelocity,I=d.decay,k=d.dragFriction,O=d.duration,V=d.stagger,P=d.random;l.style.perspective=w;var D=e(l,f,m,y,b),$=D.map(function(R){return{element:R,physics:t(v,S,T,P)}});return r(l,$,k,I,O,V)}return xx}var wL;function xoe(){if(wL)return bx;wL=1,Object.defineProperty(bx,"__esModule",{value:!0});var n=function(){function d(f,m){for(var y=0;y<m.length;y++){var b=m[y];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(f,b.key,b)}}return function(f,m,y){return m&&d(f.prototype,m),y&&d(f,y),f}}(),e=ww(),t=r(e),s=boe();function r(d){return d&&d.__esModule?d:{default:d}}function i(d,f){if(!(d instanceof f))throw new TypeError("Cannot call a class as a function")}function o(d,f){if(!d)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f&&(typeof f=="object"||typeof f=="function")?f:d}function a(d,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof f);d.prototype=Object.create(f&&f.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(d,f):d.__proto__=f)}var l={position:"relative"},u=function(d){a(f,d);function f(m){i(this,f);var y=o(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,m));return y.setRef=y.setRef.bind(y),y}return n(f,[{key:"componentDidUpdate",value:function(y){!y.active&&this.props.active&&(0,s.confetti)(this.container,this.props.config)}},{key:"setRef",value:function(y){this.container=y}},{key:"render",value:function(){return t.default.createElement("div",{className:this.props.className,style:l,ref:this.setRef})}}]),f}(e.Component);return bx.default=u,bx}xoe();function voe(){const{fetchQuiz:n}=yoe(),[e,t]=te.useState([]),[s,r]=te.useState(0),[i,o]=te.useState(null),[a,l]=te.useState(!1),[u,d]=te.useState(0),[f,m]=te.useState(!0);te.useEffect(()=>{(async()=>{const S=await n();t(S||[]),m(!1)})()},[]);const y=e[s],b=v=>{o(v),l(!0),v===y.correct_answer&&d(S=>S+1)},w=()=>{o(null),l(!1),r(v=>v+1)};return f?E.jsx("p",{children:"Loading quiz..."}):e.length?E.jsxs("div",{className:"text-gray-800 dark:text-white",children:[E.jsx("h2",{className:"text-2xl font-bold mb-4",children:" Quiz Zone"}),E.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded shadow max-w-xl",children:[E.jsxs("p",{className:"mb-2 text-sm text-gray-500",children:["Question ",s+1," of ",e.length]}),E.jsx("h3",{className:"text-lg font-semibold mb-4",children:y.question}),E.jsx("div",{className:"space-y-2",children:y.options.map((v,S)=>E.jsx("button",{onClick:()=>b(v),className:`block w-full px-4 py-2 rounded border ${i===v?v===y.correct_answer?"bg-green-500 text-white":"bg-red-500 text-white":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,disabled:a,children:v},S))}),a&&E.jsxs("div",{className:"mt-4",children:[E.jsx("p",{children:i===y.correct_answer?" Correct!":` Incorrect. Correct: ${y.correct_answer}`}),s<e.length-1?E.jsx("button",{onClick:w,className:"mt-2 px-4 py-1 bg-blue-600 text-white rounded",children:"Next"}):E.jsxs("p",{className:"mt-2 font-semibold",children:[" Quiz complete! You got ",u," out of ",e.length,"."]})]})]})]}):E.jsx("p",{children:"No quiz questions available."})}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const woe=1e-7,_oe=1e-4;class ez{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class gN{refCount(e){return Mr("refCount")}incRef(e){return Mr("incRef")}timerAvailable(){return!0}time(e){return Mr("time")}read(e){return Mr("read")}readSync(e){return Mr("readSync")}readToGPU(e,t){return Mr("readToGPU")}numDataIds(){return Mr("numDataIds")}disposeData(e,t){return Mr("disposeData")}write(e,t,s){return Mr("write")}move(e,t,s,r,i){return Mr("move")}createTensorFromGPUData(e,t,s){return Mr("createTensorFromGPUData")}memory(){return Mr("memory")}floatPrecision(){return Mr("floatPrecision")}epsilon(){return this.floatPrecision()===32?woe:_oe}dispose(){return Mr("dispose")}}function Mr(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Soe(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,Xd(n,e,t)}function oh(n,e,t){return Math.max(n,Math.min(e,t))}function yN(n){return n%2===0?n:n+1}function Xd(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function Coe(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function j(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function bN(n,e,t=""){j(zt(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function tz(n){j(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function xe(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function zt(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function If(n){return n%1===0}function PE(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function hf(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function _L(n,e=r=>0,t,s){return new Promise((r,i)=>{let o=0;const a=()=>{if(n()){r();return}o++;const l=e(o);if(t!=null&&o>=t){i();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function nz(n,e){let t=1,s=-1;for(let i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${i}`);s=i}else if(n[i]<0)throw Error(`Shapes can not be < 0. Found ${n[i]} at dim ${i}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function dt(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),j(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),j(n.every(s=>If(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function Oc(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||r?null:dt(e,n).sort();let o=0;for(let a=0;a<n.length;++a){if(i!=null){if(i[o]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(i[o]==null||i[o]>a)&&n[a]===1&&(t.push(n[a]),s.push(a)),i[o]<=a&&o++}n[a]!==1&&(t.push(n[a]),s.push(a))}return{newShape:t,keptDims:s}}function Js(n,e){return Fn(n,e)}function Fn(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function Toe(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function Eoe(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function sz(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function jv(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function Ioe(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function by(n){return typeof n=="string"||n instanceof String}function koe(n){return typeof n=="boolean"}function ME(n){return typeof n=="number"}function Jf(n){return Array.isArray(n)?Jf(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":ME(n)?"float32":by(n)?"string":koe(n)?"bool":"float32"}function LE(n){return!!(n&&n.constructor&&n.call&&n.apply)}function FE(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function je(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function rz(n,e,t,s=!1){const r=new Array;if(e.length===1){const i=e[0]*(s?2:1);for(let o=0;o<i;o++)r[o]=t[n+o]}else{const i=e[0],o=e.slice(1),a=o.reduce((l,u)=>l*u)*(s?2:1);for(let l=0;l<i;l++)r[l]=rz(n+l*a,o,t,s)}return r}function no(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,i)=>r*i)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return rz(0,n,e,t)}function Noe(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function xN(n,e){const t=Zs(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function Zs(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function iz(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return no(n,new Float32Array(t));if(e==="int32")return no(n,new Int32Array(t));if(e==="bool")return no(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function il(n){n.forEach(e=>{j(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function zo(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function Zf(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function vN(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SL="tfjsflags";class Aoe{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Roe,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(pe().getBool("IS_TEST")||pe().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];pe().getBool("IS_TEST")||pe().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(vN(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);SL in e&&e[SL].split(",").forEach(s=>{const[r,i]=s.split(":");this.urlFlags[r]=Doe(r,i)})}}function Roe(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>($oe(e,s[0],s[1]),s.join("="))),e}function $oe(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Doe(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function pe(){return oz}let oz=null;function Ooe(n){oz=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let fT;function az(){if(fT==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");fT=n}return fT}function Poe(){const n=az();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function wN(n,e){const t=Poe();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const r_="Abs",xy="Acos",vy="Acosh",ep="Add",_N="AddN",SN="All",CN="Any",i_="ArgMax",o_="ArgMin",wy="Asin",_y="Asinh",Sy="Atan",Cy="Atanh",Ty="Atan2",a_="AvgPool",TN="AvgPoolGrad",l_="AvgPool3D",EN="AvgPool3DGrad",c_="BatchMatMul",u_="BatchToSpaceND",IN="Bincount",kN="BitwiseAnd",Moe="BroadcastTo",lz="BroadcastArgs",Ey="Cast",Iy="Ceil",ky="ClipByValue",NN="Complex",h_="ComplexAbs",d_="Concat",f_="Conv2D",AN="Conv2DBackpropFilter",p_="Conv2DBackpropInput",m_="Conv3D",RN="Conv3DBackpropFilterV2",$N="Conv3DBackpropInputV2",Ny="Cos",Ay="Cosh",DN="Cumprod",g_="Cumsum",ON="CropAndResize",PN="DenseBincount",MN="DepthToSpace",y_="DepthwiseConv2dNative",LN="DepthwiseConv2dNativeBackpropFilter",FN="DepthwiseConv2dNativeBackpropInput",cz="Diag",b_="Dilation2D",VE="Dilation2DBackpropInput",UE="Dilation2DBackpropFilter",Loe="Draw",Ry="RealDiv",VN="Einsum",$y="Elu",UN="EluGrad",Dy="Erf",x_="Equal",Oy="Exp",v_="ExpandDims",Py="Expm1",BN="FFT",zN="Fill",jN="FlipLeftRight",My="Floor",Ly="FloorDiv",w_="FusedBatchNorm",__="GatherV2",uz="GatherNd",S_="Greater",Fy="GreaterEqual",Vy="Identity",WN="IFFT",GN="Imag",Uy="IsFinite",By="IsInf",zy="IsNan",C_="LeakyRelu",T_="Less",E_="LessEqual",hz="LinSpace",jy="Log",Wy="Log1p",I_="LogicalAnd",k_="LogicalNot",N_="LogicalOr",Foe="LogSoftmax",A_="LRN",HN="LRNGrad",R_="Max",Gy="Maximum",$_="MaxPool",qN="MaxPoolGrad",D_="MaxPool3D",KN="MaxPool3DGrad",dz="MaxPoolWithArgmax",O_="Mean",P_="Min",Hy="Minimum",M_="MirrorPad",qy="Mod",fz="Multinomial",Ky="Multiply",L_="Neg",F_="NotEqual",XN="NonMaxSuppressionV3",YN="NonMaxSuppressionV4",QN="NonMaxSuppressionV5",V_="OnesLike",U_="OneHot",B_="Pack",z_="PadV2",Xy="Pow",j_="Prelu",W_="Prod",pz="RaggedGather",mz="RaggedRange",gz="RaggedTensorToTensor",JN="Range",ZN="Real",Yy="Reciprocal",Qy="Relu",G_="Reshape",H_="ResizeNearestNeighbor",e2="ResizeNearestNeighborGrad",q_="ResizeBilinear",t2="ResizeBilinearGrad",Jy="Relu6",K_="Reverse",Zy="Round",e0="Rsqrt",yz="ScatterNd",bz="TensorScatterUpdate",xz="SearchSorted",X_="Select",t0="Selu",Y_="Slice",n0="Sin",s0="Sinh",r0="Sign",i0="Sigmoid",o0="Softplus",a0="Sqrt",Q_="Sum",J_="SpaceToBatchND",Z_="SplitV",e1="Softmax",vz="SparseFillEmptyRows",wz="SparseReshape",_z="SparseSegmentMean",Sz="SparseSegmentSum",Cz="SparseToDense",l0="SquaredDifference",n2="Square",s2="StaticRegexReplace",r2="StridedSlice",Tz="StringNGrams",Ez="StringSplit",Iz="StringToHashBucketFast",c0="Sub",u0="Tan",h0="Tanh",d0="Tile",i2="TopK",o2="Transform",df="Transpose",a2="Unique",t1="Unpack",n1="UnsortedSegmentSum",s1="ZerosLike",f0="Step",Voe="FromPixels",l2="RotateWithOffset",Wv="_FusedMatMul",Gv="FusedConv2D",kz="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function si(...n){pe().getBool("IS_TEST")||pe().getBool("PROD")||console.warn(...n)}function Uoe(...n){pe().getBool("IS_TEST")||pe().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hv=wN("kernelRegistry",()=>new Map),BE=wN("gradRegistry",()=>new Map);function CL(n,e){const t=Az(n,e);return Hv.get(t)}function TL(n){return BE.get(n)}function EL(n){const e=Hv.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[i,o]=r,[a]=i.split("_");a===n&&t.push(o)}return t}function Nz(n){const{kernelName:e,backendName:t}=n,s=Az(e,t);Hv.has(s)&&si(`The kernel '${e}' for backend '${t}' is already registered`),Hv.set(s,n)}function Boe(n){const{kernelName:e}=n;BE.has(e)&&pe().getBool("DEBUG")&&si(`Overriding the gradient for '${e}'`),BE.set(e,n)}function Az(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rz(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var pT,IL;function zoe(){if(IL)return pT;IL=1,pT=e;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(R,A,U){this.low=R|0,this.high=A|0,this.unsigned=!!U}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function t(R){return(R&&R.__isLong__)===!0}e.isLong=t;var s={},r={};function i(R,A){var U,F,ne;return A?(R>>>=0,(ne=0<=R&&R<256)&&(F=r[R],F)?F:(U=a(R,(R|0)<0?-1:0,!0),ne&&(r[R]=U),U)):(R|=0,(ne=-128<=R&&R<128)&&(F=s[R],F)?F:(U=a(R,R<0?-1:0,!1),ne&&(s[R]=U),U))}e.fromInt=i;function o(R,A){if(isNaN(R))return A?T:S;if(A){if(R<0)return T;if(R>=b)return P}else{if(R<=-w)return D;if(R+1>=w)return V}return R<0?o(-R,A).neg():a(R%y|0,R/y|0,A)}e.fromNumber=o;function a(R,A,U){return new e(R,A,U)}e.fromBits=a;var l=Math.pow;function u(R,A,U){if(R.length===0)throw Error("empty string");if(R==="NaN"||R==="Infinity"||R==="+Infinity"||R==="-Infinity")return S;if(typeof A=="number"?(U=A,A=!1):A=!!A,U=U||10,U<2||36<U)throw RangeError("radix");var F;if((F=R.indexOf("-"))>0)throw Error("interior hyphen");if(F===0)return u(R.substring(1),A,U).neg();for(var ne=o(l(U,8)),Q=S,G=0;G<R.length;G+=8){var K=Math.min(8,R.length-G),J=parseInt(R.substring(G,G+K),U);if(K<8){var ce=o(l(U,K));Q=Q.mul(ce).add(o(J))}else Q=Q.mul(ne),Q=Q.add(o(J))}return Q.unsigned=A,Q}e.fromString=u;function d(R,A){return typeof R=="number"?o(R,A):typeof R=="string"?u(R,A):a(R.low,R.high,typeof A=="boolean"?A:R.unsigned)}e.fromValue=d;var f=65536,m=1<<24,y=f*f,b=y*y,w=b/2,v=i(m),S=i(0);e.ZERO=S;var T=i(0,!0);e.UZERO=T;var I=i(1);e.ONE=I;var k=i(1,!0);e.UONE=k;var O=i(-1);e.NEG_ONE=O;var V=a(-1,2147483647,!1);e.MAX_VALUE=V;var P=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=P;var D=a(0,-2147483648,!1);e.MIN_VALUE=D;var $=e.prototype;return $.toInt=function(){return this.unsigned?this.low>>>0:this.low},$.toNumber=function(){return this.unsigned?(this.high>>>0)*y+(this.low>>>0):this.high*y+(this.low>>>0)},$.toString=function(A){if(A=A||10,A<2||36<A)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(D)){var U=o(A),F=this.div(U),ne=F.mul(U).sub(this);return F.toString(A)+ne.toInt().toString(A)}else return"-"+this.neg().toString(A);for(var Q=o(l(A,6),this.unsigned),G=this,K="";;){var J=G.div(Q),ce=G.sub(J.mul(Q)).toInt()>>>0,z=ce.toString(A);if(G=J,G.isZero())return z+K;for(;z.length<6;)z="0"+z;K=""+z+K}},$.getHighBits=function(){return this.high},$.getHighBitsUnsigned=function(){return this.high>>>0},$.getLowBits=function(){return this.low},$.getLowBitsUnsigned=function(){return this.low>>>0},$.getNumBitsAbs=function(){if(this.isNegative())return this.eq(D)?64:this.neg().getNumBitsAbs();for(var A=this.high!=0?this.high:this.low,U=31;U>0&&(A&1<<U)==0;U--);return this.high!=0?U+33:U+1},$.isZero=function(){return this.high===0&&this.low===0},$.eqz=$.isZero,$.isNegative=function(){return!this.unsigned&&this.high<0},$.isPositive=function(){return this.unsigned||this.high>=0},$.isOdd=function(){return(this.low&1)===1},$.isEven=function(){return(this.low&1)===0},$.equals=function(A){return t(A)||(A=d(A)),this.unsigned!==A.unsigned&&this.high>>>31===1&&A.high>>>31===1?!1:this.high===A.high&&this.low===A.low},$.eq=$.equals,$.notEquals=function(A){return!this.eq(A)},$.neq=$.notEquals,$.ne=$.notEquals,$.lessThan=function(A){return this.comp(A)<0},$.lt=$.lessThan,$.lessThanOrEqual=function(A){return this.comp(A)<=0},$.lte=$.lessThanOrEqual,$.le=$.lessThanOrEqual,$.greaterThan=function(A){return this.comp(A)>0},$.gt=$.greaterThan,$.greaterThanOrEqual=function(A){return this.comp(A)>=0},$.gte=$.greaterThanOrEqual,$.ge=$.greaterThanOrEqual,$.compare=function(A){if(t(A)||(A=d(A)),this.eq(A))return 0;var U=this.isNegative(),F=A.isNegative();return U&&!F?-1:!U&&F?1:this.unsigned?A.high>>>0>this.high>>>0||A.high===this.high&&A.low>>>0>this.low>>>0?-1:1:this.sub(A).isNegative()?-1:1},$.comp=$.compare,$.negate=function(){return!this.unsigned&&this.eq(D)?D:this.not().add(I)},$.neg=$.negate,$.add=function(A){t(A)||(A=d(A));var U=this.high>>>16,F=this.high&65535,ne=this.low>>>16,Q=this.low&65535,G=A.high>>>16,K=A.high&65535,J=A.low>>>16,ce=A.low&65535,z=0,X=0,ie=0,se=0;return se+=Q+ce,ie+=se>>>16,se&=65535,ie+=ne+J,X+=ie>>>16,ie&=65535,X+=F+K,z+=X>>>16,X&=65535,z+=U+G,z&=65535,a(ie<<16|se,z<<16|X,this.unsigned)},$.subtract=function(A){return t(A)||(A=d(A)),this.add(A.neg())},$.sub=$.subtract,$.multiply=function(A){if(this.isZero())return S;if(t(A)||(A=d(A)),n){var U=n.mul(this.low,this.high,A.low,A.high);return a(U,n.get_high(),this.unsigned)}if(A.isZero())return S;if(this.eq(D))return A.isOdd()?D:S;if(A.eq(D))return this.isOdd()?D:S;if(this.isNegative())return A.isNegative()?this.neg().mul(A.neg()):this.neg().mul(A).neg();if(A.isNegative())return this.mul(A.neg()).neg();if(this.lt(v)&&A.lt(v))return o(this.toNumber()*A.toNumber(),this.unsigned);var F=this.high>>>16,ne=this.high&65535,Q=this.low>>>16,G=this.low&65535,K=A.high>>>16,J=A.high&65535,ce=A.low>>>16,z=A.low&65535,X=0,ie=0,se=0,ve=0;return ve+=G*z,se+=ve>>>16,ve&=65535,se+=Q*z,ie+=se>>>16,se&=65535,se+=G*ce,ie+=se>>>16,se&=65535,ie+=ne*z,X+=ie>>>16,ie&=65535,ie+=Q*ce,X+=ie>>>16,ie&=65535,ie+=G*J,X+=ie>>>16,ie&=65535,X+=F*z+ne*ce+Q*J+G*K,X&=65535,a(se<<16|ve,X<<16|ie,this.unsigned)},$.mul=$.multiply,$.divide=function(A){if(t(A)||(A=d(A)),A.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&A.low===-1&&A.high===-1)return this;var U=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,A.low,A.high);return a(U,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?T:S;var F,ne,Q;if(this.unsigned){if(A.unsigned||(A=A.toUnsigned()),A.gt(this))return T;if(A.gt(this.shru(1)))return k;Q=T}else{if(this.eq(D)){if(A.eq(I)||A.eq(O))return D;if(A.eq(D))return I;var G=this.shr(1);return F=G.div(A).shl(1),F.eq(S)?A.isNegative()?I:O:(ne=this.sub(A.mul(F)),Q=F.add(ne.div(A)),Q)}else if(A.eq(D))return this.unsigned?T:S;if(this.isNegative())return A.isNegative()?this.neg().div(A.neg()):this.neg().div(A).neg();if(A.isNegative())return this.div(A.neg()).neg();Q=S}for(ne=this;ne.gte(A);){F=Math.max(1,Math.floor(ne.toNumber()/A.toNumber()));for(var K=Math.ceil(Math.log(F)/Math.LN2),J=K<=48?1:l(2,K-48),ce=o(F),z=ce.mul(A);z.isNegative()||z.gt(ne);)F-=J,ce=o(F,this.unsigned),z=ce.mul(A);ce.isZero()&&(ce=I),Q=Q.add(ce),ne=ne.sub(z)}return Q},$.div=$.divide,$.modulo=function(A){if(t(A)||(A=d(A)),n){var U=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,A.low,A.high);return a(U,n.get_high(),this.unsigned)}return this.sub(this.div(A).mul(A))},$.mod=$.modulo,$.rem=$.modulo,$.not=function(){return a(~this.low,~this.high,this.unsigned)},$.and=function(A){return t(A)||(A=d(A)),a(this.low&A.low,this.high&A.high,this.unsigned)},$.or=function(A){return t(A)||(A=d(A)),a(this.low|A.low,this.high|A.high,this.unsigned)},$.xor=function(A){return t(A)||(A=d(A)),a(this.low^A.low,this.high^A.high,this.unsigned)},$.shiftLeft=function(A){return t(A)&&(A=A.toInt()),(A&=63)===0?this:A<32?a(this.low<<A,this.high<<A|this.low>>>32-A,this.unsigned):a(0,this.low<<A-32,this.unsigned)},$.shl=$.shiftLeft,$.shiftRight=function(A){return t(A)&&(A=A.toInt()),(A&=63)===0?this:A<32?a(this.low>>>A|this.high<<32-A,this.high>>A,this.unsigned):a(this.high>>A-32,this.high>=0?0:-1,this.unsigned)},$.shr=$.shiftRight,$.shiftRightUnsigned=function(A){if(t(A)&&(A=A.toInt()),A&=63,A===0)return this;var U=this.high;if(A<32){var F=this.low;return a(F>>>A|U<<32-A,U>>>A,this.unsigned)}else return A===32?a(U,0,this.unsigned):a(U>>>A-32,0,this.unsigned)},$.shru=$.shiftRightUnsigned,$.shr_u=$.shiftRightUnsigned,$.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},$.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},$.toBytes=function(A){return A?this.toBytesLE():this.toBytesBE()},$.toBytesLE=function(){var A=this.high,U=this.low;return[U&255,U>>>8&255,U>>>16&255,U>>>24,A&255,A>>>8&255,A>>>16&255,A>>>24]},$.toBytesBE=function(){var A=this.high,U=this.low;return[A>>>24,A>>>16&255,A>>>8&255,A&255,U>>>24,U>>>16&255,U>>>8&255,U&255]},e.fromBytes=function(A,U,F){return F?e.fromBytesLE(A,U):e.fromBytesBE(A,U)},e.fromBytesLE=function(A,U){return new e(A[0]|A[1]<<8|A[2]<<16|A[3]<<24,A[4]|A[5]<<8|A[6]<<16|A[7]<<24,U)},e.fromBytesBE=function(A,U){return new e(A[4]<<24|A[5]<<16|A[6]<<8|A[7],A[0]<<24|A[1]<<16|A[2]<<8|A[3],U)},pT}var $z=zoe();const Dz=vw($z),joe=d8({__proto__:null,default:Dz},[$z]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Du=Dz||joe;function r1(n){return Du.fromString(n,!0,16)}const Oz=r1("c3a5c85c97cb3127"),Nu=r1("b492b66fbe98f273"),dr=r1("9ae16a3b2f90404f");function zE(n){return n.xor(n.shru(47))}function Pz(n,e,t){const s=n.slice(e,e+t);return Du.fromBytes(Array.from(s),!0,!0)}function dn(n,e){return Pz(n,e,8)}function kL(n,e){return Pz(n,e,4)}function xs(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function ic(n,e,t=r1("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function Woe(n,e,t,s,r,i){r=r.add(n),i=xs(i.add(r).add(s),21);const o=r;return r=r.add(e),r=r.add(t),i=i.add(xs(r,44)),[r.add(s),i.add(o)]}function vx(n,e,t,s){return Woe(dn(n,e),dn(n,e+8),dn(n,e+16),dn(n,e+24),t,s)}function Goe(n,e=n.length){if(e>=8){const t=dr.add(e*2),s=dn(n,0).add(dr),r=dn(n,e-8),i=xs(r,37).mul(t).add(s),o=xs(s,25).add(r).mul(t);return ic(i,o,t)}if(e>=4){const t=dr.add(e*2),s=kL(n,0);return ic(s.shl(3).add(e),kL(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],i=t+(s<<8),o=e+(r<<2);return zE(dr.mul(i).xor(Oz.mul(o))).mul(dr)}return dr}function Hoe(n,e=n.length){const t=dr.add(e*2),s=dn(n,0).mul(Nu),r=dn(n,8),i=dn(n,e-8).mul(t),o=dn(n,e-16).mul(dr);return ic(xs(s.add(r),43).add(xs(i,30)).add(o),s.add(xs(r.add(dr),18)).add(i),t)}function qoe(n,e=n.length){const t=dr.add(e*2),s=dn(n,0).mul(dr),r=dn(n,8),i=dn(n,e-8).mul(t),o=dn(n,e-16).mul(dr),a=xs(s.add(r),43).add(xs(i,30)).add(o),l=ic(a,s.add(xs(r.add(dr),18)).add(i),t),u=dn(n,16).mul(t),d=dn(n,24),f=a.add(dn(n,e-32)).mul(t),m=l.add(dn(n,e-24)).mul(t);return ic(xs(u.add(d),43).add(xs(f,30)).add(m),u.add(xs(d.add(s),18)).add(f),t)}function Koe(n,e=n.length){const t=Du.fromNumber(81,!0);if(e<=32)return e<=16?Goe(n,e):Hoe(n,e);if(e<=64)return qoe(n,e);let s=t,r=t.mul(Nu).add(113),i=zE(r.mul(dr).add(113)).mul(dr),o=[Du.UZERO,Du.UZERO],a=[Du.UZERO,Du.UZERO];s=s.mul(dr).add(dn(n,0));let l=0;const u=(e-1>>6)*64,d=u+(e-1&63)-63;do s=xs(s.add(r).add(o[0]).add(dn(n,l+8)),37).mul(Nu),r=xs(r.add(o[1]).add(dn(n,l+48)),42).mul(Nu),s=s.xor(a[1]),r=r.add(o[0]).add(dn(n,l+40)),i=xs(i.add(a[0]),33).mul(Nu),o=vx(n,l,o[1].mul(Nu),s.add(a[0])),a=vx(n,l+32,i.add(a[1]),r.add(dn(n,l+16))),[i,s]=[s,i],l+=64;while(l!==u);const f=Nu.add(i.and(255).shl(1));return l=d,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),s=xs(s.add(r).add(o[0]).add(dn(n,l+8)),37).mul(f),r=xs(r.add(o[1]).add(dn(n,l+48)),42).mul(f),s=s.xor(a[1].mul(9)),r=r.add(o[0].mul(9).add(dn(n,l+40))),i=xs(i.add(a[0]),33).mul(f),o=vx(n,l,o[1].mul(f),s.add(a[0])),a=vx(n,l+32,i.add(a[1]),r.add(dn(n,l+16))),[i,s]=[s,i],ic(ic(o[0],a[0],f).add(zE(r).mul(Oz)).add(i),ic(o[1],a[1],f).add(s),f)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pc(n,e){return e==="string"?oc(n):kh([n],e)}function Xoe(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function kh(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=ah(n)),pe().getBool("DEBUG")&&Toe(n,e),Xoe(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Sr(){return pe().platform.now()}function oc(n,e="utf-8"){return e=e||"utf-8",pe().platform.encode(n,e)}function xc(n,e="utf-8"){return e=e||"utf-8",pe().platform.decode(n,e)}function Oi(n){return pe().platform.isTypedArray!=null?pe().platform.isTypedArray(n):Rz(n)}function ah(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||vN(n)||n==null||Oi(n)&&t)e.push(n);else if(Array.isArray(n)||Oi(n))for(let s=0;s<n.length;++s)ah(n[s],e,t);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)ah(n[r],e,t)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yoe{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Joe)}profileKernel(e,t,s){let r;const i=()=>{r=s()};let o;const a=Sr();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const u of r)u.dataSync();o=Promise.resolve({kernelMs:Sr()-a})}if(pe().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<r.length;u++){const d=r[u];d.data().then(f=>{Qoe(f,d.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:o.then(u=>u.kernelMs),extraInfo:o.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:i,extraInfo:o}=e;s.forEach(a=>{Promise.all([a.data(),r,o]).then(l=>{this.logger.logKernelProfile(t,a,l[0],l[1],i,l[2])})})}}function Qoe(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}class Joe{logKernelProfile(e,t,s,r,i,o){const a=typeof r=="number"?hf(`${r}ms`,9):r.error,l=hf(e,25),u=t.rank,d=t.size,f=hf(t.shape.toString(),14);let m="";for(const y in i){const b=i[y];if(b!=null){const w=b.shape||t.shape,v=w.length;m+=`${y}: ${v}D ${v>0?w:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${f}	%c${d}	%c${m}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zoe(n,e,t){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<n.length;l++){const u=n[l],d=u.inputs;for(const f in d){const m=d[f];let y=!1;for(let b=0;b<e.length;b++)if(s[m.id]){u.outputs.forEach(w=>s[w.id]=!0),y=!0,r[u.id]=!0;break}if(y)break}}const i={};i[t.id]=!0;const o={};for(let l=n.length-1;l>=0;l--){const u=n[l],d=u.inputs;for(let f=0;f<u.outputs.length;f++)if(i[u.outputs[f].id]){for(const m in d)i[d[m].id]=!0,o[u.id]=!0;break}}const a=[];for(let l=0;l<n.length;l++){const u=n[l];if(r[u.id]&&o[u.id]){const d={};for(const m in u.inputs){const y=u.inputs[m];s[y.id]&&(d[m]=y)}const f=Object.assign({},u);f.inputs=d,f.outputs=u.outputs,a.push(f)}}return a}function eae(n,e,t,s){for(let r=e.length-1;r>=0;r--){const i=e[r],o=[];if(i.outputs.forEach(l=>{const u=n[l.id];u!=null?o.push(u):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=t(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const d=i.inputs[l];if(!zt(u.shape,d.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${d.shape}'`);if(n[d.id]==null)n[d.id]=u;else{const f=n[d.id];n[d.id]=s(f,u),f.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NL=20,km=3,mT=7;function tae(n,e,t,s){const r=je(e),i=nae(n,e,t,r),o=e.length,a=Hx(n,e,t,r,i),l=["Tensor"];return s&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function nae(n,e,t,s){const r=xe(e),i=s[s.length-1],o=new Array(i).fill(0),a=e.length,l=t==="complex64"?jm(n):n;if(a>1)for(let u=0;u<r/i;u++){const d=u*i;for(let f=0;f<i;f++)o[f]=Math.max(o[f],zm(l[d+f],0,t).length)}return o}function zm(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(mT))} + ${parseFloat(n[1].toFixed(mT))}j`:by(n)?s=`'${n}'`:t==="bool"?s=Mz(n):s=parseFloat(n.toFixed(mT)).toString(),hf(s,e)}function Mz(n){return n===0?"false":"true"}function Hx(n,e,t,s,r,i=!0){const o=t==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(t==="complex64"){const w=jm(n);return[zm(w[0],0,t)]}return t==="bool"?[Mz(n[0])]:[n[0].toString()]}if(l===1){if(a>NL){const v=km*o;let S=Array.from(n.slice(0,v)),T=Array.from(n.slice((a-km)*o,a*o));return t==="complex64"&&(S=jm(S),T=jm(T)),["["+S.map((I,k)=>zm(I,r[k],t)).join(", ")+", ..., "+T.map((I,k)=>zm(I,r[a-km+k],t)).join(", ")+"]"]}return["["+(t==="complex64"?jm(n):Array.from(n)).map((v,S)=>zm(v,r[S],t)).join(", ")+"]"]}const u=e.slice(1),d=s.slice(1),f=s[0]*o,m=[];if(a>NL){for(let w=0;w<km;w++){const v=w*f,S=v+f;m.push(...Hx(n.slice(v,S),u,t,d,r,!1))}m.push("...");for(let w=a-km;w<a;w++){const v=w*f,S=v+f;m.push(...Hx(n.slice(v,S),u,t,d,r,w===a-1))}}else for(let w=0;w<a;w++){const v=w*f,S=v+f;m.push(...Hx(n.slice(v,S),u,t,d,r,w===a-1))}const y=l===2?",":"";m[0]="["+(a>0?m[0]+y:"");for(let w=1;w<m.length-1;w++)m[w]=" "+m[w]+y;let b=`,
`;for(let w=2;w<l;w++)b+=`
`;return m[m.length-1]=" "+m[m.length-1]+"]"+(i?"":b),m}function jm(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ms{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=xe(e),s!=null){const r=s.length;j(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||Fn(t,this.size),this.strides=je(e)}set(e,...t){t.length===0&&(t=[0]),j(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Ki().makeTensor(this.values,this.shape,this.dtype)}}let Ki=null,Yd=null;function sae(n){Ki=n}function rae(n){Yd=n}class ts{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=xe(e),this.strides=je(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Yd.buffer(this.shape,this.dtype,e)}bufferSync(){return Yd.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return no(this.shape,e,this.dtype==="complex64")}arraySync(){return no(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Ki().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>xc(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Ki().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Ki().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>xc(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Ki().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Ki().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Yd.print(this,e)}clone(){return this.throwIfDisposed(),Yd.clone(this)}toString(e=!1){const t=this.dataSync();return tae(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Yd.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),Ki().makeVariable(this,e,t,s)}}Object.defineProperty(ts,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function ye(){return wN("Tensor",()=>ts)}ye();class qv extends ts{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!zt(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Ki().disposeTensor(this),this.dataId=e.dataId,Ki().incRef(this,null)}dispose(){Ki().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(qv,Symbol.hasInstance,{value:n=>n instanceof ts&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var AL;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(AL||(AL={}));var jE;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(jE||(jE={}));var WE;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(WE||(WE={}));var GE;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(GE||(GE={}));var HE;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(HE||(HE={}));const iae={float32:GE,int32:jE,bool:WE,complex64:HE};function Gr(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return iae[n][e]}function c2(n){return Gr(n,"int32")}function Lz(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function Fz(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Un(n,e){if(n.dtype===e.dtype)return[n,e];const t=Gr(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function Vz(n){const e=[];return Uz(n,e,new Set),e}function Uz(n,e,t){if(n==null)return;if(n instanceof ts){e.push(n);return}if(!oae(n))return;const s=n;for(const r in s){const i=s[r];t.has(i)||(t.add(i),Uz(i,e,t))}}function oae(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gT(n){return n.kernelName!=null}class RL{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class kf{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new RL}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(si(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Yoe(this.backendInstance),!0}setupRegisteredKernels(){EL(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){EL(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof gN)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,i=s.then(o=>r<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,si(`Initialization of backend ${e} failed`),si(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return si(`Initialization of backend ${e} failed`),si(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:i}=this.initializeBackend(s);if(i||r)return{name:s,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,i=this.readSync(t),o=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,i,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return kf.nextTensorId++}nextVariableId(){return kf.nextVariableId++}clone(e){const t=re.runKernel(Vy,{x:e}),s={x:e},r=o=>({x:()=>{const a="float32",l={x:o},u={dtype:a};return re.runKernel(Ey,l,u)}}),i=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,i,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!(CL(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let i=0;s.forEach(l=>{i+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-t-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=gT(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(gT(e)){const{kernelName:b,inputs:w,attrs:v}=e;this.backendName==null&&this.backend;const S=CL(b,this.backendName);j(S!=null,()=>`Cannot find registered kernel '${b}' for backend '${this.backendName}'`),a=()=>{const T=this.backend.numDataIds();l=S.kernelFunc({inputs:w,attrs:v,backend:this.backend});const I=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(b,T,I);const k=I.map(O=>O.rank!=null?O:this.makeTensorFromTensorInfo(O));if(r){const O=this.getTensorsForGradient(b,w,k);s=this.saveTensorsForBackwardMode(O)}return k}}else{const{forwardFunc:b}=e,w=v=>{r&&(s=v.map(S=>this.keep(this.clone(S))))};a=()=>{const v=this.backend.numDataIds();l=this.tidy(()=>b(this.backend,w));const S=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,v,S),S}}const{inputs:d,attrs:f}=e,m=gT(e)?null:e.backwardsFunc;let y;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(y=this.profiler.profileKernel(u,d,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(y),t=y.outputs)}),r&&this.addTapeNode(u,d,t,m,s,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(b=>d[b]!=null?d[b].shape:null),outputShapes:t.map(b=>b.shape),kernelTimeMs:y.timeMs,extraInfo:y.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=TL(e);if(r!=null){const i=r.inputsToSave||[],o=r.outputsToSave||[];let a;r.saveAllInputs?(j(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(u=>t[u])):a=i.map(u=>t[u]);const l=s.filter((u,d)=>o[d]);return a.concat(l)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let i=e;s==="string"&&by(e[0])&&(i=e.map(l=>oc(l)));const o=r.write(i,t,s),a=new ts(t,s,o,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(o),u=Ioe(i);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,t,s,r){s=s||"float32";const i={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:i}=e,o=new ts(r,i,s,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const i=new qv(e,t,s,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*jv(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof qv||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*jv(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:i},l=TL(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=u=>(u=u.map((d,f)=>{if(d==null){const m=s[f],y=Zs(m.size,m.dtype);return this.makeTensor(y,m.shape,m.dtype)}return d}),r(u.length>1?u:u[0],i,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=Vz(e),s=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!s.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(e,t,s,r=!1){if(j(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));j(i instanceof ts,()=>"The result y returned by f() must be a tensor.");const o=Zoe(this.state.activeTape,t,i);if(!r&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=s??aae(i.shape),eae(a,o,u=>this.tidy(u),lae);const l=t.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const d of u.saved)d.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return j(LE(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{j(t.every(a=>a instanceof ts),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((a,l)=>{r[l]=a});const i=(a,l)=>(s=e(...t,l),j(s.value instanceof ts,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),j(LE(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(a,l)=>{const u=s.gradFunc(a,l),d=Array.isArray(u)?u:[u];j(d.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),j(d.every(m=>m instanceof ts),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const f={};return d.forEach((m,y)=>{f[y]=()=>m}),f};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=Sr(),s=await this.backend.time(e);return s.wallMs=Sr()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new RL;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}kf.nextTensorId=0;kf.nextVariableId=0;function aae(n){const e=xN(xe(n),"float32");return re.makeTensor(e,n,"float32")}function Bz(){const n=az();if(n._tfengine==null){const e=new Aoe(n);n._tfengine=new kf(e)}return Ooe(n._tfengine.ENV),sae(()=>n._tfengine),n._tfengine}const re=Bz();function lae(n,e){const t={a:n,b:e};return re.runKernel(ep,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cae(){return typeof navigator<"u"&&navigator!=null}function zz(n){if(n||cae()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function jz(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ir=pe();Ir.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Ir.registerFlag("IS_BROWSER",()=>jz());Ir.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Ir.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Ir.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Ir.registerFlag("PROD",()=>!1);Ir.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Ir.getBool("DEBUG"));Ir.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Ir.registerFlag("IS_TEST",()=>!1);Ir.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Ir.getBool("DEBUG"));Ir.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Ir.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Ir.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i1(n,e){let t=n;if(Oi(n))return e==="string"?[]:[n.length];if(Lz(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(Fz(n))return[n.buffer.size/(e==null?4:jv(e))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||Oi(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&pe().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Wz(n,s,[]),s}function Wz(n,e,t){if(t=t||[],!Array.isArray(n)&&!Oi(n)){j(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}j(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),j(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)Wz(n[r],s,t.concat(r))}function $L(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function H(n,e,t,s="numeric"){if(n instanceof ye())return $L(s,n.dtype,e,t),n;let r=Jf(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),$L(s,r,e,t),n==null||!Oi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const i=i1(n,r);!Oi(n)&&!Array.isArray(n)&&(n=[n]);const a=r!=="string"?kh(n,r):ah(n,[],!0);return re.makeTensor(a,i,r)}function Gz(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,o)=>H(i,`${e}[${o}]`,t,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uae="__op";function ae(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+uae;const r=(...i)=>{re.startScope(t);try{const o=s(...i);return vN(o)&&console.error("Cannot return a Promise inside of tidy."),re.endScope(o),o}catch(o){throw re.endScope(null),o}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hae(n,e){const t=H(n,"real","complex"),s=H(e,"imag","complex");bN(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return re.runKernel(NN,r)}const lh=ae({complex_:hae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o1(n,e,t,s){if(s==null)s=Jf(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(Fz(n)||Lz(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return re.backend.createTensorFromGPUData(n,e||t,s)}if(!Oi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){il(e);const r=xe(e),i=xe(t);j(r===i,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${i}`);for(let o=0;o<t.length;++o){const a=t[o],l=o===t.length-1?a!==xe(e.slice(o)):!0;j(t[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Oi(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?kh(n,s):ah(n,[],!0),re.makeTensor(n,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ug(n,e,t){const s=i1(n,t);return o1(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kv={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Mc{static join(e){return new Mc(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>Oi(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=t+r.byteLength;this.shards.push({buffer:r,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=t-e,i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(let l=s;l<this.shards.length;l++){const u=this.shards[l],f=e+a-u.start,m=a,b=Math.min(t,u.end)-u.start,w=new Uint8Array(u.buffer,f,b-f);if(o.set(w,m),a+=w.length,t<u.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(r){return e<r.start?-1:e>=r.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=dae(this.shards,t);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function dae(n,e){let t=0,s=n.length;for(;t<=s;){const r=Math.floor((s-t)/2)+t,i=e(n[r]);if(i===0)return r;i<0?s=r:t=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ko(){return re}function DL(){return re.memory()}function de(n,e){return re.tidy(n,e)}function ut(n){Vz(n).forEach(t=>t.dispose())}function jo(n){return re.keep(n)}function Hz(n,e,t=1){return re.registerBackend(n,e,t)}function fae(){return re.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nf=4;async function OL(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(o=>o.name):Object.keys(n);for(let o=0;o<r.length;++o){const a=r[o],l=Array.isArray(n)?n[o].tensor:n[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const d=new Promise(async f=>{const m=await l.bytes(),y=m.reduce((v,S)=>v+S.length,0)+Nf*m.length,b=new Uint8Array(y);let w=0;for(let v=0;v<m.length;v++){const S=m[v],T=new Uint8Array(new Uint32Array([S.length]).buffer);b.set(T,w),w+=Nf,b.set(S,w),w+=S.length}f(b)});s.push(d)}else s.push(l.data());e!=null&&(u.group=e),t.push(u)}const i=await Promise.all(s);return{data:yae(i),specs:t}}function pae(n,e){const t=new Mc(n),s={};let r=0;for(const i of e){const o=mae(i,(a,l)=>t.slice(r+a,r+l));s[i.name]=gae(i,t.slice(r,r+o)),r+=o}return s}function mae(n,e){const t=xe(n.shape);let s;if("quantization"in n){const r=n.quantization;s=Kv[r.dtype]}else if(n.dtype==="string"){let r=0;for(let i=0;i<t;i++)r+=Nf+new Uint32Array(e(r,r+Nf))[0];return r}else s=Kv[n.dtype];return t*s}function gae(n,e){const t=n.name,s=n.dtype,r=n.shape,i=xe(r);let o,a=0;if("quantization"in n){const l=n.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${n.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${n.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const u=Kv[l.dtype],d=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){o=new Float32Array(d.length);for(let f=0;f<d.length;f++){const m=d[f];o[f]=m*l.scale+l.min}}else if(l.dtype==="float16")o=Iae()(d);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);o=new Int32Array(d.length);for(let f=0;f<d.length;f++){const m=d[f];o[f]=Math.round(m*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=i*u}else if(s==="string"){const l=xe(n.shape);o=[];for(let u=0;u<l;u++){const d=new Uint32Array(e.slice(a,a+Nf))[0];a+=Nf;const f=new Uint8Array(e.slice(a,a+d));o.push(f),a+=d}}else{const l=Kv[s];if(s==="float32")o=new Float32Array(e);else if(s==="int32")o=new Int32Array(e);else if(s==="bool")o=new Uint8Array(e);else if(s==="complex64"){o=new Float32Array(e);const u=new Float32Array(o.length/2),d=new Float32Array(o.length/2);for(let b=0;b<u.length;b++)u[b]=o[b*2],d[b]=o[b*2+1];const f=ug(u,r,"float32"),m=ug(d,r,"float32"),y=lh(f,m);return f.dispose(),m.dispose(),y}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=i*l}return ug(o,r,s)}function yae(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(i=>{if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(i=>{s.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),s.buffer}const u2=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function PL(n){return u2?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function bae(n){if(u2)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function xae(n){if(u2){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function vae(n){return Mc.join(n)}function wae(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function _ae(n,e,t){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=t}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(s.initializerSignature=n.initializerSignature),s}async function Sae(n,e){let t,s;return n.weightsManifest!=null&&([t,s]=await e(n.weightsManifest)),_ae(n,t,s)}function h2(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:PL(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:PL(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Mc(n.weightData).byteLength}}function ML(n){const e=[];for(const t of n)e.push(...t.weights);return e}function Cae(){const n=t=>{let s=t<<13,r=0;for(;(s&8388608)===0;)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function Tae(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function Eae(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function Iae(){const n=Cae(),e=Tae(),t=Eae();return s=>{const r=new ArrayBuffer(4*s.length),i=new Uint32Array(r);for(let o=0;o<s.length;o++){const a=s[o],l=n[t[a>>10]+(a&1023)]+e[a>>10];i[o]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bs{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return bs.instance==null&&(bs.instance=new bs),bs.instance}static registerSaveRouter(e){bs.getInstance().saveRouters.push(e)}static registerLoadRouter(e){bs.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return bs.getHandlers(e,"save")}static getLoadHandlers(e,t){return bs.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?bs.getInstance().loadRouters:bs.getInstance().saveRouters).forEach(o=>{const a=o(e,s);a!==null&&r.push(a)}),r}}const qz=n=>bs.getSaveHandlers(n),kae=(n,e)=>bs.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qE="tensorflowjs",KE=1,Uu="models_store",Yl="model_info_store";function Kz(){if(!pe().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function XE(n){const e=n.result;e.createObjectStore(Uu,{keyPath:"modelPath"}),e.createObjectStore(Yl,{keyPath:"modelPath"})}class ch{constructor(e){if(this.indexedDB=Kz(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const i=this.indexedDB.open(qE,KE);i.onupgradeneeded=()=>XE(i),i.onsuccess=()=>{const o=i.result;if(t==null){const a=o.transaction(Uu,"readonly"),u=a.objectStore(Uu).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(u.result.modelArtifacts)},u.onerror=d=>(o.close(),r(u.error)),a.oncomplete=()=>o.close()}else{t.weightData=Mc.join(t.weightData);const a=h2(t),l=o.transaction(Yl,"readwrite");let u=l.objectStore(Yl),d;try{d=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(m){return r(m)}let f;d.onsuccess=()=>{f=o.transaction(Uu,"readwrite");const m=f.objectStore(Uu);let y;try{y=m.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(b){return r(b)}y.onsuccess=()=>s({modelArtifactsInfo:a}),y.onerror=b=>{u=l.objectStore(Yl);const w=u.delete(this.modelPath);w.onsuccess=()=>(o.close(),r(y.error)),w.onerror=v=>(o.close(),r(y.error))}},d.onerror=m=>(o.close(),r(d.error)),l.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},i.onerror=o=>r(i.error)})}}ch.URL_SCHEME="indexeddb://";const Xz=n=>pe().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ch.URL_SCHEME)?Nae(n.slice(ch.URL_SCHEME.length)):null;bs.registerSaveRouter(Xz);bs.registerLoadRouter(Xz);function Nae(n){return new ch(n)}function Aae(n){return n.startsWith(ch.URL_SCHEME)?n.slice(ch.URL_SCHEME.length):n}class Rae{constructor(){this.indexedDB=Kz()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open(qE,KE);s.onupgradeneeded=()=>XE(s),s.onsuccess=()=>{const r=s.result,i=r.transaction(Yl,"readonly"),a=i.objectStore(Yl).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),t(a.error)),i.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=Aae(e),new Promise((t,s)=>{const r=this.indexedDB.open(qE,KE);r.onupgradeneeded=()=>XE(r),r.onsuccess=()=>{const i=r.result,o=i.transaction(Yl,"readwrite"),a=o.objectStore(Yl),l=a.get(e);let u;l.onsuccess=()=>{if(l.result==null)return i.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const d=a.delete(e),f=()=>{u=i.transaction(Uu,"readwrite");const y=u.objectStore(Uu).delete(e);y.onsuccess=()=>t(l.result.modelArtifactsInfo),y.onerror=b=>s(l.error)};d.onsuccess=f,d.onerror=m=>(f(),i.close(),s(l.error))}},l.onerror=d=>(i.close(),s(l.error)),o.oncomplete=()=>{u==null?i.close():u.oncomplete=()=>i.close()}},r.onerror=i=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const La="/",Qd="tensorflowjs_models",Yz="info",$ae="model_topology",Dae="weight_specs",Oae="weight_data",Pae="model_metadata";function Qz(n){return{info:[Qd,n,Yz].join(La),topology:[Qd,n,$ae].join(La),weightSpecs:[Qd,n,Dae].join(La),weightData:[Qd,n,Oae].join(La),modelMetadata:[Qd,n,Pae].join(La)}}function Jz(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function Mae(n){const e=n.split(La);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(La)}function Lae(n){return n.startsWith(uh.URL_SCHEME)?n.slice(uh.URL_SCHEME.length):n}class uh{constructor(e){if(!pe().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Qz(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=h2(e),i=Mc.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,bae(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw Jz(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=xae(o),t}}uh.URL_SCHEME="localstorage://";const Zz=n=>pe().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(uh.URL_SCHEME)?Fae(n.slice(uh.URL_SCHEME.length)):null;bs.registerSaveRouter(Zz);bs.registerLoadRouter(Zz);function Fae(n){return new uh(n)}class Vae{constructor(){j(pe().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),j(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Qd+La,s=La+Yz;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(t)&&i.endsWith(s)){const o=Mae(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=Lae(e);const t=Qz(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return Jz(t),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LL="://";class Ao{constructor(){this.managers={}}static getInstance(){return Ao.instance==null&&(Ao.instance=new Ao),Ao.instance}static registerManager(e,t){j(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(LL)&&(e=e.slice(0,e.indexOf(LL))),j(e.length>0,()=>"scheme must not be an empty string.");const s=Ao.getInstance();j(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=Ao.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(Ao.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uae{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!pe().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return Rz(e)}}if(pe().get("IS_BROWSER")){pe().setPlatform("browser",new Uae);try{Ao.registerManager(uh.URL_SCHEME,new Vae)}catch{}try{Ao.registerManager(ch.URL_SCHEME,new Rae)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bae={importFetch:()=>require("node-fetch")};let yT;class zae{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return pe().global.fetch!=null?pe().global.fetch(e,t):(yT==null&&(yT=Bae.importFetch()),yT(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}pe().get("IS_NODE")&&!pe().get("IS_BROWSER")&&pe().setPlatform("node",new zae);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ht(n,e="float32",t){return e=e||"float32",il(n),new Ms(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jae(n,e){const t=H(n,"x","cast");if(!Eoe(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return re.runKernel(Ey,s,r)}const Me=ae({cast_:jae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wae(n){const t={x:H(n,"x","clone","string_or_numeric")};return re.runKernel(Vy,t)}const Ku=ae({clone_:Wae});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gae(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Bz();const Hae={buffer:ht,cast:Me,clone:Ku,print:Gae};rae(Hae);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qae(n,e){let t=H(n,"a","add"),s=H(e,"b","add");[t,s]=Un(t,s);const r={a:t,b:s};return re.runKernel(ep,r)}const Ne=ae({add_:qae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kae(n,e){let t=H(n,"a","floorDiv"),s=H(e,"b","floorDiv");[t,s]=Un(t,s);const r={a:t,b:s};return re.runKernel(Ly,r)}const ej=ae({floorDiv_:Kae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xae(n,e){let t=H(n,"a","div"),s=H(e,"b","div");if([t,s]=Un(t,s),t.dtype==="int32"&&s.dtype==="int32")return ej(t,s);const r={a:t,b:s},i={};return re.runKernel(Ry,r,i)}const qe=ae({div_:Xae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yae(n,e){let t=H(n,"a","mul"),s=H(e,"b","mul");[t,s]=Un(t,s);const r={a:t,b:s};return re.runKernel(Ky,r)}const ee=ae({mul_:Yae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qae(n){const e=H(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return re.runKernel(h_,t)}else{const t={x:e};return re.runKernel(r_,t)}}const ur=ae({abs_:Qae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jae(n){const t={x:H(n,"x","acos")};return re.runKernel(xy,t)}const Zae=ae({acos_:Jae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ele(n){const t={x:H(n,"x","acosh")};return re.runKernel(vy,t)}const tle=ae({acosh_:ele});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nle(n,e=null,t=!1){const r={x:H(n,"x","all","bool")},i={axis:e,keepDims:t};return re.runKernel(SN,r,i)}const tj=ae({all_:nle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sle(n,e=null,t=!1){const r={x:H(n,"x","any","bool")},i={axis:e,keepDims:t};return re.runKernel(CN,r,i)}const YE=ae({any_:sle});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rle(n,e=0){const s={x:H(n,"x","argMax")},r={axis:e};return re.runKernel(i_,s,r)}const Mg=ae({argMax_:rle});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ile(n,e=0){const s={x:H(n,"x","argMin")},r={axis:e};return re.runKernel(o_,s,r)}const ole=ae({argMin_:ile});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ale(n){const t={x:H(n,"x","asin")};return re.runKernel(wy,t)}const lle=ae({asin_:ale});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cle(n){const t={x:H(n,"x","asinh")};return re.runKernel(_y,t)}const ule=ae({asinh_:cle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hle(n){const t={x:H(n,"x","atan")};return re.runKernel(Sy,t)}const dle=ae({atan_:hle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fle(n,e){let t=H(n,"a","atan2"),s=H(e,"b","atan2");[t,s]=Un(t,s);const r={a:t,b:s};return re.runKernel(Ty,r)}const ple=ae({atan2_:fle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mle(n){const t={x:H(n,"x","atanh")};return re.runKernel(Cy,t)}const gle=ae({atanh_:mle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p0(n,e,t,s,r="NHWC",i){const o=n[3],a=[...e,o],l=al(r);return Ls(n,a,t,i,s,null,null,l)}function Mi(n,e,t,s,r,i,o="channelsLast"){const[a,l]=Lg(e);let u;if(o==="channelsLast")u=[a,l,n[3],n[3]];else if(o==="channelsFirst")u=[a,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return Ls(n,u,t,s,r,i,!1,o)}function ol(n,e,t,s,r,i,o="NDHWC"){const[a,l,u]=QE(e);let d,f;if(o==="NDHWC")f="channelsLast",d=[a,l,u,n[4],n[4]];else if(o==="NCDHW")f="channelsFirst",d=[a,l,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return Lc(n,d,t,s,r,!1,f,i)}function Ls(n,e,t,s,r,i,o=!1,a="channelsLast"){let[l,u,d,f]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,d,f]=n;else if(a==="channelsFirst")[l,f,u,d]=n;else throw new Error(`Unknown dataFormat ${a}`);const[m,y,,b]=e,[w,v]=Lg(t),[S,T]=Lg(s),I=ff(m,S),k=ff(y,T),{padInfo:O,outHeight:V,outWidth:P}=xle(r,u,d,w,v,I,k,i,a),D=o?b*f:b;let $;return a==="channelsFirst"?$=[l,D,V,P]:a==="channelsLast"&&($=[l,V,P,D]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:d,inChannels:f,outHeight:V,outWidth:P,outChannels:D,padInfo:O,strideHeight:w,strideWidth:v,filterHeight:m,filterWidth:y,effectiveFilterHeight:I,effectiveFilterWidth:k,dilationHeight:S,dilationWidth:T,inShape:n,outShape:$,filterShape:e}}function Lc(n,e,t,s,r,i=!1,o="channelsLast",a){let[l,u,d,f,m]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,u,d,f,m]=n;else if(o==="channelsFirst")[l,m,u,d,f]=n;else throw new Error(`Unknown dataFormat ${o}`);const[y,b,w,,v]=e,[S,T,I]=QE(t),[k,O,V]=QE(s),P=ff(y,k),D=ff(b,O),$=ff(w,V),{padInfo:R,outDepth:A,outHeight:U,outWidth:F}=vle(r,u,d,f,S,T,I,P,D,$,a),ne=i?v*m:v;let Q;return o==="channelsFirst"?Q=[l,ne,A,U,F]:o==="channelsLast"&&(Q=[l,A,U,F,ne]),{batchSize:l,dataFormat:o,inDepth:u,inHeight:d,inWidth:f,inChannels:m,outDepth:A,outHeight:U,outWidth:F,outChannels:ne,padInfo:R,strideDepth:S,strideHeight:T,strideWidth:I,filterDepth:y,filterHeight:b,filterWidth:w,effectiveFilterDepth:P,effectiveFilterHeight:D,effectiveFilterWidth:$,dilationDepth:k,dilationHeight:O,dilationWidth:V,inShape:n,outShape:Q,filterShape:e}}function yle(n,e,t,s,r){s==null&&(s=d2(n,e,t));const i=n[0],o=n[1],a=Fg((i-e+2*s)/t+1,r),l=Fg((o-e+2*s)/t+1,r);return[a,l]}function ble(n,e,t,s,r,i){r==null&&(r=d2(n,e[0],s[0]));const o=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*r>=e[a]&&(o[a]=Fg((n[a]-e[a]+2*r)/s[a]+1,i));return o}function d2(n,e,t,s=1){const r=ff(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function Lg(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function QE(n){return typeof n=="number"?[n,n,n]:n}function ff(n,e){return e<=1?n:n+(n-1)*(e-1)}function xle(n,e,t,s,r,i,o,a,l){let u,d,f;if(typeof n=="number"){u={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const y=yle([e,t],i,s,n,a);d=y[0],f=y[1]}else if(n==="same"){d=Math.ceil(e/s),f=Math.ceil(t/r);const m=Math.max(0,(d-1)*s+i-e),y=Math.max(0,(f-1)*r+o-t),b=Math.floor(m/2),w=m-b,v=Math.floor(y/2),S=y-v;u={top:b,bottom:w,left:v,right:S,type:"SAME"}}else if(n==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((e-i+1)/s),f=Math.ceil((t-o+1)/r);else if(typeof n=="object"){const m=l==="channelsLast"?n[1][0]:n[2][0],y=l==="channelsLast"?n[1][1]:n[2][1],b=l==="channelsLast"?n[2][0]:n[3][0],w=l==="channelsLast"?n[2][1]:n[3][1];u={top:m,bottom:y,left:b,right:w,type:m===0&&y===0&&b===0&&w===0?"VALID":"EXPLICIT"},d=Fg((e-i+m+y)/s+1,a),f=Fg((t-o+b+w)/r+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:u,outHeight:d,outWidth:f}}function vle(n,e,t,s,r,i,o,a,l,u,d){let f,m,y,b;if(n==="valid"&&(n=0),typeof n=="number"){f={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const v=ble([e,t,s,1],[a,l,u],1,[r,i,o],n,d);m=v[0],y=v[1],b=v[2]}else if(n==="same"){m=Math.ceil(e/r),y=Math.ceil(t/i),b=Math.ceil(s/o);const w=(m-1)*r+a-e,v=(y-1)*i+l-t,S=(b-1)*o+u-s,T=Math.floor(w/2),I=w-T,k=Math.floor(v/2),O=v-k,V=Math.floor(S/2),P=S-V;f={top:k,bottom:O,left:V,right:P,front:T,back:I,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:f,outDepth:m,outHeight:y,outWidth:b}}function Fg(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function hh(n){const[e,t,s]=Lg(n);return e===1&&t===1&&s===1}function tr(n,e){return hh(n)||hh(e)}function dh(n){return Lg(n).every(e=>e>0)}function al(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Nr(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")j(If(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{j(If(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wle(n,e){const s={x:H(n,"x","reshape","string_or_numeric")},r={shape:e};return re.runKernel(G_,s,r)}const oe=ae({reshape_:wle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _le(n,e,t,s,r){const i=H(n,"x","avgPool","float32"),o=1;j(tr(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=oe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),j(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Nr("avgPool",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let f=re.runKernel(a_,u,d);return f=Me(f,i.dtype),l?oe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const f2=ae({avgPool_:_le});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sle(n,e,t,s,r,i="NDHWC"){const o=H(n,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=oe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),j(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),j(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),j(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),Nr("avgPool3d",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i};let f=re.runKernel(l_,u,d);return f=Me(f,a.dtype),l?oe(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const Cle=ae({avgPool3d_:Sle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tle(n,e=0){j(n.length>=1,()=>"Pass at least one tensor to concat");const t=Gz(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return Ku(t[0]);const s=t,r={axis:e};return re.runKernel(d_,s,r)}const Er=ae({concat_:Tle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ele(n,e,t=!1,s=!1){let r=H(n,"a","matMul"),i=H(e,"b","matMul");[r,i]=Un(r,i);const o={a:r,b:i},a={transposeA:t,transposeB:s};return re.runKernel(c_,o,a)}const Ut=ae({matMul_:Ele});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ile(n){const t={x:H(n,"x","sigmoid","float32")};return re.runKernel(i0,t)}const tp=ae({sigmoid_:Ile});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kle(n,e,t){const s=H(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},i={begin:e,size:t};return re.runKernel(Y_,r,i)}const fn=ae({slice_:kle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nle(n){const t={x:H(n,"x","tanh","float32")};return re.runKernel(h0,t)}const a1=ae({tanh_:Nle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ale(n,e,t){const s=H(n,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);j(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),j(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),j(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const i={x:s},o={blockShape:e,crops:t};return re.runKernel(u_,i,o)}const p2=ae({batchToSpaceND_:Ale});function Rle(n){let e;return n.rank===0||n.rank===1?e=oe(n,[1,1,1,n.size]):n.rank===2?e=oe(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=oe(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $le(n,e,t,s,r,i){i==null&&(i=.001);const o=H(n,"x","batchNorm"),a=H(e,"mean","batchNorm"),l=H(t,"variance","batchNorm");let u;r!=null&&(u=H(r,"scale","batchNorm"));let d;s!=null&&(d=H(s,"offset","batchNorm")),j(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),j(d==null||a.rank===d.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),j(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const m={x:Rle(o),scale:u,offset:d,mean:a,variance:l},y={varianceEpsilon:i},b=re.runKernel(w_,m,y);return oe(b,o.shape)}const l1=ae({batchNorm_:$le});function Dle(n,e,t,s,r,i){const o=H(n,"x","batchNorm"),a=H(e,"mean","batchNorm"),l=H(t,"variance","batchNorm");let u;r!=null&&(u=H(r,"scale","batchNorm"));let d;return s!=null&&(d=H(s,"offset","batchNorm")),j(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),j(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),j(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&j(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),d!=null&&j(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${d.rank}.`),l1(o,a,l,d,u,i)}const Ole=ae({batchNorm2d_:Dle});function Ple(n,e,t,s,r,i){const o=H(n,"x","batchNorm"),a=H(e,"mean","batchNorm"),l=H(t,"variance","batchNorm");let u;r!=null&&(u=H(r,"scale","batchNorm"));let d;return s!=null&&(d=H(s,"offset","batchNorm")),j(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),j(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),j(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&j(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),d!=null&&j(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${d.rank}.`),l1(o,a,l,d,u,i)}const Mle=ae({batchNorm3d_:Ple});function Lle(n,e,t,s,r,i){const o=H(n,"x","batchNorm"),a=H(e,"mean","batchNorm"),l=H(t,"variance","batchNorm");let u;r!=null&&(u=H(r,"scale","batchNorm"));let d;return s!=null&&(d=H(s,"offset","batchNorm")),j(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),j(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),j(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&j(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),d!=null&&j(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${d.rank}.`),l1(o,a,l,d,u,i)}const Fle=ae({batchNorm4d_:Lle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vle(n,e,t){const s=H(n,"x","bincount"),r=H(e,"weights","bincount");j(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),j(t>=0,()=>`size must be non-negative, but got ${t}.`),j(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const i={x:s,weights:r},o={size:t};return re.runKernel(IN,i,o)}const Ule=ae({bincount_:Vle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ble(n,e){let t=H(n,"broadcastTo","x");const s=t.shape;if(il(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const u=t.shape.slice();for(;u.length<e.length;)u.unshift(1);t=oe(t,u)}const r=t.shape,i=Array.from(e);for(let u=e.length-1;u>=0;u--)if(r[u]===e[u])i[u]=1;else if(t.shape[u]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(i.map((u,d)=>u>1?d:-1).filter(u=>u>=0).length===0)return Ku(t);const a={x:t},l={reps:i};return re.runKernel(d0,a,l)}const hg=ae({broadcastTo_:Ble});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zle(n){const t={x:H(n,"x","ceil","float32")};return re.runKernel(Iy,t)}const jle=ae({ceil_:zle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c1(n,e,t){il(n),t=t||Jf(e);const s={shape:n,value:e,dtype:t};return re.runKernel(zN,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wle(n,e,t){const s=H(n,"x","clipByValue");if(j(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return c1(s.shape,e,s.dtype);const r={x:s},i={clipValueMin:e,clipValueMax:t};return re.runKernel(ky,r,i)}const ai=ae({clipByValue_:Wle});function Gle(n){return Er(n,0)}const Hle=ae({concat1d_:Gle});function qle(n,e){return Er(n,e)}const Kle=ae({concat2d_:qle});function Xle(n,e){return Er(n,e)}const Yle=ae({concat3d_:Xle});function Qle(n,e){return Er(n,e)}const Jle=ae({concat4d_:Qle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zle(n,e,t,s,r="NHWC",i=[1,1],o){const a=H(n,"x","conv2d","float32"),l=H(e,"filter","conv2d","float32");let u=a,d=!1;a.rank===3&&(d=!0,u=oe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),j(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),j(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),Nr("conv2d",s,o);const f=r==="NHWC"?u.shape[3]:u.shape[1];j(f===l.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${l.shape[2]}.`),j(tr(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),j(dh(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),j(dh(t),()=>"Error in conv2D: Strides should be larger than 0.");const m={x:u,filter:l},y={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},b=re.runKernel(f_,m,y);return d?oe(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const fh=ae({conv2d_:Zle});function ece(n,e,t,s,r="NWC",i=1,o){const a=H(n,"x","conv1d"),l=H(e,"filter","conv1d");let u=a,d=!1;a.rank===2&&(d=!0,u=oe(a,[1,a.shape[0],a.shape[1]])),j(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),j(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),Nr("conv1d",s,o),j(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),j(tr(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),j(dh(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),j(dh(t),()=>"Error in conv1D: Stride should be larger than 0."),j(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const f=oe(l,[1,l.shape[0],l.shape[1],l.shape[2]]),m=oe(u,[u.shape[0],1,u.shape[1],u.shape[2]]),v=fh(m,f,[1,t],s,"NHWC",[1,i],o);return d?oe(v,[v.shape[2],v.shape[3]]):oe(v,[v.shape[0],v.shape[2],v.shape[3]])}const nj=ae({conv1d_:ece});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tce(n,e,t,s,r,i="NHWC",o){j(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,l=e,u=!1;e.rank===3&&(u=!0,l=oe(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),j(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),j(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),j(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const d=i==="NHWC"?a[3]:a[1],f=i==="NHWC"?l.shape[3]:l.shape[1];j(d===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${t.shape[2]}.`),j(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),Nr("conv2dDerInput",r,o);const m={dy:l,filter:t},y={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,inputShape:a},b=re.runKernel(p_,m,y);return u?oe(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const m2=ae({conv2DBackpropInput_:tce});function nce(n,e,t,s,r,i){const o=H(n,"x","conv2dTranspose"),a=H(e,"filter","conv2dTranspose");return m2(t,o,a,s,r,"NHWC",i)}const sj=ae({conv2dTranspose_:nce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sce(n,e,t,s,r="NDHWC",i=[1,1,1]){const o=H(n,"x","conv3d"),a=H(e,"filter","conv3d");let l=o,u=!1;o.rank===4&&(u=!0,l=oe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),j(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),j(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),j(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),j(tr(t,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),j(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),j(dh(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),j(dh(t),()=>"Error in conv3D: Strides should be larger than 0.");const d={x:l,filter:a},f={strides:t,pad:s,dataFormat:r,dilations:i},m=re.runKernel(m_,d,f);return u?oe(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const rce=ae({conv3d_:sce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ice(n,e,t,s,r){j(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,o=e,a=!1;e.rank===4&&(a=!0,o=oe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);const l=i[4],u=o.shape[4];j(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),j(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),j(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),j(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),j(u===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${t.shape[4]}.`);const d={dy:o,filter:t},f={pad:r,strides:s,inputShape:i},m=re.runKernel($N,d,f);return a?oe(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const rj=ae({conv3DBackpropInput_:ice});function oce(n,e,t,s,r){const i=H(n,"x","conv3dTranspose"),o=H(e,"filter","conv3dTranspose");return rj(t,i,o,s,r)}const ace=ae({conv3dTranspose_:oce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lce(n){const t={x:H(n,"x","cos","float32")};return re.runKernel(Ny,t)}const g2=ae({cos_:lce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cce(n){const t={x:H(n,"x","cosh","float32")};return re.runKernel(Ay,t)}const ij=ae({cosh_:cce});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uce(n,e=0,t=!1,s=!1){const i={x:H(n,"x","cumprod")},o={axis:e,exclusive:t,reverse:s};return re.runKernel(DN,i,o)}const JE=ae({cumprod_:uce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hce(n,e=0,t=!1,s=!1){const i={x:H(n,"x","cumsum")},o={axis:e,exclusive:t,reverse:s};return re.runKernel(g_,i,o)}const oj=ae({cumsum_:hce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dce(n,e,t,s=!1){const r=H(n,"x","denseBincount"),i=H(e,"weights","denseBincount");j(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),j(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),j(t>=0,()=>`size must be non-negative, but got ${t}.`),j(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const o={x:r,weights:i},a={size:t,binaryOutput:s};return re.runKernel(PN,o,a)}const FL=ae({denseBincount_:dce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fce(n,e,t="NHWC"){const s=H(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],i=t==="NHWC"?s.shape[2]:s.shape[3],o=t==="NHWC"?s.shape[3]:s.shape[1];j(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),j(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),j(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${s.shape}`),j(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:t};return re.runKernel(MN,a,l)}const pce=ae({depthToSpace_:fce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mce(n,e,t,s,r="NHWC",i=[1,1],o){const a=H(n,"x","depthwiseConv2d","float32"),l=H(e,"filter","depthwiseConv2d","float32");let u=a,d=!1;a.rank===3&&(d=!0,u=oe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),j(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),j(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const f=r==="NHWC"?u.shape[3]:u.shape[1];j(f===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${l.shape[2]}.`),Nr("depthwiseConv2d",s,o);const m={x:u,filter:l},y={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},b=re.runKernel(y_,m,y);return d?oe(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const y2=ae({depthwiseConv2d_:mce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gce(n,e,t,s,r=[1,1],i="NHWC"){const o=H(n,"x","dilation2d"),a=H(e,"filter","dilation2d");j(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),j(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),j(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=o,u=!1;o.rank===3&&(l=oe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0),j(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const d={x:l,filter:a},f={strides:t,pad:s,dilations:r},m=re.runKernel(b_,d,f);return u?oe(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const yce=ae({dilation2d_:gce});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Af(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const i=t-1-r,o=n[i]||1;(e[e.length-1-r]||1)>1&&o===1&&s.unshift(i)}return s}function us(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],i=e.length-s-1,o=e[i];(r==null||r===1&&o>1)&&t.unshift(i)}return t}function it(n,e){const t=Math.max(n.length,e.length),s=new Array(t);for(let r=0;r<t;r++){let i=n[n.length-r-1];i==null&&(i=1);let o=e[e.length-r-1];if(o==null&&(o=1),i===1)s[t-r-1]=o;else if(o===1)s[t-r-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else s[t-r-1]=i}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bce(n,e){let t=H(n,"a","equal","string_or_numeric"),s=H(e,"b","equal","string_or_numeric");[t,s]=Un(t,s),it(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(x_,r)}const Yo=ae({equal_:bce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xce(n,e,t){const s=H(e,"a","where"),r=H(t,"b","where"),i=H(n,"condition","where","bool"),o=it(it(i.shape,s.shape),r.shape),a=hg(i,o),l=hg(s,o),u=hg(r,o),d={condition:a,t:l,e:u};return re.runKernel(X_,d)}const pr=ae({where_:xce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vce(n){const t={x:H(n,"x","zerosLike")};return re.runKernel(s1,t)}const At=ae({zerosLike_:vce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wce(n,e){let t=H(n,"a","div"),s=H(e,"b","div");[t,s]=Un(t,s);const r=qe(t,s),i=At(r),o=Yo(s,i);return pr(o,i,r)}const _ce=ae({divNoNan_:wce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sce(n,e){const t=H(n,"t1","dot"),s=H(e,"t2","dot");j((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],i=s.rank===1?s.size:s.shape[0];if(j(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),t.rank===1&&s.rank===1){const o=oe(t,[1,-1]),a=oe(s,[-1,1]),l=Ut(o,a);return oe(l,[])}else if(t.rank===1&&s.rank===2){const o=oe(t,[1,-1]),a=oe(s,[s.shape[0],s.shape[1]]),l=Ut(o,a);return oe(l,[l.size])}else if(t.rank===2&&s.rank===1){const o=oe(s,[-1,1]),a=Ut(t,o);return oe(a,[a.size])}else{const o=oe(s,[s.shape[0],s.shape[1]]);return Ut(t,o)}}const Cce=ae({dot_:Sce});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tce(n,...e){const t=e.map((r,i)=>H(r,`tensors${i}`,"einsum")),s={equation:n};return re.runKernel(VN,t,s)}const Nm=ae({einsum_:Tce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ece(n){const t={x:H(n,"x","elu","float32")};return re.runKernel($y,t)}const u1=ae({elu_:Ece});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ice(n){let e=H(n,"x","erf");j(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Me(e,"float32"));const t={x:e};return re.runKernel(Dy,t)}const aj=ae({erf_:Ice});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b2(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function lj(n,e,t){const s=n.length+e.length,r=[];let i=0,o=0;for(let a=0;a<s;a++)t.indexOf(a)===-1?r.push(n[i++]):r.push(e[o++]);return r}function Ss(n,e){const t=[],s=n.length;for(let i=0;i<s;i++)e.indexOf(i)===-1&&t.push(n[i]);const r=e.map(i=>n[i]);return[t,r]}function Xn(n,e){const t=e.map(s=>1);return lj(n,t,e)}function Fs(n,e,t){j(b2(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function Nn(n,e){if(b2(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function Fc(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function Bn(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kce(n,e=null,t=!1){const r={x:H(n,"x","max")},i={reductionIndices:e,keepDims:t};return re.runKernel(R_,r,i)}const so=ae({max_:kce});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nce(n,e=null,t=!1){const r={x:H(n,"x","min")},i={axis:e,keepDims:t};return re.runKernel(P_,r,i)}const Xv=ae({min_:Nce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ace(n,e){let t=H(n,"base","pow"),s=H(e,"exp","pow");[t,s]=Un(t,s);const r={a:t,b:s};return re.runKernel(Xy,r)}const ph=ae({pow_:Ace});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bt(n,e){if((Oi(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Oi(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return o1(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rce(n){const t={x:H(n,"x","sqrt","float32")};return re.runKernel(a0,t)}const er=ae({sqrt_:Rce});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ce(n){const e=H(n,"x","square"),t={};return re.runKernel("Square",{x:e},t)}const vn=ae({square_:$ce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dce(n,e=null,t=!1){let s=H(n,"x","sum");s.dtype==="bool"&&(s=Me(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return re.runKernel(Q_,r,i)}const Ge=ae({sum_:Dce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oce(n,e="euclidean",t=null,s=!1){n=H(n,"x","norm");const r=cj(n,e,t);let i=r.shape;if(s){const o=dt(t,n.shape);i=Xn(r.shape,o)}return oe(r,i)}function cj(n,e,t=null){if(n.rank===0)return ur(n);if(n.rank!==1&&t===null)return cj(oe(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Ge(ur(n),t);if(e===1/0)return so(ur(n),t);if(e===-1/0)return Xv(ur(n),t);if(e==="euclidean"||e===2)return er(Ge(ph(ur(n),Bt(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return so(Ge(ur(n),t[0]),t[1]-1);if(e===1/0)return so(Ge(ur(n),t[1]),t[0]);if(e===-1/0)return Xv(Ge(ur(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return er(Ge(vn(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const h1=ae({norm_:Oce});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pce(n,e=null,t=!1){return h1(n,"euclidean",e,t)}const Mce=ae({euclideanNorm_:Pce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lce(n){const t={x:H(n,"x","exp")};return re.runKernel(Oy,t)}const Qo=ae({exp_:Lce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fce(n,e=0){const t=H(n,"x","expandDims","string_or_numeric");j(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return re.runKernel(v_,s,r)}const Cr=ae({expandDims_:Fce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vce(n){const t={x:H(n,"x","expm1")};return re.runKernel(Py,t)}const Uce=ae({expm1_:Vce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bce(n,e){const t=H(n,"x","tile","string_or_numeric");j(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return re.runKernel(d0,s,r)}const Zi=ae({tile_:Bce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zce(n,e,t,s="float32"){e==null&&(e=n);const r=ht([n,e],s),i=n<=e?n:e;for(let a=0;a<i;++a)r.set(1,a,a);const o=oe(r.toTensor(),[n,e]);if(t==null)return o;if(t.length===1)return Zi(Cr(o,0),[t[0],1,1]);if(t.length===2)return Zi(Cr(Cr(o,0),0),[t[0],t[1],1,1]);if(t.length===3)return Zi(Cr(Cr(Cr(o,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const uj=ae({eye_:zce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jce(n){const t={x:H(n,"x","floor","float32")};return re.runKernel(My,t)}const d1=ae({floor_:jce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wce(n,e,t=0,s=0){const r=H(n,"x","gather"),i=H(e,"indices","gather","int32"),o={x:r,indices:i},a={axis:t,batchDims:s};return re.runKernel(__,o,a)}const x2=ae({gather_:Wce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gce(n,e){let t=H(n,"a","greater","string_or_numeric"),s=H(e,"b","greater","string_or_numeric");[t,s]=Un(t,s),it(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(S_,r)}const li=ae({greater_:Gce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hce(n,e){let t=H(n,"a","greaterEqual","string_or_numeric"),s=H(e,"b","greaterEqual","string_or_numeric");[t,s]=Un(t,s),it(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(Fy,r)}const Nh=ae({greaterEqual_:Hce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qce(n){const t={input:H(n,"input","imag")};return re.runKernel(GN,t)}const v2=ae({imag_:qce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kce(n){const t={x:H(n,"x","isFinite")};return re.runKernel(Uy,t)}const Xce=ae({isFinite_:Kce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yce(n){const t={x:H(n,"x","isInf")};return re.runKernel(By,t)}const Qce=ae({isInf_:Yce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jce(n){const t={x:H(n,"x","isNaN")};return re.runKernel(zy,t)}const Zce=ae({isNaN_:Jce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eue(n,e=.2){const s={x:H(n,"x","leakyRelu")},r={alpha:e};return re.runKernel(C_,s,r)}const w2=ae({leakyRelu_:eue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tue(n,e){let t=H(n,"a","less","string_or_numeric"),s=H(e,"b","less","string_or_numeric");[t,s]=Un(t,s),it(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(T_,r)}const Yv=ae({less_:tue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nue(n,e){let t=H(n,"a","lessEqual","string_or_numeric"),s=H(e,"b","lessEqual","string_or_numeric");[t,s]=Un(t,s),it(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(E_,r)}const np=ae({lessEqual_:nue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sue(n,e=5,t=1,s=1,r=.5){const i=H(n,"x","localResponseNormalization");j(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),j(If(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=oe(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:o},u={depthRadius:e,bias:t,alpha:s,beta:r},d=re.runKernel(A_,l,u);return a?oe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const rue=ae({localResponseNormalization_:sue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iue(n){const t={x:H(n,"x","log","float32")};return re.runKernel(jy,t)}const Jo=ae({log_:iue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oue(n){const t={x:H(n,"x","log1p")};return re.runKernel(Wy,t)}const hj=ae({log1p_:oue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aue(n,e){j(LE(n),()=>"The f passed in variableGrads(f) must be a function"),j(e==null||Array.isArray(e)&&e.every(u=>u instanceof qv),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const u in re.registeredVariables)e.push(re.registeredVariables[u])}const s=t?e.filter(u=>!u.trainable):null,r=e.length;e=e.filter(u=>u.trainable),j(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:o,grads:a}=re.gradients(n,e,null,i);j(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),j(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((u,d)=>{a[d]!=null&&(l[u.name]=a[d])}),s?.forEach(u=>l[u.name]=null),{value:o,grads:l}}function Rf(n){return re.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lue(n){const t={x:H(n,"x","neg")};return re.runKernel(L_,t)}const Vn=ae({neg_:lue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cue(n){const t={x:H(n,"x","softplus")};return re.runKernel(o0,t)}const m0=ae({softplus_:cue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uue(n){const e=H(n,"x","logSigmoid");return Rf(s=>({value:Vn(m0(Vn(s))),gradFunc:o=>ee(o,tp(Vn(s)))}))(e)}const hue=ae({logSigmoid_:uue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function due(n,e){let t=H(n,"a","sub"),s=H(e,"b","sub");[t,s]=Un(t,s);const r={a:t,b:s};return re.runKernel(c0,r)}const Qe=ae({sub_:due});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fue(n,e=-1){const t=H(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return Rf((r,i)=>{const a=so(r,e,!0),l=Qe(r,a),u=Qe(Me(l,"float32"),Jo(Ge(Qo(l),e,!0)));return i([u]),{value:u,gradFunc:(f,m)=>{const[y]=m,b=!0,w=Qo(y);return Qe(f,ee(Ge(f,e,b),w))}}})(t)}const dj=ae({logSoftmax_:fue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pue(n,e=null,t=!1){const s=H(n,"x","logSumExp"),r=dt(e,s.shape),i=so(s,r,!0),o=Qe(s,i),a=Qo(o),l=Ge(a,r),u=Jo(l),d=Ne(oe(i,u.shape),u);if(t){const f=Xn(d.shape,r);return oe(d,f)}return d}const fj=ae({logSumExp_:pue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mue(n,e){const t=H(n,"a","logicalAnd","bool"),s=H(e,"b","logicalAnd","bool");it(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(I_,r)}const Ja=ae({logicalAnd_:mue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gue(n){const t={x:H(n,"x","logicalNot","bool")};return re.runKernel(k_,t)}const _2=ae({logicalNot_:gue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yue(n,e){const t=H(n,"a","logicalOr","bool"),s=H(e,"b","logicalOr","bool");it(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(N_,r)}const pj=ae({logicalOr_:yue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bue(n,e){const t=H(n,"a","logicalXor","bool"),s=H(e,"b","logicalXor","bool");return it(t.shape,s.shape),Ja(pj(n,e),_2(Ja(n,e)))}const xue=ae({logicalXor_:bue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vue(n,e,t,s,r){const i=H(n,"x","maxPool"),o=1;let a=i,l=!1;i.rank===3&&(l=!0,a=oe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),j(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),j(tr(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),Nr("maxPool",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r},f=re.runKernel($_,u,d);return l?oe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const S2=ae({maxPool_:vue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wue(n,e=[1,1,1],t,s,r,i="NDHWC"){const o=H(n,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=oe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),j(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),j(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Nr("maxPool3d",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i},f=re.runKernel(D_,u,d);return l?oe(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const _ue=ae({maxPool3d_:wue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sue(n,e){let t=H(n,"a","maximum"),s=H(e,"b","maximum");[t,s]=Un(t,s),t.dtype==="bool"&&(t=Me(t,"int32"),s=Me(s,"int32")),it(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(Gy,r)}const Vc=ae({maximum_:Sue});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cue(n,e=null,t=!1){const r={x:H(n,"x","mean")},i={axis:e,keepDims:t};return re.runKernel(O_,r,i)}const Kn=ae({mean_:Cue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vs(n,e="float32"){if(il(n),e==="complex64"){const s=vs(n,"float32"),r=vs(n,"float32");return lh(s,r)}const t=Zs(xe(n),e);return re.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uc(n,e="float32"){if(il(n),e==="complex64"){const s=Uc(n,"float32"),r=vs(n,"float32");return lh(s,r)}const t=xN(xe(n),e);return re.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tue(n,e){let t=H(n,"a","minimum"),s=H(e,"b","minimum");[t,s]=Un(t,s),t.dtype==="bool"&&(t=Me(t,"int32"),s=Me(s,"int32")),it(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(Hy,r)}const Vg=ae({minimum_:Tue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eue(n,e,t){j(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=H(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");j(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let a=0;a<s.rank;a++)j(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),j(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const i={paddings:e,mode:t},o={x:s};return re.runKernel(M_,o,i)}const Iue=ae({mirrorPad_:Eue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kue(n,e){let t=H(n,"a","mod"),s=H(e,"b","mod");[t,s]=Un(t,s);const r={a:t,b:s};return re.runKernel(qy,r)}const Nue=ae({mod_:kue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aue(n,e=null,t=!1){n=H(n,"x","moments");const s=dt(e,n.shape),r=Kn(n,s,t);let i=r.shape;t||(i=Xn(r.shape,s));const o=vn(Qe(Me(n,"float32"),oe(r,i))),a=Kn(o,s,t);return{mean:r,variance:a}}const C2=ae({moments_:Aue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rue(n,e){let t=H(n,"a","notEqual","string_or_numeric"),s=H(e,"b","notEqual","string_or_numeric");[t,s]=Un(t,s),it(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(F_,r)}const Qv=ae({notEqual_:Rue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ue(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:H(n,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:t,offValue:s};return re.runKernel(U_,o,a)}const mj=ae({oneHot_:$ue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Due(n){const t={x:H(n,"x","onesLike")};return re.runKernel(V_,t)}const Pi=ae({onesLike_:Due});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oue(n,e,t=0){const s=H(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},i={x:s};return re.runKernel(z_,i,r)}const T2=ae({pad_:Oue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pue(n,e,t){const s=H(n,"x","spaceToBatchND");j(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),j(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),j(s.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+t[l-1][0]+t[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},i={blockShape:e,paddings:t};return re.runKernel(J_,r,i)}const E2=ae({spaceToBatchND_:Pue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mue(n,e,t,s,r,i,o){r==null&&(r=[1,1]),i==null&&(i=1),s===0&&(s="valid");const a=H(n,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=oe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),j(tr(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const d=Mi(l.shape,e,i,r,s),f=[d.dilationHeight,d.dilationWidth];let m;s==="same"?m=Fue([d.filterHeight,d.filterWidth],f):m=[[0,0],[0,0]];const y=f[0]===1&&f[1]===1,[b,w]=Lue([d.inHeight,d.inWidth],f,m),v=y?s:"valid",S=y?l:E2(l,f,b),I=(t==="avg"?()=>f2(S,e,i,v,o):()=>S2(S,e,i,v,o))(),k=y?I:p2(I,f,w);return u?oe(k,[k.shape[1],k.shape[2],k.shape[3]]):k}function Lue(n,e,t){const s=t.map(d=>d[0]),r=t.map(d=>d[1]),i=n.concat(s,r),o=e.map((d,f)=>(d-i[f]%d)%d),a=r.map((d,f)=>d+o[f]),l=e.map((d,f)=>[s[f],a[f]]),u=e.map((d,f)=>[0,o[f]]);return[l,u]}function Fue(n,e){const s=n.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),r=s.map(o=>Math.floor(o/2)),i=s.map((o,a)=>o-r[a]);return s.map((o,a)=>[r[a],i[a]])}const Vue=ae({pool_:Mue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uue(n,e){const t=H(n,"x","prelu"),s=H(e,"alpha","prelu"),r={x:t,alpha:s};return re.runKernel(j_,r)}const I2=ae({prelu_:Uue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bue(n,e=null,t=!1){let s=H(n,"x","prod");s.dtype==="bool"&&(s=Me(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return re.runKernel(W_,r,i)}const zue=ae({prod_:Bue});var qx={exports:{}},jue=qx.exports,VL;function Wue(){return VL||(VL=1,function(n){(function(e,t,s){function r(l){var u=this,d=a();u.next=function(){var f=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=f-(u.c=f|0)},u.c=1,u.s0=d(" "),u.s1=d(" "),u.s2=d(" "),u.s0-=d(l),u.s0<0&&(u.s0+=1),u.s1-=d(l),u.s1<0&&(u.s1+=1),u.s2-=d(l),u.s2<0&&(u.s2+=1),d=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var d=new r(l),f=u&&u.state,m=d.next;return m.int32=function(){return d.next()*4294967296|0},m.double=function(){return m()+(m()*2097152|0)*11102230246251565e-32},m.quick=m,f&&(typeof f=="object"&&i(f,d),m.state=function(){return i(d,{})}),m}function a(){var l=4022871197,u=function(d){d=String(d);for(var f=0;f<d.length;f++){l+=d.charCodeAt(f);var m=.02519603282416938*l;l=m>>>0,m-=l,m*=l,l=m>>>0,m-=l,l+=m*4294967296}return(l>>>0)*23283064365386963e-26};return u}t&&t.exports?t.exports=o:this.alea=o})(jue,n)}(qx)),qx.exports}var Kx={exports:{}},Gue=Kx.exports,UL;function Hue(){return UL||(UL=1,function(n){(function(e,t,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var f=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^f^f>>>8},a===(a|0)?l.x=a:u+=a;for(var d=0;d<u.length+64;d++)l.x^=u.charCodeAt(d)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var m=u.next()>>>11,y=(u.next()>>>0)/4294967296,b=(m+y)/(1<<21);while(b===0);return b},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xor128=o})(Gue,n)}(Kx)),Kx.exports}var Xx={exports:{}},que=Xx.exports,BL;function Kue(){return BL||(BL=1,function(n){(function(e,t,s){function r(a){var l=this,u="";l.next=function(){var f=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(f^f<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var d=0;d<u.length+64;d++)l.x^=u.charCodeAt(d)|0,d==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var m=u.next()>>>11,y=(u.next()>>>0)/4294967296,b=(m+y)/(1<<21);while(b===0);return b},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xorwow=o})(que,n)}(Xx)),Xx.exports}var Yx={exports:{}},Xue=Yx.exports,zL;function Yue(){return zL||(zL=1,function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var d=l.x,f=l.i,m,y;return m=d[f],m^=m>>>7,y=m^m<<24,m=d[f+1&7],y^=m^m>>>10,m=d[f+3&7],y^=m^m>>>3,m=d[f+4&7],y^=m^m<<7,m=d[f+7&7],m=m^m<<13,y^=m^m<<9,d[f]=y,l.i=f+1&7,y};function u(d,f){var m,y=[];if(f===(f|0))y[0]=f;else for(f=""+f,m=0;m<f.length;++m)y[m&7]=y[m&7]<<15^f.charCodeAt(m)+y[m+1&7]<<13;for(;y.length<8;)y.push(0);for(m=0;m<8&&y[m]===0;++m);for(m==8?y[7]=-1:y[m],d.x=y,d.i=0,m=256;m>0;--m)d.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var m=u.next()>>>11,y=(u.next()>>>0)/4294967296,b=(m+y)/(1<<21);while(b===0);return b},f.int32=u.next,f.quick=f,d&&(d.x&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xorshift7=o})(Xue,n)}(Yx)),Yx.exports}var Qx={exports:{}},Que=Qx.exports,jL;function Jue(){return jL||(jL=1,function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var d=l.w,f=l.X,m=l.i,y,b;return l.w=d=d+1640531527|0,b=f[m+34&127],y=f[m=m+1&127],b^=b<<13,y^=y<<17,b^=b>>>15,y^=y>>>12,b=f[m]=b^y,l.i=m,b+(d^d>>>16)|0};function u(d,f){var m,y,b,w,v,S=[],T=128;for(f===(f|0)?(y=f,f=null):(f=f+"\0",y=0,T=Math.max(T,f.length)),b=0,w=-32;w<T;++w)f&&(y^=f.charCodeAt((w+32)%f.length)),w===0&&(v=y),y^=y<<10,y^=y>>>15,y^=y<<4,y^=y>>>13,w>=0&&(v=v+1640531527|0,m=S[w&127]^=y+v,b=m==0?b+1:0);for(b>=128&&(S[(f&&f.length||0)&127]=-1),b=127,w=512;w>0;--w)y=S[b+34&127],m=S[b=b+1&127],y^=y<<13,m^=m<<17,y^=y>>>15,m^=m>>>12,S[b]=y^m;d.w=v,d.X=S,d.i=b}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var m=u.next()>>>11,y=(u.next()>>>0)/4294967296,b=(m+y)/(1<<21);while(b===0);return b},f.int32=u.next,f.quick=f,d&&(d.X&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xor4096=o})(Que,n)}(Qx)),Qx.exports}var Jx={exports:{}},Zue=Jx.exports,WL;function ehe(){return WL||(WL=1,function(n){(function(e,t,s){function r(a){var l=this,u="";l.next=function(){var f=l.b,m=l.c,y=l.d,b=l.a;return f=f<<25^f>>>7^m,m=m-y|0,y=y<<24^y>>>8^b,b=b-f|0,l.b=f=f<<20^f>>>12^m,l.c=m=m-y|0,l.d=y<<16^m>>>16^b,l.a=b-f|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var d=0;d<u.length+20;d++)l.b^=u.charCodeAt(d)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var m=u.next()>>>11,y=(u.next()>>>0)/4294967296,b=(m+y)/(1<<21);while(b===0);return b},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.tychei=o})(Zue,n)}(Jx)),Jx.exports}var Zx={exports:{}};const the={},nhe=Object.freeze(Object.defineProperty({__proto__:null,default:the},Symbol.toStringTag,{value:"Module"})),she=x3(nhe);var rhe=Zx.exports,GL;function ihe(){return GL||(GL=1,function(n){(function(e,t,s){var r=256,i=6,o=52,a="random",l=s.pow(r,i),u=s.pow(2,o),d=u*2,f=r-1,m;function y(k,O,V){var P=[];O=O==!0?{entropy:!0}:O||{};var D=S(v(O.entropy?[k,I(t)]:k??T(),3),P),$=new b(P),R=function(){for(var A=$.g(i),U=l,F=0;A<u;)A=(A+F)*r,U*=r,F=$.g(1);for(;A>=d;)A/=2,U/=2,F>>>=1;return(A+F)/U};return R.int32=function(){return $.g(4)|0},R.quick=function(){return $.g(4)/4294967296},R.double=R,S(I($.S),t),(O.pass||V||function(A,U,F,ne){return ne&&(ne.S&&w(ne,$),A.state=function(){return w($,{})}),F?(s[a]=A,U):A})(R,D,"global"in O?O.global:this==s,O.state)}function b(k){var O,V=k.length,P=this,D=0,$=P.i=P.j=0,R=P.S=[];for(V||(k=[V++]);D<r;)R[D]=D++;for(D=0;D<r;D++)R[D]=R[$=f&$+k[D%V]+(O=R[D])],R[$]=O;(P.g=function(A){for(var U,F=0,ne=P.i,Q=P.j,G=P.S;A--;)U=G[ne=f&ne+1],F=F*r+G[f&(G[ne]=G[Q=f&Q+U])+(G[Q]=U)];return P.i=ne,P.j=Q,F})(r)}function w(k,O){return O.i=k.i,O.j=k.j,O.S=k.S.slice(),O}function v(k,O){var V=[],P=typeof k,D;if(O&&P=="object")for(D in k)try{V.push(v(k[D],O-1))}catch{}return V.length?V:P=="string"?k:k+"\0"}function S(k,O){for(var V=k+"",P,D=0;D<V.length;)O[f&D]=f&(P^=O[f&D]*19)+V.charCodeAt(D++);return I(O)}function T(){try{var k;return m&&(k=m.randomBytes)?k=k(r):(k=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(k)),I(k)}catch{var O=e.navigator,V=O&&O.plugins;return[+new Date,e,V,e.screen,I(t)]}}function I(k){return String.fromCharCode.apply(0,k)}if(S(s.random(),t),n.exports){n.exports=y;try{m=she}catch{}}else s["seed"+a]=y})(typeof self<"u"?self:rhe,[],Math)}(Zx)),Zx.exports}var bT,HL;function ohe(){if(HL)return bT;HL=1;var n=Wue(),e=Hue(),t=Kue(),s=Yue(),r=Jue(),i=ehe(),o=ihe();return o.alea=n,o.xor128=e,o.xorwow=t,o.xorshift7=s,o.xor4096=r,o.tychei=i,bT=o,bT}var k2=ohe();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gj{constructor(e,t,s,r,i){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=k2.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,i,o;do r=2*this.random()-1,i=2*this.random()-1,o=r*r+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*r*a,t=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class ahe{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=k2.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lhe(n,e=0,t=1,s,r){if(il(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const i=new gj(e,t,s,!1,r),o=ht(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const che=ae({randomNormal_:lhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uhe(n,e=0,t=1,s="float32",r){il(n);const i=ht(n,s),o=new ahe(e,t,null,r);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const g0=ae({randomUniform_:uhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ug(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return re.runKernel(JN,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hhe(n){const t={input:H(n,"input","real")};return re.runKernel(ZN,t)}const Jv=ae({real_:hhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dhe(n){const t={x:H(n,"x","reciprocal")};return re.runKernel(Yy,t)}const fhe=ae({reciprocal_:dhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function phe(n){const t={x:H(n,"x","relu")};return re.runKernel(Qy,t)}const Ah=ae({relu_:phe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mhe(n){const t={x:H(n,"x","relu6")};return re.runKernel(Jy,t)}const yj=ae({relu6_:mhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ghe(n,e){const s={x:H(n,"x","reverse")},r={dims:e};return re.runKernel(K_,s,r)}const mh=ae({reverse_:ghe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yhe(n){const t={x:H(n,"x","round")};return re.runKernel(Zy,t)}const bj=ae({round_:yhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bhe(n){const t={x:H(n,"x","rsqrt","float32")};return re.runKernel(e0,t)}const xj=ae({rsqrt_:bhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xhe(n){const t={x:H(n,"x","selu")};return re.runKernel(t0,t)}const vj=ae({selu_:xhe});function vhe(n,e,t,s,r,i=[1,1],o="NHWC"){const a=H(n,"x","separableConv2d"),l=H(e,"depthwiseFilter","separableConv2d"),u=H(t,"pointwiseFilter","separableConv2d");let d=a,f=!1;if(a.rank===3&&(f=!0,d=oe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");j(d.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`),j(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),j(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),j(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),j(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const m=l.shape[2],y=l.shape[3];j(u.shape[2]===m*y,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${m*y}, but got ${u.shape[2]}.`);const b=y2(d,l,s,r,o,i),v=fh(b,u,1,"valid",o);return f?oe(v,[v.shape[1],v.shape[2],v.shape[3]]):v}const wj=ae({separableConv2d_:vhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function whe(n){const t={x:H(n,"x","sign")};return re.runKernel(r0,t)}const _he=ae({sign_:whe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function She(n){const t={x:H(n,"x","sin","float32")};return re.runKernel(n0,t)}const _j=ae({sin_:She});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Che(n){const t={x:H(n,"x","sinh")};return re.runKernel(s0,t)}const Sj=ae({sinh_:Che});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function The(n,e,t){const s=H(n,"x","slice1d");return j(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),fn(s,[e],[t])}const N2=ae({slice1d_:The});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ehe(n,e,t){const s=H(n,"x","slice2d");return j(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),fn(s,e,t)}const Cj=ae({slice2d_:Ehe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ihe(n,e,t){const s=H(n,"x","slice3d");return j(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),fn(s,e,t)}const A2=ae({slice3d_:Ihe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function khe(n,e,t){const s=H(n,"x","slice4d");return j(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),fn(s,e,t)}const Zv=ae({slice4d_:khe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nhe(n,e=-1){const t=H(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return re.runKernel(e1,s,r)}const R2=ae({softmax_:Nhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ahe(n){j(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return re.runKernel(BN,e)}const Tj=ae({fft_:Ahe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rhe(n){j(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return re.runKernel(WN,e)}const ZE=ae({ifft_:Rhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $he(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=oe(n,[t,e]);s=ZE(r)}else{const r=[t,2*(e-1)],i=oe(Jv(n),[t,e]),o=oe(v2(n),[t,e]),a=mh(fn(i,[0,1],[t,e-2]),1),l=ee(mh(fn(o,[0,1],[t,e-2]),1),Bt(-1)),u=Er([i,a],1),d=Er([o,l],1),f=oe(lh(u,d),[r[0],r[1]]);s=ZE(f)}if(s=Jv(s),n.rank===3&&n.shape[0]!==0){const r=s,i=n.shape[0];s=oe(s,[i,s.shape[0]/i,s.shape[1]]),r.dispose()}return s}const Dhe=ae({irfft_:$he});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ohe(n,e,t=0){const r={x:H(n,"x","split")},i={numOrSizeSplits:e,axis:t};return re.runKernel(Z_,r,i)}const oi=ae({split_:Ohe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Phe(n,e){j(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const b=n.shape.map(v=>0),w=n.shape.map(v=>v);w[n.shape.length-1]=e,r=fn(n,b,w),t=e}else if(e!=null&&e>t){const b=n.shape.map(w=>w);b[n.shape.length-1]=e-t,r=Er([n,vs(b)],n.shape.length-1),t=e}else r=n;const i=At(r),o=oe(lh(r,i),[s,t]),a=Tj(o),l=Math.floor(t/2)+1,u=Jv(a),d=v2(a),f=oi(u,[l,t-l],u.shape.length-1),m=oi(d,[l,t-l],d.shape.length-1),y=r.shape.slice();return y[r.shape.length-1]=l,oe(lh(f[0],m[0]),y)}const Mhe=ae({rfft_:Phe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lhe(n,e){let t=H(n,"a","squaredDifference"),s=H(e,"b","squaredDifference");[t,s]=Un(t,s),it(t.shape,s.shape);const r={a:t,b:s},i={};return re.runKernel(l0,r,i)}const Fhe=ae({squaredDifference_:Lhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vhe(n,e){const t=H(n,"x","squeeze","string_or_numeric");return oe(t,Oc(t.shape,e).newShape)}const y0=ae({squeeze_:Vhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uhe(n,e=0){const t=Gz(n,"tensors","stack","string_or_numeric");j(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&j(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return re.runKernel(B_,s,r)}const Za=ae({stack_:Uhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bhe(n,e=0){const s={x:H(n,"x","step")},r={alpha:e};return re.runKernel(f0,s,r)}const b0=ae({step_:Bhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zhe(n,e,t,s,r=0,i=0,o=0,a=0,l=0){const d={x:H(n,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:s,beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return re.runKernel(r2,d,f)}const jhe=ae({stridedSlice_:zhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Whe(n){const t={x:H(n,"x","tan","float32")};return re.runKernel(u0,t)}const Ghe=ae({tan_:Whe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jr(n,e){tz(n);const t=i1(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return o1(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ev(n,e,t){if(tz(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=i1(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return o1(n,e,s,t)}function Ej(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(i+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(i+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(i+` update.rank != ${r+n.length-s}`);for(let o=0;o<r;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-r;++o)if(t.shape[o+r]!==n[o+s])throw new Error(i+` updates.shape[${o+r}] (${t.shape[o+r]}) != shape[${o+r}] (${n[o+r]})`)}function Hhe(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}Ej(t,e,n)}function Rh(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,i=t.length;let o=1;for(let f=r;f<i;++f)o*=t[f];const a=r<1?1:r,l=xe(e.shape)/a,u=[...je(t.slice(0,r)),1],d=xe(t);return{sliceRank:r,numUpdates:l,sliceSize:o,strides:u,outputSize:d}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qhe(n,e=1,t=!0){const s=H(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const i={x:s},o={k:e,sorted:t},[a,l]=re.runKernel(i2,i,o);return{values:a,indices:l}}const Khe=ae({topk_:qhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xhe(n,e=0,t=1,s,r){if(il(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new gj(e,t,s,!0,r),o=ht(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const Ij=ae({truncatedNormal_:Xhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yhe(n,e=0){const t=H(n,"x","unique","string_or_numeric");j(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[i,o]=re.runKernel(a2,s,r);return{values:i,indices:o}}const Qhe=ae({unique_:Yhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jhe(n,e,t){const s=H(n,"x","unsortedSegmentSum"),r=H(e,"segmentIds","unsortedSegmentSum","int32");j(If(t),()=>"numSegments must be of dtype int");const i={x:s,segmentIds:r},o={numSegments:t};return re.runKernel(n1,i,o)}const kj=ae({unsortedSegmentSum_:Jhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zhe(n,e=0){const t=H(n,"x","unstack","string_or_numeric");j(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return re.runKernel(t1,s,r)}const gh=ae({unstack_:Zhe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ede(n,e=!0,t,s){return re.makeVariable(n,e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nj(n,e){const t=[];for(let i=0;i<e.length;i++)e[i]&&t.push(i);const s=ht(n,"int32"),r=ht([t.length,n.length],"int32");for(let i=0;i<t.length;i++){const o=s.indexToLoc(t[i]),a=i*n.length;r.values.set(o,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tde(n,e,t){const s=H(n,"x","transpose");if(e==null&&(e=s.shape.map((o,a)=>a).reverse()),j(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(o=>{j(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},i={perm:e};return s.dtype==="complex64"?de(()=>{let o=Jv(s),a=v2(s);return o=re.runKernel(df,{x:o},i),a=re.runKernel(df,{x:a},i),t&&(a=Vn(a)),lh(o,a)}):re.runKernel(df,r,i)}const Nt=ae({transpose_:tde});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nde(n,e){if(e==null)return n.shape.slice();if(zt(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sde(n,e,t,s){const r=H(n,"x","dropout");if(j(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),j(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof ts?r.clone():r;const i=nde(r,t),o=1-e,a=qe(d1(Ne(g0(i,0,1,"float32",s),o)),o);return ee(r,a)}const rde=ae({dropout_:sde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ide(n,e,t,s,r,i="NHWC",o){let a=n;n.rank===3&&(a=oe(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=oe(e,[1,e.shape[0],e.shape[1],e.shape[2]])),j(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),j(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),j(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const u=i==="NHWC"?a.shape[3]:a.shape[1],d=i==="NHWC"?l.shape[3]:l.shape[1];j(u===t[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${t[2]}.`),j(d===t[3],()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${t[3]}).`),Nr("conv2dDerFilter",r,o);const f={x:a,dy:l},m={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,filterShape:t};return re.runKernel(AN,f,m)}const $2=ae({conv2DBackpropFilter_:ide});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D2(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return ee(n,b0(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function O2(n,e){let t=e;const s=us(n.shape,e.shape);return s.length>0&&(t=Ge(t,s)),oe(t,n.shape)}function P2(n,e,t,s){if(e==="linear")return n;if(e==="relu")return Ah(n);if(e==="elu")return u1(n);if(e==="relu6")return yj(n);if(e==="prelu")return I2(n,t);if(e==="leakyrelu")return w2(n,s);if(e==="sigmoid")return tp(n);throw new Error(`Unknown fused activation ${e}.`)}const M2=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ode({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:d}){if(l=l||"linear",M2(re.state.gradientDepth,l)===!1){j(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let V=fh(n,e,t,s,r,i,o);return a!=null&&(V=Ne(V,a)),P2(V,l,u,d)}const f=H(n,"x","conv2d","float32"),m=H(e,"filter","conv2d","float32");let y=f,b=!1;f.rank===3&&(b=!0,y=oe(f,[1,f.shape[0],f.shape[1],f.shape[2]])),j(y.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${y.rank}.`),j(m.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${m.rank}.`),Nr("fused conv2d",s,o);const w=r==="NHWC"?y.shape[3]:y.shape[1];j(m.shape[2]===w,()=>`Error in conv2d: depth of input (${w}) must match input depth for filter ${m.shape[2]}.`),j(tr(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);const v=Ls(y.shape,m.shape,t,i,s,o);let S;a!=null&&(S=H(a,"bias","fused conv2d"),[S]=Un(S,f),r==="NHWC"?it(v.outShape,S.shape):(j(S.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${S.shape.length}.`),j(S.shape.length===0||S.shape[0]===v.outChannels||S.shape[0]===1,()=>`Error in fused conv2d: bias shape (${S.shape}) is not compatible with the number of output channels (${v.outChannels})`)));let T;if(u!=null){const V=u.shape;if(j(V.length<=1||V.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${V.length}.`),V.length===1)j(V[0]===1||V[0]===v.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${V}) is not compatible with the number of output channels (${v.outChannels}).`);else if(V.length===3)try{it(V,v.outShape)}catch{const D=`Error in fused conv2d: PReLU activation weights (${V}) is not compatible with the output shape of the conv2d (${v.outShape}).`;throw Error(D)}T=H(u,"prelu weights","fused conv2d")}const I=(V,P)=>{j(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[D,$,R,A]=P,U=D2(V,R,l);j(hh(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const F=m2($.shape,U,D,t,s),ne=$2($,U,D.shape,t,s),Q=[F,ne];if(A!=null){const G=O2(A,U);Q.push(G)}return Q},k={x:y,filter:m,bias:S,preluActivationWeights:T},O={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:d};return a==null?Rf((P,D,$)=>{let R=re.runKernel(Gv,k,O);return $([D,P,R]),b&&(R=oe(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:I}})(y,m):Rf((P,D,$,R)=>{let A=re.runKernel(Gv,k,O);return R([D,P,A,$]),b&&(A=oe(A,[A.shape[1],A.shape[2],A.shape[3]])),{value:A,gradFunc:I}})(y,m,S)}const ade=ae({fusedConv2d_:ode});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lde(n,e,t,s,r,i=[1,1],o){let a=n;n.rank===3&&(a=oe(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=oe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:a,dy:l},d={strides:s,pad:r,dimRoundingMode:o,dilations:i,filterShape:t};return re.runKernel(LN,u,d)}const cde=ae({depthwiseConv2dNativeBackpropFilter_:lde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ude(n,e,t,s,r,i=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=oe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:a,filter:t},d={strides:s,pad:r,dimRoundingMode:o,dilations:i,inputShape:n},f=re.runKernel(FN,u,d);return l?oe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const hde=ae({depthwiseConv2dNativeBackpropInput_:ude});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dde({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(M2(re.state.gradientDepth,i)===!1){let A=Ut(n,e,t,s);return r!=null&&(A=Ne(A,r)),P2(A,i,o,a)}let l=H(n,"a","fused matMul"),u=H(e,"b","fused matMul");[l,u]=Un(l,u);const d=t?l.shape[l.rank-2]:l.shape[l.rank-1],f=s?u.shape[u.rank-1]:u.shape[u.rank-2],m=t?l.shape[l.rank-1]:l.shape[l.rank-2],y=s?u.shape[u.rank-2]:u.shape[u.rank-1],b=l.shape.slice(0,-2),w=u.shape.slice(0,-2),v=xe(b),S=xe(w);j(d===f,()=>`Error in fused matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${t} and transposeB=${s} must match.`);const I=it(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([m,y]),k=t?oe(l,[v,d,m]):oe(l,[v,m,d]),O=s?oe(u,[S,y,f]):oe(u,[S,f,y]);let V;r!=null&&(V=H(r,"bias","fused matMul"),[V]=Un(V,l),it(I,V.shape));let P;o!=null&&(P=H(o,"prelu weights","fused matMul"));const D=(A,U)=>{const[F,ne,Q,G]=U,K=D2(oe(A,Q.shape),Q,i);let J,ce;if(!t&&!s?(J=Ut(K,ne,!1,!0),ce=Ut(F,K,!0,!1)):!t&&s?(J=Ut(K,ne,!1,!1),ce=Ut(K,F,!0,!1)):t&&!s?(J=Ut(ne,K,!1,!0),ce=Ut(F,K,!1,!1)):(J=Ut(ne,K,!0,!0),ce=Ut(K,F,!0,!0)),r!=null){const z=O2(G,K);return[J,ce,z]}else return[J,ce]},$={a:k,b:O,bias:V,preluActivationWeights:P},R={transposeA:t,transposeB:s,activation:i,leakyreluAlpha:a};return r==null?Rf((U,F,ne)=>{const Q=re.runKernel(Wv,$,R);return ne([U,F,Q]),{value:oe(Q,I),gradFunc:D}})(k,O):Rf((U,F,ne,Q)=>{const G=re.runKernel(Wv,$,R);return Q([U,F,G,ne]),{value:oe(G,I),gradFunc:D}})(k,O,V)}const qL=ae({fusedMatMul_:dde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fde(n,e,t,s,r="bilinear",i=0){const o=H(n,"image","cropAndResize"),a=H(e,"boxes","cropAndResize","float32"),l=H(t,"boxInd","cropAndResize","int32"),u=a.shape[0];j(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),j(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),j(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),j(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),j(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),j(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const d={image:o,boxes:a,boxInd:l},f={method:r,extrapolationValue:i,cropSize:s};return re.runKernel(ON,d,f)}const pde=ae({cropAndResize_:fde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mde(n){const e=H(n,"image","flipLeftRight","float32");j(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return re.runKernel(jN,t,{})}const gde=ae({flipLeftRight_:mde});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yde(n){const e=H(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];j(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),j(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,Zi(e,r)}const bde=ae({grayscaleToRGB_:yde});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xde(n){const e=H(n,"image","RGBToGrayscale"),t=e.rank-1,s=e.shape[t];j(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),j(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,i=Me(e,"float32"),o=jr([.2989,.587,.114]);let a;switch(e.rank){case 2:a=Nm("ij,j->i",i,o);break;case 3:a=Nm("ijk,k->ij",i,o);break;case 4:a=Nm("ijkl,l->ijk",i,o);break;case 5:a=Nm("ijklm,m->ijkl",i,o);break;case 6:a=Nm("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return a=Cr(a,-1),Me(a,r)}const vde=ae({rgbToGrayscale_:xde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wde(n,e,t=0,s=.5){const r=H(n,"image","rotateWithOffset","float32");j(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},o={radians:e,fillValue:t,center:s};return re.runKernel(l2,i,o)}const _de=ae({rotateWithOffset_:wde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sp(n,e,t,s,r,i){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=n.shape[0];return t=Math.min(t,o),j(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),j(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),j(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),j(e.rank===1,()=>"scores must be a 1D tensor"),j(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),j(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sde(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=H(n,"boxes","nonMaxSuppression","float32"),o=H(e,"scores","nonMaxSuppression","float32"),a=sp(i,o,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return re.runKernel(XN,{boxes:i,scores:o},l)}const Cde=ae({nonMaxSuppression_:Sde});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tde(n,e,t){const s=Ede(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function Ede(n,e,t){return kde(n,e,t||Ide)}function Ide(n,e){return n>e?1:n<e?-1:0}function kde(n,e,t){let s=0,r=n.length,i=0,o=!1;for(;s<r;){i=s+(r-s>>>1);const a=t(e,n[i]);a>0?s=i+1:(r=i,o=!a)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L2(n,e,t,s,r){return U2(n,e,t,s,r,0)}function F2(n,e,t,s,r,i){return U2(n,e,t,s,r,0,!1,i,!0)}function V2(n,e,t,s,r,i){return U2(n,e,t,s,r,i,!0)}function U2(n,e,t,s,r,i,o=!1,a=!1,l=!1){const u=[];for(let v=0;v<e.length;v++)e[v]>r&&u.push({score:e[v],boxIndex:v,suppressBeginIndex:0});u.sort(KL);const d=i>0?-.5/i:0,f=[],m=[];for(;f.length<t&&u.length>0;){const v=u.pop(),{score:S,boxIndex:T,suppressBeginIndex:I}=v;if(S<r)break;let k=!1;for(let O=f.length-1;O>=I;--O){const V=Nde(n,T,f[O]);if(V>=s){k=!0;break}if(v.score=v.score*Ade(s,d,V),v.score<=r)break}v.suppressBeginIndex=f.length,k||(v.score===S?(f.push(T),m.push(v.score)):v.score>r&&Tde(u,v,KL))}const y=f.length,b=t-y;a&&b>0&&(f.push(...new Array(b).fill(0)),m.push(...new Array(b).fill(0)));const w={selectedIndices:f};return o&&(w.selectedScores=m),l&&(w.validOutputs=y),w}function Nde(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),i=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),u=Math.min(r[0],r[2]),d=Math.min(r[1],r[3]),f=Math.max(r[0],r[2]),m=Math.max(r[1],r[3]),y=(a-i)*(l-o),b=(f-u)*(m-d);if(y<=0||b<=0)return 0;const w=Math.max(i,u),v=Math.max(o,d),S=Math.min(a,f),T=Math.min(l,m),I=Math.max(S-w,0)*Math.max(T-v,0);return I/(y+b-I)}function Ade(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function KL(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Rde(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=H(n,"boxes","nonMaxSuppressionAsync"),o=H(e,"scores","nonMaxSuppressionAsync"),a=sp(i,o,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([i.data(),o.data()]),u=l[0],d=l[1],{selectedIndices:f}=L2(u,d,t,s,r);return i!==n&&i.dispose(),o!==e&&o.dispose(),jr(f,"int32")}const $de=Rde;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dde(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=H(n,"boxes","nonMaxSuppression"),a=H(e,"scores","nonMaxSuppression"),l=sp(o,a,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u={boxes:o,scores:a},d={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i},f=re.runKernel(QN,u,d);return{selectedIndices:f[0],selectedScores:f[1]}}const Ode=ae({nonMaxSuppressionWithScore_:Dde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Pde(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=H(n,"boxes","nonMaxSuppressionAsync"),a=H(e,"scores","nonMaxSuppressionAsync"),l=sp(o,a,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u=await Promise.all([o.data(),a.data()]),d=u[0],f=u[1],{selectedIndices:m,selectedScores:y}=V2(d,f,t,s,r,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:jr(m,"int32"),selectedScores:jr(y)}}const Mde=Pde;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lde(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=H(n,"boxes","nonMaxSuppression"),a=H(e,"scores","nonMaxSuppression"),l=sp(o,a,t,s,r,null),u=l.maxOutputSize,d=l.iouThreshold,f=l.scoreThreshold,m={boxes:o,scores:a},y={maxOutputSize:u,iouThreshold:d,scoreThreshold:f,padToMaxOutputSize:i},b=re.runKernel(YN,m,y);return{selectedIndices:b[0],validOutputs:b[1]}}const Fde=ae({nonMaxSuppressionPadded_:Lde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Vde(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=H(n,"boxes","nonMaxSuppressionAsync"),a=H(e,"scores","nonMaxSuppressionAsync"),l=sp(o,a,t,s,r,null),u=l.maxOutputSize,d=l.iouThreshold,f=l.scoreThreshold,[m,y]=await Promise.all([o.data(),a.data()]),{selectedIndices:b,validOutputs:w}=F2(m,y,u,d,f,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:jr(b,"int32"),validOutputs:Bt(w,"int32")}}const Ude=Vde;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bde(n,e,t=!1,s=!1){const r=H(n,"images","resizeBilinear");j(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),j(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),j(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=oe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},u=re.runKernel(q_,a,l);return o?oe(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const Aj=ae({resizeBilinear_:Bde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zde(n,e,t=!1,s=!1){const r=H(n,"images","resizeNearestNeighbor");j(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),j(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),j(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),j(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=oe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},u=re.runKernel(H_,a,l);return o?oe(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const Rj=ae({resizeNearestNeighbor_:zde});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jde(n,e="binary",t=!1,s=.5){const r=H(n,"image","threshold"),i=.2989,o=.587,a=.114,l=r.shape[0]*r.shape[1];let u=ee(jr([s]),255),d,f,m,y;if(j(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),j(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),j(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),j(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[d,f,m]=oi(r,[1,1,1],-1);const v=ee(d,i),S=ee(f,o),T=ee(m,a);y=Ne(Ne(v,S),T)}else y=n;if(e==="otsu"){const v=Ule(Me(bj(y),"int32"),ug([]),256);u=Wde(v,l)}const b=t?np(y,u):li(y,u);return Me(ee(b,255),"int32")}function Wde(n,e){let t=jr([-1]),s=jr([0]),r=jr([0]),i,o,a,l,u,d;for(let f=0;f<n.size-1;f++){i=fn(n,0,f+1),o=fn(n,f+1),u=qe(Ge(i),e),d=qe(Ge(o),e);const m=Ge(ee(i,Ug(0,i.size)));a=qe(m,Ge(i));const y=c1(o.shape,i.size),b=Ne(Ug(0,o.size),y),w=ee(o,b);l=qe(Ge(w),Ge(o));const v=Qe(a,l),S=Qe(a,l),T=ee(u,d);r=ee(ee(T,v),S);const I=li(r,s);s=pr(I,r,s),t=pr(I,jr([f]),t)}return t}const Gde=ae({threshold_:jde});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hde(n,e,t="nearest",s="constant",r=0,i){const o=H(n,"image","transform","float32"),a=H(e,"transforms","transform","float32");j(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),j(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),j(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:o,transforms:a},u={interpolation:t,fillMode:s,fillValue:r,outputShape:i};return re.runKernel(o2,l,u)}const qde=ae({transform_:Hde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kde(n,e,t){const s=H(n,"a","bandPart");j(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[i,o]=s.shape.slice(-2);let a,l;typeof e=="number"?(j(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),j(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),a=H(e<0?i:e,"numLower","bandPart")):(j(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=pr(Yv(e,0),i,Vg(e,i))),typeof t=="number"?(j(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),j(t<=o,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${o}).`),l=H(t<0?o:t,"numUpper","bandPart")):(j(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=pr(Yv(t,0),o,Vg(t,o)));const u=oe(Ug(0,i,1,"int32"),[-1,1]),d=Ug(0,o,1,"int32"),f=Qe(u,d),m=Ja(np(f,a),Nh(f,Vn(l))),y=vs([i,o],s.dtype);return oe(Za(gh(oe(s,[-1,i,o])).map(b=>pr(m,b,y))),r)}const Xde=ae({bandPart_:Kde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yde(n){let e;if(Array.isArray(n)){e=!1,j(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let i=1;i<n.length;++i)j(n[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[i].shape[0]} vs. ${r})`)}else e=!0,n=oi(n,n.shape[0],0).map(r=>y0(r,[0]));j(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(re.tidy(()=>{let i=s[r];if(r>0)for(let o=0;o<r;++o){const a=ee(Ge(ee(t[o],i)),t[o]);i=Qe(i,a)}return qe(i,h1(i,"euclidean"))}));return e?Za(t,0):t}const Qde=ae({gramSchmidt_:Yde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jde(n,e=!1){if(j(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return XL(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,u)=>l*u),s=gh(oe(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],i=[];s.forEach(l=>{const[u,d]=XL(l,e);r.push(u),i.push(d)});const o=oe(Za(r,0),n.shape),a=oe(Za(i,0),n.shape);return[o,a]}}function XL(n,e=!1){return re.tidy(()=>{j(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=uj(t),i=Ku(n);const o=ev([[1]],[1,1]);let a=Ku(o);const l=t>=s?s:t;for(let u=0;u<l;++u){const d=i,f=a,m=r;[a,i,r]=re.tidy(()=>{const y=fn(i,[u,u],[t-u,1]),b=h1(y),w=fn(i,[u,u],[1,1]),v=pr(li(w,0),ev([[-1]]),ev([[1]])),S=Qe(w,ee(v,b)),T=qe(y,S);T.shape[0]===1?a=Ku(o):a=Er([o,fn(T,[1,0],[T.shape[0]-1,T.shape[1]])],0);const I=Vn(qe(Ut(v,S),b)),k=fn(i,[u,0],[t-u,s]),O=ee(I,a),V=Nt(a);if(u===0)i=Qe(k,Ut(O,Ut(V,k)));else{const $=Qe(k,Ut(O,Ut(V,k)));i=Er([fn(i,[0,0],[u,s]),$],0)}const P=Nt(O),D=fn(r,[0,u],[t,r.shape[1]-u]);if(u===0)r=Qe(D,Ut(Ut(D,a),P));else{const $=Qe(D,Ut(Ut(D,a),P));r=Er([fn(r,[0,0],[t,u]),$],1)}return[a,i,r]}),ut([d,f,m])}return!e&&t>s&&(r=fn(r,[0,0],[t,s]),i=fn(i,[0,0],[s,s])),[r,i]})}const Zde=ae({qr_:Jde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ba={flipLeftRight:gde,grayscaleToRGB:bde,resizeNearestNeighbor:Rj,resizeBilinear:Aj,rgbToGrayscale:vde,rotateWithOffset:_de,cropAndResize:pde,nonMaxSuppression:Cde,nonMaxSuppressionAsync:$de,nonMaxSuppressionWithScore:Ode,nonMaxSuppressionWithScoreAsync:Mde,nonMaxSuppressionPadded:Fde,nonMaxSuppressionPaddedAsync:Ude,threshold:Gde,transform:qde},efe={bandPart:Xde,gramSchmidt:Qde,qr:Zde};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tfe=new Map,nfe=new Map;class rp{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class ki{constructor(){this.classNameMap={}}static getMap(){return ki.instance==null&&(ki.instance=new ki),ki.instance}static register(e){ki.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function ke(n,e,t){j(n.className!=null,()=>"Class being registered does not have the static className property defined."),j(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),j(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const s=t,r=e+">"+s;return ki.register(n),tfe.set(r,n),nfe.set(n,r),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bc extends rp{minimize(e,t=!1,s){const{value:r,grads:i}=this.computeGradients(e,s);if(s!=null){const o=s.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return ut(i),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return aue(e,t)}dispose(){this.iterations_!=null&&ut(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Bt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Bc,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $j extends Bc{static get className(){return"Adadelta"}constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=re.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=re.registeredVariables[s],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:de(()=>At(i).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:de(()=>At(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,u=this.accumulatedUpdates[r].variable;de(()=>{const d=Ne(ee(l,this.rho),ee(vn(a),1-this.rho)),f=ee(qe(er(Ne(u,this.epsilon)),er(Ne(l,this.epsilon))),a),m=Ne(ee(u,this.rho),ee(vn(f),1-this.rho));l.assign(d),u.assign(m);const y=Ne(ee(f,-this.learningRate),i);i.assign(y)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(ut(this.accumulatedGrads.map(e=>e.variable)),ut(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dj extends Bc{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=re.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:de(()=>c1(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const a=this.accumulatedGrads[r].variable;de(()=>{const l=Ne(a,vn(o));a.assign(l);const u=Ne(ee(qe(o,er(Ne(l,re.backend.epsilon()))),-this.learningRate),i);i.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&ut(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oj extends Bc{static get className(){return"Adam"}constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],de(()=>{this.accBeta1=Bt(t).variable(),this.accBeta2=Bt(s).variable()}),r==null&&(this.epsilon=re.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);de(()=>{const s=Qe(1,this.accBeta1),r=Qe(1,this.accBeta2);t.forEach((i,o)=>{const a=re.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:de(()=>At(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:de(()=>At(a).variable(l))});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const d=this.accumulatedFirstMoment[o].variable,f=this.accumulatedSecondMoment[o].variable,m=Ne(ee(d,this.beta1),ee(u,1-this.beta1)),y=Ne(ee(f,this.beta2),ee(vn(u),1-this.beta2)),b=qe(m,s),w=qe(y,r);d.assign(m),f.assign(y);const v=Ne(ee(qe(b,Ne(er(w),this.epsilon)),-this.learningRate),a);a.assign(v)}),this.accBeta1.assign(ee(this.accBeta1,this.beta1)),this.accBeta2.assign(ee(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ut(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&ut(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),de(()=>{this.accBeta1.assign(ph(this.beta1,this.iterations_+1)),this.accBeta2.assign(ph(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pj extends Bc{static get className(){return"Adamax"}constructor(e,t,s,r=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],de(()=>{this.iteration=Bt(0).variable(),this.accBeta1=Bt(t).variable()}),r==null&&(this.epsilon=re.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);de(()=>{const s=Qe(1,this.accBeta1),r=qe(-this.learningRate,Ne(ee(this.iteration,this.decay),1));t.forEach((i,o)=>{const a=re.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:At(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:At(a).variable(l)});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const d=this.accumulatedFirstMoment[o].variable,f=this.accumulatedWeightedInfNorm[o].variable,m=Ne(ee(d,this.beta1),ee(u,1-this.beta1)),y=ee(f,this.beta2),b=ur(u),w=Vc(y,b);d.assign(m),f.assign(w);const v=Ne(ee(qe(r,s),qe(m,Ne(w,this.epsilon))),a);a.assign(v)}),this.iteration.assign(Ne(this.iteration,1)),this.accBeta1.assign(ee(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ut(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&ut(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B2 extends Bc{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const o=re.registeredVariables[s];de(()=>{const a=Ne(ee(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=jo(Bt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mj extends B2{static get className(){return"Momentum"}constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=Bt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=re.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:de(()=>At(i).variable(!1))});const o=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&de(()=>{let l;const u=Ne(ee(this.m,o),a);this.useNesterov?l=Ne(ee(this.c,Ne(a,ee(u,this.m))),i):l=Ne(ee(this.c,u),i),o.assign(u),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&ut(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lj extends Bc{static get className(){return"RMSProp"}constructor(e,t=.9,s=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=re.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=re.registeredVariables[s],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:de(()=>At(i).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:de(()=>At(i).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:de(()=>At(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,u=this.accumulatedMoments[r].variable;de(()=>{const d=Ne(ee(l,this.decay),ee(vn(a),1-this.decay));if(this.centered){const f=this.accumulatedMeanGrads[r].variable,m=Ne(ee(f,this.decay),ee(a,1-this.decay)),y=qe(ee(a,this.learningRate),er(Qe(d,Ne(vn(m),this.epsilon)))),b=Ne(ee(u,this.momentum),y);l.assign(d),f.assign(m),u.assign(b);const w=Qe(i,b);i.assign(w)}else{const f=Ne(ee(l,this.decay),ee(vn(a),1-this.decay)),m=Ne(ee(u,this.momentum),qe(ee(a,this.learningRate),er(Ne(f,this.epsilon))));l.assign(f),u.assign(m);const y=Qe(i,m);i.assign(y)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&ut(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&ut(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&ut(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sfe=[$j,Dj,Oj,Pj,Mj,Lj,B2];function rfe(){for(const n of sfe)ke(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YL(n,e,t,s){o(n),t=t??0,s=s??1,a(t,s);let r=0;const i=l=>(l.then(u=>{const d=t+ ++r/n.length*(s-t);return e(d),u}),l);function o(l){j(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,u){j(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),j(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),j(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}return Promise.all(n.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function ife(n,e){e==null&&(e={});const t=e.fetchFunc==null?pe().platform.fetch:e.fetchFunc,s=n.map(f=>t(f,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await YL(s,e.onProgress,0,.5)).map(f=>f.arrayBuffer());return e.onProgress==null?await Promise.all(a):await YL(a,e.onProgress,.5,1)}function ofe(n,e){var t;const s=e.fetchFunc==null?pe().platform.fetch:e.fetchFunc;let r=0,i;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async o=>{for(var a;r<n.length;){i||(i=(await s(n[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:u}=await i.read();if(l){r++,i=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/n.length);continue}o.enqueue(u);return}o.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const afe="application/octet-stream",lfe="application/json";class z2{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(j(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=pe().platform.fetch,j(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&j(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=wae(e,s);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:lfe}),"model.json"),e.weightData!=null){const o=Mc.join(e.weightData);t.body.append("model.weights.bin",new Blob([o],{type:afe}),"model.weights.bin")}const i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:h2(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const s=t.modelTopology,r=t.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return Sae(e,t=>this.loadWeights(t))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),s=ML(e.weightsManifest),r=()=>ofe(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=cfe(t),i=this.weightPathPrefix||s,o=[],a=[];for(const l of e)for(const u of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(u)):o.push(i+u+r);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(e){const t=await this.getWeightUrls(e),s=ML(e),r=await ife(t,this.loadOptions);return[s,r]}}z2.URL_SCHEME_REGEX=/^https?:\/\//;function cfe(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),s=n.substring(0,e),r=t>e?n.substring(t):"";return[s+"/",r]}function QL(n){return n.match(z2.URL_SCHEME_REGEX)!=null}const Fj=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(s=>QL(s)):t=QL(n),t)return Vj(n,e)}return null};bs.registerSaveRouter(Fj);bs.registerLoadRouter(Fj);function Vj(n,e){return new z2(n,e)}function ufe(n,e){return Vj(n,e)}function j2(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(xe(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,i=r[r.length-1];let o=1;for(let f=0;f<r.length-1;++f)o*=r[f];const a=n.shape,l=r.slice();l.pop();let u=1;for(let f=i;f<t;++f)u*=a[f],l.push(a[f]);const d=[...je(n.shape).map(f=>f/u),1].slice(0,i);return[l,o,u,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eI=-2,hfe=-1;function W2(n,e,t){const s=n.shape.length;j(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),j(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)j(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function dfe(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function G2(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function Uj(n,e,t,s){const r=[...n];for(let i=r.length;i<s.length;i++)r.push(1);for(let i=0;i<t;i++)i===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function Bj(n,e,t){return t<=n?t:t-(e-1)}function zj(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function ffe(n,e,t,s,r,i,o,a,l){const u=n.length;let d=new Array(u),f=new Array(u),m=new Array(u);if(e.length&&t>0){const y=e[0],b=t+1;d=jj(o,y,b,s,n),f=Wj(a,y,b,r,n),m=Uj(i,y,b,n)}else for(let y=0;y<u;y++)d[y]=Hj(o,s,i,n,y,l),f[y]=qj(a,r,i,n,y,l),m[y]=Gj(i,y,l);return{begin:d,end:f,strides:m}}function jj(n,e,t,s,r){const i=[...r],o=zj(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const l=Bj(e,t,a);let u=s[l];n&1<<l&&(u=0),i[a]=u}return i}function Wj(n,e,t,s,r){const i=[...r],o=zj(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const l=Bj(e,t,a);let u=s[l];n&1<<l&&(u=Number.MAX_SAFE_INTEGER),i[a]=u}for(let a=0;a<i.length;a++){const l=r[a];i[a]<0&&(i[a]+=l),i[a]=oh(0,i[a],r[a])}return i}function Gj(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function Hj(n,e,t,s,r,i){let o=e[r];const a=t[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),o=oh(0,o,l-1),o}function qj(n,e,t,s,r,i){let o=e[r];const a=t[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),a>0?o=oh(0,o,l):o=oh(-1,o,l-1),o}function H2(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function q2(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function f1(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(o=>{j(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(r).fill(-1):typeof t=="number"?i=[t,...new Array(r-1).fill(-1)]:t.length<r?i=t.concat(new Array(r-t.length).fill(-1)):i=t,i=i.map((o,a)=>o>=0?o:(j(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),n.shape[a]-s[a])),[s,i]}function K2(n,e,t,s,r,i,o,a,l){let u;if(s==null?(u=new Array(e.length),u.fill(1)):u=s,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let d=!1;const f={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:u.slice(),beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let I=0;I<f.dims;I++)d&&(1<<I&a)!==0&&f.numAddAxisAfterEllipsis++,1<<I&o&&(d=!0);d||(f.ellipsisMask|=1<<f.dims,f.dims++);const m={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};pfe(f,m);let y=!0,b=!0,w=!0;const v=[],S=[];for(let I=0;I<n.length;++I){if(m.strides[I]===0)throw Error(`strides[${I}] must be non-zero`);const k=!!(m.shrinkAxisMask&1<<I),O=n[I];if(O===-1){v.push(k?1:-1);continue}const V=[m.beginMask&1<<I,m.endMask&1<<I],P=[m.strides[I]>0?0:-1,m.strides[I]>0?O:O-1];if(k&&m.strides[I]<=0)throw Error("only stride 1 allowed on non-range indexing.");w=w&&m.strides[I]===1;const D=!!(m.beginMask&1<<I&&m.endMask&1<<I);if(m.beginValid&&m.endValid){if(k){const U=m.begin[I]<0?O+m.begin[I]:m.begin[I];if(m.begin[I]=U,m.end[I]=m.begin[I]+1,U<0||U>=O)throw Error(`slice index ${m.begin[I]} of dimension ${I} out of bounds.`)}else m.begin[I]=JL(m.begin[I],0,m.strides[I],O,V,P),m.end[I]=JL(m.end[I],1,m.strides[I],O,V,P);const A=m.strides[I]===1&&m.begin[I]===0&&m.end[I]===O;y=y&&A,b=b&&(I===0&&m.strides[I]===1||A)}else y=y&&m.strides[I]===1&&D,b=b&&(I===0&&m.strides[I]===1||D);let $,R=!1;if(m.beginValid&&m.endValid?($=m.end[I]-m.begin[I],R=!0):k?($=1,R=!0):D&&O>=0&&(m.strides[I]<0?$=-O:$=O,R=!0),R){let A;$===0||$<0!=m.strides[I]<0?A=0:A=Math.trunc($/m.strides[I])+($%m.strides[I]!==0?1:0),v.push(A)}else v.push(-1)}for(let I=0;I<m.finalShapeGatherIndices.length;++I){const k=m.finalShapeGatherIndices[I];k>=0?S.push(v[k]):k===eI&&S.push(1)}return{finalShapeSparse:S.filter((I,k)=>m.finalShapeGatherIndices[k]!==eI),finalShape:S,isIdentity:y,sliceDim0:b,isSimpleSlice:w,begin:m.begin,end:m.end,strides:m.strides}}function pfe(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(eI),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(hfe),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function JL(n,e,t,s,r,i){if(r[e])return t>0?i[e]:i[e+1&1];{const o=n<0?s+n:n;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const mfe=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:W2,computeFlatOffset:q2,computeOutShape:G2,getNormalizedAxes:ffe,isSliceContinous:H2,maskToAxes:dfe,parseSliceParams:f1,sliceInfo:K2,startForAxis:Hj,startIndicesWithElidedDims:jj,stopForAxis:qj,stopIndicesWithElidedDims:Wj,stridesForAxis:Gj,stridesWithElidedDims:Uj},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gfe{static sgd(e){return new B2(e)}static momentum(e,t,s=!1){return new Mj(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,i=!1){return new Lj(e,t,s,r,i)}static adam(e=.001,t=.9,s=.999,r=null){return new Oj(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new $j(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,i=0){return new Pj(e,t,s,r,i)}static adagrad(e,t=.1){return new Dj(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vd=gfe;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yfe=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function Kj(){return new Promise(n=>yfe(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X2(n,e){const t=n[0].length;n.forEach((r,i)=>{j(r.length===t,()=>`Error in concat${t}D: rank of tensors[${i}] must be the same as the rank of the rest (${t})`)}),j(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,i)=>{for(let o=0;o<t;o++)j(o===e||r[o]===s[o],()=>`Error in concat${t}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`)})}function Wo(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Xi;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Xi||(Xi={}));function Xj(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const i=t[r],o=s[s.length-t.length+r],a=s[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${i} but shape[${r+n}] = ${a}`)}else s[o]=i}return s}function Yj(n){const e={FIRST_DIM_SIZE:Xi.FIRST_DIM_SIZE,VALUE_ROWIDS:Xi.VALUE_ROWIDS,ROW_LENGTHS:Xi.ROW_LENGTHS,ROW_SPLITS:Xi.ROW_SPLITS,ROW_LIMITS:Xi.ROW_LIMITS,ROW_STARTS:Xi.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function Qj(n){return n.length===0?0:n[0]===Xi.FIRST_DIM_SIZE?n.length-1:n.length}function Jj(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const i=n[r],o=e[r+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${i} but ragged tensor input.flatValues.shape[${r-n.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y2=30;function p1(n){return n<=Y2?n:FE(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q2(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x0(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const i=e.length;for(let o=0;o<i;++o)r=r.concat([n[o+1]/e[o],e[o]]);r=r.concat(n.slice(i+1))}return r}function v0(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],i=[];for(let o=1;o<n;++o)o>=e*2+1||o%2===1?i.push(o):r.push(o);s.push(...r),s.push(0),s.push(...i)}return s}function w0(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let i=1;i<n.length;++i)i<=e.length?s?r.push(e[i-1]*n[i]):r.push(n[i]/e[i-1]):r.push(n[i]);return r}function J2(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function Z2(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m1=1.7580993408473768,g1=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eA=.3275911,tA=.254829592,nA=-.284496736,sA=1.421413741,rA=-1.453152027,iA=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function el(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function Zj(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function e6(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function t6(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function oA(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function n6(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function s6(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const i=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(i),s[r]=Math.sin(i)}return{real:t,imag:s}}function r6(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),i=Math.sin(s);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xT="->",bfe=/->/g,ZL=",",eF="...";function aA(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(bfe,"").length)/xT.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${xT}").`);const[s,r]=n.split(xT);j(s.indexOf(eF)===-1,()=>`The ellipsis notation ("${eF}") is not supported yet.`);const i=s.split(ZL),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let m=0;m<r.length;++m){const y=r[m];if(!i.some(b=>b.indexOf(y)!==-1))throw new Error(`Output subscripts contain the label ${y} not present in the input subscripts.`);a.indexOf(y)===-1&&a.push(y)}for(let m=0;m<s.length;++m){const y=s[m];a.indexOf(y)===-1&&y!==ZL&&a.push(y)}const l=new Array(i.length);for(let m=0;m<o;++m){if(new Set(i[m].split("")).size!==i[m].length)throw new Error(`Found duplicate axes in input component ${i[m]}. Support for duplicate axes in input is not implemented yet.`);l[m]=[];for(let y=0;y<i[m].length;++y)l[m].push(a.indexOf(i[m][y]))}const u=a.length,d=r.length,f=[];for(let m=d;m<u;++m)f.push(m);return{allDims:a,summedDims:f,idDims:l}}function lA(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function cA(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const i=t[r].shape;for(let o=0;o<e[r].length;++o)s[e[r][o]]===void 0?s[e[r][o]]=i[o]:j(s[e[r][o]]===i[o],()=>`Expected dimension ${s[e[r][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function uA(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let o=0;o<r;++o)s.push([]);const i=[];for(let o=0;o<t.length;++o){const a=t[o],l=xfe(e,a);for(const u of l)i.indexOf(u)===-1&&(s[o].push(u),i.push(u))}return{path:t,steps:s}}function hA(n){return n.every((e,t)=>e===t)}function xfe(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function dA(n,e,t=0){let s=[];if(typeof e=="number")j(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);j(r<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[i]=n.shape[t]-o}j(n.shape[t]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i6(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function o6(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function a6(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l6(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function c6(n,e){return`size ${n} must be non-negative, not ${e}`}function u6(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function h6(n,e){const t=xe(n),s=xe(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function d6(n,e){const t=xe(n),s=xe(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tI(){return"segment ids must be >= 0"}function f6(){return"segment ids are not increasing"}function p6(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function m6(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g6(n,e){let t=!1,s;for(n<=Y2?(s=n,t=!0):s=FE(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=FE(n,s+1);return s}function y6(n,e,t){const s=[],r=n.length;for(let i=0;i<r;i++)i!==e?s.push(n[i]):s.push(t);return s}function fA(n,e,t,s){const r=e.shape.length,i=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>i)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${i}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let f=0;f<s;++f)if(n.shape[f]!==e.shape[f])throw new Error(`x.shape[${f}]: ${n.shape[f]} should be equal to indices.shape[${f}]: ${e.shape[f]}.`);const o=n.shape[t],a=[];let l=1,u=1,d=1;for(let f=0;f<s;++f)a.push(n.shape[f]),l*=n.shape[f];for(let f=s;f<t;f++)a.push(n.shape[f]),u*=n.shape[f];for(let f=s;f<r;f++)a.push(e.shape[f]);for(let f=t+1;f<i;f++)a.push(n.shape[f]),d*=n.shape[f];return{batchSize:l,sliceSize:d,outerSize:u,dimSize:o,outputShape:a}}const vfe=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:fA,computeOutShape:y6,segOpComputeOptimalWindowSize:g6},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tl(n){try{return n.map(e=>xc(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function b6(n){return n.map(e=>oc(e))}const wfe=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:tA,ERF_A2:nA,ERF_A3:sA,ERF_A4:rA,ERF_A5:iA,ERF_P:eA,PARALLELIZE_THRESHOLD:Y2,get RowPartitionType(){return Xi},SELU_SCALE:g1,SELU_SCALEALPHA:m1,applyActivation:P2,assertAndGetBroadcastShape:it,assertAxesAreInnerMostDims:Fs,assertParamsConsistent:X2,assignToTypedArray:n6,axesAreInnerMostDims:b2,calculateShapes:Rh,checkEinsumDimSizes:cA,checkPadOnDimRoundingMode:Nr,combineLocations:lj,combineRaggedTensorToTensorShapes:Xj,complexWithEvenIndex:e6,complexWithOddIndex:t6,computeConv2DInfo:Ls,computeConv3DInfo:Lc,computeDefaultPad:d2,computeDilation2DInfo:p0,computeOptimalWindowSize:p1,computeOutAndReduceShapes:Ss,computeOutShape:Wo,computePool2DInfo:Mi,computePool3DInfo:ol,convertConv2DDataFormat:al,decodeEinsumEquation:aA,eitherStridesOrDilationsAreOne:tr,expandShapeToKeepDim:Xn,exponent:r6,exponents:s6,fromStringArrayToUint8:b6,fromUint8ToStringArray:tl,getAxesPermutation:Nn,getBroadcastDims:Af,getComplexWithIndex:oA,getEinsumComputePath:uA,getEinsumPermutation:lA,getFusedBiasGradient:O2,getFusedDyActivation:D2,getImageCenter:Q2,getInnerMostAxes:Bn,getPermuted:v0,getRaggedRank:Qj,getReductionAxes:us,getReshaped:x0,getReshapedPermuted:w0,getRowPartitionTypesHelper:Yj,getSliceBeginCoords:J2,getSliceSize:Z2,getSparseFillEmptyRowsIndicesDenseShapeMismatch:i6,getSparseFillEmptyRowsNegativeIndexErrorMessage:o6,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:a6,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:u6,getSparseReshapeInputOutputMismatchErrorMessage:d6,getSparseReshapeInputOutputMultipleErrorMessage:h6,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:l6,getSparseReshapeNegativeOutputDimErrorMessage:c6,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:m6,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:tI,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:f6,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:p6,getUndoAxesPermutation:Fc,isIdentityPermutation:hA,log:Uoe,mergeRealAndImagArrays:el,prepareAndValidate:j2,prepareSplitSize:dA,segment_util:vfe,shouldFuse:M2,slice_util:mfe,splitRealAndImagArrays:Zj,stridesOrDilationsArePositive:dh,tupleValuesAreOne:hh,upcastType:Gr,validateDefaultValueShape:Jj,validateInput:Hhe,validateUpdateShape:Ej,warn:si},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */rfe();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x6={kernelName:r_,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ee(n,b0(Me(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _fe={kernelName:xy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=vn(Me(t,"float32")),r=er(Qe(Bt(1),s));return Vn(qe(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sfe={kernelName:vy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=er(Qe(vn(Me(t,"float32")),1));return qe(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cfe={kernelName:ep,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=it(t.shape,s.shape);return{a:()=>{let a=n;const l=us(t.shape,r);return l.length>0&&(a=Ge(a,l)),oe(a,t.shape)},b:()=>{let a=n;const l=us(s.shape,r);return l.length>0&&(a=Ge(a,l)),oe(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tfe={kernelName:_N,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((s,r)=>{t[r]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Efe={kernelName:i_,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>At(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ife={kernelName:o_,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>At(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kfe={kernelName:wy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>qe(n,er(Qe(Bt(1),vn(Me(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nfe={kernelName:_y,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=er(Ne(Bt(1),vn(Me(t,"float32"))));return qe(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Afe={kernelName:Ty,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=it(t.shape,s.shape);return{a:()=>{const a=Ne(vn(t),vn(s));let l=ee(n,qe(s,a));const u=us(t.shape,r);return u.length>0&&(l=Ge(l,u)),oe(l,t.shape)},b:()=>{const a=Ne(vn(t),vn(s));let l=Vn(ee(n,qe(t,a)));const u=us(s.shape,r);return u.length>0&&(l=Ge(l,u)),oe(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rfe={kernelName:Sy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>qe(n,Ne(vn(Me(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $fe={kernelName:Cy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>qe(n,Qe(Bt(1),vn(Me(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dfe(n,e,t,s,r,i){const o=H(n,"dy","avgPool3dGrad"),a=H(e,"input","avgPool3dGrad");let l=o,u=a,d=!1;a.rank===4&&(d=!0,l=oe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),u=oe(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),j(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),j(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),Nr("avgPool3dGrad",r,i);const f={dy:l,input:u},m={filterSize:t,strides:s,pad:r,dimRoundingMode:i},y=re.runKernel(EN,f,m);return d?oe(y,[y.shape[1],y.shape[2],y.shape[3],y.shape[4]]):y}const Ofe=ae({avgPool3dGrad_:Dfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pfe={kernelName:l_,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:i,pad:o,dimRoundingMode:a}=t;return{x:()=>Ofe(n,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mfe(n,e,t,s,r){const i=H(n,"dy","avgPoolGrad"),o=H(e,"input","avgPoolGrad");j(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let a=o,l=i,u=!1;o.rank===3&&(u=!0,a=oe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=oe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),j(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),j(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const d={dy:l,input:a},f={filterSize:t,strides:s,pad:r},m=re.runKernel(TN,d,f);return u?oe(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const Lfe=ae({avgPoolGrad_:Mfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ffe={kernelName:a_,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:i,pad:o}=t;return{x:()=>Lfe(n,s,r,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vfe={kernelName:c_,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[s,r]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>Ut(n,r,!1,!0),b:()=>Ut(s,n,!0,!1)}:!i&&o?{a:()=>Ut(n,r,!1,!1),b:()=>Ut(n,s,!0,!1)}:i&&!o?{a:()=>Ut(r,n,!1,!0),b:()=>Ut(s,n,!1,!1)}:{a:()=>Ut(r,n,!0,!0),b:()=>Ut(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ufe={kernelName:u_,gradFunc:(n,e,t)=>{const{blockShape:s,crops:r}=t;return{x:()=>E2(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bfe={kernelName:Moe,gradFunc:(n,e,t)=>{const s=t,r=s.inputShape,i=s.shape,o=Array.from(i);for(let l=r.length-1;l>=0;l--)if(r[l]===i[l])o[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>Ge(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zfe={kernelName:Ey,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jfe={kernelName:Iy,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wfe={kernelName:ky,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{clipValueMin:r,clipValueMax:i}=t;return{x:()=>pr(Ja(Nh(s,r),np(s,i)),n,At(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gfe={kernelName:h_,inputsToSave:["x"],gradFunc:x6.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hfe={kernelName:d_,saveAllInputs:!0,gradFunc:(n,e,t)=>{const s=e.map(l=>l.shape),{axis:r}=t,i=dt(r,e[0].shape)[0],o=s.map(l=>l[i]);return oi(n,o,i).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qfe={kernelName:f_,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{dilations:i,strides:o,pad:a,dataFormat:l}=t;return j(hh(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>m2(s.shape,n,r,o,a,l),filter:()=>$2(s,n,r.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kfe={kernelName:p_,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{strides:i,pad:o,dataFormat:a,dimRoundingMode:l}=t;return{dy:()=>fh(n,r,i,o,a,1,l),filter:()=>$2(n,s,r.shape,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xfe(n,e,t,s,r){let i=n;n.rank===4&&(i=oe(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let o=e;o.rank===4&&(o=oe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),j(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),j(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),j(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),j(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),j(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:i,dy:o},l={strides:s,pad:r,filterShape:t};return re.runKernel(RN,a,l)}const Yfe=ae({conv3DBackpropFilter_:Xfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qfe={kernelName:m_,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:i}=t;j(hh(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[o,a]=e;return{x:()=>rj(o.shape,n,a,r,i),filter:()=>Yfe(o,n,a.shape,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jfe={kernelName:Ny,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ee(Vn(_j(Me(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zfe={kernelName:Ay,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ee(Sj(Me(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const epe={kernelName:g_,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r,exclusive:i,reverse:o}=t;return{x:()=>{const a=Nn([r],s.rank);let l=oj(n,r,i,!o);return a!=null&&(l=Nt(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tpe={kernelName:y_,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:i,dimRoundingMode:o}=t,a=s??[1,1];j(hh(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=e;return j(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),j(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),j(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),j(tr(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),Nr("depthwiseConv2d",i,o),{x:()=>hde(l.shape,n,u,r,i,a,o),filter:()=>cde(l,n,u.shape,r,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const npe={kernelName:b_,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,i={x:s,filter:r,dy:n},o={x:s,filter:r,dy:n};return{x:()=>re.runKernel(VE,i,t),filter:()=>re.runKernel(UE,o,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const spe={kernelName:$y,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,s={dy:n,y:t};return{x:()=>re.runKernel(UN,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rpe={kernelName:Dy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=ee(Qo(Vn(vn(t))),2/Math.sqrt(Math.PI));return{x:()=>ee(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ipe={kernelName:Oy,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ee(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ope={kernelName:v_,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>oe(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ape={kernelName:Py,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ee(n,Qo(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lpe={kernelName:My,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cpe={kernelName:Ly,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=it(t.shape,s.shape);return{a:()=>{const a=qe(n,Me(s,"float32")),l=us(t.shape,r);return l.length>0?oe(Ge(a,l),t.shape):a},b:()=>{let a=ee(n,Me(t,"float32"));const l=us(s.shape,r);l.length>0&&(a=oe(Ge(a,l),s.shape));const u=vn(s);return Vn(qe(a,Me(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const upe={kernelName:w_,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:s}=t,[r,i,o,a]=e,l=a??Bt(1),u=us(i.shape,r.shape),d=[];if(i.rank===1){for(let k=0;k<r.shape.length-1;++k)d.push(r.shape[k]);d.push(1)}const f=Qe(r,i),m=ee(n,l),y=xj(Ne(o,Bt(s))),b=ee(ee(ee(y,y),y),Bt(-.5));return{x:()=>i.rank===1?oe(ee(ee(n,Zi(oe(y,[1,1,1,i.shape[0]]),d)),l),r.shape):oe(ee(ee(n,y),l),r.shape),mean:()=>{let k=ee(ee(y,Bt(-1)),m);return i.rank===1&&(k=Ge(k,u)),oe(k,i.shape)},variance:()=>{let k=ee(ee(b,f),m);return i.rank===1&&(k=Ge(k,u)),oe(k,i.shape)},scale:()=>{const k=ee(f,y);let O=ee(n,k);return i.rank===1&&(O=Ge(O,u)),oe(O,i.shape)},offset:()=>{let k=n;return i.rank===1&&(k=Ge(k,u)),oe(k,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hpe={kernelName:__,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[s,r]=e,{axis:i,batchDims:o}=t,a=dt(i,s.shape)[0],l=(u,d,f)=>()=>{const m=u.shape,y=d.size,b=m.slice(0,a),w=b.length,v=m.slice(i,m.length).slice(1),S=v.length,T=tF(0,w),I=tF(w+1,w+1+S),k=nF([b,[y],v]),O=oe(f,k),V=oe(d,[y]),P=nF([[w],T,I]),D=Nt(O,P);let $=kj(D,V,u.shape[a]);const R=Fc(P);return $=Nt($,R),$};if(o===1){const u=s.shape[0],d=s.split(u,0);return{x:()=>Za(d.map((y,b)=>l(y,r.slice(b,1),n.slice(b,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,n),indices:()=>r}}};function tF(n,e){const t=[];for(let s=n;s<e;++s)t.push(s);return t}function nF(n){const e=[];for(let t=0;t<n.length;++t)for(let s=0;s<n[t].length;++s)e.push(n[t][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dpe={kernelName:Fy,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>At(t),b:()=>At(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fpe={kernelName:Vy,gradFunc:n=>({x:()=>Me(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ppe={kernelName:Uy,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mpe={kernelName:By,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gpe={kernelName:zy,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ype={kernelName:C_,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{alpha:r}=t,i=li(s,0);return{x:()=>pr(i,n,ee(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bpe={kernelName:Wy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>qe(n,Ne(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xpe={kernelName:jy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>qe(n,Me(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vpe={kernelName:Foe,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;return{logits:()=>{const o=Qo(s);return Qe(n,ee(Ge(n,r,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wpe(n,e,t,s=5,r=1,i=1,o=.5){const a={x:n,y:e,dy:t},l={depthRadius:s,bias:r,alpha:i,beta:o};return re.runKernel(HN,a,l)}const _pe=ae({localResponseNormalizationBackprop_:wpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Spe={kernelName:A_,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{depthRadius:i,bias:o,alpha:a,beta:l}=t;return{x:()=>_pe(s,r,n,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v6(n,e,t,s){return e.rank<t.rank&&(e=oe(e,Xn(e.shape,s))),n.rank<t.rank&&(n=oe(n,Xn(n.shape,s))),{x:()=>ee(n,Me(Yo(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sF={kernelName:R_,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{reductionIndices:r}=s,i=e[0],o=e[1],a=dt(r,i.shape),l=v6(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cpe={kernelName:Gy,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>ee(n,Me(Nh(t,s),"float32")),b:()=>ee(n,Me(Yv(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tpe(n,e,t,s,r,i,o){const a=H(n,"dy","maxPool3dGrad"),l=H(e,"input","maxPool3dGrad"),u=H(t,"output","maxPool3dGrad");let d=a,f=l,m=u,y=!1;l.rank===4&&(y=!0,d=oe(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),f=oe(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),m=oe(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),j(d.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${d.rank}.`),j(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),j(m.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${m.rank}.`),Nr("maxPool3dGrad",i,o);const b={dy:d,input:f,output:m},w={filterSize:s,strides:r,pad:i,dimRoundingMode:o},v=re.runKernel(KN,b,w);return y?oe(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}const Epe=ae({maxPool3dGrad_:Tpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ipe={kernelName:D_,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=t;return{x:()=>Epe(n,s,r,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kpe(n,e,t,s,r,i,o){const a=H(n,"dy","maxPoolGrad"),l=H(e,"input","maxPoolGrad"),u=H(t,"output","maxPoolGrad");j(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),j(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),j(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),Nr("maxPoolGrad",i,o);const d={dy:a,input:l,output:u},f={filterSize:s,strides:r,pad:i,dimRoundingMode:o};return re.runKernel(qN,d,f)}const Npe=ae({maxPoolGrad_:kpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ape={kernelName:$_,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a}=t;return{x:()=>Npe(n,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rpe={kernelName:O_,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t,i=dt(r,s.shape),a=Ss(s.shape,i)[1],l=xe(a);return{x:()=>{const d=s.shape.slice();i.forEach(y=>{d[y]=1});const f=oe(n,d);return qe(ee(f,Uc(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $pe={kernelName:P_,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{axis:r}=s,[i,o]=e,a=dt(r,i.shape),l=v6(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dpe={kernelName:Hy,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>ee(n,Me(np(t,s),"float32")),b:()=>ee(n,Me(li(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ope={kernelName:M_,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,i=r.map(o=>o[0]);return{x:()=>fn(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ppe={kernelName:qy,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=it(t.shape,s.shape);return{a:()=>{const a=us(t.shape,r);return a.length>0?oe(Ge(n,a),t.shape):n},b:()=>{const a=ee(n,Vn(d1(qe(t,s)))),l=us(s.shape,r);return l.length>0?oe(Ge(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mpe={kernelName:Ky,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=it(t.shape,s.shape);return{a:()=>{const a=ee(n,Me(s,"float32")),l=us(t.shape,r);return l.length>0?oe(Ge(a,l),t.shape):a},b:()=>{const a=ee(n,Me(t,"float32")),l=us(s.shape,r);return l.length>0?oe(Ge(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lpe={kernelName:L_,gradFunc:n=>({x:()=>Vn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fpe={kernelName:U_,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>vs(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vpe={kernelName:V_,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Upe={kernelName:B_,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:s}=t;return gh(n,s).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rF={kernelName:z_,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,i=r.map(o=>o[0]);return{x:()=>fn(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bpe={kernelName:Xy,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,s,r]=e,i=t,o=s,a=it(i.shape,o.shape);return{a:()=>{const d=Me(o,"float32");let f=ee(n,ee(d,ph(i,Qe(d,Bt(1)))));const m=us(i.shape,a);return m.length>0&&(f=Ge(f,m)),oe(f,i.shape)},b:()=>{const d=li(i,0),f=pr(d,Jo(i),At(i));let m=ee(n,ee(r,f));const y=us(o.shape,a);return y.length>0&&(m=Ge(m,y)),oe(m,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zpe={kernelName:j_,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,s]=e,r=li(t,0);return{x:()=>pr(r,n,ee(n,s)),alpha:()=>{let i=pr(r,At(n),ee(n,t));const o=us(s.shape,n.shape);return o.length>0&&(i=Ge(i,o)),oe(i,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jpe(n,e,t){const s=n.shape.slice();s[t]=1;const r=oe(e,s),i=JE(n,t,!0,!1),o=JE(n,t,!0,!0),a=ee(i,o);return ee(r,a)}function Wpe(n,e,t){const s=n.shape.length,r=s-t.length,i=Nn(t,s);let o=n;i!=null&&(o=Nt(n,i));const a=o.shape.slice(),u=a.splice(s-t.length,t.length).reduce((m,y)=>m*y,1);a.push(u);const d=o.reshape(a);let f=jpe(d,e,r);if(f=f.reshape(o.shape),i!=null){const m=Fc(i);f=Nt(f,m)}return f}const Gpe={kernelName:W_,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;let i=[];return r==null?i=s.shape.map((o,a)=>a):typeof r=="number"?i=[r]:i=r,{x:()=>Wpe(s,n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hpe={kernelName:Ry,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=it(t.shape,s.shape);return{a:()=>{const a=qe(n,Me(s,"float32")),l=us(t.shape,r);return l.length>0?oe(Ge(a,l),t.shape):a},b:()=>{let a=ee(n,Me(t,"float32"));const l=us(s.shape,r);l.length>0&&(a=oe(Ge(a,l),s.shape));const u=vn(s);return Vn(qe(a,Me(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qpe={kernelName:Yy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>qe(n,Vn(vn(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kpe={kernelName:Jy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=ee(np(t,6),b0(t));return{x:()=>ee(n,Me(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xpe={kernelName:Qy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ee(n,Me(b0(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ype={kernelName:G_,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>oe(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qpe={kernelName:q_,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>re.runKernel(t2,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jpe={kernelName:H_,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>re.runKernel(e2,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zpe={kernelName:K_,gradFunc:(n,e,t)=>{const{dims:s}=t,r=dt(s,n.shape);return{x:()=>mh(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eme={kernelName:Zy,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tme={kernelName:e0,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Vn(qe(n,ee(ph(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nme={kernelName:X_,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>Me(At(t),"float32"),t:()=>ee(n,Me(t,n.dtype)),e:()=>ee(n,Me(_2(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sme={kernelName:t0,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=li(t,Bt(0)),r=Bt(m1),i=Bt(g1),o=ee(n,i),a=ee(ee(n,r),Qo(Me(t,"float32")));return pr(s,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rme={kernelName:i0,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ee(n,ee(t,Qe(Bt(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ime={kernelName:r0,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ome={kernelName:n0,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ee(g2(Me(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ame={kernelName:s0,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ee(ij(Me(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lme={kernelName:Y_,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{begin:r,size:i}=t,o=s.shape,[a,l]=f1(s,r,i),u=[];for(let d=0;d<n.rank;d++)u.push([a[d],o[d]-a[d]-l[d]]);return{x:()=>T2(n,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cme={kernelName:e1,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{dim:r}=t,i=!0,o=ee(n,s);return{logits:()=>Qe(o,ee(Ge(o,[r],i),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ume={kernelName:o0,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ee(n,tp(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iF={kernelName:J_,gradFunc:(n,e,t)=>{const{blockShape:s,paddings:r}=t;return{x:()=>p2(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oF={kernelName:Z_,gradFunc:(n,e,t)=>{const{axis:s}=t;return{x:()=>Er(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hme={kernelName:a0,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>qe(n,ee(er(Me(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dme={kernelName:n2,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ee(n,ee(Me(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fme={kernelName:l0,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Bt(2);return{a:()=>ee(n,ee(r,Qe(t,s))),b:()=>ee(n,ee(r,Qe(s,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pme={kernelName:f0,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mme={kernelName:c0,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=it(t.shape,s.shape);return{a:()=>{let a=n;const l=us(t.shape,r);return l.length>0&&(a=Ge(a,l)),oe(a,t.shape)},b:()=>{let a=n;const l=us(s.shape,r);return l.length>0&&(a=Ge(a,l)),oe(Vn(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gme={kernelName:Q_,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,r=s.shape.slice(),{axis:i}=t;dt(i,s.shape).forEach(u=>{r[u]=1});const a=oe(n,r),l=ee(a,Uc(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yme={kernelName:u0,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>qe(n,vn(g2(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bme={kernelName:h0,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ee(Qe(Bt(1),vn(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xme={kernelName:d0,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{reps:r}=t;return{x:()=>{let o=At(s);if(s.rank===1)for(let a=0;a<r[0];++a)o=Ne(o,fn(n,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)o=Ne(o,fn(n,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)o=Ne(o,fn(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)for(let d=0;d<r[3];++d)o=Ne(o,fn(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vme={kernelName:df,gradFunc:(n,e,t)=>{const s=t,{perm:r}=s,i=Fc(r);return{x:()=>Nt(n,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wme={kernelName:t1,gradFunc:(n,e,t)=>{const s=t,{axis:r}=s;return{value:()=>Za(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _me={kernelName:n1,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Sme(n,t)}}};function Sme(n,e){const t=Vc(e,At(e)),s=x2(n,t);let r=Nh(e,Bt(0,"int32"));const i=s.rank-r.rank;for(let a=0;a<i;++a)r=Cr(r,a+1);r=Ja(r,Uc(s.shape,"bool"));const o=At(s);return pr(r,s,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cme={kernelName:s1,gradFunc:n=>({x:()=>At(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tme=[x6,_fe,Sfe,Cfe,Tfe,Efe,Ife,kfe,Nfe,Afe,Rfe,$fe,Pfe,Ffe,Vfe,Ufe,Bfe,zfe,jfe,Wfe,Gfe,Hfe,Kfe,qfe,Qfe,Jfe,Zfe,epe,tpe,npe,Hpe,spe,rpe,ipe,ope,ape,cpe,lpe,upe,hpe,dpe,fpe,ppe,mpe,gpe,ype,bpe,xpe,vpe,Spe,sF,sF,Cpe,Ipe,Ape,Rpe,$pe,Dpe,Ope,Ppe,Mpe,Lpe,Fpe,Vpe,Upe,rF,rF,Bpe,zpe,Gpe,qpe,Kpe,Xpe,Ype,Qpe,Jpe,Zpe,eme,tme,nme,sme,rme,ime,ome,ame,lme,cme,ume,iF,iF,oF,oF,hme,fme,dme,pme,mme,gme,yme,bme,xme,vme,wme,_me,Cme];for(const n of Tme)Boe(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.abs=function(){return this.throwIfDisposed(),ur(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.acos=function(){return this.throwIfDisposed(),Zae(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.acosh=function(){return this.throwIfDisposed(),tle(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.add=function(n){return this.throwIfDisposed(),Ne(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.all=function(n,e){return this.throwIfDisposed(),tj(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.any=function(n,e){return this.throwIfDisposed(),YE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.argMax=function(n){return this.throwIfDisposed(),Mg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.argMin=function(n){return this.throwIfDisposed(),ole(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.asScalar=function(){return this.throwIfDisposed(),j(this.size===1,()=>"The array must have only 1 element."),oe(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.asType=function(n){return this.throwIfDisposed(),Me(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.as1D=function(){return this.throwIfDisposed(),oe(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.as2D=function(n,e){return this.throwIfDisposed(),oe(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),oe(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.as4D=function(n,e,t,s){return this.throwIfDisposed(),oe(this,[n,e,t,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.as5D=function(n,e,t,s,r){return this.throwIfDisposed(),oe(this,[n,e,t,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.asin=function(){return this.throwIfDisposed(),lle(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.asinh=function(){return this.throwIfDisposed(),ule(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.atan=function(){return this.throwIfDisposed(),dle(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.atan2=function(n){return this.throwIfDisposed(),ple(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.atanh=function(){return this.throwIfDisposed(),gle(this)};ye().prototype.avgPool=function(n,e,t,s){return this.throwIfDisposed(),f2(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),p2(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.batchNorm=function(n,e,t,s,r){return this.throwIfDisposed(),l1(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.broadcastTo=function(n){return this.throwIfDisposed(),hg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.cast=function(n){return this.throwIfDisposed(),Me(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.ceil=function(){return this.throwIfDisposed(),jle(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),ai(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof ts&&(n=[n]),Er([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.conv1d=function(n,e,t,s,r,i){return this.throwIfDisposed(),nj(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.conv2dTranspose=function(n,e,t,s,r){return this.throwIfDisposed(),sj(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.conv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),fh(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.cos=function(){return this.throwIfDisposed(),g2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.cosh=function(){return this.throwIfDisposed(),ij(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),JE(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),oj(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),pce(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.depthwiseConv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),y2(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.dilation2d=function(n,e,t,s,r){return this.throwIfDisposed(),yce(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.divNoNan=function(n){return this.throwIfDisposed(),_ce(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.div=function(n){return this.throwIfDisposed(),qe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.dot=function(n){return this.throwIfDisposed(),Cce(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.elu=function(){return this.throwIfDisposed(),u1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.equal=function(n){return this.throwIfDisposed(),Yo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.erf=function(){return this.throwIfDisposed(),aj(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),Mce(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.exp=function(){return this.throwIfDisposed(),Qo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.expandDims=function(n){return this.throwIfDisposed(),Cr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.expm1=function(){return this.throwIfDisposed(),Uce(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.fft=function(){return this.throwIfDisposed(),Tj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.flatten=function(){return this.throwIfDisposed(),oe(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.floor=function(){return this.throwIfDisposed(),d1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.floorDiv=function(n){return this.throwIfDisposed(),ej(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.gather=function(n,e,t){return this.throwIfDisposed(),x2(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Nh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.greater=function(n){return this.throwIfDisposed(),li(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.ifft=function(){return this.throwIfDisposed(),ZE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.irfft=function(){return this.throwIfDisposed(),Dhe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.isFinite=function(){return this.throwIfDisposed(),Xce(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.isInf=function(){return this.throwIfDisposed(),Qce(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.isNaN=function(){return this.throwIfDisposed(),Zce(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.leakyRelu=function(n){return this.throwIfDisposed(),w2(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.lessEqual=function(n){return this.throwIfDisposed(),np(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.less=function(n){return this.throwIfDisposed(),Yv(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.localResponseNormalization=function(n,e,t,s){return this.throwIfDisposed(),rue(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logSigmoid=function(){return this.throwIfDisposed(),hue(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logSoftmax=function(n){return this.throwIfDisposed(),dj(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),fj(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.log=function(){return this.throwIfDisposed(),Jo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.log1p=function(){return this.throwIfDisposed(),hj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logicalAnd=function(n){return this.throwIfDisposed(),Ja(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logicalNot=function(){return this.throwIfDisposed(),_2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logicalOr=function(n){return this.throwIfDisposed(),pj(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logicalXor=function(n){return this.throwIfDisposed(),xue(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),Ut(this,n,e,t)};ye().prototype.maxPool=function(n,e,t,s){return this.throwIfDisposed(),S2(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.max=function(n,e){return this.throwIfDisposed(),so(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.maximum=function(n){return this.throwIfDisposed(),Vc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.mean=function(n,e){return this.throwIfDisposed(),Kn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.min=function(n,e){return this.throwIfDisposed(),Xv(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.minimum=function(n){return this.throwIfDisposed(),Vg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),Iue(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.mod=function(n){return this.throwIfDisposed(),Nue(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.mul=function(n){return this.throwIfDisposed(),ee(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.neg=function(){return this.throwIfDisposed(),Vn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.norm=function(n,e,t){return this.throwIfDisposed(),h1(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.notEqual=function(n){return this.throwIfDisposed(),Qv(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),mj(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.onesLike=function(){return this.throwIfDisposed(),Pi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.pad=function(n,e){return this.throwIfDisposed(),T2(this,n,e)};ye().prototype.pool=function(n,e,t,s,r,i){return this.throwIfDisposed(),Vue(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.pow=function(n){return this.throwIfDisposed(),ph(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.prelu=function(n){return this.throwIfDisposed(),I2(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.prod=function(n,e){return this.throwIfDisposed(),zue(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.reciprocal=function(){return this.throwIfDisposed(),fhe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.relu=function(){return this.throwIfDisposed(),Ah(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.relu6=function(){return this.throwIfDisposed(),yj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.reshapeAs=function(n){return this.throwIfDisposed(),oe(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.reshape=function(n){return this.throwIfDisposed(),oe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),Aj(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),Rj(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.reverse=function(n){return this.throwIfDisposed(),mh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.rfft=function(){return this.throwIfDisposed(),Mhe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.round=function(){return this.throwIfDisposed(),bj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.rsqrt=function(){return this.throwIfDisposed(),xj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.selu=function(){return this.throwIfDisposed(),vj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.separableConv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),wj(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sigmoid=function(){return this.throwIfDisposed(),tp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sign=function(){return this.throwIfDisposed(),_he(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sin=function(){return this.throwIfDisposed(),_j(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sinh=function(){return this.throwIfDisposed(),Sj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.slice=function(n,e){return this.throwIfDisposed(),fn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.softmax=function(n){return this.throwIfDisposed(),R2(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.softplus=function(){return this.throwIfDisposed(),m0(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),E2(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.split=function(n,e){return this.throwIfDisposed(),oi(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sqrt=function(){return this.throwIfDisposed(),er(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.square=function(){return this.throwIfDisposed(),vn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.squaredDifference=function(n){return this.throwIfDisposed(),Fhe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.squeeze=function(n){return this.throwIfDisposed(),y0(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof ts?[this,n]:[this,...n];return Za(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.step=function(n){return this.throwIfDisposed(),b0(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.stridedSlice=function(n,e,t,s,r,i,o,a){return this.throwIfDisposed(),jhe(this,n,e,t,s,r,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sub=function(n){return this.throwIfDisposed(),Qe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sum=function(n,e){return this.throwIfDisposed(),Ge(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.tan=function(){return this.throwIfDisposed(),Ghe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.tanh=function(){return this.throwIfDisposed(),a1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.tile=function(n){return this.throwIfDisposed(),Zi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.toBool=function(){return this.throwIfDisposed(),Me(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.toFloat=function(){return this.throwIfDisposed(),Me(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.toInt=function(){return this.throwIfDisposed(),Me(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.topk=function(n,e){return this.throwIfDisposed(),Khe(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.transpose=function(n){return this.throwIfDisposed(),Nt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.unique=function(n){return this.throwIfDisposed(),Qhe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),kj(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.unstack=function(n){return this.throwIfDisposed(),gh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.where=function(n,e){return this.throwIfDisposed(),pr(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.zerosLike=function(){return this.throwIfDisposed(),At(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ro extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ro.prototype)}}class Ai extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ai.prototype)}}class Y extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Y.prototype)}}class lt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,lt.prototype)}}class pA extends Error{constructor(e){super(e),Object.setPrototypeOf(this,pA.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class w6{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yh(n,e){if(Array.isArray(n)){let t=[];for(let s=0;s<e;s++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function $o(n,e){if(!n)throw new pA(e)}function aF(n,e){let t=0;for(const s of n)s===e&&t++;return t}function Tr(n){return n.length===1?n[0]:n}function Xt(n){return Array.isArray(n)?n:[n]}function Pa(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Ou(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let Si={};function mA(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function nI(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>nI(e));else{const e=Object.keys(n);for(const t of e){const s=n[t];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[t]=s.value:nI(s))}}}function _0(n,e={},t={},s="object",r=!1){if(typeof n=="string"){const i=n;let o;if(i in t)o=t[i];else if(i in Si)o=Si[i];else if(o=e[i],o==null)throw new Y(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=n;if(i.className==null||i.config==null)throw new Y(`${s}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let a,l;if(o in t?[a,l]=t[o]:o in Si?[a,l]=Si.className:o in e&&([a,l]=e[o]),a==null)throw new Y(`Unknown ${s}: ${o}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const u={};for(const y of Object.keys(Si))u[y]=Si[y];for(const y of Object.keys(t))u[y]=t[y];const d=i.config;d.customObjects=u;const f=Object.assign({},Si);for(const y of Object.keys(t))Si[y]=t[y];nI(i.config);const m=l(a,i.config,t,r);return Si=Object.assign({},f),m}else{const u=Object.assign({},Si);for(const f of Object.keys(t))Si[f]=t[f];const d=new a(i.config);return Si=Object.assign({},u),d}}}function Eme(n,e){return n<e?-1:n>e?1:0}function wx(n,e){return-1*Eme(n,e)}function ac(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function Ime(n){if(n==null)throw new Y(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function $h(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new Y(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function gA(n,e,t=0,s=1/0){return $o(t>=0),$o(s>=t),Array.isArray(n)&&n.length>=t&&n.length<=s&&n.every(r=>typeof r===e)}function ws(n,e){Array.isArray(n)?(j(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,s)=>ws(t,`element ${s+1} of ${e}`))):j(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${_6(n)}.`)}function _6(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>_6(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function kme(n,e,t){let s=t!=null?t():Sr(),r;return(...o)=>{const a=t!=null?t():Sr();return a-s<e||(s=a,r=n(...o)),r}}function S6(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Nme=0;function C6(){return Nme++}const _x={};function y1(n=""){return n in _x||(_x[n]=0),_x[n]+=1,n+_x[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Ame=["channelsFirst","channelsLast"],Rme=["nearest","bilinear"],$me=["valid","same","causal"],Dme=["max","avg"],Ome=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Ud=new Map;function zn(n){$h(Ame,"DataFormat",n)}function Pme(n){$h(Rme,"InterpolationFormat",n)}function ci(n){$h($me,"PaddingMode",n)}function T6(n){$h(Dme,"PoolMode",n)}const dg=[],lF="/";function Xu(n,e){dg.push(n);try{const t=e();return dg.pop(),t}catch(t){throw dg.pop(),t}}function Mme(){return dg.length===0?"":dg.join(lF)+lF}function E6(n){if(!k6(n))throw new Error("Not a valid tensor name: '"+n+"'");return Mme()+n}function I6(n){if(!k6(n))throw new Error("Not a valid tensor name: '"+n+"'");Ud.has(n)||Ud.set(n,0);const e=Ud.get(n);if(Ud.set(n,Ud.get(n)+1),e>0){const t=`${n}_${e}`;return Ud.set(t,1),t}else return n}const Lme=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function k6(n){return!!n.match(Lme)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Fme(n){return n===parseInt(n.toString(),10)}function lc(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let s=1;for(let r=e;r<t;++r)s*=n[r];return s}function $f(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s<e&&(e=s)}return e}function vc(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s>e&&(e=s)}return e}function oo(n,e){if(e<n)throw new Y(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let s=n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let vT;function is(){return vT==null&&(vT=fae().epsilon()),vT}function ao(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Go(n,e){return Me(n,e)}function S0(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),oe(n,t)}function Vme(n,e){return de(()=>{if(n.shape.length!==2)throw new Y(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=S0(n,1);return sI(t,[1,e,1])})}function Ume(n){const e=[lc(n.shape)];return oe(n,e)}function Bme(n){if(n.rank<=1)throw new Y(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],lc(n.shape,1)];return oe(n,e)}function Yu(n,e,t){return de(()=>{switch(n.rank){case 1:return N2(n,e,t);case 2:return Cj(n,[e,0],[t,n.shape[1]]);case 3:return A2(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return Zv(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return fn(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return fn(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new Y(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function wT(n,e,t){return de(()=>{switch(n.rank){case 1:return N2(n,e,t);case 2:return Cj(n,[0,e],[n.shape[0],t]);case 3:return A2(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return Zv(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new Y(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Sx(n,e,t,s){return de(()=>{switch(n.rank){case 1:return N2(n,e,t);case 2:switch(s){case 1:return Yu(n,e,t);case 2:return wT(n,e,t);default:throw new Y(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Yu(n,e,t);case 2:return A2(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return wT(n,e,t);default:throw new Y(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Yu(n,e,t);case 2:return Zv(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return Zv(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return wT(n,e,t);default:throw new Y(`The axis is not within the rank of the tensor ${s}`)}default:throw new Y(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function yA(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),Er(n,e)}function cF(n,e){switch(n.rank){case 1:return Hle([n,e]);case 2:return Kle([n,e],0);case 3:return Yle([n,e],0);case 4:return Jle([n,e],0);default:throw new Y(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function sI(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new Y(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return Zi(n,e)}function b1(n,e=0,t=1,s,r){return che(n,e,t,s,r)}function Ho(n,e,t,s){if(n.rank<2||e.rank<2)throw new lt(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=n.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(r!==i)throw new lt(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return qL({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?rI(n.rank,s,ao()):null,activation:t});{const r=n.shape.slice(),i=r.pop();n=oe(n,[-1,i]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),u=[...o,a],d=Array.from({length:e.rank},(b,w)=>w===0?e.rank-2:w<=e.rank-2?w-1:w);e=oe(Nt(e,d),[l,-1]);const f=[...r,...u];return oe(qL({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?rI(n.rank,s,ao()):null,activation:t}),f)}}function N6(n,e,t){return de(()=>(Array.isArray(e)?e=jr(e,"int32"):e=Me(e,"int32"),x2(n,e,t)))}function C0(n){return ee(n,n)}function rI(n,e,t){const s=e.shape;if(e.rank!==1&&e.rank!==n)throw new Y(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return s.length===1?oe(e,[1,s[0],1,1,1]):oe(e,[1,s[3],s[0],s[1],s[2]]);if(t==="channelsLast")return s.length===1?oe(e,[1,1,1,1,s[0]]):oe(e,[1].concat(s))}else if(n===4){if(t==="channelsFirst")return s.length===1?oe(e,[1,s[0],1,1]):oe(e,[1,s[2],s[0],s[1]]);if(t==="channelsLast")return s.length===1?oe(e,[1,1,1,s[0]]):oe(e,[1].concat(s))}else if(n===3){if(t==="channelsFirst")return s.length===1?oe(e,[1,s[0],1]):oe(e,[1,s[1],s[0]]);if(t==="channelsLast")return s.length===1?oe(e,[1,1,s[0]]):oe(e,[1].concat(s))}else if(n<3)return e;throw new Y(`Unsupported input rank by biasAdd: ${e.rank}`)}function co(n,e,t){return de(()=>(t==null&&(t=ao()),zn(t),Ne(n,rI(n.rank,e,t))))}function zme(n,e=1){if(e!==1)throw new lt(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return u1(n)}function jme(n){return de(()=>qe(n,Ne(ur(n),1)))}function A6(n,e,t,s){return de(()=>rde(n,e,t,s))}function Wme(n){return de(()=>{const e=Ne(.5,ee(.2,n));return ai(e,0,1)})}function T0(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Gme=["fanIn","fanOut","fanAvg"],Hme=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qme(n){$h(Gme,"FanMode",n)}function Kme(n){$h(Hme,"Distribution",n)}class Li extends rp{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class R6 extends Li{apply(e,t){return vs(e,t)}}R6.className="Zeros";ke(R6);class bA extends Li{apply(e,t){return Uc(e,t)}}bA.className="Ones";ke(bA);class $6 extends Li{constructor(e){if(super(),typeof e!="object")throw new Y(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new Y(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return de(()=>ee(Bt(this.value),Uc(e,t)))}getConfig(){return{value:this.value}}}$6.className="Constant";ke($6);class D6 extends Li{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return g0(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}D6.className="RandomUniform";ke(D6);class O6 extends Li{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new lt(`randomNormal does not support dType ${t}.`);return b1(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}O6.className="RandomNormal";ke(O6);class P6 extends Li{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new lt(`truncatedNormal does not support dType ${t}.`);return Ij(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}P6.className="TruncatedNormal";ke(P6);class M6 extends Li{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return de(()=>{if(e.length!==2||e[0]!==e[1])throw new Y("Identity matrix initializer can only be used for 2D square matrices.");return ee(this.gain,uj(e[0]))})}getConfig(){return{gain:this.gain}}}M6.className="Identity";ke(M6);function Xme(n,e="channelsLast"){let t,s;if(zn(e),n.length===2)t=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const r=lc(n,2);t=n[1]*r,s=n[0]*r}else if(e==="channelsLast"){const r=lc(n,0,n.length-2);t=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=lc(n);t=Math.sqrt(r),s=Math.sqrt(r)}return[t,s]}class Hr extends Li{constructor(e){if(super(),e.scale<0)throw new Y(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,qme(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,Kme(this.distribution),this.seed=e.seed}apply(e,t){const s=Xme(e),r=s[0],i=s[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,r):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(r+i)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new lt(`${this.getClassName()} does not support dType ${t}.`);return Ij(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*o);return g0(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Hr.className="VarianceScaling";ke(Hr);class xA extends Hr{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Hr.className}}xA.className="GlorotUniform";ke(xA);class vA extends Hr{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Hr.className}}vA.className="GlorotNormal";ke(vA);class wA extends Hr{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Hr.className}}wA.className="HeNormal";ke(wA);class _A extends Hr{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Hr.className}}_A.className="HeUniform";ke(_A);class SA extends Hr{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Hr.className}}SA.className="LeCunNormal";ke(SA);class CA extends Hr{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Hr.className}}CA.className="LeCunUniform";ke(CA);class L6 extends Li{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return de(()=>{if(e.length<2)throw new lt("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const s=xe(e.slice(0,-1)),r=e[e.length-1],i=s*r;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(r,s),Math.min(r,s)],a=b1(o,0,1,t,this.seed),l=efe.qr(a,!1);let u=l[0];const f=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return u=ee(u,f.sign()),s<r&&(u=u.transpose()),ee(Bt(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}L6.className="Orthogonal";ke(L6);const uF={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function hF(n,e={}){return _0(n,ki.getMap().classNameMap,e,"initializer")}function In(n){return mA(n)}function Sn(n){if(typeof n=="string"){const e=n in uF?uF[n]:n;if(e==="GlorotNormal")return new vA;if(e==="GlorotUniform")return new xA;if(e==="HeNormal")return new wA;if(e==="HeUniform")return new _A;if(e==="LeCunNormal")return new SA;if(e==="LeCunUniform")return new CA;{const t={};return t.className=e,t.config={},hF(t)}}else return n instanceof Li?n:hF(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function iI(n){return Array.isArray(n)&&Array.isArray(n[0])}function ew(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function Ze(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new Y(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function Lt(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new Y(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tw(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const dF="Variable";class Yme{constructor(e,t="float32",s=dF,r=!0,i=null){this.dtype=t??"float32",this.shape=e.shape,this.id=C6(),s=s??dF,this.originalName=E6(s),this.name=I6(this.originalName),this.trainable_=r,this.constraint=i,this.val=ede(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),Qme(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function Qme(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function oI(n){return n.map(e=>e.read())}function TA(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class os{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Zo{constructor(e,t,s,r,i,o,a){this.dtype=e,this.shape=t,this.sourceLayer=s,this.inputs=r,this.callArgs=i,this.outputTensorIndex=a,this.id=C6(),o!=null&&(this.originalName=E6(o),this.name=I6(this.originalName)),this.rank=t.length}}let Jme=0;class x1{constructor(e,t){this.callArgs=t,this.id=Jme++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s?.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let Zme=0;class ft extends rp{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=Zme++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const s=this.getClassName();t=Pa(s)+"_"+y1(s)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),s=[i].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new Ai(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new Y(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Tr(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Tr(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Ro(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Ro(`Layer ${this.name} is not connected, no input to return.`);return Tr(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Ro(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Ro(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Tr(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=Xt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=Xt(this.inputSpec);if(t.length!==s.length)throw new Y(`Layer ${this.name} expects ${s.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){const i=t[r],o=s[r];if(o==null)continue;const a=i.rank;if(o.ndim!=null&&a!==o.ndim)throw new Y(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new Y(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new Y(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new Y(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const l=i.shape;for(const u in o.axes){const d=Number(u),f=o.axes[u],m=d>=0?l[d]:l[l.length+d];if(f!=null&&[f,null].indexOf(m)===-1)throw new Y(`Input ${r} is incompatible with layer ${this.name}: expected axis ${d} of input shape to have value ${f} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const u=o.shape[l],d=i.shape[l];if(u!=null&&d!=null&&u!==d)throw new Y(`Input ${r} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const s=Xt(e),r=nge(e),i=sge(e);if(r===i)throw new Y("Arguments to apply() must be all SymbolicTensors or all Tensors");return Xu(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of Xt(e))o.push(a.shape);this.build(Tr(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let o=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,o);const a=Xt(o),l=[];for(let u of a)s.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(o=Tr(l),this.activityRegularizer!=null)throw new lt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=ege(e),a=this.computeOutputShape(o);let l;const u=tge(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((d,f)=>new Zo(u,d,this,Xt(e),t,this.name,f)):l=new Zo(u,a,this,Xt(e),t,this.name),this.addInboundNode(e,l,null,null,o,a,t),this._refCount++,this.activityRegularizer!=null)throw new lt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Ro(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const s=JSON.stringify(t.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new Ro(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Ai(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return tw(this.weights)}build(e){this.built=!0}getWeights(e=!1){return oI(e?this.trainableWeights:this.weights)}setWeights(e){de(()=>{const t=this.weights;if(t.length!==e.length)throw new Y(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const s=[],r=oI(t);for(let i=0;i<r.length;++i){const o=r[i],a=t[i],l=e[i];if(!zt(o.shape,l.shape))throw new Y(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}TA(s)})}addWeight(e,t,s,r,i,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new Y(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():Sn("zeros"));const u=r.apply(t,s),d=new Yme(u,s,e,o,a);return u.dispose(),i!=null&&this.addLoss(()=>i.apply(d.read())),o==null&&(o=!0),o?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=Xt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),i=Xt(t),o=Xt(r);if(i.length!==o.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let a=0;a<i.length;a++)i[a].kerasMask=o[a]}addInboundNode(e,t,s,r,i,o,a=null){const l=Xt(e);t=Xt(t),s=Xt(s),r=Xt(r),i=ew(i),o=ew(o);const u=[],d=[],f=[];for(const m of l)u.push(m.sourceLayer),d.push(m.nodeIndex),f.push(m.tensorIndex);new x1({outboundLayer:this,inboundLayers:u,nodeIndices:d,tensorIndices:f,inputTensors:l,outputTensors:t,inputMasks:s,outputMasks:r,inputShapes:i,outputShapes:o},a);for(let m=0;m<t.length;m++)t[m].sourceLayer=this,t[m].nodeIndex=this.inboundNodes.length-1,t[m].tensorIndex=m}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function ege(n){n=Xt(n);const e=[];for(const t of n)e.push(t.shape);return Tr(e)}function tge(n){return"float32"}function F6(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const s=e.inboundNodes[t];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let i=0;i<s.inboundLayers.length;i++){const o=s.inputTensors[i],a=s.inboundLayers[i],l=s.nodeIndices[i],u=F6(o,a,l);for(const d of u)r.indexOf(d)===-1&&r.push(d)}return r}}}function nge(n){let e=!0;for(const t of Xt(n))if(!(t instanceof Zo)){e=!1;break}return e}function sge(n){let e=!0;for(const t of Xt(n))if(t instanceof Zo){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class E0 extends ft{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:y1("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new Y("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new Y("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new Y("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=t,this.dtype=s,this.inputSpec=[{shape:t}];const r=new Zo(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new x1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new Y(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}E0.className="InputLayer";ke(E0);function rge(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new Y("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new E0({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ige(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return Me(e,n.dtype)}catch{throw new Y(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class Ql{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Ql)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=ige(e,t),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new Y(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Zo){if(this.id2Value[e.id]==null)throw new Y(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new Y(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof Zo){if(this.id2Value[e.id]==null)throw new Y(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new Y(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&ut(this.id2Mask)}}const nw=new w6,sw=new w6;function oge(n){nw?.setMaxEntries(n),sw?.setMaxEntries(n)}function Wm(n,e,t,s){const r=t==null?!1:t.training,i=Array.isArray(n),o=i?n:[n],a=o.map(b=>b.name),l=[],u=e.names();for(const b of a)u.indexOf(b)!==-1?l.push(e.getValue(b)):l.push(null);const d=a.join(",")+"|"+e.names().sort().join(",");let f=nw.get(d),m;if(f==null){const b=age(o,e);f=b.sorted,m=b.recipientCounts,nw.put(d,f),sw.put(d,m)}m={},r||Object.assign(m,sw.get(d));const y=new Ql(e);for(let b=0;b<f.length;++b){const w=f[b],v=w.sourceLayer;if(v instanceof E0)continue;const S=[],T=[],I=[];let k=!1;for(const $ of w.inputs){const R=y.getValue($),A=y.getMask($);S.push(R),T.push(A),A!=null&&(k=!0),r||(m[$.name]--,m[$.name]===0&&!e.hasKey($)&&a.indexOf($.name)===-1&&!R.isDisposed&&$.sourceLayer.stateful!==!0&&I.push(R))}k&&(t=t||{},t.mask=T[0]);const O=Xt(v.apply(S,t));let V=null;v.supportsMasking&&(V=v.computeMask(S,T));const P=cge(w),D=Array.isArray(P)?P:[P];for(let $=0;$<D.length;++$){y.hasKey(D[$])||y.add(D[$],O[$],Array.isArray(V)?V[0]:V);const R=a.indexOf(D[$].name);R!==-1&&(l[R]=O[$])}r||ut(I)}return y.disposeMasks(),i?l:l[0]}function age(n,e){j(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],s={};if(n.length===1){const r=fF(n[0],e);t=r.sorted,s=r.recipientMap}else{const r=new Set;for(const i of n){const{sorted:o,recipientMap:a}=fF(i,e);for(const l of o)r.has(l.name)||(t.push(l),r.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(u=>s[l].add(u))}}return{sorted:t,recipientCounts:lge(s)}}function lge(n){const e={};for(const t in n)e[t]=n[t].size;return e}function fF(n,e){const t=new Set,s=[],r={};for(const a of e.names())t.add(a);const i=[],o=[];for(i.push(n);i.length>0;){const a=i[i.length-1];if(t.has(a.name)){i.pop();continue}const l=o[o.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),s.push(a),t.add(a.name),l&&o.pop();else{o.push(i.length-1);for(const u of a.inputs)r[u.name]==null&&(r[u.name]=new Set),r[u.name].add(a.name),!t.has(u.name)&&i.push(u)}}return{sorted:s,recipientMap:r}}function cge(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){t=s;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uge=pe();uge.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,oge);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function EA(n,e){return de(()=>er(Ge(ee(n,n),e,!0)))}class I0 extends rp{getConfig(){return{}}}class V6 extends I0{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return de(()=>{const t=EA(e,this.axis),s=ai(t,0,this.maxValue);return ee(e,qe(s,Ne(is(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}V6.className="MaxNorm";ke(V6);class U6 extends I0{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return de(()=>qe(e,Ne(is(),EA(e,this.axis))))}getConfig(){return{axis:this.axis}}}U6.className="UnitNorm";ke(U6);class B6 extends I0{apply(e){return Ah(e)}}B6.className="NonNeg";ke(B6);class z6 extends I0{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return de(()=>{const t=EA(e,this.axis),s=Ne(ee(this.rate,ai(t,this.minValue,this.maxValue)),ee(1-this.rate,t));return ee(e,qe(s,Ne(is(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}z6.className="MinMaxNorm";ke(z6);const pF={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function as(n){return mA(n)}function mF(n,e={}){return _0(n,ki.getMap().classNameMap,e,"constraint")}function ls(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in pF?pF[n]:n,config:{}};return mF(t)}else return n instanceof I0?n:mF(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Cu(n){if(n==null)return;const e=[],t=[],s=[];for(const r in n){const i=n[r];if(typeof i!="number"){const o=i;e.push(o.data()),t.push(r),s.push(o)}}if(e.length>0){const r=await Promise.all(e);for(let i=0;i<r.length;++i)n[t[i]]=r[i][0];ut(s)}}function j6(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var gF;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(gF||(gF={}));const hge=125;class Bg{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class dge{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class fge extends Bg{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const s=t.size==null?0:t.size;this.seen+=s;for(const r in t){const i=t[r];if(typeof i=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+i*s;else{let o;r in this.totals?o=this.totals[r]:this.totals[r]=0;const a=de(()=>Ne(this.totals[r],ee(i,s)));this.totals[r]=a,o?.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?t[s]=this.totals[s]/this.seen:de(()=>{const r=ee(qe(1,this.seen),this.totals[s]);t[s]=r,this.totals[s].dispose(),jo(t[s])}))}}class pge extends Bg{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const s in t)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(t[s])}async syncData(){const e=[],t=[],s=[];for(const i in this.history){const o=this.history[i];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),t.push(i),s.push(a)}}const r=await Promise.all(e);for(let i=0;i<r.length;++i)this.history[t[i]][s[i]].dispose(),this.history[t[i]][s[i]]=r[i][0]}}class mge extends Bg{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||Kj,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=hge),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");ME(this.yieldEvery)&&(this.maybeWait=kme(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,s){const r=[];this.yield!=null&&(await Cu(s),r.push(this.yield(e,t,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await Cu(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const s=[];this.epochEnd!=null&&(await Cu(t),s.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,t){this.batchBegin!=null&&(await Cu(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const s=[];this.batchEnd!=null&&(await Cu(t),s.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):ME(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Cu(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Cu(e),await this.trainEnd(e))}}function W6(n,e){return n==null&&(n={}),n instanceof Bg?[n]:Array.isArray(n)&&n[0]instanceof Bg?n:Xt(n).map(s=>new mge(s,e))}class Ti{constructor(){}static registerCallbackConstructor(e,t){j(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),Ti.checkForDuplicate(t),Ti.constructors[e]==null&&(Ti.constructors[e]=[]),Ti.constructors[e].push(t)}static checkForDuplicate(e){for(const t in Ti.constructors)Ti.constructors[+t].forEach(r=>{if(r===e)throw new Y("Duplicate callback constructor.")})}static clear(){Ti.constructors={}}static createCallbacks(e){const t=[];for(const s in Ti.constructors){const r=+s;e>=r&&t.push(...Ti.constructors[r])}return t.map(s=>new s)}}Ti.constructors={};function G6(n,e,t,s,r,i,o,a,l){const u=new pge,d=[new fge,...Ti.createCallbacks(e)];n!=null&&d.push(...n),d.push(u);const f=new dge(d);return f.setParams({epochs:t,initialEpoch:s,samples:r,steps:i,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:f,history:u}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qo(n,e={},t=!1){return _0(n,ki.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function rw(n,e){return de(()=>{n.dtype!=="float32"&&(n=Me(n,"float32"));const t=Ge(C0(n),e,!0),s=c1(t.shape,is()),r=er(Vc(t,s));return qe(n,r)})}function v1(n,e){return de(()=>Kn(C0(Qe(e,n)),-1))}function IA(n,e){return de(()=>Kn(ur(Qe(e,n)),-1))}function kA(n,e){return de(()=>{const t=Qe(n,e),s=ai(ur(n),is(),Number.MAX_VALUE),r=ur(qe(t,s));return ee(100,Kn(r,-1))})}function gge(n,e){return de(()=>{const t=ai(e,is(),Number.MAX_VALUE),s=Jo(Ne(1,t)),r=ai(n,is(),Number.MAX_VALUE),i=Jo(Ne(1,r));return Kn(C0(Qe(s,i)),-1)})}function yge(n,e){return de(()=>{const t=Vc(0,Qe(1,ee(n,e)));return Kn(C0(t),-1)})}function bge(n,e){return de(()=>{const t=Vc(0,Qe(1,ee(n,e)));return Kn(t,-1)})}function xge(n,e){return de(()=>{const t=Ge(ee(n,e),-1),s=so(ee(Qe(1,n),e),-1);return Vc(0,Ne(1,Qe(s,t)))})}function vge(n,e){return de(()=>{const t=Math.log(2),s=Qe(e,n),r=Qe(Ne(s,m0(ee(-2,s))),t);return Kn(r,-1)})}function zg(n,e,t=!1){return de(()=>{if(t)e=R2(e);else{const s=Ge(e,e.shape.length-1,!0);e=qe(e,s)}return e=ai(e,is(),1-is()),Vn(Ge(ee(Me(n,"float32"),Jo(e)),e.shape.length-1))})}function iw(n,e,t=!1){return de(()=>{const s=Me(d1(Ume(n)),"int32");e=ai(e,is(),1-is());const r=e.shape,i=oe(mj(s,r[r.length-1]),r);return zg(i,e,t)})}function wge(n,e){if(!zt(n.shape,e.shape))throw new Y(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return de(()=>{const t=Ah(e),s=Vn(ur(e));return Ne(Qe(t,ee(e,n)),hj(Qo(s)))})}function w1(n,e){return de(()=>{let t;return t=ai(e,is(),1-is()),t=Jo(qe(t,Qe(1,t))),Kn(wge(n,t),-1)})}function _ge(n,e){return de(()=>{const t=ai(n,is(),1),s=ai(e,is(),1);return Ge(ee(n,Jo(qe(t,s))),-1)})}function Sge(n,e){return de(()=>{const t=Jo(Ne(is(),e));return Kn(Qe(e,ee(n,t)),-1)})}function H6(n,e){return de(()=>{const t=rw(n,-1),s=rw(e,-1),r=ee(t,s);return Vn(Ge(r,-1))})}const ow={meanSquaredError:v1,meanAbsoluteError:IA,meanAbsolutePercentageError:kA,meanSquaredLogarithmicError:gge,squaredHinge:yge,hinge:bge,categoricalHinge:xge,logcosh:vge,categoricalCrossentropy:zg,sparseCategoricalCrossentropy:iw,binaryCrossentropy:w1,kullbackLeiblerDivergence:_ge,poisson:Sge,cosineProximity:H6};function _T(n){if(typeof n=="string"){if(n in ow)return ow[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new Y(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function q6(n,e){return de(()=>{const t=ee(.5,Pi(e)),s=Go(li(e,t),n.dtype);return Kn(Yo(n,s),-1)})}function K6(n,e){return de(()=>Go(Yo(Mg(n,-1),Mg(e,-1)),"float32"))}function Cge(n,e){return de(()=>Me(Ge(Ja(Yo(n,1),Yo(e,1))),"float32"))}function Tge(n,e){return de(()=>Me(Ge(Ja(Yo(n,0),Yo(e,1))),"float32"))}function Ege(n,e){return de(()=>{const t=Cge(n,e),s=Tge(n,e),r=Ne(t,s);return Me(pr(li(r,0),qe(t,r),0),"float32")})}function Ige(n,e){return w1(n,e)}function kge(n,e){return n.rank===e.rank&&(n=y0(n,[n.rank-1])),e=Mg(e,-1),e.dtype!==n.dtype&&(e=Me(e,n.dtype)),Me(Yo(n,e),"float32")}const Nge=v1,Age=v1,Rge=IA,$ge=IA,Dge=kA,Oge=kA,X6=zg,Pge=H6,Y6=iw,aw={binaryAccuracy:q6,categoricalAccuracy:K6,precision:Ege,categoricalCrossentropy:X6,sparseCategoricalCrossentropy:Y6,mse:Nge,MSE:Age,mae:Rge,MAE:$ge,mape:Dge,MAPE:Oge,cosine:Pge};function Mge(n){if(typeof n=="string"&&n in aw)return aw[n];if(typeof n!="string"&&n!=null)return n;throw new Y(`Unknown metric ${n}`)}function Cx(n){if($o(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(ow))if(ow[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(aw))if(aw[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Lge(n){const e={Adagrad:()=>Vd.adagrad(.01),Adadelta:()=>Vd.adadelta(1,.95,is()),Adam:()=>Vd.adam(.001,.9,.999,is()),Adamax:()=>Vd.adamax(.002,.9,.999,is(),0),RMSProp:()=>Vd.rmsprop(.001,.9,0,is()),SGD:()=>Vd.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new Y(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const yF=1*1024*1024;function bF(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!aI(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const s=JSON.stringify(n);s.length>yF&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${yF}.`)}}function aI(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!aI(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!aI(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Fge(n,e,t,s=console.log){const r=Uge(n),i=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(d=>Math.floor(e*d)));let o;if(!r){i.push("Receives inputs"),o=[];for(const d in n.nodesByDepth)o.push(...n.nodesByDepth[d])}s("_".repeat(e)),lw(i,t,s),s("=".repeat(e));const a=n.layers;for(let d=0;d<a.length;++d)r?Bge(a[d],t,s):zge(a[d],t,o,s),s((d===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const l=Vge(n),u=tw(n.nonTrainableWeights);s(`Total params: ${l+u}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${u}`),s("_".repeat(e))}function Vge(n){let e;return n.collectedTrainableWeights!=null?e=tw(n.collectedTrainableWeights):e=tw(n.trainableWeights),e}function Uge(n){let e=!0;const t=[],s=[];for(const r in n.nodesByDepth)t.push(n.nodesByDepth[r]);for(const r of t){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of n.layers){let i=!1;for(const o of r.inboundNodes)if(s.indexOf(o)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function lw(n,e,t=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);t(s)}function Bge(n,e,t){let s,r;try{r=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const i=n.name,o=n.getClassName(),a=[`${i} (${o})`,r,s,n.countParams().toString()];lw(a,e,t)}function zge(n,e,t,s){let r,i;try{i=n.inboundNodes.map(f=>JSON.stringify(f.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const o=[];for(const f of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(let m=0;m<f.inboundLayers.length;++m){const y=f.inboundLayers[m].name,b=f.nodeIndices[m],w=f.tensorIndices[m];o.push(`${y}[${b}][${w}]`)}const a=n.name,l=n.getClassName(),u=o.length===0?"":o[0],d=[`${a} (${l})`,i,r,n.countParams().toString(),u];lw(d,e,s);for(let f=1;f<o.length;++f)lw(["","","","",o[f]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Q6(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function cw(n,e){if(n===null)return null;if(typeof n=="string")return Ou(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];Q6(e,r,i)?t.push(i):t.push(cw(i,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")t[s]=r;else{const i=Ou(s);t[i]=cw(r,i)}}return t}}function lI(n,e){if(n==null)return null;if(typeof n=="string")return Pa(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];Q6(e,r,i)?t.push(i):t.push(lI(i,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s],i=Pa(s);(s==="name"||s==="className")&&typeof r=="string"?t[i]=r:t[i]=lI(r,s)}return t}}/** @license See the LICENSE file. */const J6="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const jge=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class Hi extends ft{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const T=this.getClassName().toLowerCase();this.name=y1(T)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],ac(this.inputs).length!==this.inputs.length)throw new Y(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(T=>T.name)}`);ac(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(T=>T.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const T of this.outputs){const I=T.sourceLayer,k=T.nodeIndex,O=T.tensorIndex;this.outputLayers.push(I),this.outputLayersNodeIndices.push(k),this.outputLayersTensorIndices.push(O)}for(const T of this.inputs){const I=T.sourceLayer,k=T.nodeIndex,O=T.tensorIndex;$o(k===0,"input layer has >1 nodes"),$o(O===0,"input layer has >1 tensors"),this.inputLayers.push(I),this.inputLayersNodeIndices.push(k),this.inputLayersTensorIndices.push(O)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let T=0;T<this.inputLayers.length;T++){const I=this.inputLayers[T];if(!(I instanceof E0))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${T} (0-based) originates from layer type ${I.getClassName()}.`);this.inputNames.push(I.name),this.feedInputShapes.push(I.batchInputShape),this.feedInputNames.push(I.name)}for(const T of this.outputLayers)this.outputNames.push(T.name);this.internalInputShapes=this.inputs.map(T=>T.shape),this.internalOutputShapes=this.outputs.map(T=>T.shape);const t={},s={},r={},i={},o={},a=[],l=(T,I,k,O,V,P)=>{(O==null||V==null||P==null)&&(O=T.sourceLayer,V=T.nodeIndex,P=T.tensorIndex);const D=O.inboundNodes[V];if(k.indexOf(D)!==-1)throw new Ai(`The tensor ${T.name} at layer "${O.name}" is part of a cycle.`);if(I.indexOf(D)!==-1)return;this.containerNodes.add(Hi.nodeKey(O,V)),O.id in o||(o[O.id]=Object.keys(o).length),k.indexOf(D)===-1&&k.push(D);const $=D.inboundLayers.length;for(let R=0;R<$;R++){const A=D.inputTensors[R],U=D.inboundLayers[R],F=D.nodeIndices[R],ne=D.tensorIndices[R];l(A,I,k,U,F,ne)}for(I.push(D);k.indexOf(D)>=0;)k.splice(k.indexOf(D),1);a.push(D)},u=[],d=[];for(const T of this.outputs)l(T,u,d);const f=a.slice().reverse();for(const T of f){s[T.id]=T,T.id in t||(t[T.id]=0);let I=t[T.id];const k=r[T.outboundLayer.id]==null?0:r[T.outboundLayer.id];I=Math.max(I,k),r[T.outboundLayer.id]=I,i[T.outboundLayer.id]=T.outboundLayer,t[T.id]=I;for(let O=0;O<T.inboundLayers.length;O++){const V=T.inboundLayers[O],P=T.nodeIndices[O],D=V.inboundNodes[P],$=t[D.id]==null?0:t[D.id];t[D.id]=Math.max(I+1,$),s[D.id]=D}}const m={};for(const T in t){const I=t[T];I in m||(m[I]=[]),m[I].push(s[T])}const y={};for(const T in r){const I=r[T];I in y||(y[I]=[]),y[I].push(i[T])}let b=Object.keys(y).map(T=>parseInt(T,10)).sort(wx);this.layers=[];for(const T of b){const I=y[T];I.sort((k,O)=>{const V=o[k.id],P=o[O.id];return V<P?-1:V>P?1:0});for(const k of I)k instanceof Hi&&this.internalContainerRefs.push(k),this.layers.push(k)}this.layersByDepth=y,b=Object.keys(m).map(T=>parseInt(T,10)).sort(wx);const w=this.inputs.slice(),v=[];for(const T of b)for(const I of m[T]){const k=I.outboundLayer;if(k!=null){for(const O of I.inputTensors)if(w.indexOf(O)===-1)throw new Ai(`Graph disconnected: cannot obtain value for tensor ${O} at layer "${k.name}". The following previous layers were accessed without issue: ${v}`);for(const O of I.outputTensors)w.push(O);v.push(k.name)}}this.nodesByDepth=m;const S=this.layers.map(T=>T.name);for(const T of S){const I=S.filter(k=>k===T).length;if(I!==1)throw new Ai(`The name "${T}" is used ${I} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(S))}this.outboundNodes=[],this.inboundNodes=[],new x1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(T=>null),outputMasks:this.outputs.map(T=>null),inputShapes:this.inputs.map(T=>T.shape),outputShapes:this.outputs.map(T=>T.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new Y("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.layers)t.push(...s.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const s={};let r=0;const i=jge(e);i&&this.parseWeights(e);for(const a of this.layers)for(const[l,u]of a.weights.entries()){const d=i?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(s[d]!=null)throw new Y(`Duplicate weight name: ${d}`);s[d]=u,r++}const o=[];for(const a in e){let l=a;if(s[a]==null){const u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(s[l]!=null)o.push([s[l],e[a]]);else if(t)throw new Y(`Provided weight data has no target variable: ${a}`);delete s[l]}if(t){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new Y(`${a.length} of ${r} weights are not set: ${a}`)}TA(o)}parseWeights(e){for(const t in Object.keys(e)){const s=t.split("/"),r=["vars","layer_checkpoint_dependencies"],i=s.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!r.includes(o)).join("/");i!==t&&(e[i]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${J6}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const s=lI(this.updatedConfig());return t?JSON.stringify(s):s}call(e,t){return de(()=>{e=Xt(e);const s=new Ql;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return Wm(this.outputs,s,t)})}computeMask(e,t){return de(()=>{e=Xt(e);let s;return t==null?s=yh(null,e.length):s=Xt(t),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const t=ew(e);if(t.length!==this.inputLayers.length)throw new Y(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<t.length;a++){const l=this.inputLayers[a],u=t[a],d=l.name+"_0_0";s[d]=u}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(wx);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const u of l){const d=u.outboundLayer;if(this.inputLayers.map(w=>w.id).indexOf(d.id)!==-1)continue;const f=[];for(let w=0;w<u.inboundLayers.length;w++){const v=u.inboundLayers[w],S=u.nodeIndices[w],T=u.tensorIndices[w],I=`${v.name}_${S}_${T}`,k=s[I];f.push(k)}const m=d.computeOutputShape(Tr(f)),y=ew(m),b=d.inboundNodes.indexOf(u);for(let w=0;w<y.length;w++){const v=`${d.name}_${b}_${w}`;s[v]=y[w]}}}const i=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],d=this.outputLayersTensorIndices[a],f=`${l.name}_${u}_${d}`;o.push(f)}for(let a=0;a<o.length;a++){const l=o[a];$o(l in s),i.push(s[l])}return Tr(i)}runInternalGraph(e,t){t==null&&(t=yh(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const u=this.inputs[l],d=e[l],f=t[l];s[u.id]=[d,f]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(wx);for(const l of r){const u=this.nodesByDepth[l];for(const d of u){const f=d.outboundLayer,m=d.inputTensors,y=d.outputTensors,b=new Array;for(const w of m)w.id in s&&b.push(s[w.id]);if(b.length===m.length){let w={},v,S,T,I;if(d.callArgs!=null&&(w=d.callArgs),b.length===1){const[k,O]=b[0];w.mask==null&&(w.mask=O),T=Xt(f.call(k,w)),I=Xt(f.computeMask(k,O)),v=[k],S=[O]}else v=b.map(k=>k[0]),S=b.map(k=>k[1]),w.mask==null&&(w.mask=S),T=Xt(f.call(v,w)),I=Xt(f.computeMask(v,S));if(f.activityRegularizer)throw new lt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let k=0;k<y.length;++k){const O=y[k],V=T[k],P=I[k];s[O.id]=[V,P]}}}}const i=[],o=[],a=[];for(const l of this.outputs){$o(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[u,d]=s[l.id];a.push(u.shape),i.push(u),o.push(d)}return[i,o,a]}buildNodeConversionMap(e){const t={};let s;for(const r of this.layers){s=r instanceof Hi?1:0;for(let i=0;i<r.inboundNodes.length;i++){const o=Hi.nodeKey(r,i);this.containerNodes.has(o)&&(t[o]=s,s+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new Y("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new Y(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new Y(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return de(()=>{const e=[];for(const t of this.layers)for(let s=0;s<t.inboundNodes.length;++s){const r=Hi.nodeKey(t,s);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),s=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),u=[];for(let f=0;f<o.inboundNodes.length;f++){const m=o.inboundNodes[f],y=Hi.nodeKey(o,f);let b={};if(this.containerNodes.has(y)){if(m.callArgs)try{JSON.stringify(m.callArgs),b=m.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${m.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),b={}}if(m.inboundLayers.length>0){const w=[];for(let v=0;v<m.inboundLayers.length;v++){const S=m.inboundLayers[v],T=m.nodeIndices[v],I=m.tensorIndices[v],k=Hi.nodeKey(S,T);let O=t[k];O==null&&(O=0),w.push([S.name,O,I,b])}u.push(w)}}}const d={};d.name=o.name,d.className=a,d.config=l,d.inboundNodes=u,s.push(d)}e.layers=s;const r=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],u=Hi.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let d=t[u];d==null&&(d=0);const f=this.inputLayersTensorIndices[o];r.push([a.name,d,f])}e.inputLayers=r;const i=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],u=Hi.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let d=t[u];d==null&&(d=0);const f=this.outputLayersTensorIndices[o];i.push([a.name,d,f])}return e.outputLayers=i,e}static fromConfig(e,t,s={},r=!1){const i={},o={};function a(v,S){v.name in o?o[v.name].push(S):o[v.name]=[S]}function l(v,S){const T=[];let I;for(const k of S){const O=k[0],V=k[1],P=k[2];if(I=k[3]==null?{}:k[3],!(O in i)){a(v,S);return}const D=i[O];if(D.inboundNodes.length<=V){a(v,S);return}const $=D.inboundNodes[V];T.push($.outputTensors[P])}T.length>0&&v.apply(Tr(T),I)}function u(v){const S=v.name,T=qo(v,t.customObjects!=null?t.customObjects:{});T.setFastWeightInitDuringBuild(r),i[S]=T,v.inboundNodes.forEach(k=>{if(!(k instanceof Array))throw new Y(`Corrupted configuration, expected array for nodeData: ${k}`);a(T,k)})}const d=t.name,f=t.layers;for(const v of f)u(v);for(;!Ime(o);)for(const v of f){const S=i[v.name];if(S.name in o){const T=o[S.name];delete o[S.name];for(const I of T)l(S,I)}}const m=[],y=[],b=t.inputLayers;for(const v of b){const S=v[0],T=v[1],I=v[2];$o(S in i);const O=i[S].inboundNodes[T].outputTensors;m.push(O[I])}const w=t.outputLayers;for(const v of w){const S=v[0],T=v[1],I=v[2];$o(S in i);const O=i[S].inboundNodes[T].outputTensors;y.push(O[I])}return new e({inputs:m,outputs:y,name:d})}get stateful(){if(this._stateful)throw new Y("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){de(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Wge(n,e,t){const s=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return e.forEach(i=>{i in n?r.push(n[i]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${t} must be either an array with ${s} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function Z6(n,e){return Wge(n,e,"classWeight")}async function eW(n,e,t,s){if(t!=null){const r=de(()=>{if(n.shape.length===1)return Ku(n);if(n.shape.length===2){if(n.shape[1]>1)return Mg(n,1);if(n.shape[1]===1)return oe(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await r.data());ut(r);const o=[];return i.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(t[a])}),jr(o,"float32")}else return null}function Gge(n,e){return ee(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Hge=32;function tW(n,e){let t,s;const r=e;t=r.xs,s=r.ys,j(t!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=xF("input",n.inputNames,t),o=xF("output",n.outputNames,s),a=i[0].shape[0];j(i.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),j(o.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<i.length;l++)j(i[l].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let l=0;l<o.length;l++)j(o[l].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:i,ys:o}}function xF(n,e,t){if(t instanceof ts)return[t];if(Array.isArray(t))return j(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const s=[];for(const r of e){if(t[r]==null)throw new Y(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(t[r])}return s}}function qge(n){if(n.length===3)throw new lt("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function Kge(n,e,t){const s=t.batchesPerEpoch!=null;if(j(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),j(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),j(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),j(!s||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),j(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=t.validationData!=null;let i,o;if(r)if(vF(t.validationData))j(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const v=qge(t.validationData);i=v.xs,o=v.ys}const a=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let u;r?u=l.slice().concat(l.map(v=>"val_"+v)):u=l.slice();const d=W6(t.callbacks,t.yieldEvery),f=t.verbose==null?1:t.verbose,{callbackList:m,history:y}=G6(d,f,t.epochs,null,null,Xge(e,t),null,r,u);m.setModel(n),n.history=y,await m.onTrainBegin(),n.stopTraining_=!1;let b=t.initialEpoch==null?0:t.initialEpoch,w=await e.iterator();for(;b<t.epochs;){const v={};await m.onEpochBegin(b);let S=0,T=0;for(s||(w=await e.iterator());!s||S<t.batchesPerEpoch;){const I=await w.next();if(s&&I.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${S} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(I.value!=null){const{xs:k,ys:O}=tW(n,I.value),V={};V.batch=T,V.size=k[0].shape[0],await m.onBatchBegin(T,V);const P=[];if(t.classWeight!=null){const R=Z6(t.classWeight,n.outputNames);for(let A=0;A<R.length;++A)P.push(await eW(O[A],null,R[A]))}const D=k.concat(O).concat(P),$=a(D);ut(D);for(let R=0;R<l.length;++R){const A=l[R],U=$[R];V[A]=U,jo(U)}await m.onBatchEnd(T,V),j6(V),T++,S++}if(s?S>=t.batchesPerEpoch:I.done){if(r){let k;vF(t.validationData)?k=Xt(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):k=Xt(n.evaluate(i,o,{batchSize:t.validationBatchSize==null?Hge:t.validationBatchSize,verbose:0}));for(let O=0;O<n.metricsNames.length;++O)v[`val_${n.metricsNames[O]}`]=k[O]}break}if(n.stopTraining_)break}if(await m.onEpochEnd(b,v),b++,n.stopTraining_)break}return await m.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function Xge(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function vF(n){return typeof n.iterator=="function"}function Yge(n){return typeof n.next=="function"}async function Qge(n,e,t){t=t||{};const s=t.batches!=null,r=n.testFunction;let i=[];if(t.verbose>0)throw new lt("Verbose mode is not implemented yet.");j(!s||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const o=Yge(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<t.batches;){const u=await o.next();if(i=de(()=>{if(u.value){const{xs:d,ys:f}=tW(n,u.value),m=d.concat(f),y=de(()=>r(m));if(ut(m),l===0)for(let w=0;w<y.length;++w)i.push(Bt(0));const b=m[0].shape[0];for(let w=0;w<y.length;++w){const v=y[w],S=i[w];i[w]=de(()=>Ne(i[w],ee(b,v))),l>0&&ut(S)}ut(y),a+=b,++l}return i}),u.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<i.length;++u){const d=i[u];i[u]=qe(i[u],a),ut(d)}return Tr(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ST(n){j(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function Am(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(s=>Yu(s,e,t-e)):Yu(n,e,t-e)}function cI(n,e){return de(()=>n==null?null:Array.isArray(n)?n.map(t=>cI(t,e)):N6(n,e.dtype==="int32"?e:Me(e,"int32")))}function CT(n,e){const t=[];let s=0,r=null;for(;s<n;)r=s+e,r>=n&&(r=n),t.push([s,r]),s=r;return t}function nW(n){const e=[];n instanceof ts&&(n=[n]);for(let t=0;t<n.length;++t){const s=n[t];if(s.rank===1)e.push(S0(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function Wi(n,e){if(n==null)return;const t=[];if(e instanceof ts)t.push(e.id);else if(Array.isArray(e))e.forEach(r=>t.push(r.id));else if(e!=null)for(const r in e){const i=e[r];t.push(i.id)}const s=[];if(n instanceof ts)t.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{t.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const i=n[r];t.indexOf(i.id)===-1&&s.push(i)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Jge(n){return n instanceof ts}function uI(n){return Array.isArray(n)}function wF(n){return!Jge(n)&&!uI(n)}function _F(n,e,t,s=!0,r=""){if(e==null||e.length===0){if(n!=null){let o=!1;if(uI(n)&&n.length>0)o=!0;else if(wF(n)){for(const a in n)if(n.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new Y(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(o=>null);let i;if(wF(n)){n=n,i=[];for(const o of e){if(n[o]==null)throw new Y(`No data provided for "${o}". Need data for each key in: ${e}`);i.push(n[o])}}else if(uI(n)){if(n=n,n.length!==e.length)throw new Y(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);i=n}else{if(n=n,e.length>1)throw new Y(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);i=[n]}if(i=nW(i),t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new Y(`Error when checking ${r}: expected ${e[o]} to have ${t[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<t[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],d=t[o][l];if(d!=null&&d>=0&&u!==d)throw new Y(`${r} expected a batch of elements where each example has shape [${t[o].slice(1,t[o].length)}] (i.e.,tensor shape [*,${t[o].slice(1,t[o].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function Zge(n,e,t){const s=ac(n.map(i=>i.shape[0]));s.sort();const r=ac(e.map(i=>i.shape[0]));if(r.sort(),s.length>1)throw new Y(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(r.length>1)throw new Y(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(s.length>0&&r.length>0&&!zt(s,r))throw new Y(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function eye(n,e,t){const s=[v1,w1,zg];for(let r=0;r<n.length;++r){const i=n[r],o=e[r],a=t[r];if(o!=null){if(o===zg&&i.shape[i.shape.length-1]===1)throw new Y(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(o)!==-1){const l=i.shape.slice(1),u=a.slice(1);for(let d=0;d<l.length;++d){const f=l[d],m=u[d];if(m!=null&&f!==m)throw new Y(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function SF(n,e,t,s=!0,r=""){let i;if(Array.isArray(n)){if(n.length!==e.length)throw new Y(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);i=n}else{if(e.length>1)throw new Y(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);i=[n]}if(t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new Y(`Error when checking ${r}: expected ${e[o]} to have ${t[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<t[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],d=t[o][l];if(d!=null&&d!==u)throw new Y(`Error when checking ${r}: expected ${e[o]} to have shape ${JSON.stringify(t[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function tye(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(s=>t);{const s=[];for(const r of e){let i=t.hasOwnProperty(r)?t[r]:[];Array.isArray(i)||(i=[i]),s.push(i)}return s}}const nye="layers-model";class pf extends Hi{constructor(e){super(e),this.isTraining=!1}summary(e,t,s=console.log){if(!this.built)throw new Y("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Fge(this,e,t,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=Lge(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Bc))throw new Y("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new Y(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),t.push(_T(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new Y(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>_T(a))}else{const o=_T(e.loss);this.outputs.forEach(a=>{t.push(o)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Xu("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const r=tye(e.metrics,this.outputNames),i=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};Xu("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=r[o];(u=>{let f,m,y;for(const b of u){if(typeof b=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(b)!==-1){const v=this.internalOutputShapes[o];v[v.length-1]===1||this.lossFunctions[o]===w1?["accuracy","acc"].indexOf(b)!==-1?m=q6:["crossentropy","ce"].indexOf(b)!==-1&&(m=Ige):this.lossFunctions[o]===iw?["accuracy","acc"].indexOf(b)!==-1?m=kge:["crossentropy","ce"].indexOf(b)!==-1&&(m=Y6):["accuracy","acc"].indexOf(b)!==-1?m=K6:["crossentropy","ce"].indexOf(b)!==-1&&(m=X6);let S;["accuracy","acc"].indexOf(b)!==-1?S="acc":["crossentropy","ce"].indexOf(b)!==-1&&(S="ce"),y=m,f=""+S}else y=Mge(b),f=""+Cx(b);let w;Xu(f,()=>{w=y}),i(o,f,w)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,s={}){const r=s.batchSize==null?32:s.batchSize;ST(r);const o=this.standardizeUserDataXY(e,t,!0,r);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,u=this.testLoop(l,a,r,s.verbose,s.steps);return Tr(u)}finally{Wi(o[0],e),Wi(o[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),Qge(this,e,t)}checkNumSamples(e,t,s,r="steps"){let i;if(s!=null){if(i=null,t!=null)throw new Y(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new Y(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return i}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new Y("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(t),r=s?t:[t],i=this.retrieveSymbolicTensors(r),o=new Ql;if(e instanceof ts&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new Y(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const u=e[l.name];if(u==null)throw new Y(`No value is provided for the model's input ${l.name}`);o.add(l,u)}const a=Wm(i,o);return s?a:a[0]}retrieveSymbolicTensors(e){const t=yh(null,e.length);let s=e.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],o=i.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(t[a]=i[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw t.forEach((i,o)=>{i==null&&r.push(e[o])}),new Y(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,s=!1){return de(()=>{const r=this.checkNumSamples(e);if(s)throw new lt("Verbose predictLoop() is not implemented yet.");const i=CT(r,t),o=this.outputs.map(a=>[]);for(let a=0;a<i.length;++a)de(()=>{const u=i[a][0],d=i[a][1],f=Am(e,u,d),m=[];if(Array.isArray(f))for(let b=0;b<f.length;++b)m.push({key:this.inputs[b],value:f[b]});else m.push({key:this.inputs[0],value:f});const y=new Ql(m);return Wm(this.outputs,y)}).forEach((u,d)=>o[d].push(u));return Tr(o.map(a=>Er(a,0)))})}predict(e,t={}){const s=nW(e);SF(s,this.inputNames,this.feedInputShapes,!1);try{const r=t.batchSize==null?32:t.batchSize;return ST(r),this.predictLoop(s,r)}finally{Wi(s,e)}}predictOnBatch(e){SF(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,s=!0,r){if(this.optimizer_==null)throw new Ai("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===iw?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(e=_F(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=_F(t,this.feedOutputNames,i,!1,"target"),Zge(e,t),eye(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new Y(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,s,r,i=!0,o){const[a,l]=this.standardizeUserDataXY(e,t,i,o);if(s!=null)throw new Error("sample weight is not supported yet.");let u=null;if(r!=null){const d=Z6(r,this.outputNames);u=[];for(let f=0;f<d.length;++f)u.push(await eW(l[f],null,d[f]))}return[a,l,u]}testLoop(e,t,s,r=0,i){return de(()=>{const o=this.checkNumSamples(t,s,i,"steps"),a=[];if(r>0)throw new lt("Verbose mode is not implemented yet.");if(i!=null)throw new lt("steps mode in testLoop() is not implemented yet");{const l=CT(o,s),u=jr(oo(0,o));for(let d=0;d<l.length;++d){const f=l[d][0],m=l[d][1],y=Yu(u,f,m-f),b=cI(t,y),w=e(b);if(d===0)for(let v=0;v<w.length;++v)a.push(Bt(0));for(let v=0;v<w.length;++v){const S=w[v];a[v]=Ne(a[v],ee(m-f,S))}}for(let d=0;d<a.length;++d)a[d]=qe(a[d],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let s=0;s<e.length;++s){const r=e[s];let i=r;if(aF(e,r)>1){const o=aF(e.slice(0,s),r);i+=`_${o}`}t.push(i)}return t}makeTrainFunction(){return e=>{const t=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const f=[];for(let w=0;w<this.inputs.length;++w)f.push({key:this.inputs[w],value:s[w]});const m=new Ql(f),y=Wm(this.outputs,m,{training:!0});let b;for(let w=0;w<this.lossFunctions.length;++w){const v=this.lossFunctions[w];let S=v(r[w],y[w]);i[w]!=null&&(S=Gge(S,i[w]));const T=Kn(S);t.push(T),w===0?b=S:b=Ne(b,S)}for(let w=0;w<this.metricsTensors.length;++w){let v;if(this.outputs.length>1&&w<this.outputs.length)v=t[w];else{const S=this.metricsTensors[w][0],T=this.metricsTensors[w][1];v=Kn(S(r[T],y[T]))}jo(v),o.push(v)}return b=Kn(b),this.calculateLosses().forEach(w=>{b=Ne(b,w)}),b},l=this.collectedTrainableWeights.map(f=>f.read());return[this.optimizer_.minimize(a,!0,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>de(()=>{const t=[];let s;const r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let u=0;u<this.inputs.length;++u)o.push({key:this.inputs[u],value:r[u]});const a=new Ql(o),l=Wm(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){const d=this.lossFunctions[u],f=Kn(d(i[u],l[u]));u===0?s=f:s=Ne(s,f),t.push(s)}for(let u=0;u<this.metricsTensors.length;++u){const d=this.metricsTensors[u][0],f=this.metricsTensors[u][1],m=Kn(d(i[f],l[f]));t.push(m)}return t})}async fit(e,t,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,i,o,a,l,u,d,f,m;try{const y=s.batchSize==null?32:s.batchSize;ST(y);const w=await this.standardizeUserData(e,t,s.sampleWeight,s.classWeight,!1,y);r=w[0],i=w[1],m=w[2];let v=!1,S;if(s.validationData!=null&&s.validationData.length>0){if(v=!0,s.validationData.length===2)l=s.validationData[0],u=s.validationData[1];else throw s.validationData.length===3?new lt("validationData including sample weights is not supported yet."):new Y(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const R=await this.standardizeUserData(l,u,null,null,!0,y);d=R[0],f=R[1],S=d.concat(f)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){v=!0;const $=Math.floor(r[0].shape[0]*(1-s.validationSplit)),R=r[0].shape[0];d=Am(r,$,R),o=r,r=Am(r,0,$),f=Am(i,$,R),a=i,i=Am(i,0,$),S=d.concat(f)}else s.validationSteps!=null&&(v=!0);const T=r.concat(i).concat(m);this.checkTrainableWeightsConsistency();const I=this.makeTrainFunction(),k=this.getDedupedMetricsNames();let O,V;v?(this.makeTestFunction(),O=this.testFunction,V=k.slice().concat(k.map($=>"val_"+$))):(O=null,S=[],V=k.slice());const P=W6(s.callbacks,s.yieldEvery);return await this.fitLoop(I,T,k,y,s.epochs,s.verbose,P,O,S,s.shuffle,V,s.initialEpoch,null,null)}finally{this.isTraining=!1,Wi(r,e),Wi(i,t),Wi(o,e),Wi(a,t),Wi(d,l),Wi(f,u),m!=null&&ut(m)}}async fitLoop(e,t,s,r,i,o,a,l,u,d,f,m,y,b){r==null&&(r=32),i==null&&(i=1),d==null&&(d=!0),m==null&&(m=0);let w=!1;if(l!=null&&u!=null&&(w=!0),b!=null&&(w=!0,y==null))throw new Y("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const v=this.checkNumSamples(t,r,y,"steps_per_epoch");let S;v!=null&&(S=oo(0,v)),o==null&&(o=1);const{callbackList:T,history:I}=G6(a,o,i,m,v,y,r,w,f);T.setModel(this),this.history=I,await T.onTrainBegin(),this.stopTraining_=!1;for(let k=m;k<i;++k){await T.onEpochBegin(k);const O={};if(y!=null)throw new lt("stepsPerEpoch mode is not implemented yet.");{if(d==="batch")throw new lt("batch shuffling is not implemneted yet");d&&Soe(S);const V=jr(S),P=CT(v,r);for(let D=0;D<P.length;++D){const $={};if(await T.onBatchBegin(D,$),de(()=>{const R=P[D][0],A=P[D][1],U=Yu(V,R,A-R);$.batch=D,$.size=A-R;const F=cI(t,U),ne=e(F);for(let Q=0;Q<s.length;++Q){const G=s[Q],K=ne[Q];$[G]=K,jo(K)}if(D===P.length-1&&w){const Q=this.testLoop(l,u,r);for(let G=0;G<s.length;++G){const K=s[G],J=Q[G];jo(J),O["val_"+K]=J}}}),await T.onBatchEnd(D,$),j6($),this.stopTraining_)break}V.dispose()}if(await T.onEpochEnd(k,O),this.stopTraining_)break}return await T.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return Kge(this,e,t)}async trainOnBatch(e,t){const s=await this.standardizeUserData(e,t),r=s[0],i=s[1],a=this.makeTrainFunction()(r.concat(i)),l=[];for(const u of a){const d=await u.data();l.push(d[0])}return ut(a),Wi(s[0],e),Wi(s[1],t),Tr(l)}getNamedWeights(e){const t=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,i=this.getWeights(s);for(let o=0;o<r.length;++o)s&&!r[o].trainable||t.push({name:r[o].originalName,tensor:i[o]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=DL().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-DL().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Pa(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>Pa(t))}else{const t=Object.keys(this.loss);e={};const s=this.loss;for(const r of t)if(typeof s[r]=="string")e[r]=Pa(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Pa(Cx(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Pa(Cx(e)));{const e={};for(const t in this.metrics)e[t]=Pa(Cx(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=cw(e.optimizer_config),s=qo(t);let r;if(typeof e.loss=="string")r=Ou(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(o=>Ou(o));else if(e.loss!=null){r={};for(const o in e.loss)r[o]=Ou(e.loss[o])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(o=>Ou(o));else if(e.metrics!=null){i={};for(const o in e.metrics)i[o]=Ou(e.metrics[o])}this.compile({loss:r,metrics:i,optimizer:s})}async save(e,t){if(typeof e=="string"){const u=qz(e);if(u.length===0)throw new Y(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new Y(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new Y("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await OL(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:nye,generatedBy:`TensorFlow.js tfjs-layers v${J6}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:d,specs:f}=await OL(await this.optimizer.getWeights(),u);s.specs.push(...f),s.data=vae([s.data,d])}return this.userDefinedMetadata!=null&&(bF(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){bF(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}pf.className="Model";ke(pf);class sW extends pf{}sW.className="Functional";ke(sW);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function CF(n,e){if(e==null&&(e={}),typeof n=="string"){const t=kae(n,e);if(t.length===0)t.push(ufe(n,e));else if(t.length>1)throw new Y(`Found more than one (${t.length}) load handlers for URL '${n}'`);n=t[0]}return sye(n,void 0,e)}async function sye(n,e,t){if(t==null&&(t={}),n.load==null)throw new Y("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await n.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const i=t.strict==null?!0:t.strict,o=s.weightData!=null&&s.weightSpecs!=null&&i,a=qo(cw(r),e,o),l=s.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new Y("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:u,optimizerWeights:d}=rye(s.weightData,s.weightSpecs);a.loadWeights(u,i),a.optimizer!=null&&d.length>0&&await a.optimizer.setWeights(d),ut(u),ut(d.map(f=>f.tensor))}return a}function rye(n,e){const t=pae(n,e),s={},r=[];return e.forEach(i=>{i.group==="optimizer"?r.push({name:i.name,tensor:t[i.name]}):s[i.name]=t[i.name]}),{modelWeights:s,optimizerWeights:r}}class jg extends pf{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:y1("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new Y(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof jg||e instanceof pf;let s;if(t){if(s=e,s.outputs.length!==1)throw new Y("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new Y("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new Y("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=rge({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(t)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new Y(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new Y("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=F6(this.outputs[0])}this.inboundNodes=[],new x1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:yh(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(Lt(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new pf({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,s=console.log){this.built||this.build(),super.summary(e,t,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,s={}){if(!this.built)throw new Ai("The model needs to be compiled before being used.");return this.model.evaluate(e,t,s)}async evaluateDataset(e,t){if(!this.built)throw new Ai("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,s={}){if(!this.built)throw new Ai("The model needs to be compiled before being used.");return this.model.fit(e,t,s)}async fitDataset(e,t){if(!this.built)throw new Ai("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,s={},r=!1){let i,o={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new Y("Legacy serialization format not supported yet.");i=t}else j(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=t.layers,delete t.layers,o=t;const a=new e(o);if(!(a instanceof jg))throw new lt(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of i){const d=qo(l,void 0,r);r&&d.setFastWeightInitDuringBuild(!0),a.add(d)}return a}set stopTraining(e){if(this.model==null)throw new Y("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new Y("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const s={};s.className=t.getClassName(),s.config=t.getConfig(),e.push(s)}return{name:this.name,layers:e}}}jg.className="Sequential";ke(jg);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let nr=class extends rp{getConfig(){return{}}};class rW extends nr{apply(e,t=1){return zme(e,t)}}rW.className="elu";ke(rW);class iW extends nr{apply(e){return vj(e)}}iW.className="selu";ke(iW);class oW extends nr{apply(e){return Ah(e)}}oW.className="relu";ke(oW);class aW extends nr{apply(e){return de(()=>Vg(6,Ah(e)))}}aW.className="relu6";ke(aW);class lW extends nr{apply(e){return e}}lW.className="linear";ke(lW);class cW extends nr{apply(e){return tp(e)}}cW.className="sigmoid";ke(cW);class uW extends nr{apply(e){return Wme(e)}}uW.className="hardSigmoid";ke(uW);class hW extends nr{apply(e){return m0(e)}}hW.className="softplus";ke(hW);class dW extends nr{apply(e){return jme(e)}}dW.className="softsign";ke(dW);class fW extends nr{apply(e){return a1(e)}}fW.className="tanh";ke(fW);let NA=class extends nr{apply(e,t=-1){return R2(e,t)}};NA.className="softmax";ke(NA);class pW extends nr{apply(e,t=-1){return dj(e,t)}}pW.className="logSoftmax";ke(pW);class mW extends nr{apply(e){return de(()=>de(()=>{const t=Math.sqrt(2),s=ee(.5,Ne(1,aj(qe(e,t))));return ee(e,s)}))}}mW.className="gelu";ke(mW);class gW extends nr{apply(e){return de(()=>ee(.5,ee(e,Ne(1,a1(ee(er(qe(2,Math.PI)),Ne(e,ee(.044715,ph(e,3)))))))))}}gW.className="gelu_new";ke(gW);class yW extends nr{apply(e){return de(()=>ee(e,a1(m0(e))))}}yW.className="mish";ke(yW);class bW extends nr{apply(e,t=1){return de(()=>ee(tp(ee(e,t)),e))}}bW.className="swish";ke(bW);function wc(n){return n.getClassName()}function TT(n,e={}){return _0(n,ki.getMap().classNameMap,e,"activation")}function _c(n){if(n==null){const e={};return e.className="linear",e.config={},TT(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},TT(e)}else return n instanceof nr?n:TT(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function iye(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class xW extends rp{}class vW extends xW{constructor(e){super(),iye(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return de(()=>{let t=vs([1]);return this.hasL1&&(t=Ne(t,Ge(ee(this.l1,ur(e))))),this.hasL2&&(t=Ne(t,Ge(ee(this.l2,C0(e))))),oe(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}vW.className="L1L2";ke(vW);const TF={l1l2:"L1L2"};function cn(n){return mA(n)}function EF(n,e={}){return _0(n,ki.getMap().classNameMap,e,"regularizer")}function Cn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in TF?TF[n]:n,config:{}};return EF(t)}else return n instanceof xW?n:EF(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class wW extends ft{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=Ze(e);let s=Ah(e);return this.maxValue!=null&&(s=ai(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}wW.className="ReLU";ke(wW);class _W extends ft{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=Ze(e);return w2(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}_W.className="LeakyReLU";ke(_W);class SW extends ft{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Sn(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Cn(e.alphaRegularizer),this.alphaConstraint=ls(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new Y(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Lt(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new os({ndim:e.length,axes:s})],this.built=!0}call(e,t){return e=Ze(e),I2(e,this.alpha.read())}getConfig(){const e={alphaInitializer:In(this.alphaInitializer),alphaRegularizer:cn(this.alphaRegularizer),alphaConstraint:as(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}SW.className="PReLU";ke(SW);let CW=class extends ft{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new lt(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=Ze(e);return u1(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};CW.className="ELU";ke(CW);class TW extends ft{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const s=Ze(e);return ee(s,Me(li(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}TW.className="ThresholdedReLU";ke(TW);class EW extends ft{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new NA().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return de(()=>{let s=Ze(e);const r=t.mask;if(r!=null){const i=ee(Qe(Uc(s.shape),Me(r,s.dtype)),Bt(-1e9));s=Ne(s,i)}return this.axis instanceof Array?this.axis.length>1?Qo(Qe(s,fj(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}EW.className="Softmax";ke(EW);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mf(n,e,t){if(typeof n=="number")return yh(n,e);if(n.length!==e)throw new Y(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let s=0;s<e;++s){const r=n[s];if(!Fme(r))throw new Y(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function ro(n,e,t,s,r=1){if(n==null)return n;const i=e+(e-1)*(r-1);let o;return t==="same"?o=n:o=n-i+1,Math.floor((o+s-1)/s)}function Do(n,e,t,s){if(n==null)return null;if(s==="valid")n=n*e+vc([t-e,0]);else if(s==="same")n=n*e;else throw new Y(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function AA(n,e){return de(()=>(zn(e),e==="channelsFirst"?Nt(n,[0,2,3,1]):n))}function IW(n,e){return de(()=>(zn(e),e==="channelsFirst"?Nt(n,[0,2,3,4,1]):n))}function oye(n,e,t,s=1,r="valid",i,o=1){return de(()=>{if(i==null&&(i=ao()),zn(i),n.shape.length!==3)throw new Y(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new Y(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new Y(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(i==="channelsFirst"&&(n=Nt(n,[0,2,1])),r==="causal")throw new lt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=nj(n,e,s,r==="same"?"same":"valid","NWC",o);return t!=null&&(a=co(a,t)),a})}function IF(n,e,t,s=[1,1],r="valid",i,o,a=null){return de(()=>{if(i==null&&(i=ao()),zn(i),n.rank!==3&&n.rank!==4)throw new Y(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new Y(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=AA(n,i);if(r==="causal")throw new lt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=ade({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:a}),i==="channelsFirst"&&(l=Nt(l,[0,3,1,2])),l})}function aye(n,e,t,s=[1,1,1],r="valid",i,o){return de(()=>{if(i==null&&(i=ao()),zn(i),n.rank!==4&&n.rank!==5)throw new Y(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new Y(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=IW(n,i);if(r==="causal")throw new lt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=rce(a,e,s,r==="same"?"same":"valid","NDHWC",o),t!=null&&(a=co(a,t)),i==="channelsFirst"&&(a=Nt(a,[0,4,1,2,3])),a})}class _1 extends ft{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",_1.verifyArgs(t),this.rank=e,ws(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new lt(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=mf(t.kernelSize,e,"kernelSize"),this.strides=mf(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,ci(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,zn(this.dataFormat),this.activation=_c(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=Sn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=ls(t.biasConstraint),this.biasRegularizer=Cn(t.biasRegularizer),this.activityRegularizer=Cn(t.activityRegularizer),this.dilationRate=mf(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new Y(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new Y(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new Y(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if($o("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!gA(e.kernelSize,"number",1,3))throw new Y(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:wc(this.activation),useBias:this.useBias,biasInitializer:In(this.biasInitializer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),biasConstraint:as(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class ip extends _1{constructor(e,t){super(e,t),this.kernel=null,ip.verifyArgs(t),this.filters=t.filters,ws(this.filters,"filters"),this.kernelInitializer=Sn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=ls(t.kernelConstraint),this.kernelRegularizer=Cn(t.kernelRegularizer)}build(e){e=Lt(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new Y(`The channel dimension of the input should be defined. Found ${e[t]}`);const s=e[t],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:s}}],this.built=!0}call(e,t){return de(()=>{e=Ze(e);let s;const r=this.bias==null?null:this.bias.read(),i=S6(this.activation.getClassName());if(i!=null&&this.rank===2)s=IF(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)s=oye(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=IF(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=aye(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new lt("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=Lt(e);const t=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<s.length;++i){const o=ro(s[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);t.push(o)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:In(this.kernelInitializer),kernelRegularizer:cn(this.kernelRegularizer),kernelConstraint:as(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new Y(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class k0 extends ip{constructor(e){super(2,e),k0.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!gA(e.kernelSize,"number",1,2))throw new Y(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}k0.className="Conv2D";ke(k0);class N0 extends ip{constructor(e){super(3,e),N0.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new Y(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}N0.className="Conv3D";ke(N0);class kW extends k0{constructor(e){if(super(e),this.inputSpec=[new os({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new Y(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Lt(e),e.length!==4)throw new Y("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new Y("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new os({ndim:4,axes:{[t]:s}})],this.built=!0}call(e,t){return de(()=>{let s=Ze(e);if(s.shape.length!==4)throw new Y(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=r[o],u=r[a],d=this.kernelSize[0],f=this.kernelSize[1],m=this.strides[0],y=this.strides[1],b=Do(l,m,d,this.padding),w=Do(u,y,f,this.padding),v=[i,b,w,this.filters];this.dataFormat!=="channelsLast"&&(s=Nt(s,[0,2,3,1]));let S=sj(s,this.kernel.read(),v,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(S=Nt(S,[0,3,1,2])),this.bias!=null&&(S=co(S,this.bias.read(),this.dataFormat)),this.activation!=null&&(S=this.activation.apply(S)),S})}computeOutputShape(e){e=Lt(e);const t=e.slice();let s,r,i;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3):(s=3,r=1,i=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return t[s]=this.filters,t[r]=Do(t[r],l,o,this.padding),t[i]=Do(t[i],u,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}kW.className="Conv2DTranspose";ke(kW);class NW extends N0{constructor(e){if(super(e),this.inputSpec=[new os({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new Y(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Lt(e),e.length!==5)throw new Y("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new Y("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new os({ndim:5,axes:{[t]:s}})],this.built=!0}call(e,t){return de(()=>{let s=Ze(e);if(s.shape.length!==5)throw new Y(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const u=r[l],d=r[o],f=r[a],m=this.kernelSize[0],y=this.kernelSize[1],b=this.kernelSize[2],w=this.strides[0],v=this.strides[1],S=this.strides[2],T=Do(u,w,m,this.padding),I=Do(d,v,y,this.padding),k=Do(f,S,b,this.padding),O=[i,T,I,k,this.filters];this.dataFormat!=="channelsLast"&&(s=Nt(s,[0,2,3,4,1]));let V=ace(s,this.kernel.read(),O,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(V=Nt(V,[0,4,1,2,3])),this.bias!==null&&(V=co(V,this.bias.read(),this.dataFormat)),this.activation!==null&&(V=this.activation.apply(V)),V})}computeOutputShape(e){e=Lt(e);const t=e.slice();let s,r,i,o;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3,o=4):(s=4,r=1,i=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],d=this.strides[0],f=this.strides[1],m=this.strides[2];return t[s]=this.filters,t[r]=Do(t[r],d,a,this.padding),t[i]=Do(t[i],f,l,this.padding),t[o]=Do(t[o],m,u,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}NW.className="Conv3DTranspose";ke(NW);class AW extends ip{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new Y("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new Y("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new Y(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=Sn(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Cn(t.depthwiseRegularizer),this.depthwiseConstraint=ls(t.depthwiseConstraint),this.pointwiseInitializer=Sn(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Cn(t.pointwiseRegularizer),this.pointwiseConstraint=ls(t.pointwiseConstraint)}build(e){if(e=Lt(e),e.length<this.rank+2)throw new Y(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new Y(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const s=e[t],r=this.kernelSize.concat([s,this.depthMultiplier]),i=[];for(let a=0;a<this.rank;++a)i.push(1);i.push(s*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new os({ndim:this.rank+2,axes:{[t]:s}})],this.built=!0}call(e,t){return de(()=>{e=Ze(e);let s;if(this.rank===1)throw new lt("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Nt(e,[0,2,3,1])),s=wj(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=co(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=Nt(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=In(this.depthwiseInitializer),e.pointwiseInitializer=In(this.pointwiseInitializer),e.depthwiseRegularizer=cn(this.depthwiseRegularizer),e.pointwiseRegularizer=cn(this.pointwiseRegularizer),e.depthwiseConstraint=as(this.depthwiseConstraint),e.pointwiseConstraint=as(this.pointwiseConstraint),e}}AW.className="SeparableConv";class RW extends AW{constructor(e){super(2,e)}}RW.className="SeparableConv2D";ke(RW);class S1 extends ip{constructor(e){super(1,e),S1.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!gA(e.kernelSize,"number",1,1))throw new Y(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}S1.className="Conv1D";ke(S1);class $W extends ft{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return de(()=>{if(e=Ze(e),this.dataFormat==="channelsLast"){const s=Sx(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Sx(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=Sx(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Sx(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}$W.className="Cropping2D";ke($W);class DW extends ft{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,zn(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,Pme(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,s]}else{const t=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],t,s,e[3]]}}call(e,t){return de(()=>{let s=Ze(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=Nt(s,[0,2,3,1]);const i=this.size[0]*r[2],o=this.size[1]*r[3],a=this.interpolation==="nearest"?Ba.resizeNearestNeighbor(s,[i,o]):Ba.resizeBilinear(s,[i,o]);return Nt(a,[0,3,1,2])}else{const i=this.size[0]*r[1],o=this.size[1]*r[2];return this.interpolation==="nearest"?Ba.resizeNearestNeighbor(s,[i,o]):Ba.resizeBilinear(s,[i,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}DW.className="UpSampling2D";ke(DW);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function lye(n,e,t=[1,1],s="valid",r,i){return de(()=>{r==null&&(r=ao()),zn(r);let o=AA(n,r);if(n.rank!==4)throw new Y(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new Y(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=y2(o,e,t,s==="same"?"same":"valid","NHWC",i),r==="channelsFirst"&&(o=Nt(o,[0,3,1,2])),o})}class OW extends _1{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Sn(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=ls(e.depthwiseConstraint),this.depthwiseRegularizer=Cn(e.depthwiseRegularizer)}build(e){if(e=Lt(e),e.length<4)throw new Y(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new Y(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const s=e[t],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return de(()=>{e=Ze(e);let s=lye(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=co(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=Lt(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=ro(t,this.kernelSize[0],this.padding,this.strides[0]),o=ro(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,i,o]:[e[0],i,o,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=In(this.depthwiseInitializer),e.depthwiseRegularizer=cn(this.depthwiseRegularizer),e.depthwiseConstraint=as(this.depthwiseRegularizer),e}}OW.className="DepthwiseConv2D";ke(OW);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function PW(n,e,t,s){if(Array.isArray(n)){if(e!=null||t!=null)throw new Y("When inputs is an array, neither initialState or constants should be provided");s!=null&&(t=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function r(i){return i==null||Array.isArray(i)?i:[i]}return e=r(e),t=r(t),{inputs:n,initialState:e,constants:t}}function MW(n,e,t,s=!1,r,i,o=!1,a=!1){return de(()=>{const l=e.shape.length;if(l<3)throw new Y(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(oo(2,l));e=Nt(e,u),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=Me(Me(r,"bool"),"float32"),r.rank===l-1&&(r=Cr(r,-1)),r=Nt(r,u)),s&&(e=mh(e,0),r!=null&&(r=mh(r,0)));const d=[];let f,m=t;const y=e.shape[0],b=gh(e);let w;r!=null&&(w=gh(r));for(let S=0;S<y;++S){const T=b[S],I=de(()=>n(T,m));if(r==null)f=I[0],m=I[1];else{const k=de(()=>{const O=w[S],V=Qe(Pi(O),O),P=Ne(ee(I[0],O),ee(m[0],V)),D=m.map(($,R)=>Ne(ee(I[1][R],O),ee($,V)));return{output:P,newStates:D}});f=k.output,m=k.newStates}a&&d.push(f)}let v;return a&&(v=Za(d,1)),[f,v,m]})}class zc extends ft{constructor(e){super(e);let t;if(e.cell==null)throw new Y("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new DA({cells:e.cell}):t=e.cell,t.stateSize==null)throw new Y("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new os({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return oo(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){iI(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const s=t[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const i=[];for(const o of t)i.push([e[0],o]);return[r].concat(i)}else return r}computeMask(e,t){return de(()=>{Array.isArray(t)&&(t=t[0]);const s=this.returnSequences?t:null;if(this.returnState){const r=this.states.map(i=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let s=0;s<e;++s)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new lt("Constants support is not implemented in RNN yet.");iI(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new os({shape:[t,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!zt(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new Y(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new os({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){de(()=>{if(!this.stateful)throw new Ro("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new Y("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>vs([s,r])):this.states_=[vs([s,this.cell.stateSize])];else if(e==null)ut(this.states_),this.keptStates!=null&&(ut(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>vs([s,r])):this.states_[0]=vs([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new Y(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):ut(this.states_);for(let r=0;r<this.states_.length;++r){const i=e[r],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,o];if(!zt(i.shape,a))throw new Y(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${i.shape}`);this.states_[r]=i}}this.states_=this.states_.map(r=>jo(r.clone()))})}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const i=PW(e,s,r,this.numConstants);e=i.inputs,s=i.initialState,r=i.constants;let o=[],a=[];if(s!=null){t.initialState=s,o=o.concat(s),this.stateSpec=[];for(const u of s)this.stateSpec.push(new os({shape:u.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(t.constants=r,o=o.concat(r),this.numConstants=r.length),o[0]instanceof Zo){const u=[e].concat(o),d=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=d;const m=super.apply(u,t);return this.inputSpec=f,m}else return super.apply(e,t)}call(e,t){return de(()=>{const s=t==null?null:t.mask,r=t==null?null:t.training;let i=t==null?null:t.initialState;e=Ze(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new Y(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},u=MW((b,w)=>{const v=this.cell.call([b].concat(w),a);return[v[0],v.slice(1)]},e,i,this.goBackwards,s,null,this.unroll,this.returnSequences),d=u[0],f=u[1],m=u[2];this.stateful&&this.resetStates(m,r);const y=this.returnSequences?f:d;return this.returnState?[y].concat(m):y})}getInitialState(e){return de(()=>{let t=vs(e.shape);return t=Ge(t,[1,2]),t=S0(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?sI(t,[1,s]):t):this.cell.stateSize>1?[sI(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===zc.className&&(t.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),t)}static fromConfig(e,t,s={}){const r=t.cell,i=qo(r,s);return new e(Object.assign(t,{cell:i}))}}zc.className="RNN";ke(zc);class C1 extends ft{}class RA extends C1{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,ws(this.units,"units"),this.activation=_c(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Sn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Sn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Sn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Cn(e.kernelRegularizer),this.recurrentRegularizer=Cn(e.recurrentRegularizer),this.biasRegularizer=Cn(e.biasRegularizer),this.kernelConstraint=ls(e.kernelConstraint),this.recurrentConstraint=ls(e.recurrentConstraint),this.biasConstraint=ls(e.biasConstraint),this.dropout=$f([1,vc([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=$f([1,vc([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Lt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return de(()=>{if(e=e,e.length!==2)throw new Y(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Sc({ones:()=>Pi(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Sc({ones:()=>Pi(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?i=Ho(ee(e,o),this.kernel.read()):i=Ho(e,this.kernel.read()),this.bias!=null&&(i=co(i,this.bias.read())),a!=null&&(s=ee(s,a));let l=Ne(i,Ho(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:wc(this.activation),useBias:this.useBias,kernelInitializer:In(this.kernelInitializer),recurrentInitializer:In(this.recurrentInitializer),biasInitializer:In(this.biasInitializer),kernelRegularizer:cn(this.kernelRegularizer),recurrentRegularizer:cn(this.recurrentRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:as(this.kernelConstraint),recurrentConstraint:as(this.recurrentConstraint),biasConstraint:as(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}RA.className="SimpleRNNCell";ke(RA);class LW extends zc{constructor(e){e.cell=new RA(e),super(e)}call(e,t){return de(()=>{this.cell.dropoutMask!=null&&(ut(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ut(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return new e(t)}}LW.className="SimpleRNN";ke(LW);class $A extends C1{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new Y("GRUCell does not support reset_after parameter set to true.");this.units=e.units,ws(this.units,"units"),this.activation=_c(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=_c(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Sn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Sn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Sn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Cn(e.kernelRegularizer),this.recurrentRegularizer=Cn(e.recurrentRegularizer),this.biasRegularizer=Cn(e.biasRegularizer),this.kernelConstraint=ls(e.kernelConstraint),this.recurrentConstraint=ls(e.recurrentConstraint),this.biasConstraint=ls(e.biasConstraint),this.dropout=$f([1,vc([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=$f([1,vc([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Lt(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return de(()=>{if(e=e,e.length!==2)throw new Y(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training==null?!1:t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Sc({ones:()=>Pi(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Sc({ones:()=>Pi(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,u;0<this.dropout&&this.dropout<1&&(e=ee(e,i[0]));let d=Ho(e,this.kernel.read());this.useBias&&(d=co(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=ee(r,o[0]));const f=this.recurrentKernel.read(),[m,y]=oi(f,[2*this.units,this.units],f.rank-1),b=Ho(r,m),[w,v,S]=oi(d,3,d.rank-1),[T,I]=oi(b,2,b.rank-1);a=this.recurrentActivation.apply(Ne(w,T)),l=this.recurrentActivation.apply(Ne(v,I));const k=Ho(ee(l,r),y);u=this.activation.apply(Ne(S,k));const O=Ne(ee(a,r),ee(Ne(1,Vn(a)),u));return[O,O]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:wc(this.activation),recurrentActivation:wc(this.recurrentActivation),useBias:this.useBias,kernelInitializer:In(this.kernelInitializer),recurrentInitializer:In(this.recurrentInitializer),biasInitializer:In(this.biasInitializer),kernelRegularizer:cn(this.kernelRegularizer),recurrentRegularizer:cn(this.recurrentRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:as(this.kernelConstraint),recurrentConstraint:as(this.recurrentConstraint),biasConstraint:as(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}$A.className="GRUCell";ke($A);class FW extends zc{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new $A(e),super(e)}call(e,t){return de(()=>{this.cell.dropoutMask!=null&&(ut(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ut(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}FW.className="GRU";ke(FW);class T1 extends C1{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,ws(this.units,"units"),this.activation=_c(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=_c(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Sn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Sn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Sn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Cn(e.kernelRegularizer),this.recurrentRegularizer=Cn(e.recurrentRegularizer),this.biasRegularizer=Cn(e.biasRegularizer),this.kernelConstraint=ls(e.kernelConstraint),this.recurrentConstraint=ls(e.recurrentConstraint),this.biasConstraint=ls(e.biasConstraint),this.dropout=$f([1,vc([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=$f([1,vc([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=Lt(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;r=new(t=class extends Li{apply(l,u){const d=i.apply([o]),f=new bA().apply([o]),m=i.apply([o*2]);return cF(cF(d,f),m)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return de(()=>{const s=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new Y(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Sc({ones:()=>Pi(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Sc({ones:()=>Pi(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,u,d,f;0<this.dropout&&this.dropout<1&&(e=ee(e,o[0]));let m=Ho(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=ee(r,a[0])),m=Ne(m,Ho(r,this.recurrentKernel.read())),this.useBias&&(m=co(m,this.bias.read()));const[y,b,w,v]=oi(m,4,m.rank-1);l=this.recurrentActivation.apply(y),u=this.recurrentActivation.apply(b),d=Ne(ee(u,i),ee(l,this.activation.apply(w))),f=this.recurrentActivation.apply(v);const S=ee(f,this.activation.apply(d));return[S,S,d]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:wc(this.activation),recurrentActivation:wc(this.recurrentActivation),useBias:this.useBias,kernelInitializer:In(this.kernelInitializer),recurrentInitializer:In(this.recurrentInitializer),biasInitializer:In(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:cn(this.kernelRegularizer),recurrentRegularizer:cn(this.recurrentRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:as(this.kernelConstraint),recurrentConstraint:as(this.recurrentConstraint),biasConstraint:as(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}T1.className="LSTMCell";ke(T1);class VW extends zc{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new T1(e),super(e)}call(e,t){return de(()=>{this.cell.dropoutMask!=null&&(ut(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ut(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}VW.className="LSTM";ke(VW);class DA extends C1{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return de(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const i=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=r[a],a===0?o=[e[0]].concat(s):o=[o[0]].concat(s),o=l.call(o,t),i.push(o.slice(1))}s=[];for(const a of i.slice().reverse())s.push(...a);return[o[0]].concat(s)})}build(e){iI(e)&&(e=e[0]),e=e;let t;this.cells.forEach((s,r)=>{Xu(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?t=s.stateSize[0]:t=s.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=i=>({className:i.getClassName(),config:i.getConfig()}),r={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,t,s={}){const r=[];for(const i of t.cells)r.push(qo(i,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.cells)t.push(...s.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return oI(e)}setWeights(e){const t=[];for(const s of this.cells){const r=s.weights.length,i=e.splice(r);for(let o=0;o<s.weights.length;++o)t.push([s.weights[o],i[o]])}TA(t)}}DA.className="StackedRNNCells";ke(DA);function Sc(n){const{ones:e,rate:t,training:s=!1,count:r=1,dropoutFunc:i}=n,o=()=>i!=null?i(e(),t):A6(e(),t),a=()=>T0(o,e,s);return!r||r<=1?jo(a().clone()):Array(r).fill(void 0).map(a).map(u=>jo(u.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var cye=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class UW extends zc{constructor(e){if(e.unroll)throw new lt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new lt("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new os({ndim:5})]}call(e,t){return de(()=>{if(this.cell.dropoutMask!=null&&(ut(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ut(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new Y("ConvRNN2D cell does not support constants");const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return de(()=>{const{stateSize:t}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)],o=vs(i);return Array.isArray(t)?Array(t.length).fill(o):[o]})}resetStates(e,t=!1){de(()=>{if(!this.stateful)throw new Ro("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)];if(s[0]==null)throw new Y("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>vs(i)):this.states_=[vs(i)];else if(e==null)ut(this.states_),this.keptStates!=null&&(ut(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>vs(i)):this.states_[0]=vs(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new Y(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):ut(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],u=i;if(!zt(l.shape,u))throw new Y(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>jo(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:s,kernelSize:r,padding:i,strides:o,dilationRate:a}=this.cell,l=t==="channelsFirst",u=e[l?3:2],d=e[l?4:3],f=ro(u,r[0],i,o[0],a[0]),m=ro(d,r[1],i,o[1],a[1]);return[...e.slice(0,2),...l?[s,f,m]:[f,m,s]]}}UW.className="ConvRNN2D";class OA extends T1{constructor(e){const{filters:t,kernelSize:s,strides:r,padding:i,dataFormat:o,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,ws(this.filters,"filters"),this.kernelSize=mf(s,2,"kernelSize"),this.kernelSize.forEach(l=>ws(l,"kernelSize")),this.strides=mf(r||1,2,"strides"),this.strides.forEach(l=>ws(l,"strides")),this.padding=i||"valid",ci(this.padding),this.dataFormat=o||"channelsLast",zn(this.dataFormat),this.dilationRate=mf(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>ws(l,"dilationRate"))}build(e){var t;e=Lt(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new Y(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],i=4,o=this.kernelSize.concat([r,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const u=this.biasInitializer,d=this.filters;l=new(t=class extends Li{apply(m,y){const b=u.apply([d]),w=Uc([d]),v=u.apply([d*2]);return yA([b,w,v])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return de(()=>{if(e.length!==3)throw new Y(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training||!1,r=e[0],i=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Sc({ones:()=>Pi(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=(z,X,ie)=>!X||!X[ie]?z:ee(X[ie],z);let d=u(r,l,0),f=u(r,l,1),m=u(r,l,2),y=u(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Sc({ones:()=>Pi(i),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const b=this.recurrentDropoutMask;let w=u(i,b,0),v=u(i,b,1),S=u(i,b,2),T=u(i,b,3);const I=3,[k,O,V,P]=oi(this.kernel.read(),a,I),[D,$,R,A]=this.useBias?oi(this.bias.read(),a):[null,null,null,null];d=this.inputConv(d,k,D,this.padding),f=this.inputConv(f,O,$,this.padding),m=this.inputConv(m,V,R,this.padding),y=this.inputConv(y,P,A,this.padding);const[U,F,ne,Q]=oi(this.recurrentKernel.read(),a,I);w=this.recurrentConv(w,U),v=this.recurrentConv(v,F),S=this.recurrentConv(S,ne),T=this.recurrentConv(T,Q);const G=this.recurrentActivation.apply(Ne(d,w)),K=this.recurrentActivation.apply(Ne(f,v)),J=Ne(ee(K,o),ee(G,this.activation.apply(Ne(m,S)))),ce=ee(this.recurrentActivation.apply(Ne(y,T)),this.activation.apply(J));return[ce,ce,J]})}getConfig(){const e=super.getConfig(),{units:t}=e,s=cye(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),r)}inputConv(e,t,s,r){const i=fh(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?co(i,s,this.dataFormat):i}recurrentConv(e,t){return fh(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}OA.className="ConvLSTM2DCell";ke(OA);class BW extends UW{constructor(e){const t=new OA(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}BW.className="ConvLSTM2D";ke(BW);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class PA extends ft{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return s}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=Ze(e);if(0<this.rate&&this.rate<1){const r=t.training==null?!1:t.training,i=this.getNoiseShape(s);return T0(()=>A6(s,this.rate,i,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}PA.className="Dropout";ke(PA);class zW extends PA{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}zW.className="SpatialDropout1D";ke(zW);class jW extends ft{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,ws(this.units,"units"),this.activation=_c(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Sn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Sn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=ls(e.kernelConstraint),this.biasConstraint=ls(e.biasConstraint),this.kernelRegularizer=Cn(e.kernelRegularizer),this.biasRegularizer=Cn(e.biasRegularizer),this.activityRegularizer=Cn(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Lt(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=Lt(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=Ze(e),r=S6(this.activation.getClassName());let i;return r!=null?i=Ho(s,this.kernel.read(),r,this.bias?this.bias.read():null):(i=Ho(s,this.kernel.read()),this.bias!=null&&(i=co(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:wc(this.activation),useBias:this.useBias,kernelInitializer:In(this.kernelInitializer),biasInitializer:In(this.biasInitializer),kernelRegularizer:cn(this.kernelRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:as(this.kernelConstraint),biasConstraint:as(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}jW.className="Dense";ke(jW);class WW extends ft{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Lt(e);for(const t of e.slice(1))if(t==null)throw new Y(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],lc(e,1)]}call(e,t){return de(()=>{this.invokeCallHook(e,t);let s=Ze(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let i=2;i<s.rank;++i)r.push(i);r.push(1),s=Nt(s,r)}return Bme(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}WW.className="Flatten";ke(WW);class GW extends ft{constructor(e){super(e),this.supportsMasking=!0,this.activation=_c(e.activation)}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=Ze(e);return this.activation.apply(s)})}getConfig(){const e={activation:wc(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}GW.className="Activation";ke(GW);class HW extends ft{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return de(()=>(e=Ze(e),Vme(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}HW.className="RepeatVector";ke(HW);class qW extends ft{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const s="Total size of new array must be unchanged.",r=t.slice();let i=1,o=null;for(let l=0;l<r.length;++l){const u=r[l];if(this.isUnknown(u))if(o===null)o=l;else throw new Y("Can only specifiy one unknown dimension.");else i*=u}const a=lc(e);if(o!==null){if(i===0||a%i!==0)throw new Y(s);r[o]=a/i}else if(a!==i)throw new Y(s);return r}computeOutputShape(e){let t=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=Ze(e),r=s.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return oe(s,i)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}qW.className="Reshape";ke(qW);class KW extends ft{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=oo(1,e.dims.length+1);if(!zt(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new os({ndim:this.dims.length+1})]}computeOutputShape(e){e=Lt(e);const t=e.slice();return this.dims.forEach((s,r)=>{t[r+1]=e[s]}),t}call(e,t){return Nt(Ze(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}KW.className="Permute";ke(KW);class XW extends ft{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const s=Ze(e);return YE(Qv(s,this.maskValue),-1)}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=Ze(e),o=YE(Qv(s,this.maskValue),-1,!0);return ee(s,Me(o,s.dtype))})}}XW.className="Masking";ke(XW);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class YW extends ft{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(Xt(e.inputLength))}this.inputDim=e.inputDim,ws(this.inputDim,"inputDim"),this.outputDim=e.outputDim,ws(this.outputDim,"outputDim"),this.embeddingsInitializer=Sn(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Cn(e.embeddingsRegularizer),this.activityRegularizer=Cn(e.activityRegularizer),this.embeddingsConstraint=ls(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return de(()=>this.maskZero?(e=Ze(e),Qv(e,At(e))):null)}computeOutputShape(e){if(e=Lt(e),this.inputLength==null)return[...e,this.outputDim];const t=Xt(this.inputLength);if(t.length!==e.length-1)throw new Y(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<t.length;++r){const i=t[r],o=e[r+1];if(i!=null&&o!=null&&i!==o)throw new Y(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(t[s]=o),s++}}return[e[0],...t,this.outputDim]}call(e,t){return de(()=>{this.invokeCallHook(e,t);let s=Ze(e);s.dtype!=="int32"&&(s=Go(s,"int32"));const r=N6(this.embeddings.read(),oe(s,[s.size]));return oe(r,Lt(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:In(this.embeddingsInitializer),embeddingsRegularizer:cn(this.embeddingsRegularizer),activityRegularizer:cn(this.activityRegularizer),embeddingsConstraint:as(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}YW.className="Embedding";ke(YW);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Dh extends ft{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new lt}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const s=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const i=e[e.length-t.length+r],o=t[r];if(i==null||o==null||i<0||o<0)s.push(null);else if(i===1)s.push(o);else if(o===1)s.push(i);else{if(i!==o)throw new Y("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));s.push(i)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Lt(e)]),e=e,e.length<2)throw new Y(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const i of e)i!=null&&i[0]!==null&&t.push(i[0]);if(t=ac(t),t.length>1)throw new Y(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const o=e[i]==null?null:e[i].slice(1);s=this.computeElementwiseOpOutputShape(s,o)}const r=e.map(i=>i.length);e.indexOf(null)===-1&&ac(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return de(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(i=>i.rank);if(r.indexOf(null)===-1){const i=vc(r);for(let o of e){const a=o.rank;for(let l=0;l<i-a;++l)o=S0(o,1);s.push(o)}return this.mergeFunction(s)}else{let i=!1;for(const l of e){const u=l.rank;if(u==null){const d=l.shape,f=d[0],m=d.slice(1).concat([f]);let y=oe(l,[f].concat(lc(d.slice(1))));y=Nt(y,[1,0]),y=oe(y,m),s.push(y),i=!0}else if(u>1){const d=oo(1,u).concat([0]);s.push(Nt(l,d)),i=!0}else s.push(l)}let o=this.mergeFunction(s);const a=o.rank;if(i){if(a==null){const l=o.shape,u=l.length,d=l[u-1],f=[d].concat(l.slice(0,l.length-1));o=oe(Nt(oe(o,[-1,d]),[1,0]),f)}else if(a>1){const l=[a-1].concat(oo(0,a-1));o=Nt(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){const i=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,i)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=ac(s),s.length===1?t=s.concat(t):t=[null].concat(t),t}computeMask(e,t){return de(()=>{if(t==null)return null;if(!Array.isArray(t))throw new Y("`mask` should be an Array");if(!Array.isArray(e))throw new Y("`inputs` should be an Array");if(t.length!==e.length)throw new Y(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:Cr(r,0));let s=t[0];for(let r=1;r<t.length-1;++r)s=Ja(s,t[r]);return s})}}class QW extends Dh{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Ne(t,e[s]);return t})}}QW.className="Add";ke(QW);class JW extends Dh{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=ee(t,e[s]);return t})}}JW.className="Multiply";ke(JW);class ZW extends Dh{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Ne(t,e[s]);return ee(1/e.length,t)})}}ZW.className="Average";ke(ZW);class eG extends Dh{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=Vc(t,e[s]);return t})}}eG.className="Maximum";ke(eG);class tG extends Dh{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=Vg(t,e[s]);return t})}}tG.className="Minimum";ke(tG);class nG extends Dh{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new Y("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(r!=null){t=!1;break}if(t)return;const s=[];for(let r=0;r<e.length;++r){const i=e[r].slice();i.splice(this.axis,1);let o=!1;for(const a of s)if(zt(a,i)){o=!0;break}o||s.push(i)}if(s.length>1)throw new Y("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return de(()=>yA(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new Y("A `Concatenate` layer should be called on a list of inputs.");const t=e,s=t[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const i of t.slice(1)){if(s[r]==null||i[r]==null){s[r]=null;break}s[r]+=i[r]}return s}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new Y("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new Y("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new Y(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return de(()=>{let s=!0;if(t.forEach(o=>{if(o!=null){s=!1;return}}),s)return null;const r=[];for(let o=0;o<e.length;++o)t[o]==null?r.push(Me(Pi(e[o]),"bool")):t[o].rank<e[o].rank?r.push(Cr(t[o],-1)):r.push(t[o]);const i=Er(r,this.axis);return tj(i,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}nG.className="Concatenate";ke(nG);function Rm(n,e){for(;n<0;)n+=e;return n}function uye(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new lt("batchDot is not implemented for tensors of 4D or higher rank yet");if(j(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),j(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new lt("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=e.shape.length;t==null&&(t=[s-1,r-2]);const i=t;return de(()=>{let o;if(s>r){o=s-r;const l=[];for(let u=0;u<o;++u)l.push(1);e=oe(e,e.shape.concat(l))}else if(r>s){o=r-s;const l=[];for(let u=0;u<o;++u)l.push(1);n=oe(n,n.shape.concat(l))}else o=0;let a;if(n.shape.length===2&&e.shape.length===2)i[0]===i[1]?a=Ge(ee(n,e),i[0]):a=Ge(ee(Nt(n,[1,0]),e),i[1]);else{const l=i[0]!==n.shape.length-1,u=i[1]===e.shape.length-1;a=Ut(n,e,l,u)}if(o>0){let l;s>r?l=s+r-3:l=s-1;const u=[];for(let d=l;d<l+o;++d)u.push(d);a=y0(a,u)}return a.shape.length===1&&(a=Cr(a,1)),a})}class sG extends Dh{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){j(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],s=e[1];if(t.length>3||s.length>3)throw new lt("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);if(t[r[0]]!==s[r[1]])throw new Y(`Dimension incompatibility: ${t[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new Y(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((i,o)=>Rm(i,e[o].shape.length)):r=[Rm(this.axes,t.shape.length),Rm(this.axes,s.shape.length)],this.normalize&&(t=rw(t,r[0]),s=rw(s,r[1])),uye(t,s,r)}interpretAxes(e,t){let s;return Array.isArray(this.axes)?s=this.axes:s=[Rm(this.axes,e.length),Rm(this.axes,t.length)],s}computeOutputShape(e){j(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),s=e[1].slice();if(t.length>3||s.length>3)throw new lt("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);t.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const i=t.concat(s);return i.length===1&&i.push(1),i}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}sG.className="Dot";ke(sG);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class rG extends ft{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=Ze(e);return T0(()=>Ne(b1(s.shape,0,this.stddev),s),()=>s,t.training||!1)})}}rG.className="GaussianNoise";ke(rG);class iG extends ft{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=Ze(e);return this.rate>0&&this.rate<1?T0(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return ee(s,b1(s.shape,1,i))},()=>s,t.training||!1):s})}}iG.className="GaussianDropout";ke(iG);class oG extends ft{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Ze(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return de(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return T0(()=>{const i=Ze(e),a=-1.6732632423543772*1.0507009873554805;let l=Nh(g0(s),this.rate);l=Go(l,"float32");const u=((1-this.rate)*(1+this.rate*a**2))**-.5,d=-u*a*this.rate,f=Ne(ee(i,l),ee(Ne(l,-1),a));return Ne(ee(f,u),d)},()=>Ze(e),t.training||!1)}return e})}}oG.className="AlphaDropout";ke(oG);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Wg(n,e,t,s,r,i=.001){let o;if(n.rank===2)o=Ole(n,e,t,s,r,i);else if(n.rank===3)o=Mle(n,e,t,s,r,i);else if(n.rank===4)o=Fle(n,e,t,s,r,i);else throw new lt(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return o}function hye(n,e,t,s,r=.001){return de(()=>{const i=C2(n,s),o=i.mean,a=i.variance;return[Wg(n,o,a,t,e,r),o,a]})}function dye(n,e,t,s,r=.001){return de(()=>{const i=C2(n,s),o=i.mean,a=i.variance,l=[];for(const b of oo(0,n.rank))s.indexOf(b)!==-1?l.push(1):l.push(n.shape[b]);const u=oe(o,l),d=oe(a,l),f=e==null?null:oe(e,l),m=t==null?null:oe(t,l);return[Wg(n,u,d,m,f,r),o,a]})}function fye(n,e,t,s,r=.001){return zt(s.slice().sort(),oo(0,n.rank-1))?hye(n,e,t,s,r):dye(n,e,t,s,r)}class aG extends ft{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Sn(e.betaInitializer||"zeros"),this.gammaInitializer=Sn(e.gammaInitializer||"ones"),this.movingMeanInitializer=Sn(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Sn(e.movingVarianceInitializer||"ones"),this.betaConstraint=ls(e.betaConstraint),this.gammaConstraint=ls(e.gammaConstraint),this.betaRegularizer=Cn(e.betaRegularizer),this.gammaRegularizer=Cn(e.gammaRegularizer)}build(e){e=Lt(e);const t=this.axis>=0?this.axis:this.axis+e.length,s=e[t];if(s==null)throw new Y(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new os({ndim:e.length,axes:{[t]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return de(()=>{const s=t.training==null?!1:t.training,r=Ze(e),i=r.shape,o=i.length,a=oo(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const u=yh(1,o);u[l]=i[l];const d=a.slice();d.sort();const f=!zt(d,oo(0,o).slice(0,o-1)),m=()=>{if(f){const T=oe(this.movingMean.read(),u),I=oe(this.movingVariance.read(),u),k=this.center?oe(this.beta.read(),u):null,O=this.scale?oe(this.gamma.read(),u):null;return Wg(r,T,I,k,O,this.epsilon)}else return Wg(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return m();const[y,b,w]=fye(r,this.gamma.read(),this.beta.read(),a,this.epsilon),v=(T,I,k)=>{de(()=>{const O=1-k,V=T.read(),P=ee(Qe(V,I),O);T.write(Qe(V,P))})};return(()=>{v(this.movingMean,b,this.momentum),v(this.movingVariance,w,this.momentum)})(),y})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:In(this.betaInitializer),gammaInitializer:In(this.gammaInitializer),movingMeanInitializer:In(this.movingMeanInitializer),movingVarianceInitializer:In(this.movingVarianceInitializer),betaRegularizer:cn(this.betaRegularizer),gammaRegularizer:cn(this.gammaRegularizer),betaConstraint:as(this.betaConstraint),gammaConstraint:as(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}aG.className="BatchNormalization";ke(aG);class lG extends ft{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Sn(e.betaInitializer||"zeros"),this.gammaInitializer=Sn(e.gammaInitializer||"ones"),this.betaRegularizer=Cn(e.betaRegularizer),this.gammaRegularizer=Cn(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Lt(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=t);for(const i of this.axis)if(i<0||i>=t)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==ac(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(i=>e[i]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const s=Ze(e),r=s.shape,i=r.length;return de(()=>{let{mean:a,variance:l}=C2(s,this.axis,!0);const u=yh(1,i);for(const w of this.axis)u[w]=r[w];const d=w=>w!=null&&w.shape.length!==i?oe(w,u):w;let f=this.scale?d(this.gamma.read()):null,m=this.center?d(this.beta.read()):null;const y=[],b=[];for(let w=0;w<i;++w)this.axis.indexOf(w)!==-1?(y.push(r[w]),b.push(1)):(y.push(1),b.push(r[w]));return a=Zi(a,y),l=Zi(l,y),f!=null&&(f=Zi(f,b)),m!=null&&(m=Zi(m,b)),Wg(s,a,l,m,f,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:In(this.betaInitializer),gammaInitializer:In(this.gammaInitializer),betaRegularizer:cn(this.betaRegularizer),gammaRegularizer:cn(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}lG.className="LayerNormalization";ke(lG);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function pye(n,e,t){return de(()=>{if(n.rank!==4)throw new Y(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new Y("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=ao()),t!=="channelsLast"&&t!=="channelsFirst")throw new Y(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return t==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],T2(n,s)})}class cG extends ft{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?ao():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new Y(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,s;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new Y(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new Y(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[t,s]}this.inputSpec=[new os({ndim:4})]}computeOutputShape(e){e=Lt(e);let t,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],t,s]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],t,s,e[3]])}call(e,t){return de(()=>pye(Ze(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}cG.className="ZeroPadding2D";ke(cG);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function E1(n,e,t,s,r,i){return de(()=>{zn(r),T6(i),ci(s),t==null&&(t=[1,1]),s==null&&(s="valid"),r==null&&(r=ao()),i==null&&(i="max"),n=AA(n,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=S2(n,e,t,a):o=f2(n,e,t,a),r==="channelsFirst"&&(o=Nt(o,[0,3,1,2])),o})}function uG(n,e,t,s,r,i){return de(()=>{zn(r),T6(i),ci(s),t==null&&(t=[1,1,1]),s==null&&(s="valid"),r==null&&(r=ao()),i==null&&(i="max"),n=IW(n,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=_ue(n,e,t,a):o=Cle(n,e,t,a),r==="channelsFirst"&&(o=Nt(o,[0,4,1,2,3])),o})}class hG extends ft{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new Y(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(ws(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new Y(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);ws(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,ci(this.padding),this.inputSpec=[new os({ndim:3})]}computeOutputShape(e){e=Lt(e);const t=ro(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return de(()=>{this.invokeCallHook(e,t),e=S0(Ze(e),2);const s=this.poolingFunction(Ze(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return y0(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class dG extends hG{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return zn(i),ci(r),E1(e,t,s,r,i,"max")}}dG.className="MaxPooling1D";ke(dG);class fG extends hG{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return zn(i),ci(r),E1(e,t,s,r,i,"avg")}}fG.className="AveragePooling1D";ke(fG);class pG extends ft{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new Y(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];ws(this.poolSize,"poolSize"),ws(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,zn(this.dataFormat),ci(this.padding),this.inputSpec=[new os({ndim:4})]}computeOutputShape(e){e=Lt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=ro(t,this.poolSize[0],this.padding,this.strides[0]),s=ro(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s]:[e[0],t,s,e[3]]}call(e,t){return de(()=>(this.invokeCallHook(e,t),this.poolingFunction(Ze(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class mG extends pG{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return zn(i),ci(r),E1(e,t,s,r,i,"max")}}mG.className="MaxPooling2D";ke(mG);class gG extends pG{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return zn(i),ci(r),E1(e,t,s,r,i,"avg")}}gG.className="AveragePooling2D";ke(gG);class yG extends ft{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new Y(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];ws(this.poolSize,"poolSize"),ws(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,zn(this.dataFormat),ci(this.padding),this.inputSpec=[new os({ndim:5})]}computeOutputShape(e){e=Lt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=ro(t,this.poolSize[0],this.padding,this.strides[0]),s=ro(s,this.poolSize[1],this.padding,this.strides[1]),r=ro(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s,r]:[e[0],t,s,r,e[4]]}call(e,t){return de(()=>(this.invokeCallHook(e,t),this.poolingFunction(Ze(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class bG extends yG{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return zn(i),ci(r),uG(e,t,s,r,i,"max")}}bG.className="MaxPooling3D";ke(bG);class xG extends yG{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return zn(i),ci(r),uG(e,t,s,r,i,"avg")}}xG.className="AveragePooling3D";ke(xG);class vG extends ft{constructor(e){super(e),this.inputSpec=[new os({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new lt}}class wG extends vG{constructor(e){super(e||{})}call(e,t){return de(()=>{const s=Ze(e);return Kn(s,1)})}}wG.className="GlobalAveragePooling1D";ke(wG);class _G extends vG{constructor(e){super(e||{})}call(e,t){return de(()=>{const s=Ze(e);return so(s,1)})}}_G.className="GlobalMaxPooling1D";ke(_G);class SG extends ft{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,zn(this.dataFormat),this.inputSpec=[new os({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new lt}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class CG extends SG{call(e,t){return de(()=>{const s=Ze(e);return this.dataFormat==="channelsLast"?Kn(s,[1,2]):Kn(s,[2,3])})}}CG.className="GlobalAveragePooling2D";ke(CG);class TG extends SG{call(e,t){return de(()=>{const s=Ze(e);return this.dataFormat==="channelsLast"?so(s,[1,2]):so(s,[2,3])})}}TG.className="GlobalMaxPooling2D";ke(TG);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class EG extends ft{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,s={}){const r=t.layer,i=qo(r,s);delete t.layer;const o={layer:i};return Object.assign(o,t),new e(o)}}class IG extends EG{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Lt(e),e.length<3)throw new Y(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Lt(e);const t=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(t),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,t){return de(()=>(e=Ze(e),MW((o,a)=>[Ze(this.layer.call(o,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}IG.className="TimeDistributed";ke(IG);function mye(n){$h(Ome,"BidirectionalMergeMode",n)}const gye="concat";class kG extends EG{constructor(e){super(e);const t=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=t,this.forwardLayer=qo(s),t.goBackwards=t.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=qo(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?gye:e.mergeMode,mye(this.mergeMode),e.weights)throw new lt("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,s=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let s,r,i;return this.returnState&&(i=t.slice(1)),s=t[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(i).concat(i.slice()):[s].concat(i).concat(i.slice()):Tr(r)}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const i=PW(e,s,r,this.numConstants);if(e=i.inputs,s=i.initialState,r=i.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,t);const o=[],a=[];if(s!=null){const u=s.length;if(u%2>0)throw new Y("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=s,o.push(...s);const d=s.map(f=>new os({shape:f.shape}));this.forwardLayer.stateSpec=d.slice(0,u/2),this.backwardLayer.stateSpec=d.slice(u/2),a.push(...d)}if(r!=null)throw new lt("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof Zo;for(const u of o)if(u instanceof Zo!==l)throw new Y("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const u=[e].concat(o),d=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=d;const m=super.apply(u,t);return this.inputSpec=f,m}else return super.apply(e,t)}call(e,t){return de(()=>{const s=t.initialState;let r,i;if(s==null)r=this.forwardLayer.call(e,t),i=this.backwardLayer.call(e,t);else{const l=s.slice(0,s.length/2),u=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),i=this.backwardLayer.call(e,Object.assign(t,{initialState:u}))}let o;this.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=mh(i,1));let a;return this.mergeMode==="concat"?a=yA([r,i]):this.mergeMode==="sum"?a=Ne(r,i):this.mergeMode==="ave"?a=ee(.5,Ne(r,i)):this.mergeMode==="mul"?a=ee(r,i):this.mergeMode==null&&(a=[r,i]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Xu(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Xu(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[t,t]:s=t:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(i).concat(i):[s].concat(i).concat(i)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const s=qo(t.layer);if(delete t.layer,t.numConstants!=null)throw new lt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=s,new e(r)}}kG.className="Bidirectional";ke(kG);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class NG extends ft{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return de(()=>(e=Ze(e),e.dtype!=="float32"&&(e=Go(e,"float32")),Ne(ee(e,this.scale),this.offset)))}}NG.className="Rescaling";ke(NG);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:yye,cropAndResize:bye}=Ba;class AG extends ft{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,s,r,i,o,a,l){return de(()=>{let u,d=!1;const f=t/o,m=s/a,y=(r+t)/o,b=(i+s)/a,w=[f,m,y,b],v=[];e.rank===3?(d=!0,u=Za([e])):u=e;for(let O=0;O<u.shape[0];O++)v.push(w);const S=ug(v,[v.length,4]),T=Ug(0,v.length,1,"int32"),k=bye(u,S,T,[r,i],"nearest");return Go(d?Ze(gh(k)):k,l)})}upsize(e,t,s,r){return de(()=>{const i=yye(e,[t,s]);return Go(i,r)})}call(e,t){return de(()=>{const s=Ze(e),r=s.dtype,i=s.shape,o=i[i.length-3],a=i[i.length-2];let l=0;o!==this.height&&(l=Math.floor((o-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(s,l,u,this.height,this.width,o,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Lt(e);const t=e.length-3,s=e.length-2;return e[t]=this.height,e[s]=this.width,e}}AG.className="CenterCrop";ke(AG);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xye(n,e,t,s){let r=Ze(n);if(r.dtype!=="int32"&&(r=Go(r,"int32")),e==="int")return r;const i=r.shape;if(r.rank===0&&(r=Cr(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=Cr(r,-1)),r.rank>2)throw new Y(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${r.rank}.`);const o=["multiHot","oneHot"].includes(e),a=r;let l;if(typeof s<"u"&&e==="count"?l=FL(a,s,t,o):l=FL(a,[],t,o),e!=="tfIdf")return l;if(s)return ee(l,s);throw new Y("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class RG extends ft{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=Lt(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return de(()=>{e=Ze(e),e.dtype!=="int32"&&(e=Go(e,"int32"));let s;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new Y(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);s=Ze(t.countWeights)}const r=so(e),i=Xv(e),o=li(this.numTokens,r).bufferSync().get(0),a=Nh(i,0).bufferSync().get(0);if(!(o&&a))throw new Y(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return xye(e,this.outputMode,this.numTokens,s)})}}RG.className="CategoryEncoding";ke(RG);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const vye=["bilinear","nearest"],kF=new Set(vye);class $G extends ft{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(kF.has(e.interpolation))this.interpolation=e.interpolation;else throw new Y(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Lt(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return de(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Ba.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Ba.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...kF]} are supported`)})}}$G.className="Resizing";ke($G);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class DG{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}DG.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class OG extends ft{constructor(e){super(e),this.randomGenerator=new DG(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}OG.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const wye=["bilinear","nearest"],NF=new Set(wye);class PG extends OG{constructor(e){super(e);const{factor:t,interpolation:s="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new Y(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new Y(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new Y(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(NF.has(s))this.interpolation=s;else throw new Y(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Lt(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return de(()=>{const s=Ze(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=g0([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*r;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return Ba.resizeBilinear(e,o);case"nearest":return Ba.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...NF]} are supported`)}})}}PG.className="RandomWidth";ke(PG);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ye=pe();_ye.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var AF;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(AF||(AF={}));var RF;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(RF||(RF={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var $F;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})($F||($F={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ve(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&j(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sye=Nj;class I1 extends gN{nextDataId(){return I1.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new ez(this,ko())}write(e,t,s){this.firstUse&&(this.firstUse=!1,pe().get("IS_NODE")&&si(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&by(s[0])){const i=s.map(o=>oc(o));r=this.write(i,e,t)}else r=this.write(s,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,s,r,i){this.data.set(e,{values:t,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:s}=this.data.get(e);if(t==="complex64"){const r=this.readSync(s.real.dataId),i=this.readSync(s.imag.dataId);return el(r,i)}return Noe(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>xc(r));return ht(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ht(e.shape,e.dtype,t)}makeOutput(e,t,s){return ko().makeTensorFromTensorInfo(this.makeTensorInfo(t,s,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=Sr();return e(),{kernelMs:Sr()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Ve([e],"where");const t=this.readSync(e.dataId);return Sye(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}I1.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MG(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const Cye=n=>{const{x:e}=n.inputs,t=n.backend;Ve(e,"abs");let s=new Float32Array(xe(e.shape));const r=t.data.get(e.dataId).values;return s=MG(r),t.makeOutput(s,e.shape,e.dtype)},Tye={kernelName:r_,backendName:"cpu",kernelFunc:Cye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jn(n){return(e,t,s,r,i)=>{const o=it(e,t),a=o.length,l=je(o),u=xe(o),d=Js(i,u),f=e.length,m=t.length,y=je(e),b=je(t),w=Af(e,o),v=Af(t,o);if(w.length+v.length===0)for(let S=0;S<d.length;++S)d[S]=n(s[S%s.length],r[S%r.length]);else for(let S=0;S<d.length;++S){const T=Zf(S,a,l),I=T.slice(-f);w.forEach(P=>I[P]=0);const k=zo(I,f,y),O=T.slice(-m);v.forEach(P=>O[P]=0);const V=zo(O,m,b);d[S]=n(s[k],r[V])}return[d,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ur(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,a=t.makeTensorInfo(s.shape,"complex64"),l=t.data.get(a.dataId);return l.complexTensorInfos={real:t.makeTensorInfo(s.shape,"float32",i),imag:t.makeTensorInfo(r.shape,"float32",o)},a}const Eye={kernelName:NN,backendName:"cpu",kernelFunc:Ur};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uw(n,e,t="float32"){if(t==="complex64"){const r=uw(n,e,"float32"),i=uw(n,e,"float32");return Ur({inputs:{real:r,imag:i},backend:n})}const s=Zs(xe(e),t);return n.makeTensorInfo(e,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ea(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const Iye={kernelName:Vy,backendName:"cpu",kernelFunc:ea};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bh(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.real,i=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,i)}const kye={kernelName:ZN,backendName:"cpu",kernelFunc:bh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LG(n,e,t,s){if(s==="int32"){const r=Int32Array.from(n);return[e,"int32",r]}if(s==="bool"){const r=kh([0],t),[i,o]=jn((a,l)=>a!==l?1:0)(e,[],n,r,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${t} to ${s}`)}function Cc(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return ea({inputs:{x:r},backend:t});const d=uw(t,r.shape,r.dtype),f=Cc({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),m=Ur({inputs:{real:f,imag:d},backend:t});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),m}if(r.dtype==="complex64"){const d=bh({inputs:{input:r},backend:t}),f=Cc({inputs:{x:d},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(d),f}if(!sz(r.dtype,i)){const d=ea({inputs:{x:r},backend:t});return{dataId:d.dataId,shape:d.shape,dtype:i}}const o=t.data.get(r.dataId).values,[a,l,u]=LG(o,r.shape,r.dtype,i);return t.makeTensorInfo(a,l,u)}const Nye={kernelName:Ey,backendName:"cpu",kernelFunc:Cc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hs(n,e,t,s){return t==null?({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;Ve([o,a],n);const u=l.data.get(o.dataId).values,d=l.data.get(a.dataId).values,f=o.dtype==="string"?tl(u):u,m=o.dtype==="string"?tl(d):d,y=s||o.dtype,[b,w]=e(o.shape,a.shape,f,m,y);return l.makeTensorInfo(w,y,b)}:({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;if(o.dtype==="complex64"||a.dtype==="complex64"){const u=Cc({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),d=l.data.get(u.dataId),f=d.complexTensorInfos.real,m=d.complexTensorInfos.imag,y=l.data.get(f.dataId).values,b=l.data.get(m.dataId).values,w=Cc({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),v=l.data.get(w.dataId),S=v.complexTensorInfos.real,T=v.complexTensorInfos.imag,I=l.data.get(S.dataId).values,k=l.data.get(T.dataId).values,[O,V,P]=t(o.shape,a.shape,y,b,I,k),D=l.makeTensorInfo(P,"float32",O),$=l.makeTensorInfo(P,"float32",V),R=Ur({inputs:{real:D,imag:$},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(w),l.disposeIntermediateTensorInfo(D),l.disposeIntermediateTensorInfo($),R}else{const u=l.data.get(o.dataId).values,d=l.data.get(a.dataId).values,f=s||o.dtype,[m,y]=e(o.shape,a.shape,u,d,f);return l.makeTensorInfo(y,f,m)}}}function MA(n){return(e,t,s,r,i,o)=>{const a=it(e,t),l=xe(a),u=a.length,d=je(a),f=Js("float32",l),m=Js("float32",l),y=Af(e,a),b=Af(t,a),w=el(s,r),v=el(i,o),S=e.length,T=je(e),I=t.length,k=je(t);if(y.length+b.length===0)for(let O=0;O<f.length;O++){const V=O%w.length,P=O%v.length,D=n(w[V*2],w[V*2+1],v[P*2],v[P*2+1]);f[O]=D.real,m[O]=D.imag}else for(let O=0;O<f.length;O++){const V=Zf(O,u,d),P=V.slice(-S);y.forEach(U=>P[U]=0);const D=zo(P,S,T),$=V.slice(-I);b.forEach(U=>$[U]=0);const R=zo($,I,k),A=n(w[D*2],w[D*2+1],v[R*2],v[R*2+1]);f[O]=A.real,m[O]=A.imag}return[f,m,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FG=jn((n,e)=>n+e),Aye=MA((n,e,t,s)=>({real:n+t,imag:e+s})),Df=hs(ep,FG,Aye),Rye={kernelName:ep,backendName:"cpu",kernelFunc:Df};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LA(n,e,t,s,r){const i=xe(s),o=Zs(r,t);for(let a=0;a<n.length;a++){const l=n[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(i>0?o[l]+=e[a]:o[l]+=1)}return o}function VG(n,e,t,s=!1){const r=n.shape[0],i=n.shape[1],o=ht([r,t],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<i;l++){const u=n.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=t||(s?o.set(1,a,u):e.size>0?o.set(o.get(a,u)+e.get(a,l),a,u):o.set(o.get(a,u)+1,a,u))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UG=jn((n,e)=>n&e),$ye=hs(kN,UG),Dye={kernelName:kN,backendName:"cpu",kernelFunc:$ye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ra(n){return(e,t,s)=>{const r=Fn(t,e.length);for(let i=0;i<e.length;++i)r[i]=n(e[i],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qt(n,e,t){const s=ra(e);return jc(n,s,t)}function jc(n,e,t){return({inputs:s,attrs:r,backend:i})=>{const{x:o}=s;Ve(o,n);const a=i,l=a.data.get(o.dataId).values;let u;if(o.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=tl(l)}else u=l;const d=t||o.dtype,f=e(u,d,r);return a.makeTensorInfo(o.shape,d,f)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BG=ra(n=>Math.ceil(n)),Oye=jc(Iy,BG),Pye={kernelName:Iy,backendName:"cpu",kernelFunc:Oye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zG(n,e,t,s){const r=Fn(t,xe(e));if(s&&t!=="string"){let i=0;n.forEach(o=>{const a=xe(o.shape);r.set(o.vals,i),i+=a})}else{let i=0;n.forEach(o=>{const a=t==="string"?tl(o.vals):o.vals;let l=0;for(let u=0;u<o.shape[0];++u){const d=u*e[1]+i;for(let f=0;f<o.shape[1];++f)r[d+f]=a[l++]}i+=o.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jG=jn((n,e)=>n===e?1:0),WG=hs(x_,jG,null,"bool"),Mye={kernelName:x_,backendName:"cpu",kernelFunc:WG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GG=ra(n=>Math.exp(n)),HG=jc(Oy,GG,"float32"),Lye={kernelName:Oy,backendName:"cpu",kernelFunc:HG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qG=ra(n=>Math.expm1(n)),Fye=jc(Py,qG),Vye={kernelName:Py,backendName:"cpu",kernelFunc:Fye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KG=ra(n=>Math.floor(n)),Uye=jc(My,KG),Bye={kernelName:My,backendName:"cpu",kernelFunc:Uye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XG=jn((n,e)=>Math.floor(n/e)),zye=hs(Ly,XG,null,"int32"),jye={kernelName:Ly,backendName:"cpu",kernelFunc:zye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YG(n,e,t,s,r,i,o,a,l){const u=ht([s,i],t);for(let d=0;d<s;d++){const f=[];let m=0;for(let y=0;y<r;y++){const b=n[d*r+y];m+=b*o[y],f.push(b)}if(m<0||m>=l/i)throw new Error(`Invalid indices: ${f} does not index into ${a}`);for(let y=0;y<i;y++)u.values[d*i+y]=e.get(...e.indexToLoc(m*i+y))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QG(n,e,t){const s=ht(t,n.dtype);for(let r=0;r<s.size;++r){const o=s.indexToLoc(r).slice(),a=o[0],l=o[2],u=e.locToIndex([a,l]);o[2]=e.values[u];const d=n.locToIndex(o);0<=d&&d<n.values.length&&(s.values[r]=n.values[d])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JG=jn((n,e)=>n>e?1:0),Wye=hs(S_,JG,null,"bool"),Gye={kernelName:S_,backendName:"cpu",kernelFunc:Wye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZG=jn((n,e)=>n>=e?1:0),Hye=hs(Fy,ZG,null,"bool"),qye={kernelName:Fy,backendName:"cpu",kernelFunc:Hye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e5=jn((n,e)=>n<e?1:0),Kye=hs(T_,e5,null,"bool"),Xye={kernelName:T_,backendName:"cpu",kernelFunc:Kye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t5=jn((n,e)=>n<=e?1:0),Yye=hs(E_,t5,null,"bool"),Qye={kernelName:E_,backendName:"cpu",kernelFunc:Yye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n5(n,e,t){const s=(e-n)/(t-1),r=Zs(t,"float32");r[0]=n;for(let i=1;i<r.length;i++)r[i]=r[i-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s5=ra(n=>Math.log(n)),Jye=jc(jy,s5),Zye={kernelName:jy,backendName:"cpu",kernelFunc:Jye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r5(n,e,t,s){const r=Js(s,xe(t));for(let i=0;i<r.length;++i){const o=i*e;let a=n[o];for(let l=0;l<e;++l){const u=n[o+l];(Number.isNaN(u)||u>a)&&(a=u)}r[i]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i5=jn((n,e)=>Math.max(n,e)),e0e=hs(Gy,i5),t0e={kernelName:Gy,backendName:"cpu",kernelFunc:e0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o5=jn((n,e)=>Math.min(n,e)),n0e=hs(Hy,o5),s0e={kernelName:Hy,backendName:"cpu",kernelFunc:n0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FA=jn((n,e)=>n*e),r0e=MA((n,e,t,s)=>({real:n*t-e*s,imag:n*s+e*t})),k1=hs(Ky,FA,r0e),i0e={kernelName:Ky,backendName:"cpu",kernelFunc:k1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a5(n,e,t){const s=Pc(-1,t);return FA([],e,s,n,t)}function o0e(n){const{inputs:e,backend:t}=n,{x:s}=e;Ve(s,"neg");const r=t.data.get(s.dataId).values,[i,o]=a5(r,s.shape,s.dtype);return t.makeTensorInfo(o,s.dtype,i)}const a0e={kernelName:L_,backendName:"cpu",kernelFunc:o0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l5=jn((n,e)=>n!==e?1:0),l0e=hs(F_,l5,null,"bool"),c0e={kernelName:F_,backendName:"cpu",kernelFunc:l0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VA(n,e,t,s,r){const i=e.length,o=xe(e),a=je(e),l=je(r),u=Js(t,xe(r));for(let d=0;d<o;++d){const f=Zf(d,i,a),m=new Array(f.length);for(let b=0;b<m.length;b++)m[b]=f[s[b]];const y=zo(m,i,l);u[y]=n[d]}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kr(n){const{inputs:e,attrs:t,backend:s}=n,{x:r}=e,{perm:i}=t;Ve(r,"transpose");const o=r.shape.length,a=new Array(o);for(let f=0;f<a.length;f++)a[f]=r.shape[i[f]];const l=s.data.get(r.dataId).values,u=VA(l,r.shape,r.dtype,i,a);return{dataId:s.write(u,a,r.dtype),shape:a,dtype:r.dtype}}const u0e={kernelName:df,backendName:"cpu",kernelFunc:kr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c5(n,e,t,s){const[r,i]=Ss(n,s),o=Gr(e,"int32"),a=Zs(xe(r),o),l=xe(i);for(let u=0;u<a.length;++u){const d=u*l;let f=1;for(let m=0;m<l;++m)f*=t[d+m];a[u]=f}return{outVals:a,outShape:r,outDtype:o}}function h0e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Ve(r,"prod");const a=r.shape.length,l=dt(i,r.shape),u=Nn(l,a);let d=l,f=r;const m=[];u!=null&&(f=kr({inputs:{x:r},backend:t,attrs:{perm:u}}),m.push(f),d=Bn(d.length,a));const y=t.data.get(f.dataId).values,{outVals:b,outShape:w,outDtype:v}=c5(f.shape,f.dtype,y,d);let S=w;return o&&(S=Xn(w,l)),m.forEach(T=>t.disposeIntermediateTensorInfo(T)),t.makeTensorInfo(S,v,b)}const d0e={kernelName:W_,backendName:"cpu",kernelFunc:h0e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f0e(n,e,t){n.forEach((s,r)=>{if(s<0||s>=t){const i=Zf(r,e.length,je(e)).join(",");throw new Error(`indices[${i}] = ${s} is not in [0, ${t})`)}})}function p0e(n,e){for(let t=0;t<n.length;++t){const s=n[t],r=t===n.length-1?e:n[t+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let i=1;i<s.length;++i)if(s[i-1]>s[i])throw new Error("Ragged splits must be sorted in ascending order")}}function m0e(n,e,t,s){const r=[];let i=0;const o=e.length-1+t.length,a=new Array(o).fill(null).map(()=>[0]);p0e(t,s);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];const d=e[u+1];for(let f=1;f<l+1;++f)a[u].push(f*d)}for(let u=0;u<n.length;++u){let d=n[u],f=n[u]+1;for(let m=0;m<t.length;++m){const y=t[m],b=m+e.length-1;if(b>=0){const w=a[b],v=w[w.length-1]-y[d];for(let S=d;S<f;++S)a[b].push(y[S+1]+v)}d=y[d],f=y[f]}f!==d&&(r.push([d,f]),i+=f-d)}return{outSplits:a,valueSlices:r,numValues:i}}function g0e(n){const e=[];for(let t=0;t<n.length;++t){const s=n[t].length,r=Fn("int32",s);e.push(r),n[t].forEach((i,o)=>r[o]=i)}return e}function DF(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let s=e;s<n.length;s++)t[e-1]*=n[s];return t}function y0e(n,e,t,s,r,i){const o=DF(e,2)[1],a=DF(i,2)[1];let l=0;for(const u of t)for(let d=u[0];d<u[1];++d){for(let f=0;f<s;++f)r[l*a+f]=n[d*o+f];++l}}function b0e(n,e,t,s,r){const i=e.slice();i[0]=r;const o=Fn(t,xe(i)),a=n.length,l=a===0?0:a/e[0];return y0e(n,e,s,l,o,i),[o,i]}function u5(n,e,t,s,r,i,o,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(f0e(i,o,l),s.length===0)throw new Error("params.rank must be nonzero");const u=s[0],{outSplits:d,valueSlices:f,numValues:m}=m0e(i,o,n,u),y=g0e(d),b=b0e(t,s,r,f,m);return[y,b[0],b[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OF=2147483647;function h5(n,e,t,s,r,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,u=o.length===0,d=[];a||d.push(e[0]),l||d.push(r[0]),u||d.push(o[0]);for(let v=1;v<d.length;++v)if(d[v]!==d[v-1])throw new Error("starts, limits, and deltas must have the same shape");const f=d.length===0?1:d[0],m=Fn("int32",f+1);m[0]=0;for(let v=0;v<f;++v){const S=a?n[0]:n[v],T=l?s[0]:s[v],I=u?i[0]:i[v];if(I===0)throw new Error("Requires delta != 0");let k;if(I>0&&T<S||I<0&&T>S)k=0;else if(k=Math.ceil(Math.abs((T-S)/I)),k>OF)throw new Error(`Requires ((limit - start) / delta) <= ${OF}`);m[v+1]=m[v]+k}const y=m[f],b=Fn(t,y);let w=0;for(let v=0;v<f;++v){const S=m[v+1]-m[v];let T=a?n[0]:n[v];const I=u?i[0]:i[v];for(let k=0;k<S;++k)b[w++]=T,T+=I}return[m,b]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Ci=Xi;class hw{constructor(e,t,s,r,i,o,a,l,u,d){this.shape=e,this.shapeShape=t,this.values=s,this.valuesShape=r,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=Yj(d),this.raggedRank=Qj(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Ci.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Ci.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Ci.VALUE_ROWIDS:return hw.getMaxWidthValueRowID(t);case Ci.ROW_SPLITS:return hw.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${Ci[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let s=0;for(let r=0;r<t-1;++r){const i=e[r+1]-e[r];i>s&&(s=i)}return s}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let s=0,r=e[0],i=0;for(let o=1;o<t;++o){const a=e[o];a!==r&&(r=a,i=Math.max(o-s,i),s=o)}return Math.max(t-s,i)}tensorShapeFromTensor(e,t,s=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return MF(e,s)}calculateOutputSize(e){const t=this.valuesShape,s=this.defaultValueShape;Jj(s,t);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=Xj(this.raggedRank,r,t);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,t,s){const r=Math.min(e,s),i=[];let o=0;for(let a=0;a<r;++a,o+=t)i.push(o);for(let a=r;a<e;++a)i.push(-1);return j(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,t,s,r){const i=e.length,o=[];for(let a=0;a<i-1;++a){const l=e[a+1]-e[a];let u=Math.min(r,l),d=t[a];d===-1&&(u=0);for(let f=0;f<u;++f)o.push(d),d+=s;for(let f=0;f<l-u;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,t,s,r){const i=e.length,o=[];if(i===0)return[];let a=0,l=e[0];if(l>=t.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${t.length}`);let u=t[l];o.push(u);for(let d=1;d<i;++d){const f=e[d];if(f===l)u>=0&&(++a,a<r?u+=s:u=-1);else{if(a=0,l=f,f>=t.length)throw new Error(`Got nextValueRowId=${f} which is not less than ${t.length}`);u=t[f]}o.push(u)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,t,s,r){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Ci.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,s,r);case Ci.ROW_SPLITS:if(i.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(i,t,s,r);default:throw new Error(`Unsupported partition type: ${Ci[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case Ci.FIRST_DIM_SIZE:return e[0];case Ci.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Ci.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Ci[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),s=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const i=MF(s,!1),o=Fn(this.valuesDType,xe(i));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(t,r[0],s[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,r[u],s[u]);this.setOutput(this.raggedRank,l,o,i)}return[i,o]}setOutput(e,t,s,r){if(s.length===0)return;const i=this.values,o=s;let a=r.slice();a=a.slice(e+1);const l=xe(a),u=t.length;let d=this.defaultValue;if(d.length!==l&&d.length!==1){const b=this.defaultValueShape;de(()=>{const w=oe(d,b);d=hg(w,a).dataSync()})}let f=0,m=0,y=0;for(let b=0;b<=u;++b){let w=b<u?t[b]:-1;if(w===y){++y;continue}if(m<y){const v=i.subarray(f*l),S=o.subarray(m*l),T=(y-m)*l;PF(S,v,T)}if(b>=u){const v=s.length;w=Math.floor(v/l)}if(w>y)if(this.defaultValue.length===1)o.subarray(y*l,w*l).fill(this.defaultValue[0]),y=w;else for(;w>y;){const v=o.slice(y*l);PF(v,d,l),++y}w<0?(f=b+1,m=y):(f=b,m=y,y=m+1)}}}function PF(n,e,t){for(let s=0;s<t;s++)n[s]=e[s]}function MF(n,e){const t=[];for(let s of n){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}t.push(s)}return t}function d5(n,e,t,s,r,i,o,a,l,u){return new hw(n,e,t,s,r,i,o,a,l,u).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f5(n,e,t,s){const r=n===e,i=n<e&&t<0,o=e<n&&t>1;if(r||i||o)return Zs(0,s);const a=Math.abs(Math.ceil((e-n)/t)),l=Zs(a,s);e<n&&t===1&&(t=-1),l[0]=n;for(let u=1;u<l.length;u++)l[u]=l[u-1]+t;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p5=ra(n=>1/Math.sqrt(n)),x0e=jc(e0,p5),v0e={kernelName:e0,backendName:"cpu",kernelFunc:x0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bu(n,e,t,s,r,i,o,a,l,u){const d=[s/r,r],f=n.values,m=e.values;if(s===0)return ht(t,e.dtype);const y=l instanceof Ms?l:ht(d,e.dtype);typeof l=="string"||typeof l=="number"?y.values.fill(l):typeof l=="boolean"&&y.values.fill(+l);for(let b=0;b<i;b++){const w=[];let v=0;for(let S=0;S<o;S++){const T=f[b*o+S];w.push(T),v+=T*a[S]}if(v<0||v>=s/r)throw new Error(`Invalid indices: ${w} does not index into ${t}`);for(let S=0;S<r;S++)u?y.values[v*r+S]+=m[b*r+S]:y.values[v*r+S]=e.rank===0?m[0]:m[b*r+S]}return y}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w0e=ra(n=>1/(1+Math.exp(-n))),m5=Qt(i0,n=>1/(1+Math.exp(-n))),_0e={kernelName:i0,backendName:"cpu",kernelFunc:m5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g5(n,e,t,s,r){const i=H2(s,e,t),o=xe(t),a=je(s);if(i){const f=q2(e,a);return r==="string"?n.slice(f,f+o):n.subarray(f,f+o)}const l=r==="string"?tl(n):n,u=ht(s,r,l),d=ht(t,r);for(let f=0;f<d.size;++f){const m=d.indexToLoc(f),y=m.map((b,w)=>b+e[w]);d.set(u.get(...y),...m)}return r==="string"?b6(d.values):d.values}function xh(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,size:o}=s;Ve(r,"slice");const[a,l]=f1(r,i,o);W2(r,a,l);const u=t.data.get(r.dataId).values,d=g5(u,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,d)}const S0e={kernelName:Y_,backendName:"cpu",kernelFunc:xh};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y5(n,e,t,s,r,i,o){const a=e[0],l=i[0],u=new Array(l),d=new Array(a),f=e[1];if(l===0){if(a!==0)throw new Error(i6(a));const v=Fn(t,0),S=Fn(r,0);return[v,[0,f],S,u,d]}let m=!0,y=0;const b=new Array(l).fill(0);for(let v=0;v<a;++v){const S=n[v*f];if(S<0)throw new Error(o6(v,S));if(S>=l)throw new Error(a6(v,S,l));++b[S],m=m&&S>=y,y=S}let w=!0;for(let v=0;v<l;++v){const S=b[v]===0;u[v]=S,w=w&&!S,b[v]=Math.max(b[v],1),v>0&&(b[v]+=b[v-1])}if(w&&m){const v=n,S=s;for(let T=0;T<a;++T)d[T]=T;return[v,[a,f],S,u,d]}else{const v=b[l-1],S=Fn(t,v*f),T=Fn(r,v),I=new Array(l).fill(0);for(let k=0;k<a;++k){const O=n[k*f],V=I[O],P=(O===0?0:b[O-1])+V;I[O]++;for(let D=0;D<f;++D)S[P*f+D]=n[k*f+D];T[P]=s[k],d[k]=P}for(let k=0;k<l;++k)if(I[k]===0){const V=k===0?0:b[k-1];S[V*f+0]=k;for(let P=1;P<f;++P)S[V*f+P]=0;T[V]=o}return[S,[v,f],T,u,d]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b5(n,e,t,s,r){const i=xe(s),o=e[0],a=r.length,l=[];let u=1,d=-1;for(let v=0;v<a;++v){const S=r[v];if(S===-1){if(d!==-1)throw new Error(l6(d,v));d=v,l.push(1)}else{if(S<0)throw new Error(c6(v,S));u*=S,l.push(S)}}if(d!==-1){if(u<=0)throw new Error(u6());const v=Math.trunc(i/u);if(u*v!==i)throw new Error(h6(s,l));l[d]=v}if(xe(l)!==i)throw new Error(d6(s,l));const m=s.length,y=[];if(m>0){y[m-1]=1;for(let v=m-2;v>=0;--v)y[v]=y[v+1]*s[v+1]}const b=[];if(a>0){b[a-1]=1;for(let v=a-2;v>=0;--v)b[v]=b[v+1]*l[v+1]}const w=Fn(t,o*a);for(let v=0;v<o;++v){let S=0;for(let T=0;T<m;++T)S+=n[v*m+T]*y[T];for(let T=0;T<a;++T)w[v*a+T]=Math.trunc(S/b[T]),S%=b[T]}return[w,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UA(n,e,t,s,r,i=!1,o=0){const a=s.length,l=[e[0],n.length/e[0]],u=l[1],f=a>0?r[a-1]+1:0;if(f<0)throw new Error(tI());const m=e.slice();m[0]=f;const y=m.reduce((I,k)=>I*k,1),b=Fn(t,y);if(a===0)return f>0&&b.fill(o),[b,m];if(f<=0)throw new Error(tI());let w=0,v=1,S=0,T=r[w];for(;;){let I=0;if(v<a){if(I=r[v],T===I){++v;continue}if(T>=I)throw new Error(f6())}if(T<0||T>=f)throw new Error(p6(T,f));T>S&&b.fill(o,S*u,T*u);for(let k=w;k<v;++k){const O=s[k];if(O<0||O>=l[0])throw new Error(m6(k,s[k],l[0]));for(let V=0;V<u;V++)b[T*u+V]+=n[O*u+V]}if(i)for(let k=0;k<u;k++)b[T*u+k]/=v-w;if(w=v,++v,S=T+1,T=I,v>a)break}return S<f&&b.fill(o,S*u,f*u),[b,m]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C0e=ra(n=>Math.sqrt(n)),T0e=Qt(a0,n=>Math.sqrt(n)),E0e={kernelName:a0,backendName:"cpu",kernelFunc:T0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x5=jn((n,e)=>{const t=n-e;return t*t}),I0e=hs(l0,x5),k0e={kernelName:l0,backendName:"cpu",kernelFunc:I0e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v5=ra((n,e)=>{const{pattern:t,replaceGlobal:s,rewrite:r}=e;return n.replace(new RegExp(t,s?"g":""),r)}),N0e=jc(s2,v5),A0e={kernelName:s2,backendName:"cpu",kernelFunc:N0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w5(n,e,t,s){const r=ht(n,e.dtype);for(let i=0;i<r.size;i++){const o=r.indexToLoc(i),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*t[l]+s[l];r.set(e.get(...a),...o)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R0e{constructor(e,t,s,r,i,o){this.separator=oc(e),this.nGramWidths=t,this.leftPad=oc(s),this.rightPad=oc(r),this.padWidth=i,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const s=this.getPadWidth(t);return Math.max(0,e+2*s-t+1)}createNGrams(e,t,s,r,i,o){for(let a=0;a<i;++a){const l=this.getPadWidth(o),u=Math.max(0,l-a),d=Math.max(0,l-(i-(a+1))),f=o-(u+d),m=t+(u>0?0:a-l);let y=0;y+=u*this.leftPad.length;for(let T=0;T<f;++T)y+=e[m+T].length;y+=d*this.rightPad.length;const b=u+d+f-1;y+=b*this.separator.length,s[r+a]=new Uint8Array(y);const w=s[r+a];let v=0;const S=T=>T.forEach(I=>w[v++]=I);for(let T=0;T<u;++T)S(this.leftPad),S(this.separator);for(let T=0;T<f-1;++T)S(e[m+T]),S(this.separator);if(f>0){S(e[m+f-1]);for(let T=0;T<d;++T)S(this.separator),S(this.rightPad)}else{for(let T=0;T<d-1;++T)S(this.rightPad),S(this.separator);S(this.rightPad)}}}compute(e,t){const s=e.length,r=t.length;if(r>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<r;++u){let d=t[u]>=l;if(d=d&&t[u]<=s,!d)throw new Error(`Invalid split value ${t[u]}, must be in [${l}, ${s}]`);l=t[u]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const i=r-1,o=Fn("int32",r);if(s===0||r===0){const l=new Array(s);for(let u=0;u<=i;++u)o[u]=0;return[l,o]}o[0]=0;for(let l=1;l<=i;++l){const u=t[l]-t[l-1];let d=0;this.nGramWidths.forEach(f=>{d+=this.getNumNGrams(u,f)}),this.preserveShort&&u>0&&d===0&&(d=1),o[l]=o[l-1]+d}const a=new Array(o[i]);for(let l=0;l<i;++l){const u=t[l];let d=o[l];if(this.nGramWidths.forEach(f=>{const m=t[l+1]-t[l],y=this.getNumNGrams(m,f);this.createNGrams(e,u,a,d,y,f),d+=y}),this.preserveShort&&d===o[l]){const f=t[l+1]-t[l];if(f===0)continue;const m=f+2*this.padWidth;this.createNGrams(e,u,a,d,1,m)}}return[a,o]}}function _5(n,e,t,s,r,i,o,a){return new R0e(t,s,r,i,o,a).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $0e(n,e,t,s){if(!n.length)return;if(e.length===0){for(let i=0;i<n.length;++i)s.push(n.subarray(i,i+1));return}if(e.length===1){const i=e[0];let o=n.indexOf(i);for(;o!==-1;){const a=n.subarray(0,o);(!t||a.length!==0)&&s.push(a),n=n.subarray(o+1),o=n.indexOf(i)}(!t||n.length!==0)&&s.push(n);return}let r=0;for(let i=0;i<n.length+1;i++)if(i===n.length||e.indexOf(n[i])!==-1){const o=n.subarray(r,i);(!t||o.length!==0)&&s.push(o),r=i+1}}function S5(n,e,t){const s=n.length,r=[];let i=0,o=0;const a=new Array(s);for(let m=0;m<s;++m){const y=r.length;$0e(n[m],e,t,r);const b=r.length-y;a[m]=b,i+=b,o=Math.max(o,b)}const l=Fn("int32",i*2),u=new Array(i),d=[s,o];let f=0;for(let m=0;m<s;++m)for(let y=0;y<a[m];++y)l[f*2]=m,l[f*2+1]=y,u[f]=r[f],++f;return[l,u,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C5(n,e){const t=Fn("int32",n.length);for(let s=0;s<n.length;++s)t[s]=Koe(n[s]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T5=jn((n,e)=>n-e),D0e=MA((n,e,t,s)=>({real:n-t,imag:e-s})),BA=hs(c0,T5,D0e),O0e={kernelName:c0,backendName:"cpu",kernelFunc:BA};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E5(n,e){const t=new Array(n.rank);for(let r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];const s=ht(t,n.dtype);for(let r=0;r<s.values.length;++r){const i=s.indexToLoc(r),o=new Array(n.rank);for(let l=0;l<o.length;l++)o[l]=i[l]%n.shape[l];const a=n.locToIndex(o);s.values[r]=n.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gm=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function I5(n,e,t=0,s=n.length-1){for(;s>t;){if(s-t>600){const a=s-t+1,l=e-t+1,u=Math.log(a),d=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*d*(a-d)/a)*Math.sign(l-a/2),m=Math.max(t,Math.floor(e-l*d/a+f)),y=Math.min(s,Math.floor(e+(a-l)*d/a+f));I5(n,e,m,y)}const r=n[e];let i=t,o=s;for(Xd(n,t,e),Gm(n[s],r)>0&&Xd(n,t,s);i<o;){for(Xd(n,i,o),i++,o--;Gm(n[i],r)<0;)i=i+1;for(;Gm(n[o],r)>0;)o=o-1}Gm(n[t],r)===0?Xd(n,t,o):(o=o+1,Xd(n,o,s)),o<=e&&(t=o+1),e<=o&&(s=o-1)}}function k5(n,e,t,s,r){const i=e[e.length-1],[o,a]=[n.length/i,i],l=Js(t,o*s),u=Js("int32",o*s);for(let f=0;f<o;f++){const m=f*a,y=n.subarray(m,m+a);let b=new Array(y.length);y.forEach((T,I)=>b[I]={value:T,index:I}),s<b.length&&(I5(b,s),b=b.slice(0,s)),r&&b.sort(Gm);const w=f*s,v=l.subarray(w,w+s),S=u.subarray(w,w+s);for(let T=0;T<s;T++)v[T]=b[T].value,S[T]=b[T].index}const d=e.slice();return d[d.length-1]=s,[ht(d,t,l),ht(d,"int32",u)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N5(n,e,t,s){const r=dt(e,t)[0],i=[1,t[0],1];for(let b=0;b<r;b++)i[0]*=t[b];i[1]=t[r];for(let b=r+1;b<t.length;b++)i[2]*=t[b];const o=new Map,a=new Int32Array(t[r]),l=new Ms(i,s,n),u=[],d=i[0]===1&&i[2]===1;for(let b=0;b<t[r];b++){let w;if(d)w=n[b].toString();else{const S=[];for(let T=0;T<i[0];T++)for(let I=0;I<i[2];I++)S.push(l.get(T,b,I));w=S.join(",")}const v=o.get(w);if(v!=null)a[b]=v;else{const S=o.size;o.set(w,S),a[b]=S,u.push(b)}}const f=i.slice();f[1]=o.size;const m=new Ms(f,s);u.forEach((b,w)=>{for(let v=0;v<i[0];v++)for(let S=0;S<i[2];S++)m.set(l.get(v,b,S),v,w,S)});const y=t.slice();return y[r]=f[1],{outputValues:m.values,outputShape:y,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P0e=Object.freeze(Object.defineProperty({__proto__:null,addImpl:FG,bincountImpl:LA,bincountReduceImpl:VG,bitwiseAndImpl:UG,castImpl:LG,ceilImpl:BG,concatImpl:zG,equalImpl:jG,expImpl:GG,expm1Impl:qG,floorDivImpl:XG,floorImpl:KG,gatherNdImpl:YG,gatherV2Impl:QG,greaterEqualImpl:ZG,greaterImpl:JG,lessEqualImpl:t5,lessImpl:e5,linSpaceImpl:n5,logImpl:s5,maxImpl:r5,maximumImpl:i5,minimumImpl:o5,multiplyImpl:FA,negImpl:a5,notEqualImpl:l5,prodImpl:c5,raggedGatherImpl:u5,raggedRangeImpl:h5,raggedTensorToTensorImpl:d5,rangeImpl:f5,rsqrtImpl:p5,scatterImpl:Bu,sigmoidImpl:w0e,simpleAbsImpl:MG,sliceImpl:g5,sparseFillEmptyRowsImpl:y5,sparseReshapeImpl:b5,sparseSegmentReductionImpl:UA,sqrtImpl:C0e,squaredDifferenceImpl:x5,staticRegexReplaceImpl:v5,stridedSliceImpl:w5,stringNGramsImpl:_5,stringSplitImpl:S5,stringToHashBucketFastImpl:C5,subImpl:T5,tileImpl:E5,topKImpl:k5,transposeImpl:VA,uniqueImpl:N5},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Hz("cpu",()=>new I1,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A5=Qt($y,n=>n>=0?n:Math.exp(n)-1),M0e={kernelName:$y,backendName:"cpu",kernelFunc:A5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R5(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:i}=s;Ve([r],"leakyRelu");const o=xe(r.shape),a=t.data.get(r.dataId).values,l=Js("float32",o);for(let u=0;u<a.length;u++)l[u]=a[u]<0?i*a[u]:a[u];return t.makeTensorInfo(r.shape,"float32",l)}const L0e={kernelName:C_,backendName:"cpu",kernelFunc:R5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F0e=jn((n,e)=>n<0?e*n:n);function $5(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e;Ve([s,r],"prelu");const i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,[a,l]=F0e(s.shape,r.shape,i,o,"float32");return t.makeTensorInfo(l,"float32",a)}const V0e={kernelName:j_,backendName:"cpu",kernelFunc:$5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D5=Qt(Qy,n=>Math.max(0,n)),U0e={kernelName:Qy,backendName:"cpu",kernelFunc:D5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O5=Qt(Jy,n=>Math.min(Math.max(0,n),6)),B0e={kernelName:Jy,backendName:"cpu",kernelFunc:O5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dw(n,e,t,s,r){if(t==="linear")return ea({inputs:{x:e},backend:n});if(t==="relu")return D5({inputs:{x:e},backend:n});if(t==="elu")return A5({inputs:{x:e},backend:n});if(t==="relu6")return O5({inputs:{x:e},backend:n});if(t==="prelu")return $5({inputs:{x:e,alpha:s},backend:n});if(t==="leakyrelu")return R5({inputs:{x:e},backend:n,attrs:{alpha:r}});if(t==="sigmoid")return m5({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pn(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:i}=s,o=xe(r.shape),a=nz(i,o),l=xe(a);j(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),t.incRef(r.dataId);const u=t.data.get(r.dataId);if(u.complexTensorInfos!=null){const d=u.complexTensorInfos.real,f=u.complexTensorInfos.imag;d.shape=a,f.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const z0e={kernelName:G_,backendName:"cpu",kernelFunc:pn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P5(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;Ve([r,i],"matMul");const l=r.shape.length,u=i.shape.length,d=o?r.shape[l-2]:r.shape[l-1],f=a?i.shape[u-1]:i.shape[u-2],m=o?r.shape[l-1]:r.shape[l-2],y=a?i.shape[u-2]:i.shape[u-1],b=r.shape.slice(0,-2),w=i.shape.slice(0,-2),v=xe(b),S=xe(w),I=it(r.shape.slice(0,-2),i.shape.slice(0,-2)).concat([m,y]);j(d===f,()=>`Error in matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${r.shape} and ${i.shape} and transposeA=${o} and transposeB=${a} must match.`);const k=o?[v,d,m]:[v,m,d],O=a?[S,y,f]:[S,f,y],V=pn({inputs:{x:r},backend:t,attrs:{shape:k}}),P=pn({inputs:{x:i},backend:t,attrs:{shape:O}}),D=o?V.shape[1]:V.shape[2],$=o?V.shape[2]:V.shape[1],R=a?P.shape[1]:P.shape[2],A=Math.max(v,S),U=t.data.get(V.dataId).values,F=t.data.get(P.dataId).values,ne=je(V.shape),Q=je(P.shape),[G,K,J]=o?[ne[0],1,ne[1]]:[ne[0],ne[1],1],[ce,z,X]=a?[1,Q[1],Q[0]]:[Q[1],1,Q[0]],ie=$*R,se=ht([A,$,R],V.dtype),ve=se.values,we=t.blockSize;for(let Se=0;Se<A;Se++){const Oe=Se%v,De=Se%S;for(let Ue=0;Ue<$;Ue+=we){const Ke=Math.min(Ue+we,$);for(let Xe=0;Xe<R;Xe+=we){const mt=Math.min(Xe+we,R);for(let kt=0;kt<D;kt+=we){const jt=Math.min(kt+we,D);for(let Ft=Ue;Ft<Ke;Ft++)for(let $t=Xe;$t<mt;$t++){let xt=0;for(let Jt=kt;Jt<jt;Jt++){const br=U[Oe*G+Ft*K+Jt*J],wn=F[Jt*ce+$t*z+De*X];xt+=br*wn}ve[Se*ie+(Ft*R+$t)]+=xt}}}}}return t.disposeIntermediateTensorInfo(V),t.disposeIntermediateTensorInfo(P),t.makeTensorInfo(I,se.dtype,se.values)}const j0e={kernelName:c_,backendName:"cpu",kernelFunc:P5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W0e(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:d,leakyreluAlpha:f}=s;let m,y,b;const w=[];m=P5({inputs:{a:r,b:i},attrs:{transposeA:l,transposeB:u},backend:t}),o&&(y=Df({inputs:{a:m,b:o},backend:t}),w.push(m),m=y),d&&(b=dw(t,m,d,a,f),w.push(m),m=b);for(const S of w)t.disposeIntermediateTensorInfo(S);return m}const G0e={kernelName:Wv,backendName:"cpu",kernelFunc:W0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H0e=Qt(xy,n=>Math.acos(n)),q0e={kernelName:xy,backendName:"cpu",kernelFunc:H0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K0e=Qt(vy,n=>Math.acosh(n)),X0e={kernelName:vy,backendName:"cpu",kernelFunc:K0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y0e(n){const{inputs:e,backend:t}=n,s=e;Ve(e,"addN");const r=s.map(a=>t.data.get(a.dataId).values),i=ht(s[0].shape,s[0].dtype),o=i.values;for(let a=0;a<s.length;a++){const l=r[a];for(let u=0;u<o.length;u++)o[u]+=l[u]}return t.makeTensorInfo(i.shape,i.dtype,i.values)}const Q0e={kernelName:_N,backendName:"cpu",kernelFunc:Y0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J0e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Ve(r,"all");const a=dt(i,r.shape);let l=a;const u=Nn(l,r.shape.length);let d=r;u!=null&&(d=kr({inputs:{x:r},backend:t,attrs:{perm:u}}),l=Bn(l.length,r.shape.length)),Fs("all",l,d.shape.length);const[f,m]=Ss(d.shape,l),y=xe(m),b=Zs(xe(f),d.dtype),w=t.data.get(d.dataId).values;for(let S=0;S<b.length;++S){const T=S*y;let I=w[T];for(let k=0;k<y;++k){const O=w[T+k];I=I&&O}b[S]=I}u!=null&&t.disposeIntermediateTensorInfo(d);const v=t.makeTensorInfo(f,d.dtype,b);if(o){const S=Xn(f,a),T=pn({inputs:{x:v},backend:t,attrs:{shape:S}});return t.disposeIntermediateTensorInfo(v),T}return v}const Z0e={kernelName:SN,backendName:"cpu",kernelFunc:J0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ebe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Ve(r,"any");const a=dt(i,r.shape);let l=a;const u=Nn(l,r.shape.length);let d=r;u!=null&&(d=kr({inputs:{x:r},backend:t,attrs:{perm:u}}),l=Bn(l.length,r.shape.length)),Fs("any",l,d.shape.length);const[f,m]=Ss(d.shape,l),y=xe(m),b=Zs(xe(f),d.dtype),w=t.data.get(d.dataId).values;for(let S=0;S<b.length;++S){const T=S*y;let I=w[T];for(let k=0;k<y;++k){const O=w[T+k];I=I||O}b[S]=I}u!=null&&t.disposeIntermediateTensorInfo(d);const v=t.makeTensorInfo(f,d.dtype,b);if(o){const S=Xn(f,a),T=pn({inputs:{x:v},backend:t,attrs:{shape:S}});return t.disposeIntermediateTensorInfo(v),T}return v}const tbe={kernelName:CN,backendName:"cpu",kernelFunc:ebe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nbe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;Ve(r,"argMax");let o=dt(i,r.shape);const a=Nn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=kr({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=Bn(o.length,l.shape.length)),o=[o[0]],Fs("argMax",o,l.shape.length);const[d,f]=Ss(l.shape,o),m=xe(d),y=Zs(m,"int32"),b=xe(f),w=t.data.get(l.dataId).values;for(let v=0;v<y.length;++v){const S=v*b;let T=w[S],I=0;for(let k=0;k<b;++k){const O=w[S+k];O>T&&(T=O,I=k)}y[v]=I}return u.forEach(v=>t.disposeIntermediateTensorInfo(v)),t.makeTensorInfo(d,"int32",y)}const sbe={kernelName:i_,backendName:"cpu",kernelFunc:nbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rbe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;Ve(r,"argMin");let o=dt(i,r.shape);const a=Nn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=kr({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=Bn(o.length,l.shape.length)),o=[o[0]],Fs("argMin",o,l.shape.length);const[d,f]=Ss(l.shape,o),m=xe(d),y=Zs(m,"int32"),b=xe(f),w=t.data.get(l.dataId).values;for(let v=0;v<y.length;++v){const S=v*b;let T=w[S],I=0;for(let k=0;k<b;++k){const O=w[S+k];O<T&&(T=O,I=k)}y[v]=I}return u.forEach(v=>t.disposeIntermediateTensorInfo(v)),t.makeTensorInfo(d,"int32",y)}const ibe={kernelName:o_,backendName:"cpu",kernelFunc:rbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const obe=Qt(wy,n=>Math.asin(n)),abe={kernelName:wy,backendName:"cpu",kernelFunc:obe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lbe=Qt(_y,n=>Math.asinh(n)),cbe={kernelName:_y,backendName:"cpu",kernelFunc:lbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ube=Qt(Sy,n=>Math.atan(n)),hbe={kernelName:Sy,backendName:"cpu",kernelFunc:ube};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dbe=jn((n,e)=>Math.atan2(n,e)),fbe=hs(Ty,dbe),pbe={kernelName:Ty,backendName:"cpu",kernelFunc:fbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mbe=Qt(Cy,n=>Math.atanh(n)),gbe={kernelName:Cy,backendName:"cpu",kernelFunc:mbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zA(n,e,t,s,r,i){const o=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,m=r.padInfo.top,y=r.padInfo.left,b=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=ht(r.outShape,t),v=w.values,S=r.outShape[1]*r.outShape[2]*r.outShape[3],T=r.outShape[2]*r.outShape[3],I=r.outShape[3];for(let k=0;k<r.batchSize;++k){const O=k*S,V=k*s[0];for(let P=0;P<r.inChannels;++P)for(let D=0;D<r.outHeight;++D){const $=D*o-m,R=Math.max(0,$),A=Math.min(r.inHeight,d+$),U=O+D*T;for(let F=0;F<r.outWidth;++F){const ne=F*a-y,Q=Math.max(0,ne),G=Math.min(r.inWidth,f+ne);let K=b,J=0,ce=0;for(let X=R;X<A;X+=l){const ie=V+X*s[1];for(let se=Q;se<G;se+=u){const ve=ie+se*s[2],we=n[ve+P];i==="max"&&we>K?K=we:i==="avg"&&(J+=we,ce++)}if(isNaN(K))break}const z=U+F*I+P;v[z]=i==="avg"?J/ce:K}}}return w}function M5(n,e,t,s,r=!1,i=!1){const o=ht(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,u=s.dilationHeight,d=s.dilationWidth,f=s.effectiveFilterHeight,m=s.effectiveFilterWidth,y=s.padInfo.top,b=s.padInfo.left,w=ht(e,t,n);for(let v=0;v<s.batchSize;++v)for(let S=0;S<s.inChannels;++S)for(let T=0;T<s.outHeight;++T){const I=T*a-y;let k=I;for(;k<0;)k+=u;const O=Math.min(s.inHeight,f+I);for(let V=0;V<s.outWidth;++V){const P=V*l-b;let D=P;for(;D<0;)D+=d;const $=Math.min(s.inWidth,m+P);let R=Number.NEGATIVE_INFINITY,A=-1;for(let U=k;U<O;U+=u){const F=U-I;for(let ne=D;ne<$;ne+=d){const Q=ne-P,G=w.get(v,U,ne,S);G>R&&(R=G,r?A=i?((v*s.inHeight+U)*s.inWidth+ne)*s.inChannels+S:(U*s.inWidth+ne)*s.inChannels+S:A=F*m+Q)}}o.set(A,v,T,V,S)}}return o}function L5(n,e,t,s,r,i){const o=r.strideDepth,a=r.strideHeight,l=r.strideWidth,u=r.dilationDepth,d=r.dilationHeight,f=r.dilationWidth,m=r.effectiveFilterDepth,y=r.effectiveFilterHeight,b=r.effectiveFilterWidth,w=r.padInfo.front,v=r.padInfo.top,S=r.padInfo.left,T=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,I=ht(r.outShape,t),k=I.values,O=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],V=r.outShape[2]*r.outShape[3]*r.outShape[4],P=r.outShape[3]*r.outShape[4],D=r.outShape[4];for(let $=0;$<r.batchSize;++$){const R=$*O,A=$*s[0];for(let U=0;U<r.inChannels;++U)for(let F=0;F<r.outDepth;++F){const ne=F*o-w;let Q=ne;for(;Q<0;)Q+=u;const G=Math.min(r.inDepth,m+ne),K=R+F*V;for(let J=0;J<r.outHeight;++J){const ce=J*a-v;let z=ce;for(;z<0;)z+=d;const X=Math.min(r.inHeight,y+ce),ie=K+J*P;for(let se=0;se<r.outWidth;++se){const ve=se*l-S;let we=ve;for(;we<0;)we+=f;const Se=Math.min(r.inWidth,b+ve),Oe=ie+se*D;let De=T,Ue=0,Ke=0;for(let mt=Q;mt<G;mt+=u){const kt=A+mt*s[1];for(let jt=z;jt<X;jt+=d){const Ft=kt+jt*s[2];for(let $t=we;$t<Se;$t+=f){const xt=Ft+$t*s[3],Jt=n[xt+U];if(i==="max"&&Jt>De?De=Jt:i==="avg"&&(Ue+=Jt,Ke++),isNaN(De))break}if(isNaN(De))break}if(isNaN(De))break}const Xe=Oe+U;k[Xe]=i==="avg"?Ue/Math.max(Ke,1):De}}}}return I}function ybe(n,e){const t=ht(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,m=e.padInfo.front,y=e.padInfo.top,b=e.padInfo.left;for(let w=0;w<e.batchSize;++w)for(let v=0;v<e.inChannels;++v)for(let S=0;S<e.outDepth;++S){const T=S*s-m;let I=T;for(;I<0;)I+=o;const k=Math.min(e.inDepth,u+T);for(let O=0;O<e.outHeight;++O){const V=O*r-y;let P=V;for(;P<0;)P+=a;const D=Math.min(e.inHeight,d+V);for(let $=0;$<e.outWidth;++$){const R=$*i-b;let A=R;for(;A<0;)A+=l;const U=Math.min(e.inWidth,f+R);let F=Number.NEGATIVE_INFINITY,ne=-1;for(let Q=I;Q<k;Q+=o){const G=Q-T;for(let K=P;K<D;K+=a){const J=K-V;for(let ce=A;ce<U;ce+=l){const z=ce-R,X=n.get(w,Q,K,ce,v);X>=F&&(F=X,ne=G*d*f+J*d+z)}}}t.set(ne,w,S,O,$,v)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bbe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Ve(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;j(tr(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=Mi(r.shape,i,o,u,a,l);let f;if(d.filterWidth===1&&d.filterHeight===1&&zt(d.inShape,d.outShape))f=ea({inputs:{x:r},backend:t});else{const m=t.data.get(r.dataId).values,y=je(r.shape),b=zA(m,r.shape,r.dtype,y,d,"avg");f=t.makeTensorInfo(d.outShape,r.dtype,b.values)}return f}const xbe={kernelName:a_,backendName:"cpu",kernelFunc:bbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vbe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;Ve(r,"avgPool3d");const d=ol(r.shape,i,o,1,a,l,u),f=t.data.get(r.dataId).values,m=L5(f,r.shape,r.dtype,je(r.shape),d,"avg");return t.makeTensorInfo(m.shape,"float32",m.values)}const wbe={kernelName:l_,backendName:"cpu",kernelFunc:vbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _be(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;Ve([r,i],"avgPool3DGrad");const d=ol(i.shape,o,a,1,l,u),f=d.strideDepth,m=d.strideHeight,y=d.strideWidth,b=d.filterDepth,w=d.filterHeight,v=d.filterWidth,S=d.dilationDepth,T=d.dilationHeight,I=d.dilationWidth,k=d.effectiveFilterDepth,O=d.effectiveFilterHeight,V=d.effectiveFilterWidth,P=k-1-d.padInfo.front,D=V-1-d.padInfo.left,$=O-1-d.padInfo.top,R=ht(i.shape,"float32"),A=1/(b*w*v),U=t.bufferSync(r);for(let F=0;F<d.batchSize;++F)for(let ne=0;ne<d.inChannels;++ne)for(let Q=0;Q<d.inDepth;++Q)for(let G=0;G<d.inHeight;++G)for(let K=0;K<d.inWidth;++K){const J=Q-P,ce=G-$,z=K-D;let X=0;for(let ie=0;ie<k;ie+=S){const se=(J+ie)/f;if(!(se<0||se>=d.outDepth||Math.floor(se)!==se))for(let ve=0;ve<O;ve+=T){const we=(ce+ve)/m;if(!(we<0||we>=d.outHeight||Math.floor(we)!==we))for(let Se=0;Se<V;Se+=I){const Oe=(z+Se)/y;if(Oe<0||Oe>=d.outWidth||Math.floor(Oe)!==Oe)continue;const De=U.get(F,se,we,Oe,ne);X+=De}}}R.set(X*A,F,Q,G,K,ne)}return t.makeTensorInfo(R.shape,R.dtype,R.values)}const Sbe={kernelName:EN,backendName:"cpu",kernelFunc:_be};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cbe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i;Ve([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,d=Mi(o.shape,a,l,1,u),f=d.strideHeight,m=d.strideWidth,y=d.filterHeight,b=d.filterWidth,w=d.dilationHeight,v=d.dilationWidth,S=d.effectiveFilterHeight,T=d.effectiveFilterWidth,I=T-1-d.padInfo.left,k=S-1-d.padInfo.top,O=ht(o.shape,"float32"),V=1/(y*b),P=t.data.get(r.dataId).values,D=ht(r.shape,"float32",P);for(let $=0;$<d.batchSize;++$)for(let R=0;R<d.inChannels;++R)for(let A=0;A<d.inHeight;++A)for(let U=0;U<d.inWidth;++U){const F=A-k,ne=U-I;let Q=0;for(let G=0;G<S;G+=w){const K=(F+G)/f;if(!(K<0||K>=d.outHeight||Math.floor(K)!==K))for(let J=0;J<T;J+=v){const ce=(ne+J)/m;if(ce<0||ce>=d.outWidth||Math.floor(ce)!==ce)continue;const z=D.get($,K,ce,R);Q+=z}}O.set(Q*V,$,A,U,R)}return t.makeTensorInfo(O.shape,O.dtype,O.values)}const Tbe={kernelName:TN,backendName:"cpu",kernelFunc:Cbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ebe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,scale:i,offset:o,mean:a,variance:l}=e;j(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),j(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),j(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Ve([r,a,l,i,o],"batchNorm");let{varianceEpsilon:u}=s;u==null&&(u=.001);const d=t.data.get(r.dataId).values,f=t.data.get(a.dataId).values,m=t.data.get(l.dataId).values,y=i?t.data.get(i.dataId).values:new Float32Array([1]),b=o?t.data.get(o.dataId).values:new Float32Array([0]),w=new Float32Array(d.length),v=b.length,S=y.length,T=m.length,I=f.length;let k=0,O=0,V=0,P=0;for(let D=0;D<d.length;++D)w[D]=b[k++]+(d[D]-f[O++])*y[V++]/Math.sqrt(m[P++]+u),k>=v&&(k=0),O>=I&&(O=0),V>=S&&(V=0),P>=T&&(P=0);return t.makeTensorInfo(r.shape,r.dtype,w)}const Ibe={kernelName:w_,backendName:"cpu",kernelFunc:Ebe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kbe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,crops:o}=s;Ve([r],"batchToSpaceND");const a=i.reduce((S,T)=>S*T),l=x0(r.shape,i,a),u=v0(l.length,i.length),d=w0(r.shape,i,a),f=J2(o,i.length),m=Z2(d,o,i.length),y=pn({inputs:{x:r},backend:t,attrs:{shape:l}}),b=kr({inputs:{x:y},backend:t,attrs:{perm:u}}),w=pn({inputs:{x:b},backend:t,attrs:{shape:d}}),v=xh({inputs:{x:w},backend:t,attrs:{begin:f,size:m}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(w),v}const Nbe={kernelName:u_,backendName:"cpu",kernelFunc:kbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Abe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o}=s,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,u=LA(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}const Rbe={kernelName:IN,backendName:"cpu",kernelFunc:Abe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $be(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,a=it(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Dbe={kernelName:lz,backendName:"cpu",kernelFunc:$be};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Obe=Qt(ky,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),Pbe={kernelName:ky,backendName:"cpu",kernelFunc:Obe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mbe=n=>{const{x:e}=n.inputs,t=n.backend,s=new Float32Array(xe(e.shape)),r=t.data.get(e.dataId),i=r.complexTensorInfos.real,o=r.complexTensorInfos.imag,a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values;for(let u=0;u<a.length;u++){const d=a[u],f=l[u];s[u]=Math.hypot(d,f)}return t.makeOutput(s,e.shape,"float32")},Lbe={kernelName:h_,backendName:"cpu",kernelFunc:Mbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Of(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.imag,i=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,i)}const Fbe={kernelName:GN,backendName:"cpu",kernelFunc:Of};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pf(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,i=dt(r,e[0].shape)[0],o=e.map(w=>w.shape);X2(o,i);let a=Wo(e.map(w=>w.shape),i);if(xe(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(w=>xe(w.shape)>0);if(l.length===1)return ea({inputs:{x:l[0]},backend:t});if(l[0].dtype==="complex64"){const w=l.map(k=>bh({inputs:{input:k},backend:t})),v=l.map(k=>Of({inputs:{input:k},backend:t})),S=Pf({inputs:w,backend:t,attrs:{axis:i}}),T=Pf({inputs:v,backend:t,attrs:{axis:i}}),I=Ur({inputs:{real:S,imag:T},backend:t});return w.forEach(k=>t.disposeIntermediateTensorInfo(k)),v.forEach(k=>t.disposeIntermediateTensorInfo(k)),t.disposeIntermediateTensorInfo(S),t.disposeIntermediateTensorInfo(T),I}const u=l.map(w=>{const S=[-1,xe(w.shape.slice(i))];return pn({inputs:{x:w},backend:t,attrs:{shape:S}})}),d=u.map(w=>({vals:t.data.get(w.dataId).values,shape:w.shape}));a=Wo(u.map(w=>w.shape),1);const f=u[0].shape[0]===1,m=zG(d,a,e[0].dtype,f),y=Wo(l.map(w=>w.shape),i),b=t.makeTensorInfo(y,e[0].dtype,m);return u.forEach(w=>t.disposeIntermediateTensorInfo(w)),b}const Vbe={kernelName:d_,backendName:"cpu",kernelFunc:Pf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F5(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:d}=s;Ve([r,i],"conv2d");const f=al(l),m=Ls(r.shape,i.shape,o,u,a,d,!1,f),y=m.filterHeight,b=m.filterWidth,w=m.dilationHeight,v=m.dilationWidth,S=m.padInfo.left,T=m.padInfo.top,I=m.dataFormat==="channelsLast",k=new Ms(m.outShape,r.dtype),O=je(r.shape),V=je(i.shape),P=O[0],D=I?O[1]:O[2],$=I?O[2]:1,R=I?1:O[1],A=k.strides[0],U=I?k.strides[1]:k.strides[2],F=I?k.strides[2]:1,ne=I?1:k.strides[1],Q=t.data.get(r.dataId).values,G=t.data.get(i.dataId).values,K=k.values;for(let J=0;J<m.batchSize;++J){const ce=J*P,z=J*A;for(let X=0;X<m.outHeight;++X){const ie=z+X*U,se=X*m.strideHeight-T;for(let ve=0;ve<y;++ve){const we=se+ve*w;if(we<0||we>=m.inHeight)continue;const Se=ve*V[0],Oe=ce+we*D;for(let De=0;De<m.outWidth;++De){const Ue=ie+De*F,Ke=De*m.strideWidth-S;for(let Xe=0;Xe<b;++Xe){const mt=Ke+Xe*v;if(mt<0||mt>=m.inWidth)continue;const kt=Se+Xe*V[1],jt=Oe+mt*$;let Ft=kt;for(let $t=0;$t<m.inChannels;++$t){const xt=Q[jt+$t*R];for(let Jt=0;Jt<m.outChannels;++Jt)K[Ue+Jt*ne]+=xt*G[Ft+Jt];Ft+=m.outChannels}}}}}}return t.makeTensorInfo(k.shape,k.dtype,K)}const Ube={kernelName:f_,backendName:"cpu",kernelFunc:F5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bbe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:d}=s;Ve([r,i],"conv2dBackpropFilter");const f=al(l),m=Ls(r.shape,d,o,1,a,u,!1,f),{strideHeight:y,strideWidth:b,filterHeight:w,filterWidth:v}=m,S=m.dataFormat==="channelsLast",T=new Ms(m.filterShape,"float32"),I=m.padInfo.left,k=m.padInfo.top,O=t.data.get(r.dataId).values,V=t.data.get(i.dataId).values,P=new Ms(r.shape,r.dtype,O),D=new Ms(i.shape,i.dtype,V);for(let $=0;$<w;++$){const R=Math.max(0,Math.ceil((k-$)/y)),A=Math.min(m.outHeight,(m.inHeight+k-$)/y);for(let U=0;U<v;++U){const F=Math.max(0,Math.ceil((I-U)/b)),ne=Math.min(m.outWidth,(m.inWidth+I-U)/b);for(let Q=0;Q<m.inChannels;++Q)for(let G=0;G<m.outChannels;++G){let K=0;for(let J=0;J<m.batchSize;++J)for(let ce=R;ce<A;++ce){const z=$+ce*y-k;for(let X=F;X<ne;++X){const ie=U+X*b-I;S?K+=P.get(J,z,ie,Q)*D.get(J,ce,X,G):K+=P.get(J,Q,z,ie)*D.get(J,G,ce,X)}}T.set(K,$,U,Q,G)}}}return t.makeTensorInfo(T.shape,T.dtype,T.values)}const zbe={kernelName:AN,backendName:"cpu",kernelFunc:Bbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jbe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:d}=s;Ve([r,i],"conv2dBackpropInput");const f=je(i.shape),m=je(r.shape);let y=al(u);const b=Ls(o,i.shape,a,1,l,d,!1,y),w=new Ms(b.inShape,"float32"),v=w.values,S=t.data.get(r.dataId).values,T=t.data.get(i.dataId).values,[I,k,O]=f,{batchSize:V,filterHeight:P,filterWidth:D,inChannels:$,inHeight:R,inWidth:A,outChannels:U,outHeight:F,outWidth:ne,strideHeight:Q,strideWidth:G}=b;y=b.dataFormat;const K=P-1-b.padInfo.top,J=D-1-b.padInfo.left,ce=y==="channelsLast",z=w.strides[0],X=ce?w.strides[1]:w.strides[2],ie=ce?w.strides[2]:1,se=ce?1:w.strides[1],ve=m[0],we=ce?m[1]:m[2],Se=ce?m[2]:1,Oe=ce?1:m[1];for(let De=0;De<V;++De)for(let Ue=0;Ue<$;++Ue)for(let Ke=0;Ke<R;++Ke){const Xe=Ke-K,mt=Math.max(0,Math.ceil(Xe/Q)),kt=Math.min(F,(P+Xe)/Q);for(let jt=0;jt<A;++jt){const Ft=jt-J,$t=Math.max(0,Math.ceil(Ft/G)),xt=Math.min(ne,(D+Ft)/G);let Jt=0;for(let wn=mt;wn<kt;++wn){const rr=wn*Q-Xe;for(let Us=$t;Us<xt;++Us){const Ar=Us*G-Ft,Bs=ve*De+we*wn+Se*Us,Rr=I*(P-1-rr)+k*(D-1-Ar)+O*Ue;for(let Wt=0;Wt<U;++Wt){const gt=S[Bs+Oe*Wt],$n=T[Rr+Wt];Jt+=gt*$n}}}const br=z*De+X*Ke+ie*jt+se*Ue;v[br]=Jt}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const Wbe={kernelName:p_,backendName:"cpu",kernelFunc:jbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gbe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s;Ve([r,i],"conv3d");const u=Lc(r.shape,i.shape,o,l,a),{filterDepth:d,filterHeight:f,filterWidth:m,dilationDepth:y,dilationHeight:b,dilationWidth:w,padInfo:v}=u,S=v.front,T=v.left,I=v.top,k=new Ms(u.outShape,r.dtype),O=t.data.get(r.dataId).values,V=t.data.get(i.dataId).values,P=k.values,D=je(r.shape),$=je(i.shape);for(let R=0;R<u.batchSize;++R){const A=R*D[0],U=R*k.strides[0];for(let F=0;F<u.outDepth;++F){const ne=U+F*k.strides[1],Q=F*u.strideDepth-S;for(let G=0;G<d;++G){const K=Q+G*y;if(K<0||K>=u.inDepth)continue;const J=G*$[0],ce=A+K*D[1];for(let z=0;z<u.outHeight;++z){const X=ne+z*k.strides[2],ie=z*u.strideHeight-I;for(let se=0;se<f;++se){const ve=ie+se*b;if(ve<0||ve>=u.inHeight)continue;const we=J+se*$[1],Se=ce+ve*D[2];for(let Oe=0;Oe<u.outWidth;++Oe){const De=X+Oe*u.outChannels,Ue=Oe*u.strideWidth-T;for(let Ke=0;Ke<m;++Ke){const Xe=Ue+Ke*w;if(Xe<0||Xe>=u.inWidth)continue;const mt=we+Ke*$[2],kt=Se+Xe*u.inChannels;let jt=mt;for(let Ft=0;Ft<u.inChannels;++Ft){const $t=O[kt+Ft];for(let xt=0;xt<u.outChannels;++xt)P[De+xt]+=$t*V[jt+xt];jt+=u.outChannels}}}}}}}}return t.makeTensorInfo(k.shape,k.dtype,k.values)}const Hbe={kernelName:m_,backendName:"cpu",kernelFunc:Gbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qbe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s;Ve([r,i],"conv3dBackpropFilterV2");const u=je(r.shape),d=je(i.shape),f=Lc(r.shape,l,o,1,a),m=f.strideDepth,y=f.strideHeight,b=f.strideWidth,w=f.filterDepth,v=f.filterHeight,S=f.filterWidth,T=new Ms(f.filterShape,"float32"),I=T.values,[k,O,V,P]=T.strides,D=t.data.get(i.dataId).values,[$,R,A,U]=d,F=t.data.get(r.dataId).values,[ne,Q,G,K]=u,J=f.padInfo.front,ce=f.padInfo.left,z=f.padInfo.top;for(let X=0;X<w;++X){const ie=Math.max(0,Math.ceil((J-X)/m)),se=Math.min(f.outDepth,(f.inDepth+J-X)/m),ve=X*k;for(let we=0;we<v;++we){const Se=Math.max(0,Math.ceil((z-we)/y)),Oe=Math.min(f.outHeight,(f.inHeight+z-we)/y),De=we*O+ve;for(let Ue=0;Ue<S;++Ue){const Ke=Math.max(0,Math.ceil((ce-Ue)/b)),Xe=Math.min(f.outWidth,(f.inWidth+ce-Ue)/b),mt=Ue*V+De;for(let kt=0;kt<f.inChannels;++kt){const jt=kt*P+mt;for(let Ft=0;Ft<f.outChannels;++Ft){let $t=0;for(let xt=0;xt<f.batchSize;++xt){const Jt=xt*ne,br=xt*$;for(let wn=ie;wn<se;++wn){const Us=(X+wn*m-J)*Q+Jt,Ar=wn*R+br;for(let Bs=Se;Bs<Oe;++Bs){const Wt=(we+Bs*y-z)*G+Us,gt=Bs*A+Ar;for(let $n=Ke;$n<Xe;++$n){const cl=(Ue+$n*b-ce)*K+Wt,Gc=$n*U+gt;$t+=F[cl+kt]*D[Gc+Ft]}}}}I[jt+Ft]=$t}}}}}return t.makeTensorInfo(T.shape,T.dtype,T.values)}const Kbe={kernelName:RN,backendName:"cpu",kernelFunc:qbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xbe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s;Ve([r],"conv3dBackpropInputV2");const u=je(r.shape),d=je(i.shape),f=Lc(l,i.shape,a,1,o),m=new Ms(f.inShape,"float32"),y=m.values,[b,w,v,S]=m.strides,T=t.data.get(r.dataId).values,[I,k,O,V]=u,P=t.data.get(i.dataId).values,[D,$,R,A]=d,{batchSize:U,filterDepth:F,filterHeight:ne,filterWidth:Q,inChannels:G,inDepth:K,inHeight:J,inWidth:ce,outChannels:z,outDepth:X,outHeight:ie,outWidth:se,strideDepth:ve,strideHeight:we,strideWidth:Se}=f,Oe=F-1-f.padInfo.front,De=ne-1-f.padInfo.top,Ue=Q-1-f.padInfo.left;for(let Ke=0;Ke<U;++Ke)for(let Xe=0;Xe<G;++Xe)for(let mt=0;mt<K;++mt){const kt=mt-Oe,jt=Math.max(0,Math.ceil(kt/ve)),Ft=Math.min(X,(F+kt)/ve);for(let $t=0;$t<J;++$t){const xt=$t-De,Jt=Math.max(0,Math.ceil(xt/we)),br=Math.min(ie,(ne+xt)/we);for(let wn=0;wn<ce;++wn){const rr=wn-Ue,Us=Math.max(0,Math.ceil(rr/Se)),Ar=Math.min(se,(Q+rr)/Se);let Bs=0;for(let Rr=jt;Rr<Ft;++Rr){const Wt=Rr*ve-kt;for(let gt=Jt;gt<br;++gt){const $n=gt*we-xt;for(let Dn=Us;Dn<Ar;++Dn){const cl=Dn*Se-rr,Gc=I*Ke+k*Rr+O*gt+V*Dn,ia=D*(F-1-Wt)+$*(ne-1-$n)+R*(Q-1-cl)+A*Xe;for(let ui=0;ui<z;++ui){const oa=T[Gc+ui],Kr=P[ia+ui];Bs+=oa*Kr}}}}y[b*Ke+w*mt+v*$t+S*wn+Xe]=Bs}}}return t.makeTensorInfo(m.shape,m.dtype,m.values)}const Ybe={kernelName:$N,backendName:"cpu",kernelFunc:Xbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qbe=Qt(Ny,n=>Math.cos(n)),Jbe={kernelName:Ny,backendName:"cpu",kernelFunc:Qbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zbe=Qt(Ay,n=>Math.cosh(n)),exe={kernelName:Ay,backendName:"cpu",kernelFunc:Zbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function txe(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,[d,f,m,y]=r.shape,b=i.shape[0],[w,v]=a,S=ht([b,w,v,y],"float32"),T=t.data.get(i.dataId).values,I=t.data.get(o.dataId).values,k=t.data.get(r.dataId).values,O=je(r.shape),V=je(S.shape);for(let P=0;P<b;P++){const D=P*4,$=T[D],R=T[D+1],A=T[D+2],U=T[D+3],F=I[P];if(F>=d)continue;const ne=w>1?(A-$)*(f-1)/(w-1):0,Q=v>1?(U-R)*(m-1)/(v-1):0;for(let G=0;G<w;G++){const K=w>1?$*(f-1)+G*ne:.5*($+A)*(f-1);if(K<0||K>f-1){for(let J=0;J<v;J++)for(let ce=0;ce<y;ce++){const z=ce+J*V[2]+G*V[1]+P*V[0];S.values[z]=u}continue}if(l==="bilinear"){const J=Math.floor(K),ce=Math.ceil(K),z=K-J;for(let X=0;X<v;X++){const ie=v>1?R*(m-1)+X*Q:.5*(R+U)*(m-1);if(ie<0||ie>m-1){for(let Se=0;Se<y;Se++){const Oe=Se+X*V[2]+G*V[1]+P*V[0];S.values[Oe]=u}continue}const se=Math.floor(ie),ve=Math.ceil(ie),we=ie-se;for(let Se=0;Se<y;Se++){let Oe=Se+se*O[2]+J*O[1]+F*O[0];const De=k[Oe];Oe=Se+ve*O[2]+J*O[1]+F*O[0];const Ue=k[Oe];Oe=Se+se*O[2]+ce*O[1]+F*O[0];const Ke=k[Oe];Oe=Se+ve*O[2]+ce*O[1]+F*O[0];const Xe=k[Oe],mt=De+(Ue-De)*we,kt=Ke+(Xe-Ke)*we;Oe=Se+X*V[2]+G*V[1]+P*V[0],S.values[Oe]=mt+(kt-mt)*z}}}else for(let J=0;J<v;++J){const ce=v>1?R*(m-1)+J*Q:.5*(R+U)*(m-1);if(ce<0||ce>m-1){for(let ie=0;ie<y;ie++){const se=ie+J*V[2]+G*V[1]+P*V[0];S.values[se]=u}continue}const z=Math.round(ce),X=Math.round(K);for(let ie=0;ie<y;ie++){const se=ie+z*O[2]+X*O[1]+F*O[0],ve=ie+J*V[2]+G*V[1]+P*V[0];S.values[ve]=k[se]}}}}return t.makeTensorInfo(S.shape,S.dtype,S.values)}const nxe={kernelName:ON,backendName:"cpu",kernelFunc:txe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sxe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;Ve(r,"cumprod");const l=Nn([i],r.shape.length);let u=r;l!=null&&(u=kr({inputs:{x:r},backend:t,attrs:{perm:l}}));const d=Bn(1,r.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);const f=Gr(u.dtype,"int32"),m=xN(xe(u.shape),f),y=t.data.get(u.dataId).values,b=u.shape[u.shape.length-1],w=a?(S,T)=>S+b-T-1:(S,T)=>S+T;for(let S=0;S<y.length;S+=b)for(let T=0;T<b;T++){const I=w(S,T);if(T===0)m[I]=o?1:y[I];else{const k=w(S,T-1);m[I]=o?y[k]*m[k]:y[I]*m[k]}}const v=t.makeTensorInfo(u.shape,f,m);if(l!=null){const S=Fc(l),T=kr({inputs:{x:v},backend:t,attrs:{perm:S}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(u),T}return v}const rxe={kernelName:DN,backendName:"cpu",kernelFunc:sxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ixe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;Ve(r,"cumsum");const l=Nn([i],r.shape.length);let u=r;l!=null&&(u=kr({inputs:{x:r},backend:t,attrs:{perm:l}}));const d=Bn(1,r.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);const f=Gr(u.dtype,"int32"),m=Zs(xe(u.shape),f),y=t.data.get(u.dataId).values,b=u.shape[u.shape.length-1],w=a?(S,T)=>S+b-T-1:(S,T)=>S+T;for(let S=0;S<y.length;S+=b)for(let T=0;T<b;T++){const I=w(S,T);if(T===0)m[I]=o?0:y[I];else{const k=w(S,T-1);m[I]=o?y[k]+m[k]:y[I]+m[k]}}const v=t.makeTensorInfo(u.shape,f,m);if(l!=null){const S=Fc(l),T=kr({inputs:{x:v},backend:t,attrs:{perm:S}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(u),T}return v}const oxe={kernelName:g_,backendName:"cpu",kernelFunc:ixe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function axe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,d=LA(l,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,d)}else if(r.shape.length===2){const l=t.bufferSync(r),u=t.bufferSync(i),d=VG(l,u,o,a);return t.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const lxe={kernelName:PN,backendName:"cpu",kernelFunc:axe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cxe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:i,dataFormat:o}=s;j(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=r.shape[0],l=r.shape[1],u=r.shape[2],d=r.shape[3],f=l*i,m=u*i,y=d/(i*i),b=t.data.get(r.dataId).values,w=new Float32Array(a*f*m*y);let v=0;for(let S=0;S<a;++S)for(let T=0;T<f;++T){const I=Math.floor(T/i),k=T%i;for(let O=0;O<m;++O){const V=Math.floor(O/i),P=O%i,D=(k*i+P)*y;for(let $=0;$<y;++$){const A=$+D+d*(V+u*(I+l*S));w[v++]=b[A]}}}return t.makeTensorInfo([a,f,m,y],r.dtype,w)}const uxe={kernelName:MN,backendName:"cpu",kernelFunc:cxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V5(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;Ve([r,i],"depthwiseConv2DNative");const d=je(r.shape),f=je(i.shape);let m=l;m==null&&(m=[1,1]),j(tr(o,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${m}'`);const y=Ls(r.shape,i.shape,o,m,a,u,!0),{filterHeight:b,filterWidth:w,dilationHeight:v,dilationWidth:S,padInfo:T}=y,I=T.left,k=T.top,O=y.outChannels/y.inChannels,V=new Ms(y.outShape,r.dtype),P=t.data.get(r.dataId).values,D=t.data.get(i.dataId).values,$=V.values;for(let R=0;R<y.batchSize;++R){const A=R*d[0],U=R*V.strides[0];for(let F=0;F<y.outHeight;++F){const ne=U+F*V.strides[1],Q=F*y.strideHeight-k;for(let G=0;G<b;++G){const K=Q+G*v;if(K<0||K>=y.inHeight)continue;const J=G*f[0],ce=A+K*d[1];for(let z=0;z<y.outWidth;++z){const X=ne+z*V.strides[2],ie=z*y.strideWidth-I;for(let se=0;se<w;++se){const ve=ie+se*S;if(ve<0||ve>=y.inWidth)continue;const we=J+se*f[1],Se=ce+ve*y.inChannels;let Oe=X,De=we;for(let Ue=0;Ue<y.inChannels;++Ue){const Ke=P[Se+Ue];for(let Xe=0;Xe<O;++Xe)$[Oe+Xe]+=Ke*D[De+Xe];Oe+=O,De+=O}}}}}}return t.makeTensorInfo(V.shape,V.dtype,V.values)}const hxe={kernelName:y_,backendName:"cpu",kernelFunc:V5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dxe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:d}=s;Ve([r,i],"depthwiseConv2dNativeBackpropFilter");const f=Ls(r.shape,d,o,a,l,u,!0),{strideHeight:m,strideWidth:y,filterHeight:b,filterWidth:w}=f,v=new Ms(f.filterShape,"float32"),S=f.padInfo.left,T=f.padInfo.top,I=f.outChannels/f.inChannels,k=t.data.get(r.dataId).values,O=new Ms(r.shape,r.dtype,k),V=t.data.get(i.dataId).values,P=new Ms(i.shape,i.dtype,V);for(let D=0;D<b;++D){const $=Math.max(0,Math.ceil((T-D)/m)),R=Math.min(f.outHeight,(f.inHeight+T-D)/m);for(let A=0;A<w;++A){const U=Math.max(0,Math.ceil((S-A)/y)),F=Math.min(f.outWidth,(f.inWidth+S-A)/y);for(let ne=0;ne<f.outChannels;++ne){const Q=Math.trunc(ne/I),G=ne%I;let K=0;for(let J=0;J<f.batchSize;++J)for(let ce=$;ce<R;++ce){const z=D+ce*m-T;for(let X=U;X<F;++X){const ie=A+X*y-S;K+=O.get(J,z,ie,Q)*P.get(J,ce,X,ne)}}v.set(K,D,A,Q,G)}}}return t.makeTensorInfo(v.shape,v.dtype,v.values)}const fxe={kernelName:LN,backendName:"cpu",kernelFunc:dxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pxe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:d}=s;Ve([r,i],"depthwiseConv2DNativeBackpropInput");const f=je(r.shape),m=je(i.shape),y=Ls(d,i.shape,o,a,l,u,!0),b=new Ms(y.inShape,"float32"),w=b.values,[v,S,T]=b.strides,I=t.data.get(r.dataId).values,[k,O,V]=f,P=t.data.get(i.dataId).values,[D,$,R]=m,{batchSize:A,filterHeight:U,filterWidth:F,inChannels:ne,inHeight:Q,inWidth:G,outChannels:K,outHeight:J,outWidth:ce,strideHeight:z,strideWidth:X}=y,ie=U-1-y.padInfo.top,se=F-1-y.padInfo.left,ve=K/ne;for(let we=0;we<A;++we)for(let Se=0;Se<ne;++Se)for(let Oe=0;Oe<Q;++Oe){const De=Oe-ie,Ue=Math.max(0,Math.ceil(De/z)),Ke=Math.min(J,(U+De)/z);for(let Xe=0;Xe<G;++Xe){const mt=Xe-se,kt=Math.max(0,Math.ceil(mt/X)),jt=Math.min(ce,(F+mt)/X);let Ft=0;for(let $t=Ue;$t<Ke;++$t){const xt=$t*z-De;for(let Jt=kt;Jt<jt;++Jt){const br=Jt*X-mt,wn=k*we+O*$t+V*Jt,rr=D*(U-1-xt)+$*(F-1-br)+R*Se;for(let Us=0;Us<ve;++Us){const Ar=Se*ve+Us,Bs=I[wn+Ar],Rr=P[rr+Us];Ft+=Bs*Rr}}}w[v*we+S*Oe+T*Xe+Se]=Ft}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const mxe={kernelName:FN,backendName:"cpu",kernelFunc:pxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gxe(n){const{inputs:e,backend:t}=n,{x:s}=e,r=xe(s.shape),i=t.data.get(s.dataId).values,o=ht([r,r],s.dtype),a=o.values;for(let u=0;u<i.length;u++)a[u*r+u]=i[u];const l=[...s.shape,...s.shape];return t.makeTensorInfo(l,o.dtype,o.values)}const yxe={kernelName:cz,backendName:"cpu",kernelFunc:gxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bxe={kernelName:b_,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r}=n,{strides:i,pad:o,dilations:a}=t,l=e,u=l.data.get(s.dataId).values,d=s.shape.length,f=l.data.get(r.dataId).values,m=r.shape.length,{batchSize:y,inHeight:b,inWidth:w,inChannels:v,outHeight:S,outWidth:T,padInfo:I,strideHeight:k,strideWidth:O,filterHeight:V,filterWidth:P,dilationHeight:D,dilationWidth:$,outShape:R}=p0(s.shape,r.shape,i,o,"NHWC",a),A=xe(R),U=R.length,F=Fn(s.dtype,A);for(let Q=0;Q<y;++Q)for(let G=0;G<S;++G){const K=G*k-I.top;for(let J=0;J<T;++J){const ce=J*O-I.left;for(let z=0;z<v;++z){let X=Number.MIN_SAFE_INTEGER;for(let se=0;se<V;++se){const ve=K+se*D;if(ve>=0&&ve<b)for(let we=0;we<P;++we){const Se=ce+we*$;if(Se>=0&&Se<w){const Oe=zo([Q,ve,Se,z],d,je(s.shape)),De=zo([se,we,z],m,je(r.shape)),Ue=u[Oe]+f[De];Ue>X&&(X=Ue)}}}const ie=zo([Q,G,J,z],U,je(R));F[ie]=X}}}return{dataId:l.write(kh(F,s.dtype),R,s.dtype),shape:R,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xxe={kernelName:UE,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:a,dilations:l}=t,u=e,d=no(s.shape,u.data.get(s.dataId).values),f=no(r.shape,u.data.get(r.dataId).values),{batchSize:m,inHeight:y,inWidth:b,inChannels:w,outHeight:v,outWidth:S,padInfo:T,strideHeight:I,strideWidth:k,filterHeight:O,filterWidth:V,dilationHeight:P,dilationWidth:D,outShape:$}=p0(s.shape,r.shape,o,a,"NHWC",l);j(i.rank===$.length,()=>`Error in ${UE}, dy must have the same rank as output ${$.length}, but got ${i.rank}`);const R=no($,u.data.get(i.dataId).values),A=iz(r.shape,r.dtype);for(let F=0;F<m;++F)for(let ne=0;ne<v;++ne){const Q=ne*I-T.top;for(let G=0;G<S;++G){const K=G*k-T.left;for(let J=0;J<w;++J){let ce=Number.MIN_SAFE_INTEGER,z=0,X=0;for(let ie=0;ie<O;++ie){const se=Q+ie*P;if(se>=0&&se<y)for(let ve=0;ve<V;++ve){const we=K+ve*D;if(we>=0&&we<b){const Se=d[F][se][we][J]+f[ie][ve][J];Se>ce&&(ce=Se,z=ie,X=ve)}}}A[z][X][J]+=R[F][ne][G][J]}}}return{dataId:u.write(kh(A,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vxe={kernelName:VE,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:a,dilations:l}=t,u=e,d=no(s.shape,u.data.get(s.dataId).values),f=no(r.shape,u.data.get(r.dataId).values),{batchSize:m,inHeight:y,inWidth:b,inChannels:w,outHeight:v,outWidth:S,padInfo:T,strideHeight:I,strideWidth:k,filterHeight:O,filterWidth:V,dilationHeight:P,dilationWidth:D,outShape:$}=p0(s.shape,r.shape,o,a,"NHWC",l);j(i.rank===$.length,()=>`Error in ${VE}, dy must have the same rank as output ${$.length}, but got ${i.rank}`);const R=no($,u.data.get(i.dataId).values),A=iz(s.shape,s.dtype);for(let F=0;F<m;++F)for(let ne=0;ne<v;++ne){const Q=ne*I-T.top;for(let G=0;G<S;++G){const K=G*k-T.left;for(let J=0;J<w;++J){let ce=Number.MIN_SAFE_INTEGER,z=Q<0?0:Q,X=K<0?0:K;for(let ie=0;ie<O;++ie){const se=Q+ie*P;if(se>=0&&se<y)for(let ve=0;ve<V;++ve){const we=K+ve*D;if(we>=0&&we<b){const Se=d[F][se][we][J]+f[ie][ve][J];Se>ce&&(ce=Se,z=se,X=we)}}}A[F][z][X][J]+=R[F][ne][G][J]}}}return{dataId:u.write(kh(A,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wxe(n){const{inputs:e,backend:t,attrs:s}=n,{image:r}=e,{canvas:i,options:o}=s,{contextOptions:a,imageOptions:l}=o||{},u=l?.alpha||1,d=a?.contextType||"2d";if(d!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const f=i.getContext(d,a?.contextAttributes||{});if(f==null)throw new Error(`Could not get the context with ${d} type.`);const[m,y]=r.shape.slice(0,2),b=r.shape.length===2?1:r.shape[2],w=t.data.get(r.dataId).values,v=r.dtype==="float32"?255:1,S=new Uint8ClampedArray(y*m*4);for(let I=0;I<m*y;++I){const k=[0,0,0,255*u];for(let V=0;V<b;V++){const P=w[I*b+V];if(r.dtype==="float32"){if(P<0||P>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${P}.`)}else if(r.dtype==="int32"&&(P<0||P>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${P}.`);b===1?(k[0]=P*v,k[1]=P*v,k[2]=P*v):k[V]=P*v}const O=I*4;S[O+0]=Math.round(k[0]),S[O+1]=Math.round(k[1]),S[O+2]=Math.round(k[2]),S[O+3]=Math.round(k[3])}i.width=y,i.height=m;const T=new ImageData(S,y,m);return f.putImageData(T,0,0),r}const _xe={kernelName:Loe,backendName:"cpu",kernelFunc:wxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A0(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Ve(r,"sum");let a;r.dtype==="bool"?a=Cc({inputs:{x:r},backend:t,attrs:{dtype:"int32"}}):a=ea({inputs:{x:r},backend:t});const l=a.shape.length,u=dt(i,a.shape),d=Nn(u,l);let f=u,m=a;d!=null&&(m=kr({inputs:{x:a},backend:t,attrs:{perm:d}}),f=Bn(f.length,l)),Fs("sum",f,m.shape.length);const[y,b]=Ss(m.shape,f),w=Gr(m.dtype,"int32");let v=uw(t,y,w);const S=xe(b),T=t.data.get(v.dataId).values,I=t.data.get(m.dataId).values;for(let k=0;k<T.length;++k){const O=k*S;let V=0;for(let P=0;P<S;++P)V+=I[O+P];T[k]=V}if(o){const k=Xn(v.shape,u),O=v;v=pn({inputs:{x:v},backend:t,attrs:{shape:k}}),t.disposeIntermediateTensorInfo(O)}return t.disposeIntermediateTensorInfo(a),d!=null&&t.disposeIntermediateTensorInfo(m),v}const Sxe={kernelName:Q_,backendName:"cpu",kernelFunc:A0};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cxe(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=aA(r,i.length);cA(o.length,l,i);const{path:u,steps:d}=uA(a,l),f=d.length;let m=null,y=o.length;const b=[];for(let w=0;w<f;++w){for(const v of d[w]){const{permutationIndices:S,expandDims:T}=lA(y,l[v]);let I;hA(S)?I=i[v]:(I=kr({inputs:{x:i[v]},backend:t,attrs:{perm:S}}),b.push(I));const k=I.shape.slice();for(let O=0;O<T.length;++O)k.splice(T[O],0,1);zt(I.shape,k)||(I=pn({inputs:{x:I},backend:t,attrs:{shape:k}}),b.push(I)),m===null?m=I:(m=k1({inputs:{a:I,b:m},backend:t}),b.push(m))}w<f-1&&(u[w]>=0&&(m=A0({inputs:{x:m},backend:t,attrs:{axis:u[w]-(o.length-y),keepDims:!1}}),b.push(m)),y--)}for(const w of b)w!==m&&t.disposeIntermediateTensorInfo(w);return m}const Txe={kernelName:VN,backendName:"cpu",kernelFunc:Cxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Exe(n){const{inputs:e,backend:t}=n,{dy:s,y:r}=e;Ve([s,r],"eluGrad");const i=new Float32Array(xe(r.shape)),o=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values;for(let l=0;l<o.length;++l){const u=o[l];u>=0?i[l]=a[l]:i[l]=a[l]*(u+1)}return t.makeTensorInfo(r.shape,"float32",i)}const Ixe={kernelName:UN,backendName:"cpu",kernelFunc:Exe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kxe=eA,Nxe=tA,Axe=nA,Rxe=sA,$xe=rA,Dxe=iA,Oxe=Qt(Dy,n=>{const e=Math.sign(n),t=Math.abs(n),s=1/(1+kxe*t);return e*(1-((((Dxe*s+$xe)*s+Rxe)*s+Axe)*s+Nxe)*s*Math.exp(-t*t))}),Pxe={kernelName:Dy,backendName:"cpu",kernelFunc:Oxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fw(n){const{inputs:e,backend:t,attrs:s}=n,{input:r}=e,{dim:i}=s,o=r.shape.length,a=r.shape.slice();let l=i;return i<0&&(j(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),pn({inputs:{x:r},backend:t,attrs:{shape:a}})}const Mxe={kernelName:v_,backendName:"cpu",kernelFunc:fw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lxe=jn((n,e)=>n/e),jA=hs(Ry,Lxe),hI={kernelName:Ry,backendName:"cpu",kernelFunc:jA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U5(n,e,t){const s=n.shape,r=s[0],i=s[1],o=t.data.get(n.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,u=[r,i],d=xe(u),f=Js("float32",d),m=Js("float32",d);for(let v=0;v<r;v++){const S=xh({inputs:{x:a},backend:t,attrs:{begin:[v,0],size:[1,i]}}),T=xh({inputs:{x:l},backend:t,attrs:{begin:[v,0],size:[1,i]}}),I=Ur({inputs:{real:S,imag:T},backend:t}),{real:k,imag:O}=Fxe(I,e,t),V=el(k,O);for(let P=0;P<i;P++){const D=oA(V,P);f[v*i+P]=D.real,m[v*i+P]=D.imag}t.disposeIntermediateTensorInfo(S),t.disposeIntermediateTensorInfo(T),t.disposeIntermediateTensorInfo(I)}const y=t.makeTensorInfo(u,"float32",f),b=t.makeTensorInfo(u,"float32",m),w=Ur({inputs:{real:y,imag:b},backend:t});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),w}function Fxe(n,e,t){const s=xe(n.shape),r=t.data.get(n.dataId),i=t.data.get(r.complexTensorInfos.real.dataId).values,o=t.data.get(r.complexTensorInfos.imag.dataId).values;if(Vxe(s)){const a=dI(i,o,s,e,t),l=[n.shape[0],n.shape[1]];if(e){const u=t.makeTensorInfo(l,"float32",a.real),d=t.makeTensorInfo(l,"float32",a.imag),f=t.makeTensorInfo([],"float32",Pc(s,"float32")),m=ea({inputs:{x:f},backend:t}),y=hI.kernelFunc({inputs:{a:u,b:f},backend:t}),b=hI.kernelFunc({inputs:{a:d,b:m},backend:t}),w=t.data.get(y.dataId).values,v=t.data.get(b.dataId).values;return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),{real:w,imag:v}}return a}else{const a=el(i,o),l=Uxe(a,s,e);return Zj(l)}}function Vxe(n){return(n&n-1)===0}function dI(n,e,t,s,r){if(t===1)return{real:n,imag:e};const i=el(n,e),o=t/2,a=e6(i),l=a.real,u=a.imag,d=[l.length],f=r.makeTensorInfo(d,"float32",l),m=r.makeTensorInfo(d,"float32",u),y=Ur({inputs:{real:f,imag:m},backend:r}),b=t6(i),w=b.real,v=b.imag,S=[w.length],T=r.makeTensorInfo(S,"float32",w),I=r.makeTensorInfo(S,"float32",v),k=Ur({inputs:{real:T,imag:I},backend:r}),O=dI(l,u,o,s,r),V=O.real,P=O.imag,D=[V.length],$=r.makeTensorInfo(D,"float32",V),R=r.makeTensorInfo(D,"float32",P),A=Ur({inputs:{real:$,imag:R},backend:r}),U=dI(w,v,o,s,r),F=U.real,ne=U.imag,Q=[F.length],G=r.makeTensorInfo(Q,"float32",F),K=r.makeTensorInfo(Q,"float32",ne),J=Ur({inputs:{real:G,imag:K},backend:r}),ce=s6(t,s),z=[ce.real.length],X=r.makeTensorInfo(z,"float32",ce.real),ie=r.makeTensorInfo(z,"float32",ce.imag),se=Ur({inputs:{real:X,imag:ie},backend:r}),ve=k1({inputs:{a:se,b:J},backend:r}),we=Df({inputs:{a:A,b:ve},backend:r}),Se=BA({inputs:{a:A,b:ve},backend:r}),Oe=bh({inputs:{input:we},backend:r}),De=bh({inputs:{input:Se},backend:r}),Ue=Of({inputs:{input:we},backend:r}),Ke=Of({inputs:{input:Se},backend:r}),Xe=Pf({inputs:[Oe,De],backend:r,attrs:{axis:0}}),mt=Pf({inputs:[Ue,Ke],backend:r,attrs:{axis:0}}),kt=r.data.get(Xe.dataId).values,jt=r.data.get(mt.dataId).values;return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(T),r.disposeIntermediateTensorInfo(I),r.disposeIntermediateTensorInfo(k),r.disposeIntermediateTensorInfo($),r.disposeIntermediateTensorInfo(R),r.disposeIntermediateTensorInfo(A),r.disposeIntermediateTensorInfo(G),r.disposeIntermediateTensorInfo(K),r.disposeIntermediateTensorInfo(J),r.disposeIntermediateTensorInfo(X),r.disposeIntermediateTensorInfo(ie),r.disposeIntermediateTensorInfo(se),r.disposeIntermediateTensorInfo(ve),r.disposeIntermediateTensorInfo(we),r.disposeIntermediateTensorInfo(Se),r.disposeIntermediateTensorInfo(Oe),r.disposeIntermediateTensorInfo(Ue),r.disposeIntermediateTensorInfo(De),r.disposeIntermediateTensorInfo(Ke),r.disposeIntermediateTensorInfo(Xe),r.disposeIntermediateTensorInfo(mt),{real:kt,imag:jt}}function Uxe(n,e,t){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let i=0,o=0;for(let a=0;a<e;a++){const l=r6(r*a,e,t),u=oA(n,a);i+=u.real*l.real-u.imag*l.imag,o+=u.real*l.imag+u.imag*l.real}t&&(i/=e,o/=e),n6(s,i,o,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bxe(n){const{inputs:e,backend:t}=n,{input:s}=e,r=xe(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=pn({inputs:{x:s},backend:t,attrs:{shape:[o,i]}}),l=U5(a,!1,t),u=pn({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const zxe={kernelName:BN,backendName:"cpu",kernelFunc:Bxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WA(n){const{backend:e,attrs:t}=n,{shape:s,value:r,dtype:i}=t,o=i||Jf(r),a=Fn(o,xe(s));return Wxe(a,r,o),e.makeTensorInfo(s,o,a)}const jxe={kernelName:zN,backendName:"cpu",kernelFunc:WA};function Wxe(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gxe={kernelName:jN,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,r=t,i=Js(s.dtype,xe(s.shape)),[o,a,l,u]=s.shape,d=r.data.get(s.dataId).values;for(let m=0;m<o;m++){const y=m*l*a*u;for(let b=0;b<a;b++){const w=b*(l*u);for(let v=0;v<l;v++){const S=v*u;for(let T=0;T<u;T++){const I=Math.round(l-v-1),k=y+w+S+T;let O=d[k];if(I>=0&&I<l){const V=I*u,P=y+w+V+T;O=d[P]}i[k]=O}}}}return{dataId:r.write(i,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hxe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:m,activation:y,leakyreluAlpha:b}=s;let w=F5({inputs:{x:r,filter:i},backend:t,attrs:{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:m}});if(o){const v=w;if(d==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const S=pn({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});w=Df({inputs:{a:w,b:S},backend:t}),t.disposeIntermediateTensorInfo(S)}else w=Df({inputs:{a:w,b:o},backend:t});t.disposeIntermediateTensorInfo(v)}if(y){const v=w;if(d==="NCHW"&&y==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const S=pn({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});w=dw(t,w,y,S,b),t.disposeIntermediateTensorInfo(S)}else w=dw(t,w,y,a,b);t.disposeIntermediateTensorInfo(v)}return w}const qxe={kernelName:Gv,backendName:"cpu",kernelFunc:Hxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kxe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:m,activation:y,leakyreluAlpha:b}=s;let w=V5({inputs:{x:r,filter:i},backend:t,attrs:{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:m}});if(o){const v=w;w=Df({inputs:{a:w,b:o},backend:t}),t.disposeIntermediateTensorInfo(v)}if(y){const v=w;w=dw(t,w,y,a,b),t.disposeIntermediateTensorInfo(v)}return w}const Xxe={kernelName:kz,backendName:"cpu",kernelFunc:Kxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yxe(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,i=xe(s.shape),o=r.shape,a=o[o.length-1],[l,u,d,f]=j2(s,r);if(u===0)return t.makeTensorInfo(l,s.dtype,[]);const m=t.data.get(r.dataId).values,y=t.bufferSync(s),b=YG(m,y,s.dtype,u,a,d,f,s.shape,i);return t.makeTensorInfo(l,s.dtype,b.values)}const Qxe={kernelName:uz,backendName:"cpu",kernelFunc:Yxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jxe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:i}=e,{axis:o,batchDims:a}=s;Ve([r,i],"gatherV2");const l=dt(o,r.shape)[0],u=t.data.get(i.dataId).values,d=r.shape[l];for(let k=0;k<u.length;++k){const O=u[k];j(O<=d-1&&O>=0,()=>`GatherV2: the index value ${O} is not in [0, ${d-1}]`)}let f=a;a==null&&(f=0);const m=xe(i.shape),y=fA(r,i,l,f),b=pn({inputs:{x:r},backend:t,attrs:{shape:[y.batchSize,y.outerSize,y.dimSize,y.sliceSize]}}),w=pn({inputs:{x:i},backend:t,attrs:{shape:[y.batchSize,m/y.batchSize]}}),v=[y.batchSize,y.outerSize,m/y.batchSize,y.sliceSize],S=t.bufferSync(w),T=t.bufferSync(b),I=QG(T,S,v);return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(w),t.makeTensorInfo(y.outputShape,I.dtype,I.values)}const Zxe={kernelName:__,backendName:"cpu",kernelFunc:Jxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eve(n){const{inputs:e,backend:t}=n,{input:s}=e,r=xe(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=pn({inputs:{x:s},backend:t,attrs:{shape:[o,i]}}),l=U5(a,!0,t),u=pn({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const tve={kernelName:WN,backendName:"cpu",kernelFunc:eve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nve=Qt(Uy,n=>Number.isFinite(n)?1:0,"bool"),sve={kernelName:Uy,backendName:"cpu",kernelFunc:nve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rve=Qt(By,n=>Math.abs(n)===1/0?1:0,"bool"),ive={kernelName:By,backendName:"cpu",kernelFunc:rve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ove=Qt(zy,n=>Number.isNaN(n)?1:0,"bool"),ave={kernelName:zy,backendName:"cpu",kernelFunc:ove};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lve(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:i}=t,o=n5(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const cve={kernelName:hz,backendName:"cpu",kernelFunc:lve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uve=Qt(Wy,n=>Math.log1p(n)),hve={kernelName:Wy,backendName:"cpu",kernelFunc:uve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dve=jn((n,e)=>n&&e),fve=hs(I_,dve,null,"bool"),pve={kernelName:I_,backendName:"cpu",kernelFunc:fve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mve=Qt(k_,n=>n?0:1,"bool"),gve={kernelName:k_,backendName:"cpu",kernelFunc:mve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yve=jn((n,e)=>n||e),bve=hs(N_,yve,null,"bool"),xve={kernelName:N_,backendName:"cpu",kernelFunc:bve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vve(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s;Ve(r,"LRN");const u=r.shape[3],d=u-1,f=t.data.get(r.dataId).values,m=xe(r.shape),y=new Float32Array(m);function b(w){const v=w%u;let S=w-v+Math.max(0,v-i);const T=w-v+Math.min(v+i,d);let I=0;for(;S<=T;S++){const k=f[S];I+=k*k}return I}for(let w=0;w<m;w++){const v=b(w),S=f[w]*Math.pow(o+a*v,-l);y[w]=S}return t.makeTensorInfo(r.shape,r.dtype,y)}const wve={kernelName:A_,backendName:"cpu",kernelFunc:vve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ve(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:d}=s;Ve(o,"LRNGrad");const f=xe(o.shape),m=o.shape[3],y=t.data.get(o.dataId).values,b=t.data.get(r.dataId).values,w=t.data.get(i.dataId).values,v=new Float32Array(f),S=f;for(let T=0;T<S;T++){const I=T%m,k=T-I+Math.max(0,I-a),O=T-I+Math.min(m,I+a+1);let V=0;for(let P=k;P<O;P++)V+=Math.pow(b[P],2);V=u*V+l;for(let P=k;P<O;P++){let D=-2*u*d*b[P]*w[T]/V;T===P&&(D+=Math.pow(V,-d)),D*=y[T],v[P]+=D}}return t.makeTensorInfo(o.shape,r.dtype,v)}const Sve={kernelName:HN,backendName:"cpu",kernelFunc:_ve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B5(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=t;let l=r.shape;const u=l.length,d=dt(i,l);let f=d;const m=Nn(f,u);let y=a.data.get(r.dataId).values;if(m!=null){const k=new Array(u);for(let O=0;O<k.length;O++)k[O]=l[m[O]];y=VA(y,l,r.dtype,m,k),f=Bn(f.length,u),l=k}Ve(r,"max"),Fs("max",f,u);const[b,w]=Ss(l,f),v=xe(w),S=r5(y,v,b,r.dtype),T=a.write(S,b,r.dtype);let I=b;return o&&(I=Xn(b,d)),{dataId:T,shape:I,dtype:r.dtype}}const Cve={kernelName:R_,backendName:"cpu",kernelFunc:B5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tve(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Ve(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;j(tr(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=Mi(r.shape,i,o,u,a,l);let f;if(d.filterWidth===1&&d.filterHeight===1&&zt(d.inShape,d.outShape))f=ea({inputs:{x:r},backend:t});else{const m=t.data.get(r.dataId).values,y=je(r.shape),b=zA(m,r.shape,r.dtype,y,d,"max");f=t.makeTensorInfo(d.outShape,r.dtype,b.values)}return f}const Eve={kernelName:$_,backendName:"cpu",kernelFunc:Tve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ive(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;Ve(r,"maxPool3d");const d=ol(r.shape,i,o,1,a,l,u),f=t.data.get(r.dataId).values,m=L5(f,r.shape,r.dtype,je(r.shape),d,"max");return t.makeTensorInfo(m.shape,"float32",m.values)}const kve={kernelName:D_,backendName:"cpu",kernelFunc:Ive};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nve(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;Ve([r,i],"maxPool3DGrad");const d=ol(i.shape,o,a,1,l,u),f=t.bufferSync(i),m=ybe(f,d),y=d.strideDepth,b=d.strideHeight,w=d.strideWidth,v=d.dilationDepth,S=d.dilationHeight,T=d.dilationWidth,I=d.effectiveFilterDepth,k=d.effectiveFilterHeight,O=d.effectiveFilterWidth,V=I-1-d.padInfo.front,P=O-1-d.padInfo.left,D=k-1-d.padInfo.top,$=ht(i.shape,"float32"),R=t.bufferSync(r);for(let A=0;A<d.batchSize;++A)for(let U=0;U<d.inChannels;++U)for(let F=0;F<d.inDepth;++F)for(let ne=0;ne<d.inHeight;++ne)for(let Q=0;Q<d.inWidth;++Q){const G=F-V,K=ne-D,J=Q-P;let ce=0;for(let z=0;z<I;z+=v){const X=(G+z)/y;if(!(X<0||X>=d.outDepth||Math.floor(X)!==X))for(let ie=0;ie<k;ie+=S){const se=(K+ie)/b;if(!(se<0||se>=d.outHeight||Math.floor(se)!==se))for(let ve=0;ve<O;ve+=T){const we=(J+ve)/w;if(we<0||we>=d.outWidth||Math.floor(we)!==we)continue;const Se=I*k*O-1-m.get(A,X,se,we,U),Oe=z*k*O+ie*O+ve,De=Se===Oe?1:0;if(De===0)continue;const Ue=R.get(A,X,se,we,U);ce+=Ue*De}}}$.set(ce,A,F,ne,Q,U)}return t.makeTensorInfo($.shape,$.dtype,$.values)}const Ave={kernelName:KN,backendName:"cpu",kernelFunc:Nve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rve(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i,output:o}=e,a=i;Ve([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:d,dimRoundingMode:f}=s,m=Mi(a.shape,l,u,1,d,f),y=t.data.get(a.dataId).values,b=ht(m.outShape,a.dtype,M5(y,a.shape,a.dtype,m).values),w=m.strideHeight,v=m.strideWidth,S=m.dilationHeight,T=m.dilationWidth,I=m.effectiveFilterHeight,k=m.effectiveFilterWidth,O=k-1-m.padInfo.left,V=I-1-m.padInfo.top,P=ht(a.shape,"float32"),D=t.data.get(r.dataId).values,$=ht(r.shape,"float32",D);for(let R=0;R<m.batchSize;++R)for(let A=0;A<m.inChannels;++A)for(let U=0;U<m.inHeight;++U)for(let F=0;F<m.inWidth;++F){const ne=U-V,Q=F-O;let G=0;for(let K=0;K<I;K+=S){const J=(ne+K)/w;if(!(J<0||J>=m.outHeight||Math.floor(J)!==J))for(let ce=0;ce<k;ce+=T){const z=(Q+ce)/v;if(z<0||z>=m.outWidth||Math.floor(z)!==z)continue;const X=I*k-1-b.get(R,J,z,A),ie=K*k+ce,se=X===ie?1:0;if(se===0)continue;const ve=$.get(R,J,z,A);G+=ve*se}}P.set(G,R,U,F,A)}return t.makeTensorInfo(P.shape,P.dtype,P.values)}const $ve={kernelName:qN,backendName:"cpu",kernelFunc:Rve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dve(n,e,t,s,r){const i=je(e),o=zA(n,e,t,i,r,"max"),a=M5(n,e,t,r,!0,s);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ove={kernelName:dz,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;Ve(s,"MaxPoolWithArgmax");const u=l.data.get(s.dataId).values,d=Mi(s.shape,r,i,[1,1],o),[f,m]=Dve(u,s.shape,s.dtype,a,d),y=l.write(f,d.outShape,s.dtype),b=l.write(m,d.outShape,s.dtype);return[{dataId:y,shape:d.outShape,dtype:s.dtype},{dataId:b,shape:d.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pve(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=dt(i,r.shape),u=Ss(r.shape,a)[1],d=xe(u),f=[],m=t.makeTensorInfo([],"float32",new Float32Array([d]));f.push(m);const y=Cc({inputs:{x:r},backend:t,attrs:{dtype:"float32"}});f.push(y);const b=jA({inputs:{a:y,b:m},backend:t});f.push(b);const w=A0({inputs:{x:b},backend:t,attrs:{axis:i,keepDims:o}});return f.forEach(v=>t.disposeIntermediateTensorInfo(v)),w}const Mve={kernelName:O_,backendName:"cpu",kernelFunc:Pve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lve(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Ve(r,"min");const a=dt(i,r.shape);let l=a;const u=Nn(l,r.shape.length);let d=r;u!=null&&(d=kr({inputs:{x:r},backend:t,attrs:{perm:u}}),l=Bn(l.length,r.shape.length)),Fs("min",l,d.shape.length);const[f,m]=Ss(d.shape,l),y=xe(m),b=Zs(xe(f),d.dtype),w=t.data.get(d.dataId).values;for(let S=0;S<b.length;++S){const T=S*y;let I=w[T];for(let k=0;k<y;++k){const O=w[T+k];(Number.isNaN(O)||O<I)&&(I=O)}b[S]=I}u!=null&&t.disposeIntermediateTensorInfo(d);const v=t.makeTensorInfo(f,d.dtype,b);if(o){const S=Xn(f,a),T=pn({inputs:{x:v},backend:t,attrs:{shape:S}});return t.disposeIntermediateTensorInfo(v),T}return v}const Fve={kernelName:P_,backendName:"cpu",kernelFunc:Lve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vve(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,mode:o}=s;Ve(r,"mirrorPad");const a=i.map((I,k)=>I[0]+r.shape[k]+I[1]),l=i.map(I=>I[0]),u=i.map((I,k)=>I[0]+r.shape[k]),d=o==="reflect"?0:1,f=t.data.get(r.dataId).values,m=r.shape.length,y=je(r.shape),b=xe(a),w=a.length,v=je(a),S=Js(r.dtype,b);for(let I=0;I<b;I++){let k=Zf(I,w,v);for(let V=0;V<w;V++)k[V]<l[V]?k[V]=l[V]*2-k[V]-d:k[V]>=u[V]&&(k[V]=(u[V]-1)*2-k[V]+d);k=k.map((V,P)=>V-l[P]);const O=zo(k,m,y);S[I]=f[O]}return{dataId:t.write(S,a,r.dtype),shape:a,dtype:r.dtype}}const Uve={kernelName:M_,backendName:"cpu",kernelFunc:Vve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bve=jn((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e}),zve=hs(qy,Bve),jve={kernelName:qy,backendName:"cpu",kernelFunc:zve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z5(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:i}=s,o=r.shape.length;let a=i;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=dt([a],r.shape),u=B5({inputs:{x:r},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),d=Xn(u.shape,l),f=pn({inputs:{x:u},backend:t,attrs:{shape:d}}),m=BA({inputs:{a:r,b:f},backend:t}),y=HG({inputs:{x:m},backend:t}),b=A0({inputs:{x:y},backend:t,attrs:{axis:l,keepDims:!1}}),w=pn({inputs:{x:b},backend:t,attrs:{shape:d}}),v=jA({inputs:{a:y,b:w},backend:t});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(w),v}const Wve={kernelName:e1,backendName:"cpu",kernelFunc:z5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gve(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s;Ve(r,"multinomial");const l=a?r:z5({inputs:{logits:r},backend:t,attrs:{dim:-1}}),u=l.shape[0],d=l.shape[1],f=t.data.get(l.dataId).values,m=[u,i],y=Zs(xe(m),"int32");for(let b=0;b<u;++b){const w=b*d,v=new Float32Array(d-1);v[0]=f[w];for(let I=1;I<v.length;++I)v[I]=v[I-1]+f[w+I];const S=k2.alea(o.toString()),T=b*i;for(let I=0;I<i;++I){const k=S();y[T+I]=v.length;for(let O=0;O<v.length;O++)if(k<v[O]){y[T+I]=O;break}}}return a||t.disposeIntermediateTensorInfo(l),t.makeTensorInfo(m,"int32",y)}const Hve={kernelName:fz,backendName:"cpu",kernelFunc:Gve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qve=L2;function Kve(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s;Ve(r,"NonMaxSuppression");const u=t.data.get(r.dataId).values,d=t.data.get(i.dataId).values,{selectedIndices:f}=qve(u,d,o,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const Xve={kernelName:XN,backendName:"cpu",kernelFunc:Kve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yve=F2;function Qve(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s;Ve(r,"NonMaxSuppressionPadded");const d=t.data.get(r.dataId).values,f=t.data.get(i.dataId).values,{selectedIndices:m,validOutputs:y}=Yve(d,f,o,a,l,u);return[t.makeTensorInfo([m.length],"int32",new Int32Array(m)),t.makeTensorInfo([],"int32",new Int32Array([y]))]}const Jve={kernelName:YN,backendName:"cpu",kernelFunc:Qve};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zve=V2;function ewe(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s;Ve(r,"NonMaxSuppressionWithScore");const d=t.data.get(r.dataId).values,f=t.data.get(i.dataId).values,m=o,y=a,b=l,w=u,{selectedIndices:v,selectedScores:S}=Zve(d,f,m,y,b,w);return[t.makeTensorInfo([v.length],"int32",new Int32Array(v)),t.makeTensorInfo([S.length],"float32",new Float32Array(S))]}const twe={kernelName:QN,backendName:"cpu",kernelFunc:ewe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nwe(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s;Ve(r,"oneHot");const u=xe(r.shape),d=new Float32Array(u*o);d.fill(l);const f=t.data.get(r.dataId).values;for(let m=0;m<u;++m)f[m]>=0&&f[m]<o&&(d[m*o+f[m]]=a);return t.makeTensorInfo([...r.shape,o],i,d)}const swe={kernelName:U_,backendName:"cpu",kernelFunc:nwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pw(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=bh({inputs:{input:s},backend:t}),i=pw({inputs:{x:r},backend:t}),o=Of({inputs:{input:s},backend:t}),a=pw({inputs:{x:o},backend:t}),l=Ur({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return WA({backend:t,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const rwe={kernelName:s1,backendName:"cpu",kernelFunc:pw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j5(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=bh({inputs:{input:s},backend:t}),i=j5({inputs:{x:r},backend:t}),o=Of({inputs:{input:s},backend:t}),a=pw({inputs:{x:o},backend:t}),l=Ur({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return WA({backend:t,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const iwe={kernelName:V_,backendName:"cpu",kernelFunc:j5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W5(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return fw({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(d=>{bN(i,d.shape,"All tensors passed to stack must have matching shapes"),j(o===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const f=fw({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(f),f}),u=Pf({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const owe={kernelName:B_,backendName:"cpu",kernelFunc:W5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function awe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,constantValue:o}=s;Ve(r,"pad");const a=i.map((T,I)=>T[0]+r.shape[I]+T[1]),l=i.map(T=>T[0]),u=t.data.get(r.dataId).values,d=xe(r.shape),f=r.shape.length,m=je(r.shape),y=xe(a),b=a.length,w=je(a),v=Js(r.dtype,y);o!==0&&v.fill(o);for(let T=0;T<d;T++){const k=Zf(T,f,m).map((V,P)=>V+l[P]),O=zo(k,b,w);v[O]=u[T]}return{dataId:t.write(v,a,r.dtype),shape:a,dtype:r.dtype}}const G5={kernelName:z_,backendName:"cpu",kernelFunc:awe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lwe=jn((n,e)=>Math.pow(n,e)),cwe=hs(Xy,lwe),uwe={kernelName:Xy,backendName:"cpu",kernelFunc:cwe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hwe(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(S=>t.data.get(S.dataId).values),u=r.map(S=>S.shape),d=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,[m,y,b]=u5(l,u,d,i.shape,i.dtype,f,o.shape),w=m.map(S=>t.makeTensorInfo([S.length],"int32",S)),v=t.makeTensorInfo(b,i.dtype,y);return w.concat([v])}const dwe={kernelName:pz,backendName:"cpu",kernelFunc:hwe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fwe(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:i}=e,o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,d]=h5(o,s.shape,s.dtype,a,r.shape,l,i.shape),f=t.makeTensorInfo([u.length],"int32",u),m=t.makeTensorInfo([d.length],s.dtype,d);return[f,m]}const pwe={kernelName:mz,backendName:"cpu",kernelFunc:fwe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mwe(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=t.data.get(r.dataId).values,d=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,m=a.map(v=>t.data.get(v.dataId).values),y=a.map(v=>v.shape),[b,w]=d5(u,r.shape,d,i.shape,i.dtype,f,o.shape,m,y,l);return t.makeTensorInfo(b,i.dtype,w)}const gwe={kernelName:gz,backendName:"cpu",kernelFunc:mwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ywe(n){const{backend:e,attrs:t}=n,{start:s,stop:r,dtype:i,step:o}=t,a=f5(s,r,o,i);return e.makeTensorInfo([a.length],i,a)}const bwe={kernelName:JN,backendName:"cpu",kernelFunc:ywe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xwe=Qt(Yy,n=>1/n),vwe={kernelName:Yy,backendName:"cpu",kernelFunc:xwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wwe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;Ve(r,"resizeBilinear");const l=je(r.shape),[u,d]=a,[f,m,y,b]=r.shape,w=t.data.get(r.dataId).values,v=new Float32Array(xe([f,u,d,b])),S=[i&&u>1?m-1:m,i&&d>1?y-1:y],T=[i&&u>1?u-1:u,i&&d>1?d-1:d];let I=0;const k=S[0]/T[0],O=S[1]/T[1];for(let V=0;V<f;V++)for(let P=0;P<u;P++){let D;o?D=k*(P+.5)-.5:D=k*P;const $=Math.max(0,Math.floor(D)),R=D-$,A=Math.min(m-1,Math.ceil(D)),U=V*l[0]+$*l[1],F=V*l[0]+A*l[1];for(let ne=0;ne<d;ne++){let Q;o?Q=O*(ne+.5)-.5:Q=O*ne;const G=Math.max(0,Math.floor(Q)),K=Q-G,J=Math.min(y-1,Math.ceil(Q)),ce=U+G*l[2],z=F+G*l[2],X=U+J*l[2],ie=F+J*l[2];for(let se=0;se<b;se++){const ve=w[ce+se],we=w[z+se],Se=w[X+se],Oe=w[ie+se],De=ve+(Se-ve)*K,Ue=we+(Oe-we)*K,Ke=De+(Ue-De)*R;v[I++]=Ke}}}return t.makeTensorInfo([f,u,d,b],"float32",v)}const _we={kernelName:q_,backendName:"cpu",kernelFunc:wwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Swe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s;Ve([i,r],"resizeBilinearGrad");const a=je(r.shape),[l,u,d,f]=r.shape,[,m,y]=i.shape,b=new Float32Array(l*u*d*f),w=[o&&m>1?u-1:u,o&&y>1?d-1:d],v=[o&&m>1?m-1:m,o&&y>1?y-1:y],S=w[0]/v[0],T=w[1]/v[1],I=t.data.get(i.dataId).values;let k=0;for(let O=0;O<l;O++){const V=O*a[0];for(let P=0;P<m;P++){const D=P*S,$=Math.floor(D),R=Math.min(Math.ceil(D),u-1),A=V+$*a[1],U=V+R*a[1],F=D-$,ne=1-F;for(let Q=0;Q<y;Q++){const G=Q*T,K=Math.floor(G),J=Math.min(Math.ceil(G),d-1),ce=G-K,z=1-ce,X=A+K*a[2],ie=A+J*a[2],se=U+K*a[2],ve=U+J*a[2],we=ne*z,Se=ne*ce,Oe=F*z,De=F*ce;for(let Ue=0;Ue<f;Ue++){const Ke=I[k++];b[X+Ue]+=Ke*we,b[ie+Ue]+=Ke*Se,b[se+Ue]+=Ke*Oe,b[ve+Ue]+=Ke*De}}}}return t.makeTensorInfo([l,d,u,f],"float32",b)}const Cwe={kernelName:t2,backendName:"cpu",kernelFunc:Swe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Twe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;Ve(r,"resizeNearestNeighbor");const l=je(r.shape),[u,d]=a,[f,m,y,b]=r.shape,w=t.data.get(r.dataId).values,v=new Float32Array(f*u*d*b),S=[i&&u>1?m-1:m,i&&d>1?y-1:y],T=[i&&u>1?u-1:u,i&&d>1?d-1:d],I=S[0]/T[0],k=S[1]/T[1];let O=0;for(let V=0;V<f;V++){const P=V*l[0];for(let D=0;D<u;D++){const $=o?I*(D+.5):I*D;let R=Math.min(m-1,i?Math.round($):Math.floor($));o&&(R=Math.max(0,R));const A=P+R*l[1];for(let U=0;U<d;U++){const F=o?k*(U+.5):k*U;let ne=Math.min(y-1,i?Math.round(F):Math.floor(F));o&&(ne=Math.max(0,ne));const Q=A+ne*l[2];for(let G=0;G<b;G++){const K=w[Q+G];v[O++]=K}}}}return t.makeTensorInfo([f,u,d,b],r.dtype,v)}const Ewe={kernelName:H_,backendName:"cpu",kernelFunc:Twe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iwe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s;Ve([i,r],"resizeNearestNeighborGrad");const a=je(r.shape),l=je(i.shape),[u,d,f,m]=r.shape,[,y,b]=i.shape,w=new Float32Array(u*d*f*m),v=t.data.get(i.dataId).values,S=[o&&y>1?d-1:d,o&&b>1?f-1:f],T=[o&&y>1?y-1:y,o&&b>1?b-1:b],I=S[0]/T[0],k=S[1]/T[1],O=1/I,V=1/k,P=Math.ceil(O)*2+2,D=Math.ceil(V)*2+2;for(let $=0;$<u;$++){const R=$*a[0];for(let A=0;A<d;A++){const U=R+A*a[1],F=Math.floor(A*O),ne=Math.floor(F-P/2);for(let Q=0;Q<f;Q++){const G=U+Q*a[2],K=Math.floor(Q*V),J=Math.floor(K-D/2);for(let ce=0;ce<m;ce++){let z=0;for(let X=0;X<P;X++){const ie=X+ne;if(ie<0||ie>=y)continue;const se=R+ie*l[1],ve=ie*I,we=Math.min(d-1,o?Math.round(ve):Math.floor(ve));if(A===we)for(let Se=0;Se<D;Se++){const Oe=Se+J;if(Oe<0||Oe>=b)continue;const De=se+Oe*l[2],Ue=Oe*k,Ke=Math.min(f-1,o?Math.round(Ue):Math.floor(Ue));Q===Ke&&(z+=v[De+ce])}}w[G+ce]=z}}}}return t.makeTensorInfo(r.shape,r.dtype,w)}const kwe={kernelName:e2,backendName:"cpu",kernelFunc:Iwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nwe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:i}=s;Ve(r,"reverse");const o=r.shape.length,a=dt(i,r.shape);if(o===0)return ea({inputs:{x:r},backend:t});const l=new Ms(r.shape,r.dtype),u=t.bufferSync(r);for(let d=0;d<l.size;d++){const f=l.indexToLoc(d),m=f.slice();a.forEach(y=>m[y]=r.shape[y]-1-m[y]),l.set(u.get(...m),...f)}return t.makeTensorInfo(l.shape,l.dtype,l.values)}const Awe={kernelName:K_,backendName:"cpu",kernelFunc:Nwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rwe={kernelName:l2,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=e,a=t,l=Js(s.dtype,xe(s.shape)),[u,d,f,m]=s.shape,[y,b]=Q2(o,d,f),w=255,v=Math.sin(r),S=Math.cos(r),T=a.data.get(s.dataId).values;for(let k=0;k<u;k++){const O=k*f*d*m;for(let V=0;V<d;V++){const P=V*(f*m);for(let D=0;D<f;D++){const $=D*m;for(let R=0;R<m;R++){const A=[u,V,D,R],U=A[2],F=A[1];let ne=(U-y)*S-(F-b)*v,Q=(U-y)*v+(F-b)*S;ne=Math.round(ne+y),Q=Math.round(Q+b);let G=i;if(typeof i!="number"&&(R===3?G=w:G=i[R]),ne>=0&&ne<f&&Q>=0&&Q<d){const J=Q*(f*m),ce=ne*m,z=O+J+ce+R;G=T[z]}const K=O+P+$+R;l[K]=G}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $we=Qt(Zy,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),Dwe={kernelName:Zy,backendName:"cpu",kernelFunc:$we};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Owe(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=Rh(i,r,o),m=!0,y=t.bufferSync(r),b=t.bufferSync(i),w=Bu(y,b,o,f,u,l,a,d,0,m);return t.makeTensorInfo(o,w.dtype,w.values)}const Pwe={kernelName:yz,backendName:"cpu",kernelFunc:Owe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mwe(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<e?t=r+1:s=r;return s}function Lwe(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<=e?t=r+1:s=r;return s}function Fwe(n,e,t,s,r,i){const o=Fn("int32",t*r);for(let a=0;a<t;++a){const l=n.slice(a*s,(a+1)*s),u=a*r;for(let d=0;d<r;++d)o[u+d]=i==="left"?Mwe(l,e[d+u]):Lwe(l,e[d+u])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vwe(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:i}=e,{side:o}=s,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,u=Fwe(a,l,r.shape[0],r.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",u)}const Uwe={kernelName:xz,backendName:"cpu",kernelFunc:Vwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bwe(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:i}=e;Ve([s,r,i],"select");const o=s.shape.length,a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,d=Gr(r.dtype,i.dtype),f=Zs(xe(r.shape),d);let m=0;const y=o===0||o>1||r.shape.length===1?1:xe(r.shape.slice(1));for(let b=0;b<a.length;b++)for(let w=0;w<y;w++)a[b]===1?f[m++]=l[b]:f[m++]=u[b];return t.makeTensorInfo(r.shape,d,f)}const zwe={kernelName:X_,backendName:"cpu",kernelFunc:Bwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jwe=m1,Wwe=g1,Gwe=Qt(t0,n=>n>=0?Wwe*n:jwe*(Math.exp(n)-1)),Hwe={kernelName:t0,backendName:"cpu",kernelFunc:Gwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qwe=Qt(r0,n=>n<0?-1:n>0?1:0),Kwe={kernelName:r0,backendName:"cpu",kernelFunc:qwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xwe=Qt(n0,n=>Math.sin(n)),Ywe={kernelName:n0,backendName:"cpu",kernelFunc:Xwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qwe=Qt(s0,n=>Math.sinh(n)),Jwe={kernelName:s0,backendName:"cpu",kernelFunc:Qwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zwe=11920928955078125e-23,LF=Math.log(Zwe)+2,e_e=Qt(o0,n=>{const e=n>-LF,t=n<LF,s=Math.exp(n);let r;return t?r=s:e?r=n:r=Math.log(1+s),r}),t_e={kernelName:o0,backendName:"cpu",kernelFunc:e_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n_e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,paddings:o}=s;Ve([r],"spaceToBatchND");const a=xe(i),l=[[0,0]];l.push(...o);for(let V=1+i.length;V<r.shape.length;++V)l.push([0,0]);const u=G5.kernelFunc({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),d=x0(u.shape,i,a,!1),f=v0(d.length,i.length,!1),m=w0(u.shape,i,a,!1),w=pn({inputs:{x:u},backend:t,attrs:{shape:d}}),T=kr({inputs:{x:w},backend:t,attrs:{perm:f}}),O=pn({inputs:{x:T},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(T),O}const s_e={kernelName:J_,backendName:"cpu",kernelFunc:n_e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r_e(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,d=t.data.get(o.dataId).values[0],[f,m,y,b,w]=y5(a,s.shape,s.dtype,l,r.dtype,u,d);return[t.makeTensorInfo(m,s.dtype,f),t.makeTensorInfo([m[0]],r.dtype,y),t.makeTensorInfo([b.length],"bool",new Uint8Array(b.map(v=>Number(v)))),t.makeTensorInfo([w.length],s.dtype,new Int32Array(w))]}const i_e={kernelName:vz,backendName:"cpu",kernelFunc:r_e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o_e(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.data.get(r.dataId).values),a=t.data.get(s.dataId).values,l=Array.from(t.data.get(i.dataId).values),[u,d,f]=b5(a,s.shape,s.dtype,o,l);return[t.makeTensorInfo(d,s.dtype,u),t.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}const a_e={kernelName:wz,backendName:"cpu",kernelFunc:o_e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l_e(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,d]=UA(o,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(d,s.dtype,u)}const c_e={kernelName:_z,backendName:"cpu",kernelFunc:l_e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u_e(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,d]=UA(o,s.shape,s.dtype,a,l);return t.makeTensorInfo(d,s.dtype,u)}const h_e={kernelName:Sz,backendName:"cpu",kernelFunc:u_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d_e(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:d,strides:f,outputSize:m}=Rh(i,r,a),y=!1,b=t.bufferSync(r);let w;switch(i.dtype){case"bool":{const v=t.bufferSync(i),S=!!t.data.get(o.dataId).values[0];w=Bu(b,v,a,m,d,u,l,f,S,y);break}case"float32":{const v=t.bufferSync(i),S=t.data.get(o.dataId).values[0];w=Bu(b,v,a,m,d,u,l,f,S,y);break}case"int32":{const v=t.bufferSync(i),S=t.data.get(o.dataId).values[0];w=Bu(b,v,a,m,d,u,l,f,S,y);break}case"string":{const v=t.bufferSync(i),S=xc(t.data.get(o.dataId).values[0]);w=Bu(b,v,a,m,d,u,l,f,S,y);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return t.makeTensorInfo(a,w.dtype,w.values)}const f_e={kernelName:Cz,backendName:"cpu",kernelFunc:d_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p_e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=dt(o,r.shape)[0],l=dA(r,i,a),u=new Array(r.shape.length).fill(0),d=r.shape.slice();return l.map(f=>{const m=[...d];m[a]=f;const y=xh({inputs:{x:r},backend:t,attrs:{begin:u,size:m}});return u[a]+=f,y})}const m_e={kernelName:Z_,backendName:"cpu",kernelFunc:p_e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g_e={kernelName:n2,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,s=e;Ve(t,"square");const r=s.data.get(t.dataId).values,i=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];i[a]=l*l}return{dataId:s.write(i,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y_e=Qt(f0,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),b_e={kernelName:f0,backendName:"cpu",kernelFunc:y_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x_e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:m}=s;Ve(r,"stridedSlice");const{finalShapeSparse:y,finalShape:b,isIdentity:w,sliceDim0:v,isSimpleSlice:S,begin:T,end:I,strides:k}=K2(r.shape,i,o,a,l,u,d,f,m);let O;if(w)O=pn({inputs:{x:r},backend:t,attrs:{shape:b}});else if(v||S){j(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const V=G2(T,I,k),P=xh({inputs:{x:r},backend:t,attrs:{begin:T,size:V}});O=pn({inputs:{x:P},backend:t,attrs:{shape:b}}),t.disposeIntermediateTensorInfo(P)}else{const V=t.bufferSync(r),P=w5(y,V,k,T);O=t.makeTensorInfo(b,P.dtype,P.values)}return O}const v_e={kernelName:r2,backendName:"cpu",kernelFunc:x_e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w_e(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:d,dataSplits:f}=e,m=t.data.get(d.dataId).values,y=t.data.get(f.dataId).values,[b,w]=_5(m,y,r,i,o,a,l,u);return[t.makeTensorInfo([b.length],"string",b),t.makeTensorInfo(f.shape,"int32",w)]}const __e={kernelName:Tz,backendName:"cpu",kernelFunc:w_e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S_e(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values[0],[u,d,f]=S5(a,l,r),m=d.length;return[t.makeTensorInfo([m,2],"int32",u),t.makeTensorInfo([m],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const C_e={kernelName:Ez,backendName:"cpu",kernelFunc:S_e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T_e(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=t.data.get(i.dataId).values,a=C5(o,r);return t.makeTensorInfo(i.shape,"int32",a)}const E_e={kernelName:Iz,backendName:"cpu",kernelFunc:T_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I_e=Qt(u0,n=>Math.tan(n)),k_e={kernelName:u0,backendName:"cpu",kernelFunc:I_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N_e=Qt(h0,n=>Math.tanh(n)),A_e={kernelName:h0,backendName:"cpu",kernelFunc:N_e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R_e(n){const{inputs:e,backend:t}=n,{tensor:s,indices:r,updates:i}=e,{sliceRank:o,numUpdates:a,sliceSize:l,strides:u,outputSize:d}=Rh(i,r,s.shape),f=!1,m=t.bufferSync(r),y=t.bufferSync(i),b=t.bufferSync(s),w=Bu(m,y,s.shape,d,l,a,o,u,b,f);return t.makeTensorInfo(s.shape,w.dtype,w.values)}const $_e={kernelName:bz,backendName:"cpu",kernelFunc:R_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D_e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:i}=s;Ve(r,"tile");const o=E5(t.bufferSync(r),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}const O_e={kernelName:d0,backendName:"cpu",kernelFunc:D_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P_e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:i,sorted:o}=s;Ve(r,"topk");const a=t.data.get(r.dataId).values,[l,u]=k5(a,r.shape,r.dtype,i,o);return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(u.shape,u.dtype,u.values)]}const M_e={kernelName:i2,backendName:"cpu",kernelFunc:P_e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L_e(n){const{inputs:e,attrs:t,backend:s}=n,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=t,[d,f,m,y]=r.shape,[b,w]=u??[f,m],v=[d,b,w,y],S=je(r.shape),T=S[0],I=S[1],k=S[2],O=je(v),V=O[0],P=O[1],D=O[2],$=Js(r.dtype,xe(v));$.fill(l);const R=s.data.get(r.dataId).values,A=s.data.get(i.dataId).values;for(let F=0;F<d;++F){const ne=i.shape[0]===1?A:A.subarray(F*8,F*8+8);for(let Q=0;Q<b;++Q)for(let G=0;G<w;++G)for(let K=0;K<y;++K){let J;const ce=ne[6]*G+ne[7]*Q+1;if(ce===0)continue;const z=(ne[0]*G+ne[1]*Q+ne[2])/ce,X=(ne[3]*G+ne[4]*Q+ne[5])/ce,ie=FF(z,m,a),se=FF(X,f,a);switch(o){case"nearest":J=j_e(R,f,m,T,I,k,F,se,ie,K,l);break;case"bilinear":J=W_e(R,f,m,T,I,k,F,se,ie,K,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const ve=F*V+Q*P+G*D+K;$[ve]=J}return s.makeTensorInfo(v,r.dtype,$)}return{dataId:s.write($,v,r.dtype),shape:r.shape,dtype:r.dtype}}const F_e={kernelName:o2,backendName:"cpu",kernelFunc:L_e};function FF(n,e,t){switch(t){case"reflect":return V_e(n,e);case"wrap":return U_e(n,e);case"nearest":return z_e(n,e);case"constant":default:return B_e(n)}}function V_e(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=2*e;t<s&&(t=s*Math.trunc(-t/s)+t),t=t<-e?t+s:-t-1}else if(t>e-1)if(e<=1)t=0;else{const s=2*e;t-=s*Math.trunc(t/s),t>=e&&(t=s-t-1)}return oh(0,t,e-1)}function U_e(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=e-1;t+=e*(Math.trunc(-t/s)+1)}else if(t>e-1)if(e<=1)t=0;else{const s=e-1;t-=e*Math.trunc(t/s)}return oh(0,t,e-1)}function B_e(n,e){return n}function z_e(n,e){return oh(0,n,e-1)}function Hm(n,e,t,s,r,i,o,a,l,u,d){const f=o*s+a*r+l*i+u;return 0<=a&&a<e&&0<=l&&l<t?n[f]:d}function j_e(n,e,t,s,r,i,o,a,l,u,d){const f=Math.round(a),m=Math.round(l);return Hm(n,e,t,s,r,i,o,f,m,u,d)}function W_e(n,e,t,s,r,i,o,a,l,u,d){const f=Math.floor(a),m=Math.floor(l),y=f+1,b=m+1,w=(b-l)*Hm(n,e,t,s,r,i,o,f,m,u,d)+(l-m)*Hm(n,e,t,s,r,i,o,f,b,u,d),v=(b-l)*Hm(n,e,t,s,r,i,o,y,m,u,d)+(l-m)*Hm(n,e,t,s,r,i,o,y,b,u,d);return(y-a)*w+(a-f)*v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G_e(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:i}=e;Ve(i,"unique");const o=s.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:u}=N5(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const H_e={kernelName:a2,backendName:"cpu",kernelFunc:G_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q_e(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r.shape.length,a=r.shape[i],l=new Array(o-1);let u=0;for(let y=0;y<o;y++)y!==i&&(l[u++]=r.shape[y]);const d=new Array(o).fill(0),f=r.shape.slice();f[i]=1;const m=new Array(a);for(let y=0;y<m.length;y++){d[i]=y;const b=xh({inputs:{x:r},backend:t,attrs:{begin:d,size:f}});m[y]=pn({inputs:{x:b},backend:t,attrs:{shape:l}}),t.disposeIntermediateTensorInfo(b)}return m}const K_e={kernelName:t1,backendName:"cpu",kernelFunc:q_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X_e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:i}=e,{numSegments:o}=s;Ve(r,"unsortedSegmentSum");const a=r.shape.length,l=i.shape.length,u=[],d=[],f=a-l;let m=i;for(let b=0;b<f;++b){const w=fw({inputs:{input:m},backend:t,attrs:{dim:b+1}});m=w,d.push(w)}for(let b=0;b<o;++b){const w=Pc(b,"int32"),v=t.makeTensorInfo([],"int32",w),S=WG({inputs:{a:v,b:m},backend:t}),T=Cc({inputs:{x:S},backend:t,attrs:{dtype:"float32"}}),I=k1({inputs:{a:T,b:r},backend:t}),k=A0({inputs:{x:I},backend:t,attrs:{axis:0,keepDims:!1}});u.push(k),d.push(v),d.push(S),d.push(T),d.push(I),d.push(k)}const y=W5({inputs:u,backend:t,attrs:{axis:0}});return d.forEach(b=>t.disposeIntermediateTensorInfo(b)),y}const Y_e={kernelName:n1,backendName:"cpu",kernelFunc:X_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q_e=[G0e,Tye,q0e,X0e,Rye,Q0e,Z0e,tbe,sbe,ibe,abe,cbe,hbe,pbe,gbe,xbe,wbe,Sbe,Tbe,j0e,Ibe,Nbe,Rbe,Dye,Dbe,Nye,Pye,Pbe,Eye,Lbe,Vbe,Ube,zbe,Wbe,Hbe,Kbe,Ybe,Jbe,exe,nxe,rxe,oxe,lxe,uxe,hxe,fxe,mxe,yxe,bxe,xxe,vxe,_xe,Txe,M0e,Ixe,Mye,Pxe,Lye,Mxe,Vye,zxe,jxe,Gxe,Bye,jye,qxe,Xxe,Qxe,Zxe,Gye,qye,Iye,tve,Fbe,sve,ive,ave,L0e,Xye,Qye,cve,Zye,hve,pve,gve,xve,wve,Sve,Cve,t0e,Eve,kve,Ave,$ve,Ove,Mve,Fve,s0e,Uve,jve,Hve,i0e,a0e,Xve,Jve,twe,c0e,swe,iwe,owe,G5,uwe,V0e,d0e,dwe,pwe,gwe,bwe,kye,hI,vwe,U0e,B0e,z0e,_we,Cwe,Ewe,kwe,Awe,Rwe,Dwe,v0e,Pwe,Uwe,zwe,Hwe,_0e,Kwe,Ywe,Jwe,S0e,Wve,t_e,s_e,i_e,a_e,c_e,h_e,f_e,m_e,E0e,g_e,k0e,A0e,b_e,v_e,__e,C_e,E_e,O0e,Sxe,k_e,A_e,$_e,O_e,M_e,F_e,u0e,H_e,K_e,Y_e,rwe];for(const n of Q_e)Nz(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pu={},Tx={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function J_e(n,e){Pu[n]=e}function lo(n,e){if(!(n in Pu)||e!=null){const s=e1e(n,e);if(s!==null)Pu[n]=s;else return console.log("Could not get context for WebGL version",n),null}const t=Pu[n];return t==null||t.isContextLost()?(delete Pu[n],lo(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Pu[n])}function Z_e(n){if(!pe().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function e1e(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??Z_e(n);return t.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete Pu[n]},!1),pe().getBool("SOFTWARE_WEBGL_ENABLED")&&(Tx.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",Tx)||t.getContext("experimental-webgl",Tx):t.getContext("webgl2",Tx)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Gg;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(Gg||(Gg={}));var ii;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(ii||(ii={}));var Ps;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Ps||(Ps={}));function R0(n,e){return[e,n]}function t1e(n,e){return n*e}function Ex(n){const e=xe(n),t=Math.ceil(e/4);return PE(t)}function op(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function n1e(n,e){const[t,s]=op(n,e);return t*s*4}function GA(n,e){const t=n;let s,r,i,o,a,l,u,d,f,m;return pe().getNumber("WEBGL_VERSION")===2?(s=t.R32F,r=t.R16F,i=t.RGBA16F,o=t.RGBA32F,a=t.RED,u=4,d=1,f=t.HALF_FLOAT,m=t.FLOAT,l=t.RGBA8):(s=n.RGBA,r=n.RGBA,i=n.RGBA,o=t.RGBA,a=n.RGBA,u=4,d=4,f=e!=null?e.HALF_FLOAT_OES:null,m=n.FLOAT,l=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:d,textureTypeHalfFloat:f,textureTypeFloat:m}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pe(n,e){const t=e();return pe().getBool("DEBUG")&&s1e(n),t}function s1e(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+a1e(n,e))}const r1e=596e-10,i1e=65504;function o1e(n){return!!(pe().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||r1e<Math.abs(n)&&Math.abs(n)<i1e)}function a1e(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Ix(n,e){return ll(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function l1e(n,e){const t=ll(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Pe(n,()=>n.shaderSource(t,e)),Pe(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function c1e(n,e){const t=ll(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Pe(n,()=>n.shaderSource(t,e)),Pe(n,()=>n.compileShader(t)),pe().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw H5(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const u1e=/ERROR: [0-9]+:([0-9]+):/g;function H5(n,e){const t=u1e.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const s=+t[1],r=n.split(`
`),i=r.length.toString().length+2,o=r.map((f,m)=>hf((m+1).toString(),i)+f);let a=0;for(let f=0;f<o.length;f++)a=Math.max(o[f].length,a);const l=o.slice(0,s-1),u=o.slice(s-1,s),d=o.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${hf(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join(`
`))}function h1e(n){return ll(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function d1e(n,e){if(Pe(n,()=>n.linkProgram(e)),!pe().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function ET(n,e){if(Pe(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function f1e(n,e){const t=ll(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Pe(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Pe(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function p1e(n,e){const t=ll(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Pe(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),Pe(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function m1e(n){return ll(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function g1e(n,e){const t=pe().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const s=`[${n}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>t||e>t){const s=`[${n}x${e}]`,r=`[${t}x${t}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function y1e(n){return ll(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function VF(n,e,t,s,r,i,o){const a=n.getAttribLocation(e,t);return a===-1?!1:(Pe(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),Pe(n,()=>n.vertexAttribPointer(a,r,n.FLOAT,!1,i,o)),Pe(n,()=>n.enableVertexAttribArray(a)),!0)}function b1e(n,e,t){S1e(n,t),Pe(n,()=>n.activeTexture(n.TEXTURE0+t)),Pe(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function x1e(n,e,t){return ll(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function v1e(n,e,t){return n.getUniformLocation(e,t)}function w1e(n,e,t,s){Pe(n,()=>b1e(n,e,s)),Pe(n,()=>n.uniform1i(t,s))}function IT(n,e,t){Pe(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Pe(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function UF(n,e){Pe(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Pe(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function kx(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+_1e(n,e))}function _1e(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function ll(n,e,t){const s=Pe(n,()=>e());if(s==null)throw new Error(t);return s}function S1e(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+n.TEXTURE0;if(s<n.TEXTURE0||s>t){const r=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${r}.`)}}function Mf(n,e=2){return xe(n.slice(0,n.length-e))}function Lf(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Nx(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[Mf(n),...Lf(n)]),e}function C1e(n,e=!1){let t=pe().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=pe().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&pe().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=t/2),e&&(t=t*2,s=s*2,n=n.map((a,l)=>l>=n.length-2?yN(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=Oc(n).newShape);let r=xe(n),i=null;n.length<=1&&r<=t?i=[1,r]:n.length===2&&n[0]<=t&&n[1]<=t?i=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?i=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?i=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?i=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(i=[n[0],n[1]*n[2]*n[3]]);const o=i!=null&&Math.max(...i)>s&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||o)if(e){const a=Mf(n);let l=2,u=2;n.length&&([l,u]=Lf(n)),r=a*(l/2)*(u/2),i=PE(r).map(d=>d*2)}else i=PE(r);return i}function Ax(n){return n%2===0}function mw(n,e){if(n=n.slice(-2),e=e.slice(-2),zt(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],s=e[e.length-1];if(t===s||Ax(t)&&Ax(s)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Ax(n[0])&&Ax(e[0])}let kT,NT;function T1e(n){if(kT==null){const e=lo(n);kT=e.getParameter(e.MAX_TEXTURE_SIZE)}return kT}function E1e(n){if(NT==null){const e=lo(n);NT=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,NT)}function I1e(n){if(n===0)return 0;let e;const t=lo(n);return Ri(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:Ri(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Ri(n,e){return n.getExtension(e)!=null}function BF(n){try{if(lo(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function k1e(n){if(n===0)return!1;const e=lo(n);if(n===1){if(!Ri(e,"OES_texture_float"))return!1}else if(!Ri(e,"EXT_color_buffer_float"))return!1;return fI(e)}function N1e(n){if(n===0)return!1;const e=lo(n);if(n===1){if(!Ri(e,"OES_texture_float")||!Ri(e,"WEBGL_color_buffer_float"))return!1}else{if(Ri(e,"EXT_color_buffer_float"))return fI(e);const s="EXT_color_buffer_half_float";if(Ri(e,s)){const r=e.getExtension(s);return A1e(e,r)}return!1}return fI(e)}function fI(n){const e=GA(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(i),o}function A1e(n,e){const t=GA(n,e),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(o),a}function R1e(n){return n!==2?!1:lo(n).fenceSync!=null}function $0(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&j(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ze=pe();ze.registerFlag("HAS_WEBGL",()=>ze.getNumber("WEBGL_VERSION")>0);ze.registerFlag("WEBGL_VERSION",()=>BF(2)?2:BF(1)?1:0);ze.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);ze.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>ze.get("WEBGL_VERSION")===2);ze.registerFlag("WEBGL_CPU_FORWARD",()=>!0);ze.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);ze.registerFlag("WEBGL_PACK",()=>ze.getBool("HAS_WEBGL"));ze.registerFlag("WEBGL_PACK_NORMALIZATION",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_CLIP",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_REDUCE",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_LAZILY_UNPACK",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_CONV_IM2COL",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>T1e(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>E1e(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=ze.getNumber("WEBGL_VERSION");return n===0?0:I1e(n)});ze.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>ze.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!zz());ze.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>k1e(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>ze.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:ze.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));ze.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>N1e(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_FENCE_API_ENABLED",()=>R1e(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>ze.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);ze.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});ze.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>zz()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});ze.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);ze.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);ze.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);ze.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);ze.registerFlag("WEBGL_EXP_CONV",()=>!1);ze.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>ze.getBool("IS_TEST"));ze.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);ze.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);ze.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);ze.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yr(){let n,e,t,s,r,i,o,a,l,u;return pe().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",s="in",r="texture",i="outputColor",o="out vec4 outputColor;",a=pe().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",s="varying",r="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:s,texture2D:r,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oh(n,e,t="index"){const s=je(e);return s.map((r,i)=>{const o=`int ${n[i]} = ${t} / ${r}`,a=i===s.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${r}`:`index -= ${n[i]} * ${r}`;return`${o}; ${a};`}).join("")}function N1(n,e,t="index"){const s=je(e);return s.map((r,i)=>{const o=`int ${n[i]} = ${t} / outShapeStrides[${i}]`,a=i===s.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * outShapeStrides[${i}]`:`index -= ${n[i]} * outShapeStrides[${i}]`;return`${o}; ${a};`}).join("")}function $1e(n,e){const t=n.length,s=n.map(i=>`${e}[${i}]`),r=new Array(t-1);r[t-2]=s[t-1];for(let i=t-3;i>=0;--i)r[i]=`(${r[i+1]} * ${s[i+1]})`;return r}function D1e(n,e,t="index"){const s=n.map((i,o)=>o),r=$1e(s,e);return r.map((i,o)=>{const a=`int ${n[o]} = ${t} / ${r[o]}`,l=o===r.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${r[o]}`:`index -= ${n[o]} * ${r[o]}`;return`${a}; ${l};`}).join("")}function HA(n){const e=je(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function qA(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const q5=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:K5}=wfe;function O1e(n,e,t){const s=[];if(n.forEach(y=>{const b=xe(y.shapeInfo.logicalShape);if(y.shapeInfo.isUniform?s.push(`uniform float ${y.name}${b>1?`[${b}]`:""};`):(s.push(`uniform sampler2D ${y.name};`),s.push(`uniform int offset${y.name};`)),t.enableShapeUniforms){const{uniformShape:w}=KA(t.packedInputs,y.shapeInfo.logicalShape,y.shapeInfo.texShape);switch(w.length){case 1:s.push(`uniform int ${y.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${y.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${y.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${y.name}Shape;`);break}s.push(`uniform ivec2 ${y.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(y=>{s.push(`uniform ${y.type} ${y.name}${y.arrayIndex?`[${y.arrayIndex}]`:""};`)});const r=s.join(`
`),i=n.map(y=>P1e(y,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),o=e.texShape,a=yr(),l=F1e(a);let u,d,f=B1e(a);return e.isPacked?(u=M1e(e.logicalShape,o,t.enableShapeUniforms),d=U1e(a)):(u=L1e(e.logicalShape,o,t.enableShapeUniforms),d=V1e(a)),t.packedInputs&&(f+=G1e),[f,l,d,r,u,i,t.userCode].join(`
`)}function ap(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return sSe(n,e);case 1:return iSe(n,e);case 2:return aSe(n,e);case 3:return cSe(n,e);case 4:return hSe(n,e);case 5:return dSe(n);case 6:return fSe(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function X5(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return nSe(n);case 1:return rSe(n,e);case 2:return oSe(n,e);case 3:return lSe(n,e);default:return uSe(n,e)}}function P1e(n,e,t=!1,s){let r="";t?r+=X5(n,s):r+=ap(n,s);const i=n.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?r+=pSe(n,e):r+=mSe(n,e)),r}function M1e(n,e,t){switch(n.length){case 0:return Y5();case 1:return H1e(n,e,t);case 2:return eSe(n,e,t);case 3:return K1e(n,e,t);default:return Y1e(n,e,t)}}function L1e(n,e,t){switch(n.length){case 0:return Y5();case 1:return q1e(n,e,t);case 2:return tSe(n,e,t);case 3:return X1e(n,e,t);case 4:return Q1e(n,e,t);case 5:return J1e(n,e);case 6:return Z1e(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function F1e(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function V1e(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function U1e(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function B1e(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${z1e}
    ${j1e}
    ${W1e}
  `}const z1e=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,j1e=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,W1e=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,G1e=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Y5(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function H1e(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function q1e(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function K1e(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),i=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function X1e(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${N1(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=Oh(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function Y1e(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),i=r*Math.ceil(n[n.length-2]/2);let o=i,a="",l="b, r, c";for(let u=2;u<n.length-1;u++)o*=n[n.length-u-1],a=`
      int b${u} = index / ${o};
      index -= b${u} * ${o};
    `+a,l=`b${u}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${l});
    }
  `}function Q1e(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${N1(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Oh(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function J1e(n,e){const t=Oh(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function Z1e(n,e){const t=Oh(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function eSe(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(zt(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function tSe(n,e,t){return zt(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function Ph(n){return`offset${n}`}function nSe(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),s=yr();return`
    vec4 ${t}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function sSe(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${t};}`;const[r,i]=n.shapeInfo.texShape;if(r===1&&i===1)return`
      float ${s}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const o=Ph(t);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${o});
      return sampleTexture(${t}, uv);
    }
  `;const[a,l]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${t}, uv);
    }
  `}function rSe(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,i=yr();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${t}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${t}, uv);
    }
  `}function iSe(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${lp(n)}
      }
    `;const r=n.shapeInfo.texShape,i=r[0],o=r[1];if(o===1&&i===1)return`
      float ${s}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=Ph(t);return o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${t}, uv);
      }
    `:i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function oSe(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=i[0],a=i[1],l=yr();if(i!=null&&zt(t,i))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],d=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${d}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function aSe(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape;if(i!=null&&zt(t,i)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const m=i[0],y=i[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${y}.0, ${m}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:a}=Oc(t),l=o;if(l.length<t.length){const m=cp(n,l),y=["row","col"];return`
      ${ap(m,e)}
      float ${r}(int row, int col) {
        return ${r}(${up(y,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${lp(n)}
      }
    `;const u=i[0],d=i[1],f=Ph(s);return d===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${s}, uv);
    }
  `:u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${f};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${f};
    vec2 uv = uvFromFlat(${u}, ${d}, index);
    return sampleTexture(${s}, uv);
  }
`}function lSe(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){const m=t.slice(1),y=[1,2],b=cp(n,m),w=["b","row","col"];return`
        ${X5(b,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${up(w,y)});
        }
      `}const a=yr();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=o[0],u=o[1],d=Math.ceil(t[2]/2),f=d*Math.ceil(t[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${f}, ${d}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function cSe(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t[1]*t[2],o=t[2],{newShape:a,keptDims:l}=Oc(t),u=a;if(u.length<t.length){const w=cp(n,u),v=["row","col","depth"];return`
        ${ap(w,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${up(v,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${lp(n)}
      }
    `;const d=n.shapeInfo.texShape,f=d[0],m=d[1],y=n.shapeInfo.flatOffset;if(m===i&&y==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${m}.0, ${f}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(m===o&&y==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${m}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `;const b=Ph(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${b};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${b};
        vec2 uv = uvFromFlat(${f}, ${m}, index);
        return sampleTexture(${s}, uv);
      }
  `}function uSe(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=yr();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${t}, uv);
    }
  `;const i=n.shapeInfo.logicalShape,o=i.length,a=n.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],d=l[1],f=Math.ceil(i[o-1]/2);let m=f*Math.ceil(i[o-2]/2),y="int b, int row, int col",b=`b * ${m} + (row / 2) * ${f} + (col / 2)`;for(let w=2;w<o-1;w++)y=`int b${w}, `+y,m*=i[o-w-1],b=`b${w} * ${m} + `+b;return`
    vec4 ${s}(${y}) {
      int index = ${b};
      int texR = index / ${d};
      int texC = index - texR * ${d};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}, ${u});
      return ${r.texture2D}(${t}, uv);
    }
  `}function hSe(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t[3],o=t[2]*i,a=t[1]*o,{newShape:l,keptDims:u}=Oc(t);if(l.length<t.length){const T=cp(n,l),I=["row","col","depth","depth2"];return`
      ${ap(T,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${up(I,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${i}, 1)));
        ${lp(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,m=f[0],y=f[1],b=`int stride2 = ${s}Shape[3];`,w=`int stride1 = ${s}Shape[2] * stride2;`,v=`int stride0 = ${s}Shape[1] * stride1;`;if(y===a&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${b}
        ${w}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${y}.0, ${m}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(y===i&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${y}.0, ${m}.0);
        return sampleTexture(${s}, uv);
      }
    `;const S=Ph(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${b}
      ${w}
      ${v}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${S});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${m}, ${y}, index + ${S});
      return sampleTexture(${s}, uv);
    }
  `}function dSe(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],i=e[3]*r,o=e[2]*i,a=e[1]*o,{newShape:l,keptDims:u}=Oc(e);if(l.length<e.length){const w=cp(n,l),v=["row","col","depth","depth2","depth3"];return`
      ${ap(w)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${up(v,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${i}, ${r})) +
          depth3;
        ${lp(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,m=f[0],y=f[1];if(y===a&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${y}.0, ${m}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(y===r&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${y}.0, ${m}.0);
        return sampleTexture(${t}, uv);
      }
    `;const b=Ph(t);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${i} +
          depth2 * ${r} + depth3 + ${b};
      vec2 uv = uvFromFlat(${m}, ${y}, index);
      return sampleTexture(${t}, uv);
    }
  `}function fSe(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:r,keptDims:i}=Oc(e);if(r.length<e.length){const v=cp(n,r),S=["row","col","depth","depth2","depth3","depth4"];return`
      ${ap(v)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${up(S,i)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,u=e[2]*l,d=e[1]*u;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${d}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${lp(n)}
      }
    `;const f=n.shapeInfo.flatOffset,m=n.shapeInfo.texShape,y=m[0],b=m[1];if(b===d&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${b}.0, ${y}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(b===o&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${b}.0, ${y}.0);
        return sampleTexture(${t}, uv);
      }
    `;const w=Ph(t);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${w};
      vec2 uv = uvFromFlat(${y}, ${b}, index);
      return sampleTexture(${t}, uv);
    }
  `}function lp(n){const e=n.name,t=xe(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function pSe(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",i=n.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=K5(n.shapeInfo.logicalShape,e.logicalShape),l=sn(o),u=o-i;let d;const f=["x","y","z","w","u","v"];i===0?d="":o<2&&a.length>=1?d="coords = 0;":d=a.map(T=>`coords.${f[T+u]} = 0;`).join(`
`);let m="";o<2&&i>0?m="coords":m=n.shapeInfo.logicalShape.map((T,I)=>`coords.${f[I+u]}`).join(", ");let y="return outputValue;";const w=xe(n.shapeInfo.logicalShape)===1,S=xe(e.logicalShape)===1;if(i===1&&!w&&!S)y=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(w&&!S)o===1?y=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:y=`
        return vec4(outputValue.x);
      `;else if(a.length){const T=i-2,I=i-1;a.indexOf(T)>-1&&a.indexOf(I)>-1?y="return vec4(outputValue.x);":a.indexOf(T)>-1?y="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(I)>-1&&(y="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${d}
      vec4 outputValue = get${s}(${m});
      ${y}
    }
  `}function mSe(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",i=e.texShape,o=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===l&&n.shapeInfo.flatOffset==null&&zt(o,i))return`
      float ${r}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const u=sn(l),d=K5(n.shapeInfo.logicalShape,e.logicalShape),f=l-a;let m;const y=["x","y","z","w","u","v"];a===0?m="":l<2&&d.length>=1?m="coords = 0;":m=d.map(w=>`coords.${y[w+f]} = 0;`).join(`
`);let b="";return l<2&&a>0?b="coords":b=n.shapeInfo.logicalShape.map((w,v)=>`coords.${y[v+f]}`).join(", "),`
    float ${r}() {
      ${u} coords = getOutputCoords();
      ${m}
      return get${s}(${b});
    }
  `}function sn(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function KA(n,e,t){const{newShape:s,keptDims:r}=Oc(e),i=e.length,o=n&&i===3&&e[0]===1,a=o?e.slice(1):s,l=!n&&i>1&&!zt(e,t)&&s.length<i||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function cp(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function up(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gSe(n,e,t,s){const r=t.map((d,f)=>{const m={logicalShape:d.shape,texShape:d.isUniform?null:d.texData.texShape,isUniform:d.isUniform,isPacked:d.isUniform?!1:d.texData.isPacked,flatOffset:null};return d.texData!=null&&d.texData.slice!=null&&d.texData.slice.flatOffset>0&&(m.flatOffset=d.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:m}}),i=r.map(d=>d.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=O1e(r,o,e),l=c1e(n.gl,a),u=n.createProgram(l);return pe().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(u),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o},Q5(n,e,u)))}function Q5(n,e,t){const s=[],r=[];let i,o,a,l=null,u=null;u=n.getUniformLocation(t,"NAN",!1),pe().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));const d=!1;for(const f of e.variableNames){const m={name:f,uniform:n.getUniformLocation(t,f,d),offset:n.getUniformLocation(t,`offset${f}`,d)};e.enableShapeUniforms&&(m.shape=n.getUniformLocation(t,`${f}Shape`,d),m.texShape=n.getUniformLocation(t,`${f}TexShape`,d)),s.push(m)}if(e.enableShapeUniforms&&(i=n.getUniformLocation(t,"outShape",d),a=n.getUniformLocation(t,"outShapeStrides",d),o=n.getUniformLocation(t,"outTexShape",d)),e.customUniforms)for(const f of e.customUniforms)r.push(n.getUniformLocation(t,f.name,d));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:u,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:o}}function zF(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,s)=>{const r=t.logicalShape,i=e[s],o=i.shape;if(!zt(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(t.isUniform&&i.isUniform)return;const a=t.texShape,l=i.isUniform?null:i.texData.texShape;if(!zt(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function ySe(n,e,t,s,r){e.program.enableShapeUniforms||(zF(e.inShapeInfos,t),zF([e.outShapeInfo],[s]));const i=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):n.setOutputMatrixTexture(i.texture,o[0],o[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),pe().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<t.length;++l){const u=t[l],{uniform:d,offset:f,shape:m,texShape:y}=e.variablesLocations[l];if(m){const{uniformShape:b}=KA(e.program.packedInputs,u.shape,u.texData.texShape);switch(b.length){case 1:n.gl.uniform1iv(m,new Int32Array(b));break;case 2:n.gl.uniform2iv(m,new Int32Array(b));break;case 3:n.gl.uniform3iv(m,new Int32Array(b));break;case 4:n.gl.uniform4iv(m,new Int32Array(b));break}}if(y&&n.gl.uniform2i(y,u.texData.texShape[0],u.texData.texShape[1]),d!=null){if(u.isUniform){if(xe(u.shape)<2)n.gl.uniform1f(d,u.uniformValues[0]);else{let b=u.uniformValues;b instanceof Float32Array||(b=new Float32Array(b)),n.gl.uniform1fv(d,b)}continue}u.texData.slice!=null&&f!=null&&n.gl.uniform1i(f,u.texData.slice.flatOffset),n.setInputMatrixTexture(u.texData.texture.texture,d,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=je(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const u=e.program.customUniforms[l],d=e.customUniformLocations[l],f=r[l];if(u.type==="float")n.gl.uniform1fv(d,f);else if(u.type==="vec2")n.gl.uniform2fv(d,f);else if(u.type==="vec3")n.gl.uniform3fv(d,f);else if(u.type==="vec4")n.gl.uniform4fv(d,f);else if(u.type==="int")n.gl.uniform1iv(d,f);else if(u.type==="ivec2")n.gl.uniform2iv(d,f);else if(u.type==="ivec3")n.gl.uniform3iv(d,f);else if(u.type==="ivec4")n.gl.uniform4iv(d,f);else throw Error(`uniform type ${u.type} is not supported yet.`)}n.executeProgram()}function bSe(n,e,t){let s="";e.concat(t).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:u,uniformShape:d,keptDims:f}=KA(n.packedInputs,o.shape,l);let m="",y="",b="";if(d.length===1&&n.packedInputs){const O=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];m=`${O[0]>1}_${O[1]>1}`}else if(d.length===2&&!n.packedInputs)y=`${d[0]>1}_${d[1]>1}`;else if(d.length>2&&!n.packedInputs){const O=je(d);b=`${O[0]===l[1]}_${O[O.length-1]===l[1]}`}const w=o.shape.length,v=d.length===2&&zt(o.shape,l),S=xe(o.shape)===1,T=Af(o.shape,t.shape),I=!n.packedInputs&&w===t.shape.length&&zt(l,t.texData.texShape),k=n.packedInputs||d.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${w}_${I}_${u?f:""}_${d.length}_${S}_${T}_${v}_${m}_${y}_${b}_${k}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${l}_${a}`}});const r=n.userCode;let i=n.constructor.name;return i+="_"+s+"_"+r+`${pe().getNumber("WEBGL_VERSION")}`,i}function sr(n){return pe().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xSe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Gg.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=yr();this.outputShape=e,this.enableShapeUniforms=sr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?N1(["r","c","d"],e):Oh(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vSe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Gg.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=yr();this.outputShape=e,this.enableShapeUniforms=sr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?N1(["r","c","d"],e):Oh(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wSe{constructor(e){this.variableNames=["A"],this.outTexUsage=ii.DOWNLOAD;const t=yr();this.outputShape=e,this.userCode=`
      ${q5}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _Se{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ii.DOWNLOAD;const t=yr();this.outputShape=e,this.userCode=`
      ${q5}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SSe={R:0,G:1,B:2,A:3};class jF{constructor(e,t=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=yr();this.outputShape=e,this.enableShapeUniforms=sr(this.outputShape.length);let i="result";t&&(i="floor(result * 255. + 0.5)");let o="";for(let a=0;a<s.length;a++){const l=s[a];o+=`
          if(offset == ${a}) {
            result = values[${SSe[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?qA():HA(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CSe{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=yr();this.outputShape=e,this.enableShapeUniforms=sr(this.outputShape.length);let r="",i="result";t&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?qA():HA(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TSe(n){const e=yr(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return l1e(n,t)}function ESe(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return f1e(n,e)}function ISe(n){const e=new Uint16Array([0,1,2,2,1,3]);return p1e(n,e)}function D0(n,e,t,s,r,i){g1e(e,t);const o=m1e(n),a=n.TEXTURE_2D;return Pe(n,()=>n.bindTexture(a,o)),Pe(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Pe(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Pe(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),Pe(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),pe().getNumber("WEBGL_VERSION")===1?Pe(n,()=>n.texImage2D(a,0,s,e,t,0,r,i,null)):Pe(n,()=>n.texStorage2D(a,1,s,e,t)),Pe(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:o,texShape:[t,e]}}function J5(n){return n.internalFormatFloat}function kSe(n,e,t,s){const[r,i]=R0(e,t);return D0(n,r,i,J5(s),s.textureFormatFloat,n.FLOAT)}function Z5(n){return n.internalFormatHalfFloat}function NSe(n,e,t,s){const[r,i]=R0(e,t);return D0(n,r,i,Z5(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function eH(n){return n.downloadTextureFormat}function ASe(n,e,t,s){const[r,i]=R0(e,t);return D0(n,r,i,eH(s),n.RGBA,n.UNSIGNED_BYTE)}function tH(n){return n.internalFormatPackedFloat}function RSe(n,e,t,s){const[r,i]=op(e,t);return D0(n,r,i,tH(s),n.RGBA,n.FLOAT)}function nH(n){return n.internalFormatPackedHalfFloat}function $Se(n,e,t,s){const[r,i]=op(e,t);return D0(n,r,i,nH(s),n.RGBA,s.textureTypeHalfFloat)}function DSe(n,e,t){return Pe(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),VF(n,e,"clipSpacePos",t,3,20,0)&&VF(n,e,"uv",t,2,20,12)}function OSe(n,e,t,s,r,i){Pe(n,()=>n.bindTexture(n.TEXTURE_2D,e));let o,a,l;r instanceof Uint8Array?(o=new Uint8Array(t*s*4),a=n.UNSIGNED_BYTE,l=n.RGBA):(o=new Float32Array(t*s*4),a=n.FLOAT,l=i.internalFormatPackedFloat),o.set(r),pe().getNumber("WEBGL_VERSION")===2?Pe(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,s,n.RGBA,a,o)):Pe(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,t,s,0,n.RGBA,a,o)),Pe(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function PSe(n,e,t){Pe(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?pe().getNumber("WEBGL_VERSION")===2?Pe(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):Pe(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):pe().getNumber("WEBGL_VERSION")===2?Pe(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):Pe(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),Pe(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function MSe(n,e,t,s){const r=n.createBuffer();Pe(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const a=4*4*e*t;return Pe(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),Pe(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),Pe(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function LSe(n,e,t){const s=n,r=new Float32Array(t);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function FSe(n,e,t,s){const[r,i]=R0(e,t),o=4,a=new Uint8Array(t1e(e*t,o));return Pe(n,()=>n.readPixels(0,0,r,i,s.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function VSe(n,e,t,s,r,i,o,a){const l=n,u=new Float32Array(n1e(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function USe(n,e,t){const s=new Float32Array(e*t*4);return Pe(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AT{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=pe().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,J_e(t,e)):this.gl=lo(t),e=this.gl,pe().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>Pe(i,()=>i.createVertexArray()),this.bindVertexArray=o=>Pe(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>Pe(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>Pe(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Pe(e,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>Pe(e,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>Pe(e,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>Pe(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),pe().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=Ix(this.gl,i),Ri(this.gl,o))this.textureHalfFloatExtension=Ix(this.gl,o);else if(pe().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Ri(this.gl,r))this.colorBufferHalfFloatExtension=Ix(this.gl,r);else if(pe().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Ri(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Ri(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=ESe(this.gl),this.indexBuffer=ISe(this.gl),this.framebuffer=y1e(this.gl),this.textureConfig=GA(this.gl,this.textureHalfFloatExtension)}get debug(){return pe().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Pe(e,()=>e.finish()),Pe(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Pe(e,()=>e.deleteFramebuffer(this.framebuffer)),Pe(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Pe(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Pe(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),kSe(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),NSe(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),ASe(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),PSe(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,s,r){this.throwIfDisposed(),OSe(this.gl,e,t,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),$Se(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),RSe(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(UF(this.gl,this.framebuffer),this.outputTexture=null),Pe(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,s){return this.downloadMatrixDriver(e,()=>FSe(this.gl,t,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,s,r,i,o){return VSe(this.gl,e,t,s,r,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return LSe(this.gl,e,t)}createBufferFromTexture(e,t,s){this.bindTextureToFrameBuffer(e);const r=MSe(this.gl,t,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,s;if(pe().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const o=r.clientWaitSync(i,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},t=i}else pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(t,pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:t,isFencePassed:s}}downloadMatrixFromPackedTexture(e,t,s){return this.downloadMatrixDriver(e,()=>USe(this.gl,t,s))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=TSe(t));const s=h1e(t);Pe(t,()=>t.attachShader(s,this.vertexShader)),Pe(t,()=>t.attachShader(s,e)),d1e(t,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&ET(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;Pe(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),DSe(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Pe(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&ET(this.gl,this.program),Pe(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,s=!0){return this.throwIfDisposed(),s?x1e(this.gl,e,t):v1e(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Pe(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,s){this.throwIfDisposed(),this.throwIfNoProgram(),w1e(this.gl,e,t,s)}setOutputMatrixTexture(e,t,s){this.setOutputMatrixTextureDriver(e,s,t)}setOutputPackedMatrixTexture(e,t,s){this.throwIfDisposed();const[r,i]=op(t,s);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,t,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&ET(this.gl,this.program),kx(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Pe(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Pe(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Ix(this.gl,pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,s=this.getQueryTimerExtensionWebGL2();t.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await _L(()=>this.disposed||this.isQueryAvailable(e,pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=BSe(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:s}=this.itemsToPoll[t];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in pe().platform&&(s=pe().platform.setTimeoutCustom.bind(pe().platform)),_L(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),IT(this.gl,e,this.framebuffer),this.debug&&kx(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(IT(this.gl,this.outputTexture,this.framebuffer),this.debug&&kx(this.gl)):UF(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const s=t();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,t,s){this.throwIfDisposed();const r=this.gl;IT(r,e,this.framebuffer),this.debug&&kx(r),this.outputTexture=e,Pe(r,()=>r.viewport(0,0,t,s)),Pe(r,()=>r.scissor(0,0,t,s))}setOutputMatrixWriteRegionDriver(e,t,s,r){this.throwIfDisposed(),Pe(this.gl,()=>this.gl.scissor(e,t,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function BSe(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:zSe,bincountImpl:sH,bincountReduceImpl:jSe,bitwiseAndImpl:WSe,castImpl:GSe,ceilImpl:HSe,concatImpl:qSe,equalImpl:KSe,expImpl:XSe,expm1Impl:YSe,floorImpl:QSe,gatherNdImpl:JSe,gatherV2Impl:ZSe,greaterImpl:eCe,greaterEqualImpl:tCe,lessImpl:nCe,lessEqualImpl:sCe,linSpaceImpl:rCe,logImpl:iCe,maxImpl:oCe,maximumImpl:aCe,minimumImpl:lCe,multiplyImpl:cCe,negImpl:uCe,notEqualImpl:hCe,prodImpl:dCe,raggedGatherImpl:fCe,raggedRangeImpl:pCe,raggedTensorToTensorImpl:mCe,rangeImpl:gCe,rsqrtImpl:yCe,scatterImpl:bCe,sigmoidImpl:xCe,simpleAbsImpl:rH,sliceImpl:vCe,sparseFillEmptyRowsImpl:wCe,sparseReshapeImpl:_Ce,sparseSegmentReductionImpl:iH,sqrtImpl:SCe,staticRegexReplaceImpl:CCe,stridedSliceImpl:TCe,stringNGramsImpl:ECe,stringSplitImpl:ICe,stringToHashBucketFastImpl:kCe,subImpl:NCe,tileImpl:ACe,topKImpl:RCe,transposeImpl:XA,uniqueImpl:$Ce}=P0e;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oH(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function fr(n,e){return e===1?[n]:oH(n,e)}function DCe(n,e){if(n===1)return"rc";let t="";for(let s=0;s<n;s++)t+=e[s],s<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OCe{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=sr(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=fr("rc",this.rank),s=sn(this.rank),r=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let i=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${e[e.length-1-o]},`+i;t.push(i)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let s=this.rank-2;s<this.rank;s++)t+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aH{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=sr(this.outputShape.length);let s="";for(let r=0;r<4;r++){let i="thisRC = rc;";r%2===1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),s+=`
        ${i}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${PCe(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?qA():HA(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function PCe(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?D1e(["r","c","d"],"inputShape"):Oh(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MCe{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,s){const r=GF(t,s),i=HF(e,r,s);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=WF(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return r===Ps.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Ps.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Ps.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Ps.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Ps.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,t,s,r){if(this.freeTextures==null)return;const i=GF(s,r),o=HF(t,i,r);o in this.freeTextures||(this.freeTextures[o]=[]);const a=WF(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=pe().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const u=this.usedTextures[o],d=u&&u.indexOf(e);if(d==null||d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[d]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function LCe(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function WF(n,e,t,s,r){const i=FCe(e,s);let o;if(r){const[l,u]=op(n[0],n[1]);o=l*u}else{const[l,u]=R0(n[0],n[1]);o=l*u}const a=LCe(t,i);return o*a}function FCe(n,e){switch(n){case Ps.PACKED_2X2_FLOAT32:return tH(e);case Ps.PACKED_2X2_FLOAT16:return nH(e);case Ps.UNPACKED_FLOAT32:return J5(e);case Ps.UNPACKED_FLOAT16:return Z5(e);case Ps.PACKED_4X1_UNSIGNED_BYTE:return eH(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function VCe(n){return pe().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?Ps.PACKED_2X2_FLOAT32:Ps.UNPACKED_FLOAT32:n?Ps.PACKED_2X2_FLOAT16:Ps.UNPACKED_FLOAT16}function GF(n,e){if(n===ii.UPLOAD)return Ps.PACKED_2X2_FLOAT32;if(n===ii.RENDER||n==null)return VCe(e);if(n===ii.DOWNLOAD||n===ii.PIXELS)return Ps.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function HF(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oo{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=sr(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Fi="if (isnan(x)) return x;",UCe="return x;",qF="return abs(x);",BCe="return (x >= 0.0) ? x : (exp(x) - 1.0);",zCe=Fi+`
  return (x < 0.0) ? 0.0 : x;
`,jCe=Fi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,jl="return x;",WCe="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GCe="return x;",HCe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,qCe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,KCe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,XCe="return 1.0 / (1.0 + exp(-1.0 * x));";class Jl{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=sr(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YCe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=sr(this.outputShape.length);const t=e.length,s=fr("rc",t),r=sn(t),i=DCe(t,s),o=s.slice(-2),a=t<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QCe=Nj,JCe=1e-7,ZCe=1e-4,Rx={};function eTe(n){return n in Rx||(Rx[n]={}),Rx[n]}const tTe=pe().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),nTe=600;function sTe(){return pe().global.screen==null?1024:pe().global.screen.height*pe().global.screen.width*window.devicePixelRatio*nTe/1024/1024}class A1 extends gN{nextDataId(){return A1.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!pe().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof AT)t=e;else{const s=lo(pe().getNumber("WEBGL_VERSION"),e);t=new AT(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=lo(pe().getNumber("WEBGL_VERSION"));t=new AT(s),this.binaryCache=eTe(pe().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new MCe(this.gpgpu),this.numMBBeforeWarning=sTe(),this.texData=new ez(this,ko())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,s,r,i,o){const a=this.makeTensorInfo(t,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,i]},l.texShape=[r,i];const u=Nx(t),d=new jF(u,!1,o),f=this.runWebGLProgram(d,[a],s,[[r,i]]);return f.shape=t,l.texture=null,this.disposeIntermediateTensorInfo(a),f.dataId}write(e,t,s){if((pe().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||pe().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:s,values:e,usage:ii.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,s,r,i){if(pe().getBool("DEBUG")&&this.checkNumericalProblems(t),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:t,usage:ii.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:i,slice:o,shape:a,isPacked:l}=t;if(o!=null){let m;l?m=new Jl(a,jl):m=new Oo(a,jl);const y=this.runWebGLProgram(m,[{dataId:e,shape:a,dtype:r}],r),b=this.readSync(y.dataId);return this.disposeIntermediateTensorInfo(y),b}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const u=this.activeTimers!=null;let d;u&&(d=Sr());let f;if(r==="complex64"){const m=this.readSync(i.real.dataId),y=this.readSync(i.imag.dataId);f=el(m,y)}else f=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=Sr()-d),this.convertAndCacheOnCPU(e,f)}async read(e){if(this.pendingRead.has(e)){const b=this.pendingRead.get(e);return new Promise(w=>b.push(w))}const t=this.texData.get(e),{values:s,shape:r,slice:i,dtype:o,complexTensorInfos:a,isPacked:l}=t;if(i!=null){let b;l?b=new Jl(r,jl):b=new Oo(r,jl);const w=this.runWebGLProgram(b,[{dataId:e,shape:r,dtype:o}],o),v=this.read(w.dataId);return this.disposeIntermediateTensorInfo(w),v}if(s!=null)return this.convertAndCacheOnCPU(e);if(pe().getBool("DEBUG")&&!pe().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&pe().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,d;if(o!=="complex64"&&pe().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);const b=this.texData.get(d.dataId);u=this.gpgpu.createBufferFromTexture(b.texture.texture,...Ex(r))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let f;if(o==="complex64"){const b=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),w=b[0],v=b[1];f=el(w,v)}else if(u==null)f=this.getValuesFromTexture(e);else{const b=xe(r);f=this.gpgpu.downloadFloat32MatrixFromBuffer(u,b)}if(d!=null&&this.disposeIntermediateTensorInfo(d),u!=null){const b=this.gpgpu.gl;Pe(b,()=>b.deleteBuffer(u))}const m=this.convertAndCacheOnCPU(e,f),y=this.pendingRead.get(e);return this.pendingRead.delete(e),y.forEach(b=>b(m)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&ko().removeDataId(e,this),this.pendingDeletes--),m}readToGPU(e,t={}){const s=this.texData.get(e),{values:r,shape:i,slice:o,dtype:a,isPacked:l,texture:u}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let y;l?y=new Jl(i,jl):y=new Oo(i,jl);const b=this.runWebGLProgram(y,[{dataId:e,shape:i,dtype:a}],a),w=this.readToGPU(b,t);return this.disposeIntermediateTensorInfo(b),w}if(u==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const d=this.decode(e,t.customTexShape),f=ko().makeTensorFromTensorInfo(d),m=this.texData.get(d.dataId);return Object.assign({tensorRef:f},m.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>xc(r));return ht(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ht(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const s=e[t];if(!o1e(s))throw pe().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:s,isPacked:r}=this.texData.get(e),i=xe(t);if(pe().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const m=this.decode(e),y=this.texData.get(m.dataId),b=this.gpgpu.downloadMatrixFromPackedTexture(y.texture.texture,...Ex(t)).subarray(0,i);return this.disposeIntermediateTensorInfo(m),b}const o=pe().getBool("WEBGL_PACK")&&r===!0,a=o?Nx(t):t,l=o?new _Se(a):new wSe(a),u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),d=this.texData.get(u.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(u),f}timerAvailable(){return pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const i=ah(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=ah(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=t,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(i);a.kernelMs=Coe(l),a.getExtraProfileInfo=()=>l.map((u,d)=>({name:o[d],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Sr(),endMs:null}}endTimer(e){return pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Sr(),e)}async getQueryTime(e){if(pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,t),this.disposeData(s.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:s,texShape:r,usage:i,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),t!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(t,r,i,o)));const d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=tTe){return pe().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&xe(s.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){si("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return QCe(e.shape,t)}packedUnaryOp(e,t,s){const r=new Jl(e.shape,t),i=this.compileAndRun(r,[e],s);return ko().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=rH(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(pe().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,qF,e.dtype);const t=new Oo(e.shape,qF),s=this.compileAndRun(t,[e]);return ko().makeTensorFromTensorInfo(s)}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&by(s[0])){const i=s.map(o=>oc(o));r=this.write(i,e,t)}else r=this.write(s,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,s){return ko().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,s),this)}unpackTensor(e){const t=new YCe(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new OCe(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const s=[Mf(e.shape),...Lf(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},i=[Mf(t),...Lf(t)],o=new aH(i,s),a=!0,l=[s],u=this.runWebGLProgram(o,[r],e.dtype,l,a);return{dataId:u.dataId,shape:t,dtype:u.dtype}}decode(e,t){const s=this.texData.get(e),{isPacked:r,shape:i,dtype:o}=s;if(t!=null){const m=xe(i),y=t[0]*t[1]*4;j(m<=y,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=Nx(i);let l;r?l=new vSe(a):l=new xSe(a);const u=!0,d=[t??Ex(a)],f=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,d,u,t);return{dtype:o,shape:i,dataId:f.dataId}}runWebGLProgram(e,t,s,r,i=!1,o){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===Gg.DENSE){const S=o??Ex(e.outputShape);l.texShape=S.map(T=>T*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),xe(a.shape)===0)return l.values=Js(a.dtype,0),a;const u=[],d=t.map(S=>{if(S.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let T=this.texData.get(S.dataId);if(T.texture==null){if(!e.packedInputs&&xe(S.shape)<=pe().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:S.shape,texData:null,isUniform:!0,uniformValues:T.values};e.packedInputs&&(T.isPacked=!0,T.shape=S.shape)}if(this.uploadToGPU(S.dataId),!!T.isPacked!=!!e.packedInputs)S=T.isPacked?this.unpackTensor(S):this.packTensor(S),u.push(S),T=this.texData.get(S.dataId);else if(T.isPacked&&!mw(T.shape,S.shape)){const I=S,k=S.shape;S.shape=T.shape,S=this.packedReshape(S,k),u.push(S),T=this.texData.get(S.dataId),I.shape=k}return{shape:S.shape,texData:T,isUniform:!1}});this.uploadToGPU(a.dataId);const f={shape:a.shape,texData:l,isUniform:!1},m=bSe(e,d,f),y=this.getAndSaveBinary(m,()=>gSe(this.gpgpu,e,d,f)),b=this.activeTimers!=null;let w;b&&(w=this.startTimer()),pe().get("ENGINE_COMPILE_ONLY")||ySe(this.gpgpu,y,d,f,r),u.forEach(S=>this.disposeIntermediateTensorInfo(S)),b&&(w=this.endTimer(w),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(w)}));const v=pe().getNumber("WEBGL_FLUSH_THRESHOLD");if(v>0){const S=Sr();S-this.lastGlFlushTime>v&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=S)}if(!pe().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){const S=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),S}return a}compileAndRun(e,t,s,r,i=!1){return s=s||t[0].dtype,this.runWebGLProgram(e,t,s,r,i)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(pe().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=de(()=>{if(!pe().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=pe().getBool("DEBUG");pe().set("DEBUG",!1);const t=this.abs(Bt(1e-8)).dataSync()[0];if(pe().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?JCe:ZCe}uploadToGPU(e){const t=this.texData.get(e),{shape:s,dtype:r,values:i,texture:o,usage:a,isPacked:l}=t;if(o!=null)return;const u=this.activeTimers!=null;let d;u&&(d=Sr());let f=t.texShape;if(f==null&&(f=C1e(s,l),t.texShape=f),i!=null){const m=Nx(s);let y,b=f[1],w=f[0];const v=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!v)&&([b,w]=op(f[0],f[1])),l?y=new CSe(m,v):y=new jF(m,v);const S=v?[w,b]:f,T=this.makeTensorInfo(S,r),I=this.texData.get(T.dataId);v?I.usage=ii.PIXELS:I.usage=ii.UPLOAD,I.texShape=S,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(T.dataId),b,w,i);const k=[[w,b]],V=this.runWebGLProgram(y,[T],r,k,!0),P=this.texData.get(V.dataId);t.texShape=P.texShape,t.isPacked=P.isPacked,t.usage=P.usage,pe().get("ENGINE_COMPILE_ONLY")?this.disposeData(V.dataId):(t.texture=P.texture,t.values=null,this.texData.delete(V.dataId)),this.disposeIntermediateTensorInfo(T),u&&(this.uploadWaitMs+=Sr()-d)}else{const m=this.acquireTexture(f,a,r,l);t.texture=m}}convertAndCacheOnCPU(e,t){const s=this.texData.get(e),{dtype:r}=s;return t!=null&&(s.values=rTe(t,r)),s.values}acquireTexture(e,t,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*jv(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(t),r(!0)}catch(i){throw i}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await Kj(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(H5(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:s,infLoc:r,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=Q5(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=i,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,t,s){e.channels=e.channels||"RGBA";const{texture:r,height:i,width:o,channels:a}=e,l=ko().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(r,t,s,i,o,a);return ko().makeTensorFromDataId(u,t,s,l)}}A1.nextDataId=0;function rTe(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<t.length;++s)t[s]=Math.round(n[s]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */jz()&&Hz("webgl",()=>new A1,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YA=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class vh{constructor(e,t,s){this.variableNames=["A","B"],this.outputShape=it(t,s),this.enableShapeUniforms=sr(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mh=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class hp{constructor(e,t,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=it(t,s);const i=this.outputShape.length;this.enableShapeUniforms=sr(i);let o="";if(r)if(i===0||xe(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${sn(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=fr("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qr(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const iTe={kernelName:Vy,backendName:"webgl",kernelFunc:qr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wc(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,i=t.makeTensorInfo(s.shape,"complex64"),o=t.texData.get(i.dataId),a=qr({inputs:{x:s},backend:t}),l=qr({inputs:{x:r},backend:t});return o.complexTensorInfos={real:a,imag:l},i}const oTe={kernelName:NN,backendName:"webgl",kernelFunc:Wc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lH="return (a < 0.) ? b * a : a;",cH=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function aTe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:i}=s,o=t.makeTensorInfo([],"float32",Pc(i,"float32")),a=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new hp(cH,r.shape,o.shape):new vh(lH,r.shape,o.shape),l=t.runWebGLProgram(a,[r,o],"float32");return t.disposeIntermediateTensorInfo(o),l}const lTe={kernelName:C_,backendName:"webgl",kernelFunc:aTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uH="return (a < 0.) ? b * a : a;",hH=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function cTe(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e,i=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new hp(hH,s.shape,r.shape):new vh(uH,s.shape,r.shape);return t.runWebGLProgram(i,[s,r],"float32")}const uTe={kernelName:j_,backendName:"webgl",kernelFunc:cTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dp="if (isnan(x)) return x;";function Rt({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:s}){return({inputs:r,backend:i})=>{const{x:o}=r,a=i,l=s||o.dtype;if(a.shouldExecuteOnCPU([o])&&t!=null){const f=a.texData.get(o.dataId),m=t(f.values,l);return a.makeTensorInfo(o.shape,l,m)}const u=pe().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let d;return u?d=new Jl(o.shape,e):d=new Oo(o.shape,n),a.runWebGLProgram(d,[o],l)}}function Vs({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:i}){return({inputs:o,backend:a})=>{const{a:l,b:u}=o,d=a;if(s&&l.dtype==="complex64"){const b=d.texData.get(l.dataId),w=d.texData.get(u.dataId),[v,S]=[[b.complexTensorInfos.real,w.complexTensorInfos.real],[b.complexTensorInfos.imag,w.complexTensorInfos.imag]].map(I=>{const[k,O]=I,V={dataId:k.dataId,dtype:k.dtype,shape:l.shape},P={dataId:O.dataId,dtype:O.dtype,shape:u.shape},D=new vh(n,l.shape,u.shape);return d.runWebGLProgram(D,[V,P],Gr(k.dtype,O.dtype))}),T=Wc({inputs:{real:v,imag:S},backend:d});return d.disposeIntermediateTensorInfo(v),d.disposeIntermediateTensorInfo(S),T}const f=i||Gr(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||d.shouldExecuteOnCPU([l,u]))&&r!=null){const b=d.texData.get(l.dataId).values,w=d.texData.get(u.dataId).values,v=l.dtype==="string"?tl(b):b,S=l.dtype==="string"?tl(w):w,[T,I]=r(l.shape,u.shape,v,S,f),k=d.makeTensorInfo(I,f),O=d.texData.get(k.dataId);return O.values=T,k}const m=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let y;return m?y=new hp(e,l.shape,u.shape,t):y=new vh(n,l.shape,u.shape),d.runWebGLProgram(y,[l,u],f)}}function Hg(n,e=!1){if(n==="linear")return e?GCe:UCe;if(n==="relu")return e?qCe:zCe;if(n==="elu")return e?HCe:BCe;if(n==="relu6")return e?KCe:jCe;if(n==="prelu")return e?hH:uH;if(n==="leakyrelu")return e?cH:lH;if(n==="sigmoid")return e?XCe:WCe;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dH{constructor(e,t,s,r=!1,i=!1,o=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=sr(this.outputShape.length);const d=r?e[1]:e[2],f=Math.ceil(d/2),m=r?"i * 2, rc.y":"rc.y, i * 2",y=i?"rc.z, i * 2":"i * 2, rc.z",b=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],w=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let v="",S="";a&&(l?v=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?v=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:v=`vec4 activation(vec4 x) {
          ${a}
        }`,S="result = activation(result);");const T=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let I="rc.x",k="rc.x";e[0]<t[0]?I=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(k=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${v}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${f}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${I};
        int batchB = ${k};
        for (int i = 0; i < ${f}; i++) {
          vec4 a = getMatrixA(batchA, ${m});
          vec4 b = getMatrixB(batchB, ${y});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${b[0]} * ${w[0]});
          result += (${b[1]} * ${w[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${T}

        ${S}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KF={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class XF{constructor(e,t,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=it(t,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YF="return a * b;";function QA(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,i=Gr(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),u=new XF(KF.REAL,s.shape,r.shape),d=new XF(KF.IMAG,s.shape,r.shape),f=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],m=t.runWebGLProgram(u,f,"float32"),y=t.runWebGLProgram(d,f,"float32"),b=Wc({inputs:{real:m,imag:y},backend:t});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),b}if(t.shouldExecuteOnCPU([s,r])){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),[u,d]=cCe(s.shape,r.shape,a.values,l.values,i),f=t.makeTensorInfo(d,i),m=t.texData.get(f.dataId);return m.values=u,f}let o;return pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new hp(YF,s.shape,r.shape):o=new vh(YF,s.shape,r.shape),t.runWebGLProgram(o,[s,r],i)}const hTe={kernelName:Ky,backendName:"webgl",kernelFunc:QA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dTe(n,e,t){const s=[Mf(n.shape),...Lf(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},i=[Mf(e),...Lf(e)],o=new aH(i,s),a=!0,l=[s],u=t.runWebGLProgram(o,[r],n.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:i}=s,o=t,a=xe(r.shape),l=nz(i,a),u=xe(l);j(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const d=o.texData.get(r.dataId);return d.isPacked&&!mw(r.shape,l)&&!(d.texture!==null&&mw(d.shape,l))?dTe(r,l,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const fTe={kernelName:G_,backendName:"webgl",kernelFunc:$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QF{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];const a=Math.floor(s/4)*4,l=s%4;let u="sumValue += dot(values, ones);";if(t!=null){const f=1/t;u=`sumValue += dot(values * ${If(f)?f.toPrecision(2):f}, ones);`}let d="";i%s>0&&(d=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pTe{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];let a="0.0",l="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",l="min"):t==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");const d=Math.floor(s/4)*4,f=s%4;let m=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,y="vec4";t==="all"?(a="1.0",m=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,y="bvec4"):t==="any"&&(a="0.0",m=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,y="bvec4");let b="";i%s>0&&(b=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${b}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${y} values = ${y}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${m}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          ${y} values = ${y}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${m}
        } else if (${f===2}) {
          ${y} values = ${y}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${m}
        } else if (${f===3}) {
          ${y} values = ${y}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${m}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mTe(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],s=p1(t);e.push({inSize:t,windowSize:s,outSize:Math.ceil(t/s)})}return e}function Lh(n,e,t,s){const r=mTe(n.shape);let i=n;for(let o=0;o<r.length;o++){const{inSize:a,windowSize:l,outSize:u}=r[o];let d,f;t==="mean"?d=o===0?new QF({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},a):new QF({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u}):d=new pTe({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},t),f=i,i=s.runWebGLProgram(d,[i],e),f.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(f)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gTe{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[t[o]];this.outputShape=s,this.rank=s.length;const r=sn(this.rank),i=yTe(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function yTe(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<n.length;r++)s[n[r]]=t[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bTe{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let d=0;d<s.length;d++)s[d]=e[t[d]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=sn(this.rank),i=oH("rc",this.rank),o=new Array(this.rank);for(let d=0;d<t.length;d++)o[t[d]]=i[d];const a=`vec2(${o.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${s[this.rank-1]}`,u=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R1(n,e,t){const s=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new bTe(n.shape,e):new gTe(n.shape,e);return t.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xTe(n,e,t,s){const r=e,i=n.shape.length,o=dt(r,n.shape);let a=o;const l=Nn(a,i),u=l!=null;let d=n;u&&(d=R1(n,l,s),a=Bn(a.length,i)),Fs("sum",a,i);const[f,m]=Ss(d.shape,a);let y=f;t&&(y=Xn(f,o));const b=xe(m),v=xe(n.shape)/b,S=$e({inputs:{x:d},attrs:{shape:[v,b]},backend:s}),T=c2(n.dtype),I=Lh(S,T,"sum",s),k=$e({inputs:{x:I},attrs:{shape:y},backend:s});return s.disposeIntermediateTensorInfo(S),s.disposeIntermediateTensorInfo(I),u&&s.disposeIntermediateTensorInfo(d),k}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $1(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;return xTe(r,i,o,t)}const vTe={kernelName:Q_,backendName:"webgl",kernelFunc:$1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gr(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{perm:i}=s,o=t,a=r.shape.length,l=new Array(a);for(let d=0;d<l.length;d++)l[d]=r.shape[i[d]];let u;if(o.shouldExecuteOnCPU([r])){const f=o.texData.get(r.dataId).values,m=XA(f,r.shape,r.dtype,i,l);u=o.makeTensorInfo(l,r.dtype);const y=o.texData.get(u.dataId);y.values=m}else u=R1(r,i,o);return u}const wTe={kernelName:df,backendName:"webgl",kernelFunc:gr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fH=1e3;function gw({a:n,b:e,transposeA:t,transposeB:s,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const u=n.shape.length,d=e.shape.length,f=t?n.shape[u-2]:n.shape[u-1],m=s?e.shape[d-1]:e.shape[d-2],y=t?n.shape[u-1]:n.shape[u-2],b=s?e.shape[d-2]:e.shape[d-1],w=n.shape.slice(0,-2),v=e.shape.slice(0,-2),S=xe(w),T=xe(v),k=it(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([y,b]);j(f===m,()=>`Error in matMul: inner shapes (${f}) and (${m}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${s} must match.`);const O=t?[S,f,y]:[S,y,f],V=s?[T,b,m]:[T,m,b],P=$e({inputs:{x:n},backend:r,attrs:{shape:O}}),D=$e({inputs:{x:e},backend:r,attrs:{shape:V}}),$=[P,D],R=Math.max(S,T),A=t?P.shape[1]:P.shape[2],U=i!=null,F=o!=null,ne=l==="leakyrelu",Q=l!=null?Hg(l,!0):null,G=U||F||ne||Q!=null;let K;if((y===1||b===1)&&A>fH&&G===!1){let ce=P,z=D;t&&(ce=gr({inputs:{x:P},backend:r,attrs:{perm:[0,2,1]}}),$.push(ce)),s&&(z=gr({inputs:{x:D},backend:r,attrs:{perm:[0,2,1]}}),$.push(z));const X=b!==1,ie=b===1;let se=ce;X&&(se=$e({inputs:{x:ce},backend:r,attrs:{shape:[R,A,1]}}),$.push(se));const ve=b===1?2:1;let we=z;ie&&(we=$e({inputs:{x:z},backend:r,attrs:{shape:[R,1,A]}}),$.push(we));const Se=QA({inputs:{a:se,b:we},backend:r});K=$1({inputs:{x:Se},backend:r,attrs:{axis:ve,keepDims:!0}}),$.push(Se)}else{const ce=Gr(n.dtype,e.dtype),z=new dH(O,V,[R,y,b],t,s,U,Q,F,ne),X=[P,D];if(i!=null&&X.push(i),F&&X.push(o),ne){const ie=r.makeTensorInfo([],"float32",Pc(a,"float32"));X.push(ie),$.push(ie)}K=r.runWebGLProgram(z,X,ce)}const J=$e({inputs:{x:K},backend:r,attrs:{shape:k}});$.push(K);for(const ce of $)r.disposeIntermediateTensorInfo(ce);return J}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Te(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:d,leakyreluAlpha:f}=s;return gw({a:r,b:i,transposeA:l,transposeB:u,backend:t,bias:o,preluActivationWeights:a,leakyreluAlpha:f,activation:d})}const STe={kernelName:Wv,backendName:"webgl",kernelFunc:_Te};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JF="return abs(x);";function CTe(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const i=t.texData.get(s.dataId),o=rH(i.values);return t.makeTensorInfo(s.shape,s.dtype,o)}let r;return pe().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Jl(s.shape,JF):r=new Oo(s.shape,JF),t.runWebGLProgram(r,[s],s.dtype)}const TTe={kernelName:r_,backendName:"webgl",kernelFunc:CTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ETe=Fi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,ITe=Rt({opSnippet:ETe}),kTe={kernelName:xy,backendName:"webgl",kernelFunc:ITe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NTe=Fi+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,ATe=Rt({opSnippet:NTe}),RTe={kernelName:vy,backendName:"webgl",kernelFunc:ATe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZF="return a + b;",$Te=Vs({opSnippet:ZF,packedOpSnippet:ZF,supportsComplex:!0,cpuKernelImpl:zSe}),DTe={kernelName:ep,backendName:"webgl",kernelFunc:$Te};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OTe{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`float v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PTe{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`vec4 v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tv(n){const{inputs:e,backend:t}=n,s=e;if(s.length===1)return qr({inputs:{x:s[0]},backend:t});if(s.length>pe().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),u=tv({inputs:s.slice(0,l),backend:t}),d=tv({inputs:s.slice(l),backend:t});return tv({inputs:[u,d],backend:t})}const r=s.map(l=>l.dtype).reduce((l,u)=>Gr(l,u)),i=s.map(l=>l.shape),a=pe().getBool("WEBGL_PACK")?new PTe(s[0].shape,i):new OTe(s[0].shape,i);return t.runWebGLProgram(a,s,r)}const MTe={kernelName:_N,backendName:"webgl",kernelFunc:tv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LTe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=dt(i,r.shape);let u=l;const d=Nn(u,a);let f=r;d!=null&&(f=gr({inputs:{x:r},backend:t,attrs:{perm:d}}),u=Bn(u.length,a)),Fs("all",u,a);const[m,y]=Ss(f.shape,u),b=xe(y),w=$e({inputs:{x:f},backend:t,attrs:{shape:[-1,b]}}),v=Lh(w,w.dtype,"all",t);let S;if(o){const T=Xn(m,l);S=$e({inputs:{x:v},backend:t,attrs:{shape:T}})}else S=$e({inputs:{x:v},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(v),d!=null&&t.disposeIntermediateTensorInfo(f),S}const FTe={kernelName:SN,backendName:"webgl",kernelFunc:LTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VTe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=dt(i,r.shape);let u=l;const d=Nn(u,a);let f=r;d!=null&&(f=gr({inputs:{x:r},backend:t,attrs:{perm:d}}),u=Bn(u.length,a)),Fs("any",u,a);const[m,y]=Ss(f.shape,u),b=xe(y),w=$e({inputs:{x:f},backend:t,attrs:{shape:[-1,b]}}),v=Lh(w,w.dtype,"any",t);let S;if(o){const T=Xn(m,l);S=$e({inputs:{x:v},backend:t,attrs:{shape:T}})}else S=$e({inputs:{x:v},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(v),d!=null&&t.disposeIntermediateTensorInfo(f),S}const UTe={kernelName:CN,backendName:"webgl",kernelFunc:VTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BTe{constructor(e,t,s){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:o}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a=t==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zTe{constructor(e,t,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,j(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=sn(l),d=fr("coords",l);let f,m;if(o===1){m=l+1;const D=sn(m);f=`
        ${D} sourceLocR = ${D}(${d.join()}, 0);
        ++${d[l-1]};
        ${D} sourceLocG = ${D}(${d.join()}, 0);
        ++${d[l-2]};
        ${D} sourceLocA = ${D}(${d.join()}, 0);
        --${d[l-1]};
        ${D} sourceLocB = ${D}(${d.join()}, 0);
        --${d[l-2]};`}else m=l,f=`
        ${u} sourceLocR = coords;
        ++${d[l-1]};
        ${u} sourceLocG = coords;
        ++${d[l-2]};
        ${u} sourceLocA = coords;
        --${d[l-1]};
        ${u} sourceLocB = coords;
        --${d[l-2]};`;const y=["x","y","z","w","u","v"].slice(0,m),b="."+y[m-1],w=y.map(D=>"int "+D),v=fr("sourceLocR",m-1).concat("inIdx.r"),S=fr("sourceLocG",m-1).concat("inIdx.g"),T=fr("sourceLocB",m-1).concat("inIdx.b"),I=fr("sourceLocA",m-1).concat("inIdx.a"),k=s==="max"?"greaterThan":"lessThan",O=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${S.join()}),
                             getBestIndicesAChannel(${T.join()}),
                             getBestIndicesAChannel(${I.join()})));`,V=`vec4(
            getAChannel(${v.join()}),
            hasNextCol ? getAChannel(${S.join()}) : 0.,
            hasNextRow ? getAChannel(${T.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${I.join()}) : 0.)`,P=r?"":`
      float getBestIndicesAChannel(${w.join()}) {
        return getChannel(getBestIndicesA(${y.join()}),
                                          vec2(${y.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${w.join()}) {
        return getChannel(getA(${y.join()}),
                               vec2(${y.slice(-2).join()}));
      }
      ${P}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${d[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${d[l-2]} < ${a[l-2]-1};
        ${f}
        ivec4 srcIdx = ivec4(sourceLocR${b}, sourceLocG${b},
          sourceLocB${b}, sourceLocA${b}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${V};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${O}
          vec4 candidate = ${V};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${k}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pH(n,e,t,s=null){let r=e.shape[0],i=e.shape[1];s!=null&&(r=s.shape[0],i=s.shape[1]);const o=p1(i),a={windowSize:o,inSize:i,batchSize:r,outSize:Math.ceil(i/o)},l=new BTe(a,t,s==null),u=[e];s!=null&&u.push(s);const d=n.runWebGLProgram(l,u,"int32");if(d.shape[1]===1)return d;const f=pH(n,e,t,d);return n.disposeIntermediateTensorInfo(d),f}function mH(n,e,t,s=null){const r=s!=null?s.shape:e.shape,i=r[r.length-1],o=p1(i),a=new zTe(r,o,t,s==null),l=s==null?[e]:[e,s],u=n.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){const d=mH(n,e,t,u);return n.disposeIntermediateTensorInfo(u),d}return u}function gH(n,e,t,s){const r=[t];if(Fs("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!pe().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],o=n.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=n.unpackTensor(e),i.push(l));const[u,d]=Ss(l.shape,r),f=xe(d),m=$e({inputs:{x:l},backend:n,attrs:{shape:[-1,f]}});i.push(m);const y=pH(n,m,s);i.push(y);const b=$e({inputs:{x:y},backend:n,attrs:{shape:u}});return i.forEach(w=>n.disposeIntermediateTensorInfo(w)),b}return mH(n,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jTe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;let o=dt(i,r.shape);const a=Nn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=gr({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=Bn(o.length,l.shape.length)),Fs("argMax",[o[0]],l.shape.length);const d=gH(t,l,o[0],"max");return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),d}const WTe={kernelName:i_,backendName:"webgl",kernelFunc:jTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GTe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;let o=dt(i,r.shape);const a=Nn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=gr({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=Bn(o.length,l.shape.length)),Fs("argMin",[o[0]],l.shape.length);const d=gH(t,l,o[0],"min");return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),d}const HTe={kernelName:o_,backendName:"webgl",kernelFunc:GTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qTe=Fi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,KTe=Rt({opSnippet:qTe}),XTe={kernelName:wy,backendName:"webgl",kernelFunc:KTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YTe=Fi+"return log(x + sqrt(x * x + 1.0));",QTe=Rt({opSnippet:YTe}),JTe={kernelName:_y,backendName:"webgl",kernelFunc:QTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZTe=Fi+`
  return atan(x);
`,eEe=Rt({opSnippet:ZTe}),tEe={kernelName:Sy,backendName:"webgl",kernelFunc:eEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nEe=YA+`
  return atan(a, b);
`,sEe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Mh+`
  return result;
`,rEe=Vs({opSnippet:nEe,packedOpSnippet:sEe}),iEe={kernelName:Ty,backendName:"webgl",kernelFunc:rEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oEe=Fi+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,aEe=Rt({opSnippet:oEe}),lEe={kernelName:Cy,backendName:"webgl",kernelFunc:aEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qg{constructor(e,t,s,r=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterHeight,m=e.effectiveFilterWidth,y=e.padInfo.top,b=e.padInfo.left;this.outputShape=e.outShape;const w=t==="avg",v=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,S=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let T="0.0";if(w||(T="-1.0 / 1e-20"),s){this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${y}, ${b});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${f};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${m};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?i?v:S:`wR * ${m} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const I="max";let k=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(k="avgValue / max(count, 1.0)");const O=Math.floor(o/4)*4,V=o%4,P=`
      if (${w}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${I}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${y}, ${b});
      const float initializationValue = ${T};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${T});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${f};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${O}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${P}
          }

          int xC = xCCorner + ${O};
          if (${V===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${P}
          } else if (${V===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${P}
          } else if (${V===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${P}
          }
        }
        setOutput(${k});
      }
    `}}class JA{constructor(e,t,s,r=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,d=e.dilationDepth,f=e.dilationHeight,m=e.dilationWidth,y=e.effectiveFilterDepth,b=e.effectiveFilterHeight,w=e.effectiveFilterWidth,v=e.padInfo.front,S=e.padInfo.top,T=e.padInfo.left;this.outputShape=e.outShape;const I=t==="avg";let k="0.0";if(I||(k="-1.0 / 1e-20"),s){this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${v}, ${S}, ${T});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${y};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${b};
                wR += ${f}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${w};
                  wC += ${m}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${b} * ${w} +
                      wR * ${w} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const O="max";let V=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(V="avgValue / max(count, 1.0)");const P=Math.floor(o/4)*4,D=o%4,$=`
      if (${I}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${O}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${v}, ${S}, ${T});
      const float initializationValue = ${k};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${k});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${y};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${b};
            wR += ${f}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${P}; wC += 4) {
              int xC = xCCorner + wC * ${m};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                getValue(batch, xD, xR, xC + 2 * ${m}, ch),
                getValue(batch, xD, xR, xC + 3 * ${m}, ch)
              );

              ${$}
            }

            int xC = xCCorner + ${P};
            if (${D===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${$}
            } else if (${D===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                initializationValue,
                initializationValue
              );

              ${$}
            } else if (${D===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                getValue(batch, xD, xR, xC + 2 * ${m}, ch),
                initializationValue
              );

              ${$}
            }
          }
        }
        setOutput(${V});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cEe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;$0(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;j(tr(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=Mi(r.shape,i,o,u,a,l);if(d.filterWidth===1&&d.filterHeight===1&&zt(d.inShape,d.outShape))return qr({inputs:{x:r},backend:t});const f=new qg(d,"avg",!1);return t.runWebGLProgram(f,[r],"float32")}const uEe={kernelName:a_,backendName:"webgl",kernelFunc:cEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hEe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s,d=[1,1,1],f=ol(r.shape,i,o,d,a,l,u),m=new JA(f,"avg",!1);return t.runWebGLProgram(m,[r],"float32")}const dEe={kernelName:l_,backendName:"webgl",kernelFunc:hEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fEe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=l-1-e.padInfo.top,f=u-1-e.padInfo.left,m=1/(t*s);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${f});
      const float avgMultiplier = float(${m});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class pEe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterDepth,m=e.effectiveFilterHeight,y=e.effectiveFilterWidth,b=f-1-e.padInfo.front,w=m-1-e.padInfo.top,v=y-1-e.padInfo.left,S=1/(t*s*r);this.userCode=`
      const ivec3 pads = ivec3(${b}, ${w}, ${v});
      const float avgMultiplier = float(${S});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${m};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${y};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mEe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:d}=s,f=[1,1,1],m=ol(o.shape,a,l,f,u,d),y=new pEe(m);return t.runWebGLProgram(y,[r],o.dtype)}const gEe={kernelName:EN,backendName:"webgl",kernelFunc:mEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yEe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i;$0([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,d=Mi(o.shape,a,l,1,u),f=new fEe(d);return t.runWebGLProgram(f,[r],o.dtype)}const bEe={kernelName:TN,backendName:"webgl",kernelFunc:yEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xEe(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;return gw({a:r,b:i,transposeA:o,transposeB:a,backend:t})}const vEe={kernelName:c_,backendName:"webgl",kernelFunc:xEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wEe{constructor(e,t,s,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],it(e,t),it(e,s);let a="0.0";r!=null&&(it(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(it(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _Ee{constructor(e,t,s,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],it(e,t),it(e,s);let a="vec4(0.0)";r!=null&&(it(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(it(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SEe=({inputs:n,backend:e,attrs:t})=>{const{x:s,mean:r,variance:i,offset:o,scale:a}=n;j(r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),j(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),j(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=t;l==null&&(l=.001);const u=[s,r,i];let d=null;o!=null&&(d=o.shape,u.push(o));let f=null;a!=null&&(f=a.shape,u.push(a));const m=pe().getBool("WEBGL_PACK_NORMALIZATION")?new _Ee(s.shape,r.shape,i.shape,d,f,l):new wEe(s.shape,r.shape,i.shape,d,f,l);return e.runWebGLProgram(m,u,u[0].dtype)},CEe={kernelName:w_,backendName:"webgl",kernelFunc:SEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TEe{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=sn(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=EEe(this.rank);let r;const i=e.map((o,a)=>`sourceLoc.${pI[a]} = start[${a}] + coords.${pI[a]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const pI=["x","y","z","w","u","v"];function EEe(n){if(n===1)return"sourceLoc";if(n<=6)return pI.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IEe{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=sn(this.rank),s=fr("coords",this.rank),r=fr("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${i})`,a=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((d,f)=>`start[${f}]`).join()});`:e.map((d,f)=>`${r[f]} = ${s[f]} + start[${f}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kEe(n,e,t,s){const r=s.texData.get(n.dataId),i=s.makeTensorInfo(t,n.dtype),o=s.texData.get(i.dataId);Object.assign(o,r),o.refCount=1,o.shape=t,o.dtype=n.dtype;let a=q2(e,je(n.shape));r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||n.dataId};const l=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,l+1),i}function fp(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,size:o}=s,[a,l]=f1(r,i,o);if(W2(r,a,l),xe(l)===0)return t.makeTensorInfo(l,r.dtype,[]);if(t.shouldExecuteOnCPU([r])||r.dtype==="string"){const f=t.texData.get(r.dataId),m=vCe(f.values,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,m)}const{isPacked:u}=t.texData.get(r.dataId),d=H2(r.shape,a,l);if(u||!d){const f=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new IEe(l):new TEe(l),m=[a];return t.runWebGLProgram(f,[r],r.dtype,m)}return t.uploadToGPU(r.dataId),kEe(r,a,l,t)}const NEe={kernelName:Y_,backendName:"webgl",kernelFunc:fp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AEe=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,crops:o}=s;j(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((T,I)=>T*I),l=x0(r.shape,i,a),u=v0(l.length,i.length),d=w0(r.shape,i,a),f=J2(o,i.length),m=Z2(d,o,i.length),y=[],b=$e({inputs:{x:r},backend:t,attrs:{shape:l}}),w=gr({inputs:{x:b},backend:t,attrs:{perm:u}}),v=$e({inputs:{x:w},backend:t,attrs:{shape:d}}),S=fp({inputs:{x:v},backend:t,attrs:{begin:f,size:m}});return y.push(b),y.push(w),y.push(v),y.forEach(T=>t.disposeIntermediateTensorInfo(T)),S},REe={kernelName:u_,backendName:"webgl",kernelFunc:AEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Ee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o}=s,a=t.readSync(r.dataId),l=t.readSync(i.dataId),u=sH(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}const DEe={kernelName:IN,backendName:"webgl",kernelFunc:$Ee};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OEe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,PEe=`
  return float(int(a.r) & int(b.r));
`;function MEe(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,i=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=pe().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([s,r])||o===1){const l=t.texData.get(s.dataId).values,u=t.texData.get(r.dataId).values,[d,f]=WSe(s.shape,r.shape,l,u,s.dtype),m=t.makeTensorInfo(f,s.dtype),y=t.texData.get(m.dataId);return y.values=d,m}let a;return i?a=new hp(OEe,s.shape,r.shape,!1):a=new vh(PEe,s.shape,r.shape),t.runWebGLProgram(a,[s,r],s.dtype)}const LEe={kernelName:kN,backendName:"webgl",kernelFunc:MEe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FEe(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,i=t.readSync(s.dataId),o=t.readSync(r.dataId),a=it(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const VEe={kernelName:lz,backendName:"webgl",kernelFunc:FEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UEe="return float(a != b);",yH=Vs({opSnippet:UEe,cpuKernelImpl:hCe,dtype:"bool"}),BEe={kernelName:F_,backendName:"webgl",kernelFunc:yH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O0(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return qr({inputs:{x:r.complexTensorInfos.real},backend:t})}const zEe={kernelName:ZN,backendName:"webgl",kernelFunc:O0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jEe="return float(int(x));";function WEe(n,e){const t=new Oo(n.shape,jEe),s=e.runWebGLProgram(t,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mI(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return qr({inputs:{x:r},backend:t});const o=vs(r.shape),a=mI({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),l=Wc({inputs:{real:a,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const o=O0({inputs:{input:r},backend:t}),a=mI({inputs:{x:o},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(o),a}if(!sz(r.dtype,i)){const o=qr({inputs:{x:r},backend:t});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(t.shouldExecuteOnCPU([r])){const o=t.texData.get(r.dataId).values,[a,l,u]=GSe(o,r.shape,r.dtype,i);return t.makeTensorInfo(a,l,u)}if(i==="int32")return WEe(r,t);if(i==="bool"){const o=t.makeTensorInfo([],"bool",Js("bool",1)),l=yH({inputs:{a:r,b:o},backend:t});return t.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${i}`)}const GEe={kernelName:Ey,backendName:"webgl",kernelFunc:mI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e3="return ceil(x);",HEe=Rt({opSnippet:e3,packedOpSnippet:e3,cpuKernelImpl:HSe}),qEe={kernelName:Iy,backendName:"webgl",kernelFunc:HEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KEe{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XEe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YEe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{clipValueMin:i,clipValueMax:o}=s;let a;pe().getBool("WEBGL_PACK_CLIP")?a=new XEe(r.shape):a=new KEe(r.shape);const l=[[i],[o]];return t.runWebGLProgram(a,[r],r.dtype,l)}const QEe={kernelName:ky,backendName:"webgl",kernelFunc:YEe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JEe{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t3(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function ZEe(n){const{inputs:e,backend:t}=n,{x:s}=e,r=t.texData.get(s.dataId),i=new JEe(s.shape),o=[t3(s,r.complexTensorInfos.real),t3(s,r.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}const eIe={kernelName:h_,backendName:"webgl",kernelFunc:ZEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tIe{constructor(e){this.outputShape=[],this.outputShape=Wo(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let o=1;o<t.length;o++)t[o]=t[o-1]+e[o][1];const s=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<t.length;o++){const a=t[o-1];s.push(`else if (yC < ${t[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const r=t.length,i=t[t.length-1];s.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nIe{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Wo(e,t);const s=this.outputShape,r=s.length,i=sn(r),o=fr("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((w,v)=>`T${v}`);const l=new Array(e.length-1);l[0]=e[0][t];for(let w=1;w<l.length;w++)l[w]=l[w-1]+e[w][t];const u=a[t],d=a.slice(-2),f=a.join();let m=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${f}), vec2(${d.join()}));
        }`;for(let w=1;w<l.length;w++){const v=l[w-1];m+=`
        if (${u} < ${l[w]}  && ${u} >= ${l[w-1]}) {
          return getChannel(
            getT${w}(${$x(a,u,v)}),
            vec2(${$x(d,u,v)}));
        }`}const y=l.length,b=l[l.length-1];m+=`
        return getChannel(
          getT${y}(${$x(a,u,b)}),
          vec2(${$x(d,u,b)}));`,this.userCode=`
      float getValue(${a.map(w=>"int "+w)}) {
        ${m}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${s[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${s[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${s[r-2]} &&
            ${o[r-1]} < ${s[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function $x(n,e,t){const s=n.indexOf(e);return n.map((i,o)=>o===s?`${i} - ${t}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D1(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return qr({inputs:{x:r.complexTensorInfos.imag},backend:t})}const sIe={kernelName:GN,backendName:"webgl",kernelFunc:D1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qm(n,e,t){const s=n[0].dtype;if(s==="complex64"){const y=n.map(T=>O0({inputs:{input:T},backend:t})),b=n.map(T=>D1({inputs:{input:T},backend:t})),w=qm(y,e,t),v=qm(b,e,t),S=Wc({inputs:{real:w,imag:v},backend:t});return y.forEach(T=>t.disposeIntermediateTensorInfo(T)),b.forEach(T=>t.disposeIntermediateTensorInfo(T)),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(v),S}let r=t.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const y=n.map(k=>{const V=[-1,xe(k.shape.slice(e))];return $e({inputs:{x:k},backend:t,attrs:{shape:V}})}),b=y.map(k=>({vals:t.readSync(k.dataId),shape:k.shape})),w=Wo(y.map(k=>k.shape),1),v=y[0].shape[0]===1,S=qSe(b,w,s,v),T=Wo(n.map(k=>k.shape),e),I=t.makeTensorInfo(T,s,S);return y.forEach(k=>t.disposeIntermediateTensorInfo(k)),I}const i=n.filter(y=>xe(y.shape)>0),o=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const y=o?new Oo(n[0].shape,jl):new Jl(n[0].shape,jl);return t.runWebGLProgram(y,n,s)}const a=pe().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){const y=[];for(let w=0;w<i.length;w+=a){const v=i.slice(w,w+a);y.push(qm(v,e,t))}const b=qm(y,e,t);for(const w of y)t.disposeIntermediateTensorInfo(w);return b}if(o){const y=new nIe(i.map(b=>b.shape),e);return t.runWebGLProgram(y,i,s)}const{tensors2D:l,outShape:u}=rIe(i,e,t),d=new tIe(l.map(y=>y.shape)),f=t.runWebGLProgram(d,l,s);l.forEach(y=>t.disposeIntermediateTensorInfo(y));const m=$e({inputs:{x:f},attrs:{shape:u},backend:t});return t.disposeIntermediateTensorInfo(f),m}function rIe(n,e,t){const s=Wo(n.map(i=>i.shape),e);return{tensors2D:n.map(i=>$e({inputs:{x:i},attrs:{shape:[-1,xe(i.shape.slice(e))]},backend:t})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bH(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,i=dt(r,e[0].shape)[0],o=e.map(u=>u.shape);X2(o,i);const a=Wo(e.map(u=>u.shape),i);if(xe(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(u=>xe(u.shape)>0);return l.length===1?qr({inputs:{x:l[0]},backend:t}):qm(l,i,t)}const iIe={kernelName:d_,backendName:"webgl",kernelFunc:bH};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xH{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,d=e.dilationHeight,f=e.dilationWidth,m=e.filterHeight,y=e.filterWidth,b=Math.floor(e.inChannels/4)*4,w=e.inChannels%4,v=e.dataFormat==="channelsLast",S=v?1:2,T=v?2:3,I=v?3:1;let k="",O="";s&&(r?k=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?k=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:k=`
          float activation(float x) {
            ${s}
          }
        `,O="result = activation(result);");const V=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${k}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${I}];

        ivec2 xRCCorner =
            ivec2(coords[${S}], coords[${T}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${m}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${y}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${b}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${v}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${w===1}) {

              if (${v}) {
                dotProd +=
                    getX(batch, xR, xC, ${b}) *
                    getW(wR, wC, ${b}, d2);
              } else {
                dotProd +=
                    getX(batch, ${b}, xR, xC) *
                    getW(wR, wC, ${b}, d2);
              }

            } else if (${w===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${b}, d2),
                getW(wR, wC, ${b} + 1, d2)
              );

              if (${v}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${b}),
                  getX(batch, xR, xC, ${b} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${b}, xR, xC),
                  getX(batch, ${b} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${w===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${b}, d2),
                getW(wR, wC, ${b} + 1, d2),
                getW(wR, wC, ${b} + 2, d2)
              );

              if (${v}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${b}),
                  getX(batch, xR, xC, ${b} + 1),
                  getX(batch, xR, xC, ${b} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${b}, xR, xC),
                  getX(batch, ${b} + 1, xR, xC),
                  getX(batch, ${b} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${V}
        ${O}
        setOutput(result);
      }
    `}}class oIe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,f=e.filterDepth,m=e.filterHeight,y=e.filterWidth,b=Math.floor(e.inChannels/4)*4,w=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${a});
      const ivec3 pads = ivec3(${t}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${f}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${y}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${b}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${w===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${b}) *
                  getW(wF, wR, wC, ${b}, d2);
              } else if (${w===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${b}),
                  getX(batch, xF, xR, xC, ${b} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${b}, d2),
                  getW(wF, wR, wC, ${b} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${w===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${b}),
                  getX(batch, xF, xR, xC, ${b} + 1),
                  getX(batch, xF, xR, xC, ${b} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${b}, d2),
                  getW(wF, wR, wC, ${b} + 1, d2),
                  getW(wF, wR, wC, ${b} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vH{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=sr(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,f=d;let m=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let v=0;v<d;v++)m+=`
           vec4 xTexelC${v*2};
           int xTexelC${v*2}Ready;
           vec4 xTexelC${v*2+1};
           int xTexelC${v*2+1}Ready;
           vec4 xC${v};`;m+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let v=0;v<d;v++)m+=`
           xTexelC${v*2} = vec4(0.0);
           xTexelC${v*2}Ready = 0;
           xTexelC${v*2+1} = vec4(0.0);
           xTexelC${v*2+1}Ready = 0;
           xC${v} = vec4(0.0);`;m+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let v=0;v<(f+1)/2;v++){const S=v*2;if(m+=`
           xC = xCCorner + ${S*l};
           `,a===1){if(S<d&&(o%2===1?(m+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S}Ready == 0) {
                   xTexelC${S} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${S}.zw = vec2(0.0);
                   }
                   xTexelC${S}Ready = 1;
                 }
               `,l===1&&S>0?m+=`
                 xC${S} = vec4(xTexelC${S-2}.zw, xTexelC${S}.xy);
                 `:m+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${S} = vec4(previous.zw, xTexelC${S}.xy);
                   } else {
                     xC${S} = vec4(0.0, 0.0, xTexelC${S}.xy);
                   }
                   `):m+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${S}Ready == 0) {
                   xTexelC${S} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${S}.zw = vec2(0.0);
                   }
                   xTexelC${S}Ready = 1;
                 }

                 xC${S} = xTexelC${S};
                 `,S+1<d)){const T=o%2===0?yN(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(m+=`
                   xCOffset = xC + imod(pads[1], 2) + ${T};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S+1}Ready == 0) {
                     xTexelC${S+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${S+1}.zw = vec2(0.0);
                     }
                     xTexelC${S+1}Ready = 1;
                   }
                   `,l>1?m+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${S+1} = vec4(previous.zw, xTexelC${S+1}.xy);
                     } else {
                      xC${S+1} = vec4(0.0, 0.0, xTexelC${S+1}.xy);
                     }
                     `:m+=`
                     xC${S+1} = vec4(xTexelC${S}.zw, xTexelC${S+1}.xy);
                     `):T===1?m+=`
                     xC${S+1} = xTexelC${S};
                     `:m+=`
                     xCOffset = xC + ${T};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S+1}Ready == 0) {
                       xTexelC${S+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${S+1}.zw = vec2(0.0);
                       }
                       xTexelC${S+1}Ready = 1;
                     }

                     xC${S+1} = xTexelC${S+1};
                     `}}else S<d&&(o%2===1?(m+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S}Ready == 0) {
                   xTexelC${S} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${S}.zw = vec2(0.0);
                   }
                   xTexelC${S}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${S+1}Ready == 0) {
                   xTexelC${S+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${S+1}.zw = vec2(0.0);
                   }
                   xTexelC${S+1}Ready = 1;
                 }

                 xC${S} = vec4(xTexelC${S}.zw, xTexelC${S+1}.zw);
               `,S+1<d&&(m+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${S+1} = vec4(xTexelC${S+1}.xy, final.xy);
                 `)):(m+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${S}Ready == 0) {
                   xTexelC${S} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${S}.zw = vec2(0.0);
                   }
                   xTexelC${S}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${S+1}Ready == 0) {
                   xTexelC${S+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${S+1}.zw = vec2(0.);
                   }
                   xTexelC${S+1}Ready = 1;
                 }

                 xC${S} = vec4(
                   xTexelC${S}.xy, xTexelC${S+1}.xy);
               `,S+1<d&&(m+=`
                   xC${S+1} = vec4(xTexelC${S}.zw, xTexelC${S+1}.zw);
                 `)));S<d&&(m+=`
             wTexel = getW(r, ${S}, d1, d2);
             dotProd += xC${S}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${S}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,S+1<d&&(m+=`
               wTexel = getW(r, ${S+1}, d1, d2);
               dotProd += xC${S+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${S+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}m+=`
     }
   `,m+=`
     }
   `,m+=`
     }
   `;let y="",b="";s&&(r?y=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:i?y=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:y=`vec4 activation(vec4 x) {
           ${s}
         }`,b="result = activation(result);");const w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${y}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${m}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${w}
         ${b}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aIe{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=sr(this.outputShape.length);const{dataFormat:s}=t,r=yr(),i=s==="channelsLast",o=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let u="";for(let d=0;d<=1;d++)for(let f=0;f<=1;f++)u+=`
          blockIndex = rc.z + ${f};
          pos = rc.y + ${d};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yw(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function wH({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=n.shape,u=s.texData.get(n.dataId),d=t.inChannels,f=l[0]*l[1]*l[2],m=t.outChannels,y=t.dataFormat==="channelsLast",b=!1,w=!1;let v;const S=[];if(i!=null){const k=yw(i.shape,y);k!=null&&(i=$e({inputs:{x:i},backend:s,attrs:{shape:k}}),S.push(i))}if(r!=null){const k=yw(r.shape,y);k!=null&&(r=$e({inputs:{x:r},backend:s,attrs:{shape:k}}),S.push(r))}if(!((f===1||m===1)&&d>fH)&&u.isPacked&&y&&u.texture!=null&&l[2]%2!==0&&zt(u.shape.slice(-3),l.slice(-3))){const k=l[0]*l[1]*(l[2]+1),O={dataId:n.dataId,shape:[1,k,t.inChannels],dtype:n.dtype},V=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,j(mw(u.shape,O.shape),()=>`packed reshape ${u.shape} to ${O.shape} isn't free`);const P=$e({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}});S.push(P);const D=gw({a:O,b:P,backend:s,transposeA:b,transposeB:w,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),$=s.texData.get(D.dataId);j($.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=V,$.shape=t.outShape,v=qr({inputs:{x:D},backend:s}),v.shape=t.outShape,S.push(D)}else{const k=t.outHeight*t.outWidth,O=$e({inputs:{x:n},backend:s,attrs:{shape:y?[t.batchSize,k,t.inChannels]:[t.batchSize,t.inChannels,k]}}),V=$e({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}}),P=gw({a:y?O:V,b:y?V:O,transposeA:!y,transposeB:w,backend:s,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o});v=$e({inputs:{x:P},backend:s,attrs:{shape:t.outShape}}),S.push(O),S.push(V),S.push(P)}for(const k of S)s.disposeIntermediateTensorInfo(k);return v}function _H({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:d,outWidth:f,outHeight:m,dataFormat:y}=t,b=y==="channelsLast",w=l*u*d,v=m*f,S=[t.batchSize,w,v],T=!0,I=!1,k=[];if(i!=null){const J=yw(i.shape,b);J!=null&&(i=$e({inputs:{x:i},backend:s,attrs:{shape:J}}),k.push(i))}if(r!=null){const J=yw(r.shape,b);J!=null&&(r=$e({inputs:{x:r},backend:s,attrs:{shape:J}}),k.push(r))}const O=$e({inputs:{x:e},backend:s,attrs:{shape:[1,w,xe(e.shape)/w]}});k.push(O);const V=new aIe(S,t),P=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],D=s.runWebGLProgram(V,[n],"float32",P),$=$e({inputs:{x:D},backend:s,attrs:{shape:S}});k.push(D),k.push($);const R=r!=null,A=i!=null,U=a==="leakyrelu",F=a?Hg(a,!0):null,ne=new dH(b?$.shape:O.shape,b?O.shape:$.shape,b?[t.batchSize,v,t.outChannels]:[t.batchSize,t.outChannels,v],T,I,R,F,A,U),Q=b?[$,O]:[O,$];if(r&&Q.push(r),A&&Q.push(i),U){const J=s.makeTensorInfo([],"float32",Pc(o,"float32"));Q.push(J),k.push(J)}const G=s.runWebGLProgram(ne,Q,"float32"),K=$e({inputs:{x:G},backend:s,attrs:{shape:t.outShape}});k.push(G);for(const J of k)s.disposeIntermediateTensorInfo(J);return K}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:d}=s,f=al(l),m=Ls(r.shape,i.shape,o,u,a,d,!1,f);let y;if(m.filterHeight===1&&m.filterWidth===1&&m.dilationHeight===1&&m.dilationWidth===1&&m.strideHeight===1&&m.strideWidth===1&&(m.padInfo.type==="SAME"||m.padInfo.type==="VALID"))y=wH({x:r,filter:i,convInfo:m,backend:t});else if(m.strideWidth<=2&&f==="channelsLast"&&pe().getBool("WEBGL_EXP_CONV")){const w=new vH(m),v=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]];y=t.runWebGLProgram(w,[r,i],"float32",v)}else if(pe().getBool("WEBGL_CONV_IM2COL"))y=_H({x:r,filter:i,convInfo:m,backend:t});else{const w=new xH(m);y=t.runWebGLProgram(w,[r,i],"float32")}const b=$e({inputs:{x:y},backend:t,attrs:{shape:m.outShape}});return t.disposeIntermediateTensorInfo(y),b}const cIe={kernelName:f_,backendName:"webgl",kernelFunc:lIe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uIe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class hIe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,l=s-1-e.padInfo.left,u=o?1:2,d=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${f}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class dIe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class fIe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=t-1-e.padInfo.front,u=s-1-e.padInfo.top,d=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:d}=s,f=al(l),m=Ls(r.shape,d,o,1,a,u,!1,f),y=new uIe(m);return t.runWebGLProgram(y,[r,i],"float32")}const mIe={kernelName:AN,backendName:"webgl",kernelFunc:pIe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gIe{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=sr(this.outputShape.length);const t=e.filterHeight,s=e.filterWidth,r=t-1-e.padInfo.top,i=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yIe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:d}=s,f=al(u),m=Ls(o,i.shape,a,1,l,d,!1,f);if(pe().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&f==="channelsLast"){const y=[[m.strideHeight,m.strideWidth]],b=new gIe(m);return t.runWebGLProgram(b,[r,i],"float32",y)}else{const y=new hIe(m);return t.runWebGLProgram(y,[r,i],"float32")}}const bIe={kernelName:p_,backendName:"webgl",kernelFunc:yIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=Lc(r.shape,i.shape,o,l,a),d=new oIe(u);return t.runWebGLProgram(d,[r,i],"float32")}const vIe={kernelName:m_,backendName:"webgl",kernelFunc:xIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s,u=Lc(r.shape,l,o,1,a),d=new dIe(u);return t.runWebGLProgram(d,[r,i],"float32")}const _Ie={kernelName:RN,backendName:"webgl",kernelFunc:wIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SIe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s,u=Lc(l,i.shape,a,1,o),d=new fIe(u);return t.runWebGLProgram(d,[r,i],"float32")}const CIe={kernelName:$N,backendName:"webgl",kernelFunc:SIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TIe=dp+`
  return cos(x);
`,EIe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Mh}
  return result;
`,IIe=Rt({opSnippet:TIe,packedOpSnippet:EIe}),kIe={kernelName:Ny,backendName:"webgl",kernelFunc:IIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NIe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,AIe=Rt({opSnippet:NIe}),RIe={kernelName:Ay,backendName:"webgl",kernelFunc:AIe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $Ie{constructor(e,t,s,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,u]=e,[d]=t,[f,m]=s;this.outputShape=[d,f,m,u];const y=r==="bilinear"?1:0,[b,w]=[`${a-1}.0`,`${l-1}.0`],[v,S,T]=f>1?[`${(a-1)/(f-1)}`,"(y2-y1) * height_ratio",`y1*${b} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${b}`],[I,k,O]=m>1?[`${(l-1)/(m-1)}`,"(x2-x1) * width_ratio",`x1*${w} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${w}`];this.userCode=`
      const float height_ratio = float(${v});
      const float width_ratio = float(${I});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${S};
        float width_scale = ${k};

        float in_y = ${T};
        if( in_y < 0.0 || in_y > ${b} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${O};
        if( in_x < 0.0 || in_x > ${w} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${y} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DIe=n=>{const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,d=new $Ie(r.shape,i.shape,a,l,u);return t.runWebGLProgram(d,[r,i,o],"float32")},OIe={kernelName:ON,backendName:"webgl",kernelFunc:DIe};var Kg;(function(n){n.Prod="*",n.Sum="+"})(Kg||(Kg={}));class n3{constructor(e,t,s,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===Kg.Prod?"1.0":"0.0",a=s?o:`getX(${s3(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let u="",d="";s?(u=r?`end != ${l-1}`:"end != 0",d=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${l}`:"end >= pow2",d=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${sn(i)} coords = getOutputCoords();
        int end = ${r3(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${d};
          ${r3(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${s3(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function s3(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function r3(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SH(n,e,t,s,r,i){const o=e.shape.length,a=Nn([s],o);let l=e;a!=null&&(l=gr({inputs:{x:e},backend:t,attrs:{perm:a}}));const u=Bn(1,o)[0];if(u!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const d=l.shape[u];let f=qr({inputs:{x:l},backend:t});for(let m=0;m<=Math.ceil(Math.log2(d))-1;m++){const y=new n3(n,l.shape,!1,i),b=[[m]],w=f;f=t.runWebGLProgram(y,[f],f.dtype,b),t.disposeIntermediateTensorInfo(w)}if(r){const m=new n3(n,l.shape,r,i),y=f;f=t.runWebGLProgram(m,[f],f.dtype),t.disposeIntermediateTensorInfo(y)}if(a!=null){const m=Fc(a),y=gr({inputs:{x:f},backend:t,attrs:{perm:m}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(l),y}return f}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return SH(Kg.Prod,r,t,i,o,a)}const MIe={kernelName:DN,backendName:"webgl",kernelFunc:PIe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return SH(Kg.Sum,r,t,i,o,a)}const FIe={kernelName:g_,backendName:"webgl",kernelFunc:LIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=t.readSync(r.dataId),u=t.readSync(i.dataId),d=sH(l,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,d)}else if(r.shape.length===2){const l=t.bufferSync(r),u=t.bufferSync(i),d=jSe(l,u,o,a);return t.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const UIe={kernelName:PN,backendName:"webgl",kernelFunc:VIe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BIe{constructor(e,t,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:i,dataFormat:o}=s,a=r.shape[0],l=o==="NHWC"?r.shape[1]:r.shape[2],u=o==="NHWC"?r.shape[2]:r.shape[3],d=o==="NHWC"?r.shape[3]:r.shape[1],f=l*i,m=u*i,y=d/(i*i),b=o==="NHWC"?[a,f,m,y]:[a,y,f,m],w=new BIe(b,i,o);return t.runWebGLProgram(w,[r],r.dtype)}const jIe={kernelName:MN,backendName:"webgl",kernelFunc:zIe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CH{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=sr(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let u="",d="";s&&(r?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:u=`
          float activation(float x) {
            ${s}
          }
        `,d="result = activation(result);");const f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${f}
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TH{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=sr(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,d=e.filterHeight,f=e.filterWidth,m=f;let y=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let S=0;S<f;S++)y+=`
          vec4 xTexelC${S*2};
          int xTexelC${S*2}Ready;
          vec4 xTexelC${S*2+1};
          int xTexelC${S*2+1}Ready;
          vec4 xC${S};`;y+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let S=0;S<f;S++)y+=`
          xTexelC${S*2} = vec4(0.0);
          xTexelC${S*2}Ready = 0;
          xTexelC${S*2+1} = vec4(0.0);
          xTexelC${S*2+1}Ready = 0;
          xC${S} = vec4(0.0);`;y+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let S=0;S<(m+1)/2;S++){const T=S*2;if(y+=`
          xC = xCCorner + ${T*u};
          `,l===1){if(T<f&&(a%2===1?(y+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${T}Ready == 0) {
                  xTexelC${T} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${T}.zw = vec2(0.0);
                  }
                  xTexelC${T}Ready = 1;
                }
              `,u===1&&T>0?y+=`
                xC${T} = vec4(xTexelC${T-2}.zw, xTexelC${T}.xy);
                `:y+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${T} = vec4(previous.zw, xTexelC${T}.xy);
                  } else {
                    xC${T} = vec4(0.0, 0.0, xTexelC${T}.xy);
                  }
                  `):y+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${T}Ready == 0) {
                  xTexelC${T} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${T}.zw = vec2(0.0);
                  }
                  xTexelC${T}Ready = 1;
                }

                xC${T} = xTexelC${T};
                `,T+1<f)){const I=a%2===0?yN(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(y+=`
                  xCOffset = xC + imod(pads[1], 2) + ${I};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${T+1}Ready == 0) {
                    xTexelC${T+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${T+1}.zw = vec2(0.0);
                    }
                    xTexelC${T+1}Ready = 1;
                  }
                  `,u>1?y+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${T+1} = vec4(previous.zw, xTexelC${T+1}.xy);
                    } else {
                     xC${T+1} = vec4(0.0, 0.0, xTexelC${T+1}.xy);
                    }
                    `:y+=`
                    xC${T+1} = vec4(xTexelC${T}.zw, xTexelC${T+1}.xy);
                    `):I===1?y+=`
                    xC${T+1} = xTexelC${T};
                    `:y+=`
                    xCOffset = xC + ${I};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${T+1}Ready == 0) {
                      xTexelC${T+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${T+1}.zw = vec2(0.0);
                      }
                      xTexelC${T+1}Ready = 1;
                    }

                    xC${T+1} = xTexelC${T+1};
                    `}}else T<f&&(a%2===1?(y+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${T}Ready == 0) {
                  xTexelC${T} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${T}.zw = vec2(0.0);
                  }
                  xTexelC${T}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${T+1}Ready == 0) {
                  xTexelC${T+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${T+1}.zw = vec2(0.0);
                  }
                  xTexelC${T+1}Ready = 1;
                }

                xC${T} = vec4(xTexelC${T}.zw, xTexelC${T+1}.zw);
              `,T+1<f&&(y+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${T+1} = vec4(xTexelC${T+1}.xy, final.xy);
                `)):(y+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${T}Ready == 0) {
                  xTexelC${T} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${T}.zw = vec2(0.0);
                  }
                  xTexelC${T}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${T+1}Ready == 0) {
                  xTexelC${T+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${T+1}.zw = vec2(0.);
                  }
                  xTexelC${T+1}Ready = 1;
                }

                xC${T} = vec4(
                  xTexelC${T}.xy, xTexelC${T+1}.xy);
              `,T+1<f&&(y+=`
                  xC${T+1} = vec4(xTexelC${T}.zw, xTexelC${T+1}.zw);
                `)));T<f&&(y+=`
            wTexel = getW(r, ${T}, d1, q);
            dotProd += xC${T} * vec4(wTexel.xz, wTexel.xz);
          `,T+1<f&&(y+=`
              wTexel = getW(r, ${T+1}, d1, q);
              dotProd += xC${T+1} * vec4(wTexel.xz, wTexel.xz);
            `))}y+=`
    }
  `,y+=`
      }
    `;let b="",w="";s&&(r?b=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?b=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:b=`vec4 activation(vec4 x) {
          ${s}
        }`,w="result = activation(result);");const v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${b}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${y}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${v}
        ${w}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;let d=l;d==null&&(d=[1,1]),j(tr(o,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);const f=Ls(r.shape,i.shape,o,d,a,u,!0);let m;pe().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?m=new TH(f):m=new CH(f);const y=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(m,[r,i],"float32",y)}const GIe={kernelName:y_,backendName:"webgl",kernelFunc:WIe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HIe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class qIe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KIe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:d}=s,f=Ls(r.shape,d,o,a,l,u,!0),m=new HIe(f);return t.runWebGLProgram(m,[r,i],"float32")}const XIe={kernelName:LN,backendName:"webgl",kernelFunc:KIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YIe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:d}=s,f=Ls(d,i.shape,o,a,l,u,!0),m=new qIe(f);return t.runWebGLProgram(m,[r,i],"float32")}const QIe={kernelName:FN,backendName:"webgl",kernelFunc:YIe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JIe{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZIe(n){const{inputs:e,backend:t}=n,{x:s}=e,r=[...s.shape,...s.shape],i=xe(s.shape),o=$e({inputs:{x:s},backend:t,attrs:{shape:[i]}}),a=new JIe(i),l=t.runWebGLProgram(a,[o],o.dtype),u=$e({inputs:{x:l},backend:t,attrs:{shape:r}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),u}const eke={kernelName:cz,backendName:"webgl",kernelFunc:ZIe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tke{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:s,padInfo:r,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:d}=e,{top:f,left:m}=r;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${f}, ${m});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=p0(r.shape,i.shape,o,a,"NHWC",l);let d;const f=new tke(u);d=t.runWebGLProgram(f,[r,i],"float32");const m=$e({inputs:{x:d},backend:t,attrs:{shape:u.outShape}});return t.disposeIntermediateTensorInfo(d),m}const ske={kernelName:b_,backendName:"webgl",kernelFunc:nke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rke(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=aA(r,i.length);cA(o.length,l,i);const{path:u,steps:d}=uA(a,l),f=d.length;let m=null,y=o.length;const b=[];for(let w=0;w<f;++w){for(const v of d[w]){const{permutationIndices:S,expandDims:T}=lA(y,l[v]);let I;hA(S)?I=i[v]:(I=gr({inputs:{x:i[v]},backend:t,attrs:{perm:S}}),b.push(I));const k=I.shape.slice();for(let O=0;O<T.length;++O)k.splice(T[O],0,1);zt(I.shape,k)||(I=$e({inputs:{x:I},backend:t,attrs:{shape:k}}),b.push(I)),m===null?m=I:(m=QA({inputs:{a:I,b:m},backend:t}),b.push(m))}w<f-1&&(u[w]>=0&&(m=$1({inputs:{x:m},backend:t,attrs:{axis:u[w]-(o.length-y),keepDims:!1}}),b.push(m)),y--)}for(const w of b)w!==m&&t.disposeIntermediateTensorInfo(w);return m}const ike={kernelName:VN,backendName:"webgl",kernelFunc:rke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oke="return (x >= 0.0) ? x : (exp(x) - 1.0);",ake=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,lke=Rt({opSnippet:oke,packedOpSnippet:ake}),cke={kernelName:$y,backendName:"webgl",kernelFunc:lke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uke="return (b >= 0.0) ? a : a * (b + 1.0);",hke=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,dke=n=>{const{inputs:e,backend:t}=n,{dy:s,y:r}=e,i=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new hp(hke,s.shape,r.shape):new vh(uke,s.shape,r.shape);return t.runWebGLProgram(i,[s,r],s.dtype)},fke={kernelName:UN,backendName:"webgl",kernelFunc:dke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pke=`
  return vec4(equal(a, b));
`,mke="return float(a == b);",gke=Vs({opSnippet:mke,packedOpSnippet:pke,dtype:"bool",cpuKernelImpl:KSe}),yke={kernelName:x_,backendName:"webgl",kernelFunc:gke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bke=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${eA};
  float a1 = ${tA};
  float a2 = ${nA};
  float a3 = ${sA};
  float a4 = ${rA};
  float a5 = ${iA};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,xke=Rt({opSnippet:bke}),vke={kernelName:Dy,backendName:"webgl",kernelFunc:xke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wke=dp+`
  return exp(x);
`,_ke=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,EH=Rt({opSnippet:wke,packedOpSnippet:_ke,cpuKernelImpl:XSe,dtype:"float32"}),Ske={kernelName:Oy,backendName:"webgl",kernelFunc:EH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gI(n){const{inputs:e,attrs:t,backend:s}=n,{dim:r}=t,{input:i}=e,o=i.shape.length,a=i.shape.slice();let l=r;return r<0&&(j(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+r+1),a.splice(l,0,1),$e({inputs:{x:i},backend:s,attrs:{shape:a}})}const Cke={kernelName:v_,backendName:"webgl",kernelFunc:gI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i3="return exp(x) - 1.0;",Tke=Rt({opSnippet:i3,packedOpSnippet:i3,cpuKernelImpl:YSe}),Eke={kernelName:Py,backendName:"webgl",kernelFunc:Tke};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class o3{constructor(e,t,s){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const i=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IH(n,e,t){const s=t.texData.get(n.dataId),r=xe(n.shape),i=n.shape[n.shape.length-1],o=r/i,a=$e({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),l=a.shape,u=new o3("real",l,e),d=new o3("imag",l,e),f=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],m=t.runWebGLProgram(u,f,"float32"),y=t.runWebGLProgram(d,f,"float32"),b=Wc({inputs:{real:m,imag:y},backend:t});t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y);const w=$e({inputs:{x:b},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(b),w}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ike(n){const{inputs:e,backend:t}=n,{input:s}=e;return IH(s,!1,t)}const kke={kernelName:BN,backendName:"webgl",kernelFunc:Ike};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nke{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P0(n){const{backend:e,attrs:t}=n,{shape:s,value:r}=t;let{dtype:i}=t;if(i=i||Jf(r),i==="string"){const o=Fn(i,xe(s));return o.fill(r),e.makeTensorInfo(s,i,o)}else{const o=new Nke(s,r),a=[[r]];return e.runWebGLProgram(o,[],i,a)}}const Ake={kernelName:zN,backendName:"webgl",kernelFunc:P0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rke{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ke={kernelName:jN,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,s=e,r=new Rke(t.shape);return s.runWebGLProgram(r,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a3="return floor(x);",Dke=Rt({opSnippet:a3,packedOpSnippet:a3,cpuKernelImpl:QSe}),Oke={kernelName:My,backendName:"webgl",kernelFunc:Dke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pke=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,Mke=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,Lke=Vs({opSnippet:Pke,packedOpSnippet:Mke,dtype:"int32"}),Fke={kernelName:Ly,backendName:"webgl",kernelFunc:Lke};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vke{constructor(e){this.variableNames=["A"];const t=yr(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uke{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=yr(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bke={kernelName:Voe,backendName:"webgl",kernelFunc:zke};let Bd,RT=pe().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function zke(n){const{inputs:e,backend:t,attrs:s}=n;let{pixels:r}=e;const{numChannels:i}=s,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,u]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],d=[u,l],f=[u,l,i];if(a||o){const w=pe().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Bd==null||w!==RT)&&(RT=w,Bd=document.createElement("canvas").getContext("2d",{willReadFrequently:RT})),Bd.canvas.width=l,Bd.canvas.height=u,Bd.drawImage(r,0,0,l,u),r=Bd.canvas}const m=t.makeTensorInfo(d,"int32");t.texData.get(m.dataId).usage=ii.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(m.dataId),r);const y=pe().getBool("WEBGL_PACK")?new Uke(f):new Vke(f),b=t.runWebGLProgram(y,[m],"int32");return t.disposeData(m.dataId),b}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:m,activation:y,leakyreluAlpha:b}=s,w=al(d),v=Ls(r.shape,i.shape,l,f,u,m,!1,w);let S;const T=[],I=o!=null,k=a!=null,O=y==="leakyrelu",V=()=>{const D=[r,i],$=(R,A)=>{if(A==="NCHW"&&R.shape.length===1&&R.shape[0]!==1){const U=$e({inputs:{x:R},backend:t,attrs:{shape:[R.shape[0],1,1]}});return T.push(U),U}return R};if(I&&D.push($(o,d)),k&&D.push($(a,d)),O){const R=t.makeTensorInfo([],"float32",Pc(b,"float32"));D.push(R),T.push(R)}return D};if(v.filterHeight===1&&v.filterWidth===1&&v.dilationHeight===1&&v.dilationWidth===1&&v.strideHeight===1&&v.strideWidth===1&&(v.padInfo.type==="SAME"||v.padInfo.type==="VALID"))S=wH({x:r,filter:i,convInfo:v,backend:t,bias:o,activation:y,preluActivationWeights:a,leakyreluAlpha:b});else if(v.strideWidth<=2&&w==="channelsLast"&&pe().getBool("WEBGL_EXP_CONV")){const D=y?Hg(y,!0):null,$=new vH(v,I,D,k,O),R=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],A=V();S=t.runWebGLProgram($,A,"float32",R)}else if(pe().getBool("WEBGL_CONV_IM2COL"))S=_H({x:r,filter:i,convInfo:v,backend:t,bias:o,activation:y,preluActivationWeights:a,leakyreluAlpha:b});else{const D=y?Hg(y,!1):null,$=new xH(v,I,D,k,O),R=V();S=t.runWebGLProgram($,R,"float32")}const P=$e({inputs:{x:S},backend:t,attrs:{shape:v.outShape}});return T.push(S),T.forEach(D=>t.disposeIntermediateTensorInfo(D)),P}const Wke={kernelName:Gv,backendName:"webgl",kernelFunc:jke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:d,dimRoundingMode:f,activation:m,leakyreluAlpha:y}=s,b=[];let w=d;w==null&&(w=[1,1]),j(tr(l,w),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${w}'`);const v=Ls(r.shape,i.shape,l,w,u,f,!0),S=pe().getBool("WEBGL_PACK_DEPTHWISECONV")&&v.strideWidth<=2&&v.outChannels/v.inChannels===1,T=m?Hg(m,S):null,I=[r,i],k=o!=null,O=a!=null,V=m==="leakyrelu";if(k&&I.push(o),O&&I.push(a),V){const R=t.makeTensorInfo([],"float32",Pc(y,"float32"));I.push(R),b.push(R)}let P;S?P=new TH(v,k,T,O,V):P=new CH(v,k,T,O,V);const D=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],$=t.runWebGLProgram(P,I,"float32",D);return b.forEach(R=>t.disposeIntermediateTensorInfo(R)),$}const Hke={kernelName:kz,backendName:"webgl",kernelFunc:Gke};class qke{constructor(e,t,s,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const i=sn(s.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kke(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,i=r.shape,o=i[i.length-1],a=xe(s.shape),[l,u,d,f]=j2(s,r),m=$e({inputs:{x:r},backend:t,attrs:{shape:[u,o]}}),y=$e({inputs:{x:s},backend:t,attrs:{shape:[xe(s.shape)/d,d]}});if(t.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const S=t.readSync(r.dataId),T=t.bufferSync(s),I=JSe(S,T,s.dtype,u,o,d,f,s.shape,a);return t.makeTensorInfo(l,s.dtype,I.values)}const b=new qke(o,f,[u,d],s.shape),w=t.runWebGLProgram(b,[y,m],y.dtype),v=$e({inputs:{x:w},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),v}const Xke={kernelName:uz,backendName:"webgl",kernelFunc:Kke};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yke{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const s=sn(this.rank),r=Qke(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function Qke(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${t[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kH(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:i}=e,{axis:o,batchDims:a}=s,l=dt(o,r.shape)[0];if(pe().get("DEBUG")){const T=t.readSync(i.dataId),I=r.shape[l];for(let k=0;k<T.length;++k){const O=T[k];j(O<=I-1&&O>=0,()=>`GatherV2: the index value ${O} is not in [0, ${I-1}]`)}}const u=fA(r,i,l,a),d=xe(i.shape),f=[],m=$e({inputs:{x:r},backend:t,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),y=$e({inputs:{x:i},backend:t,attrs:{shape:[u.batchSize,d/u.batchSize]}});f.push(m),f.push(y);const b=[u.batchSize,u.outerSize,d/u.batchSize,u.sliceSize];if(t.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const T=t.bufferSync(y),I=t.bufferSync(m),k=ZSe(I,T,b);return f.forEach(O=>t.disposeIntermediateTensorInfo(O)),t.makeTensorInfo(u.outputShape,k.dtype,k.values)}const w=new Yke(m.shape,b),v=t.runWebGLProgram(w,[m,y],m.dtype);f.push(v);const S=$e({inputs:{x:v},backend:t,attrs:{shape:u.outputShape}});return f.forEach(T=>t.disposeIntermediateTensorInfo(T)),S}const Jke={kernelName:__,backendName:"webgl",kernelFunc:kH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zke="return float(a > b);",eNe=`
  return vec4(greaterThan(a, b));
`,tNe=Vs({opSnippet:Zke,packedOpSnippet:eNe,cpuKernelImpl:eCe,dtype:"bool"}),nNe={kernelName:S_,backendName:"webgl",kernelFunc:tNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sNe="return float(a >= b);",rNe=`
  return vec4(greaterThanEqual(a, b));
`,iNe=Vs({opSnippet:sNe,packedOpSnippet:rNe,dtype:"bool",cpuKernelImpl:tCe}),oNe={kernelName:Fy,backendName:"webgl",kernelFunc:iNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aNe(n){const{inputs:e,backend:t}=n,{input:s}=e;return IH(s,!0,t)}const lNe={kernelName:WN,backendName:"webgl",kernelFunc:aNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cNe="return float(!isnan(x) && !isinf(x));",uNe=Rt({opSnippet:cNe,dtype:"bool"}),hNe={kernelName:Uy,backendName:"webgl",kernelFunc:uNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dNe="return float(isinf(x));",fNe=Rt({opSnippet:dNe,dtype:"bool"}),pNe={kernelName:By,backendName:"webgl",kernelFunc:fNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mNe="return float(isnan(x));",gNe=Rt({opSnippet:mNe,dtype:"bool"}),yNe={kernelName:zy,backendName:"webgl",kernelFunc:gNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bNe="return float(a < b);",xNe=`
  return vec4(lessThan(a, b));
`,vNe=Vs({opSnippet:bNe,packedOpSnippet:xNe,cpuKernelImpl:nCe,dtype:"bool"}),wNe={kernelName:T_,backendName:"webgl",kernelFunc:vNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Ne="return float(a <= b);",SNe=`
  return vec4(lessThanEqual(a, b));
`,CNe=Vs({opSnippet:_Ne,packedOpSnippet:SNe,cpuKernelImpl:sCe,dtype:"bool"}),TNe={kernelName:E_,backendName:"webgl",kernelFunc:CNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ENe(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:i}=t,o=rCe(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const INe={kernelName:hz,backendName:"webgl",kernelFunc:ENe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kNe=dp+`
  return x < 0.0 ? 0./0. : log(x);
`,NNe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,ANe=Rt({opSnippet:kNe,packedOpSnippet:NNe,cpuKernelImpl:iCe}),RNe={kernelName:jy,backendName:"webgl",kernelFunc:ANe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Ne=dp+`
  return log(1.0 + x);
`,DNe=Rt({opSnippet:$Ne}),ONe={kernelName:Wy,backendName:"webgl",kernelFunc:DNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PNe="return float(a >= 1.0 && b >= 1.0);",MNe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,LNe=Vs({opSnippet:PNe,packedOpSnippet:MNe,dtype:"bool"}),FNe={kernelName:I_,backendName:"webgl",kernelFunc:LNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VNe="return float(!(x >= 1.0));",UNe=Rt({opSnippet:VNe}),BNe={kernelName:k_,backendName:"webgl",kernelFunc:UNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zNe="return float(a >= 1.0 || b >= 1.0);",jNe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,WNe=Vs({opSnippet:zNe,packedOpSnippet:jNe,dtype:"bool"}),GNe={kernelName:N_,backendName:"webgl",kernelFunc:WNe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HNe{constructor(e,t,s,r,i){this.variableNames=["x"],this.outputShape=[];const o=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qNe{constructor(e,t,s,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KNe=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s,u=pe().getBool("WEBGL_PACK_NORMALIZATION")?new qNe(r.shape,i,o,a,l):new HNe(r.shape,i,o,a,l);return t.runWebGLProgram(u,[r],r.dtype)},XNe={kernelName:A_,backendName:"webgl",kernelFunc:KNe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YNe{constructor(e,t,s,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=s,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QNe=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:d}=s,f=new YNe(r.shape,a,l,u,d);return t.runWebGLProgram(f,[r,i,o],r.dtype)},JNe={kernelName:HN,backendName:"webgl",kernelFunc:QNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZNe(n,e,t,s){const r=xe(e),o=xe(n.shape)/r,a=$e({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),l=Lh(a,n.dtype,"max",s),u=$e({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NH(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=r.shape.length,l=dt(i,r.shape);let u=l;const d=Nn(u,a),f=d!=null,m=t.shouldExecuteOnCPU([r]);let y=r;if(f){if(m){const I=t.texData.get(y.dataId).values,k=new Array(a);for(let P=0;P<k.length;P++)k[P]=r.shape[d[P]];const O=XA(I,r.shape,r.dtype,d,k);y=t.makeTensorInfo(k,r.dtype);const V=t.texData.get(y.dataId);V.values=O}else y=R1(r,d,t);u=Bn(u.length,a)}Fs("max",u,a);const[b,w]=Ss(y.shape,u);let v=b;o&&(v=Xn(b,l));let S;if(m){const I=t.texData.get(y.dataId).values,k=oCe(I,xe(w),v,r.dtype);S=t.makeTensorInfo(v,r.dtype);const O=t.texData.get(S.dataId);O.values=k}else S=ZNe(y,w,v,t);return f&&t.disposeIntermediateTensorInfo(y),S}const e2e={kernelName:R_,backendName:"webgl",kernelFunc:NH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t2e=YA+`
  return max(a, b);
`,n2e=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Mh+`
  return result;
`,s2e=Vs({opSnippet:t2e,packedOpSnippet:n2e,cpuKernelImpl:aCe}),r2e={kernelName:Gy,backendName:"webgl",kernelFunc:s2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i2e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;$0(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;j(tr(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=Mi(r.shape,i,o,u,a,l);if(d.filterWidth===1&&d.filterHeight===1&&zt(d.inShape,d.outShape))return qr({inputs:{x:r},backend:t});const f=new qg(d,"max",!1);return t.runWebGLProgram(f,[r],r.dtype)}const o2e={kernelName:$_,backendName:"webgl",kernelFunc:i2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a2e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:u}=s,d=[1,1,1],f=ol(r.shape,i,o,d,a,u,l),m=new JA(f,"max",!1);return t.runWebGLProgram(m,[r],r.dtype)}const l2e={kernelName:D_,backendName:"webgl",kernelFunc:a2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c2e{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=i-1-e.padInfo.top,l=o-1-e.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class u2e{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=l-1-e.padInfo.front,m=u-1-e.padInfo.top,y=d-1-e.padInfo.left,b=l*u*d-1;this.userCode=`
      const ivec3 pads = ivec3(${f}, ${m}, ${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${b} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h2e(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:d}=s,f=[1,1,1],m=ol(o.shape,a,l,f,u,d),y=new JA(m,"max",!0),b=t.runWebGLProgram(y,[o],o.dtype),w=new u2e(m),v=t.runWebGLProgram(w,[r,b],o.dtype);return t.disposeIntermediateTensorInfo(b),v}const d2e={kernelName:KN,backendName:"webgl",kernelFunc:h2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f2e(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i,output:o}=e,a=i;$0([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:d,dimRoundingMode:f}=s,m=Mi(a.shape,l,u,1,d,f),y=!0,b=new qg(m,"max",y),w=t.runWebGLProgram(b,[a],a.dtype),v=new c2e(m),S=t.runWebGLProgram(v,[r,w],a.dtype);return t.disposeIntermediateTensorInfo(w),S}const p2e={kernelName:qN,backendName:"webgl",kernelFunc:f2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m2e(n,e,t,s){let r=new qg(t,"max",!1);const i=s.runWebGLProgram(r,[n],"float32");r=new qg(t,"max",!0,!0,e);const o=s.runWebGLProgram(r,[n],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g2e={kernelName:dz,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;j(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const u=[1,1];j(tr(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=Mi(s.shape,r,i,u,o),[f,m]=m2e(s,a,d,l);return[f,m]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y2e(n,e,t,s){const r=xe(e),o=xe(n.shape)/r,a=$e({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),l=Lh(a,"float32","mean",s),u=$e({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b2e={kernelName:O_,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{keepDims:r,axis:i}=e,o=t,a=s.shape.length,l=dt(i,s.shape);let u=l;const d=Nn(u,a),f=d!=null,m=o.shouldExecuteOnCPU([s]),y=[];let b=s;if(f){if(m){const k=o.texData.get(b.dataId).values,O=new Array(a);for(let D=0;D<O.length;D++)O[D]=s.shape[d[D]];const V=XA(k,s.shape,s.dtype,d,O);b=o.makeTensorInfo(O,s.dtype);const P=o.texData.get(b.dataId);P.values=V}else b=R1(s,d,o);y.push(b),u=Bn(u.length,a)}Fs("sum",u,a);const[w,v]=Ss(b.shape,u);let S=w;r&&(S=Xn(w,l));const T=y2e(b,v,S,o);for(const I of y)o.disposeIntermediateTensorInfo(I);return T}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x2e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=dt(i,r.shape);let u=l;const d=Nn(u,a);let f=r;d!=null&&(f=gr({inputs:{x:r},backend:t,attrs:{perm:d}}),u=Bn(u.length,r.shape.length)),Fs("min",u,a);const[m,y]=Ss(f.shape,u),b=xe(y),w=$e({inputs:{x:f},backend:t,attrs:{shape:[-1,b]}}),v=Lh(w,w.dtype,"min",t);let S;if(o){const T=Xn(m,l);S=$e({inputs:{x:v},backend:t,attrs:{shape:T}})}else S=$e({inputs:{x:v},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(v),d!=null&&t.disposeIntermediateTensorInfo(f),S}const v2e={kernelName:P_,backendName:"webgl",kernelFunc:x2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w2e=YA+`
  return min(a, b);
`,_2e=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Mh+`
  return result;
`,S2e=Vs({opSnippet:w2e,packedOpSnippet:_2e,cpuKernelImpl:lCe}),C2e={kernelName:Hy,backendName:"webgl",kernelFunc:S2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class T2e{constructor(e,t,s){this.variableNames=["x"],this.outputShape=t.map((d,f)=>d[0]+e[f]+d[1]);const r=e.length,i=sn(r),o=t.map(d=>d[0]).join(","),a=t.map((d,f)=>d[0]+e[f]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E2e{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((b,w)=>b[0]+e[w]+b[1]);const r=e.length,i=sn(r),o=t.map(b=>b[0]).join(","),a=t.map((b,w)=>b[0]+e[w]).join(","),l=fr("rc",r),u=fr("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${u.slice(-2).join()})`,m=s==="reflect"?0:1;let y="";if(r===1){const b=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${m};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${m};
        }
        source -= start;
      `;y=`
        ${i} rc = outputLoc;
        ${b}
        result[0] = getChannel(getX(${u.join()}), ${f});
        ${l[r-1]} += 1;
        if(${d}) {
          ${b}
          result[1] = getChannel(getX(${u.join()}), ${f});
        }
      `}else{const b=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${m}) +
                gte * ((end - 1) * 2 - source + ${m});
        source -= start;
      `;y=`
        ${i} rc = outputLoc;
        ${b}
        result[0] = getChannel(getX(${u.join()}), ${f});
        ${l[r-1]} += 1;
        if(${d}) {
          ${b}
          result[1] = getChannel(getX(${u.join()}), ${f});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${b}
          result[2] = getChannel(getX(${u.join()}), ${f});
          ${l[r-1]} += 1;
          if(${d}) {
            ${b}
            result[3] = getChannel(getX(${u.join()}), ${f});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${y}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I2e=({inputs:n,backend:e,attrs:t})=>{const{x:s}=n,{paddings:r,mode:i}=t,o=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new E2e(s.shape,r,i):new T2e(s.shape,r,i);return e.runWebGLProgram(o,[s],s.dtype)},k2e={kernelName:M_,backendName:"webgl",kernelFunc:I2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N2e=`if (b == 0.0) return NAN;
  return mod(a, b);`,A2e=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Mh+`
  return result;
`,R2e=Vs({opSnippet:N2e,packedOpSnippet:A2e}),$2e={kernelName:qy,backendName:"webgl",kernelFunc:R2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D2e{constructor(e,t,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O2e=`
if (a == b) {
  return 1.0;
};
return a / b;`,P2e=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,AH=Vs({opSnippet:O2e,packedOpSnippet:P2e,checkOutOfBounds:!0}),M2e={kernelName:Ry,backendName:"webgl",kernelFunc:AH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l3="return a - b;",RH=Vs({opSnippet:l3,packedOpSnippet:l3,supportsComplex:!0,cpuKernelImpl:NCe}),L2e={kernelName:c0,backendName:"webgl",kernelFunc:RH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $H(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:i}=s,o=dt([i],r.shape),a=NH({inputs:{x:r},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),l=Xn(a.shape,o),u=$e({inputs:{x:a},backend:t,attrs:{shape:l}}),d=RH({inputs:{a:r,b:u},backend:t}),f=EH({inputs:{x:d},backend:t}),m=$1({inputs:{x:f},backend:t,attrs:{axis:o,keepDims:!1}}),y=$e({inputs:{x:m},backend:t,attrs:{shape:l}}),b=AH({inputs:{a:f,b:y},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),b}const F2e={kernelName:e1,backendName:"webgl",kernelFunc:$H};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V2e(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s,l=a?r:$H({inputs:{logits:r},backend:t,attrs:{dim:r.shape.length-1}}),u=l.shape[0],d=l.shape[1],f=new D2e(u,d,i),m=[[o]],y=t.runWebGLProgram(f,[l],"int32",m);return a||t.disposeIntermediateTensorInfo(l),y}const U2e={kernelName:fz,backendName:"webgl",kernelFunc:V2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B2e=Fi+`
  return -x;
`,z2e=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function j2e(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])){const i=t.texData.get(s.dataId),[o,a]=uCe(i.values,s.shape,s.dtype);return t.makeTensorInfo(a,s.dtype,o)}let r;return pe().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Jl(s.shape,z2e):r=new Oo(s.shape,B2e),t.runWebGLProgram(r,[s],s.dtype)}const W2e={kernelName:L_,backendName:"webgl",kernelFunc:j2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G2e=L2;function H2e(n){si("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s,u=t.readSync(r.dataId),d=t.readSync(i.dataId),{selectedIndices:f}=G2e(u,d,o,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const q2e={kernelName:XN,backendName:"webgl",kernelFunc:H2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K2e=F2;function X2e(n){si("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s,d=t.readSync(r.dataId),f=t.readSync(i.dataId),{selectedIndices:m,validOutputs:y}=K2e(d,f,o,a,l,u);return[t.makeTensorInfo([m.length],"int32",new Int32Array(m)),t.makeTensorInfo([],"int32",new Int32Array([y]))]}const Y2e={kernelName:YN,backendName:"webgl",kernelFunc:X2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q2e=V2;function J2e(n){si("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s,d=t.readSync(r.dataId),f=t.readSync(i.dataId),m=o,y=a,b=l,w=u,{selectedIndices:v,selectedScores:S}=Q2e(d,f,m,y,b,w);return[t.makeTensorInfo([v.length],"int32",new Int32Array(v)),t.makeTensorInfo([S.length],"float32",new Float32Array(S))]}const Z2e={kernelName:QN,backendName:"webgl",kernelFunc:J2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eAe{constructor(e,t,s,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tAe=n=>{const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s,u=xe(r.shape),d=new eAe(u,o,a,l),f=$e({inputs:{x:r},backend:t,attrs:{shape:[u]}}),m=t.runWebGLProgram(d,[f],i);t.disposeIntermediateTensorInfo(f);const y=[...r.shape,o],b=$e({inputs:{x:m},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(m),b},nAe={kernelName:U_,backendName:"webgl",kernelFunc:tAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bw(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="complex64"){const r=O0({inputs:{input:s},backend:t}),i=bw({inputs:{x:r},backend:t}),o=D1({inputs:{input:s},backend:t}),a=bw({inputs:{x:o},backend:t}),l=Wc({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return P0({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:t})}const sAe={kernelName:s1,backendName:"webgl",kernelFunc:bw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DH(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=O0({inputs:{input:s},backend:t}),i=DH({inputs:{x:r},backend:t}),o=D1({inputs:{input:s},backend:t}),a=bw({inputs:{x:o},backend:t}),l=Wc({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return P0({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:t})}const rAe={kernelName:V_,backendName:"webgl",kernelFunc:DH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iAe(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return gI({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(d=>{bN(i,d.shape,"All tensors passed to stack must have matching shapes"),j(o===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const f=gI({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(f),f}),u=bH({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const oAe={kernelName:B_,backendName:"webgl",kernelFunc:iAe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aAe{constructor(e,t,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((u,d)=>u[0]+e[d]+u[1]);const r=e.length,i=sn(r),o=t.map(u=>u[0]).join(","),a=t.map((u,d)=>u[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lAe{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((w,v)=>w[0]+e[v]+w[1]);const r=e.length,i=sn(r),o=t.map(w=>w[0]).join(","),a=t.map((w,v)=>w[0]+e[v]).join(","),l=fr("rc",r),u=fr("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${u.slice(-2).join()})`,m=[`${i} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${d}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${d}) {`],y=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let b="";for(let w=0,v=r===1?2:4;w<v;w++)b+=`
        ${m[w]}
        if (${y}) {
          result[${w}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${w}] = getChannel(getX(${u.join()}), ${f});
        }
      `;b+=r===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${b}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OH=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,constantValue:o}=s;if(xe(r.shape)===0){const u=i.map((d,f)=>d[0]+r.shape[f]+d[1]);return P0({backend:t,attrs:{shape:u,value:o,dtype:r.dtype}})}const a=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new lAe(r.shape,i,o):new aAe(r.shape,i,o),l=[[o]];return t.runWebGLProgram(a,[r],r.dtype,l)},cAe={kernelName:z_,backendName:"webgl",kernelFunc:OH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uAe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,hAe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Mh+`
  return result;
`,dAe=Vs({opSnippet:uAe,packedOpSnippet:hAe}),fAe={kernelName:Xy,backendName:"webgl",kernelFunc:dAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pAe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=[],u=dt(i,r.shape);let d=u;const f=Nn(d,a);let m=r;f!=null&&(m=gr({inputs:{x:r},backend:t,attrs:{perm:f}}),d=Bn(d.length,a),l.push(m)),Fs("prod",d,a);let y;if(t.shouldExecuteOnCPU([m])){const b=t.texData.get(m.dataId).values,{outVals:w,outShape:v,outDtype:S}=dCe(m.shape,m.dtype,b,d);y=t.makeTensorInfo(v,S,w)}else{const[b,w]=Ss(m.shape,d),v=xe(w),S=$e({inputs:{x:m},backend:t,attrs:{shape:[-1,v]}}),T=c2(r.dtype),I=Lh(S,T,"prod",t);y=$e({inputs:{x:I},backend:t,attrs:{shape:b}}),l.push(S),l.push(I)}if(o){l.push(y);const b=Xn(y.shape,u);y=$e({inputs:{x:y},backend:t,attrs:{shape:b}})}return l.forEach(b=>t.disposeIntermediateTensorInfo(b)),y}const mAe={kernelName:W_,backendName:"webgl",kernelFunc:pAe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gAe(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(S=>t.readSync(S.dataId)),u=r.map(S=>S.shape),d=t.readSync(i.dataId),f=t.readSync(o.dataId),[m,y,b]=fCe(l,u,d,i.shape,i.dtype,f,o.shape,a),w=m.map(S=>t.makeTensorInfo([S.length],"int32",S)),v=t.makeTensorInfo(b,i.dtype,y);return w.concat([v])}const yAe={kernelName:pz,backendName:"webgl",kernelFunc:gAe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bAe(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:i}=e,o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,d]=pCe(o,s.shape,s.dtype,a,r.shape,l,i.shape),f=t.makeTensorInfo([u.length],"int32",u),m=t.makeTensorInfo([d.length],s.dtype,d);return[f,m]}const xAe={kernelName:mz,backendName:"webgl",kernelFunc:bAe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vAe(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=t.readSync(r.dataId),d=t.readSync(i.dataId),f=t.readSync(o.dataId),m=a.map(v=>t.readSync(v.dataId)),y=a.map(v=>v.shape),[b,w]=mCe(u,r.shape,d,i.shape,i.dtype,f,o.shape,m,y,l);return t.makeTensorInfo(b,i.dtype,w)}const wAe={kernelName:gz,backendName:"webgl",kernelFunc:vAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PH=n=>{const{backend:e,attrs:t}=n,{start:s,stop:r,step:i,dtype:o}=t,a=gCe(s,r,i,o);return e.makeTensorInfo([a.length],o,a)},_Ae={kernelName:JN,backendName:"webgl",kernelFunc:PH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SAe="return 1.0 / x;",CAe=Rt({opSnippet:SAe}),TAe={kernelName:Yy,backendName:"webgl",kernelFunc:CAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EAe=Fi+`
  return (x < 0.0) ? 0.0 : x;
`,IAe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,kAe=Rt({opSnippet:EAe,packedOpSnippet:IAe}),NAe={kernelName:Qy,backendName:"webgl",kernelFunc:kAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AAe=Fi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,RAe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,$Ae=Rt({opSnippet:AAe,packedOpSnippet:RAe}),DAe={kernelName:Jy,backendName:"webgl",kernelFunc:$Ae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OAe{constructor(e,t,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let m;i?m="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":m="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${m};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PAe{constructor(e,t,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let m;i?m="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":m="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${m};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MAe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,d=pe().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new PAe(r.shape,l,u,i,o):new OAe(r.shape,l,u,i,o);return t.runWebGLProgram(d,[r],"float32")}const LAe={kernelName:q_,backendName:"webgl",kernelFunc:MAe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FAe{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],d=l[0]/u[0],f=l[1]/u[1],m=1/d,y=1/f,b=Math.ceil(m)*2+2,w=Math.ceil(y)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${m});
        const float invWidthScale = float(${y});

        const int winHeight = int(${b});
        const int winWidth = int(${w});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VAe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s,a=new FAe(i.shape,r.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const UAe={kernelName:t2,backendName:"webgl",kernelFunc:VAe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BAe{constructor(e,t,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],m=r?"0.5":"0.0";let y;i?y="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":y="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${y};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${m})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zAe{constructor(e,t,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],m=r?"0.5":"0.0";let y;i?y="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":y="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${y};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${m})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jAe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,d=pe().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new zAe(r.shape,l,u,i,o):new BAe(r.shape,l,u,i,o);return t.runWebGLProgram(d,[r],r.dtype)}const WAe={kernelName:H_,backendName:"webgl",kernelFunc:jAe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GAe{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],d=l[0]/u[0],f=l[1]/u[1],m=1/d,y=1/f,b=Math.ceil(m)*2+2,w=Math.ceil(y)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${m});
        const float invWidthScale = float(${y});

        const int winHeight = int(${b});
        const int winWidth = int(${w});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HAe(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s,a=new GAe(i.shape,r.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const qAe={kernelName:e2,backendName:"webgl",kernelFunc:HAe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KAe{constructor(e,t){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,i=e.map((a,l)=>r(l)).join(","),o=sn(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XAe{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=fr("rc",s),i=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=sn(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${i}){
            result.g = ${u(r.slice())};
          }
          if(${o}) {
            result.b = ${d(r.slice())};
            if(${i}) {
              result.a = ${f(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(b){return m(b)}function u(b){return b[s-1]="("+b[s-1]+" + 1)",m(b)}function d(b){return b[s-2]="("+b[s-2]+" + 1)",m(b)}function f(b){return b[s-1]="("+b[s-1]+" + 1)",b[s-2]="("+b[s-2]+" + 1)",m(b)}function m(b){const w=e.map((T,I)=>y(I,b)),v=w.join(","),S=w.slice(-2).join(",");return`getChannel(getX(${v}), vec2(${S}))`}function y(b,w){return t.indexOf(b)!==-1&&e[b]!==1?`${e[b]} - ${w[b]} - 1`:`${w[b]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YAe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:i}=s,o=r.shape.length,a=dt(i,r.shape);if(o===0)return qr({inputs:{x:r},backend:t});const l=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new XAe(r.shape,a):new KAe(r.shape,a);return t.runWebGLProgram(l,[r],r.dtype)}const QAe={kernelName:K_,backendName:"webgl",kernelFunc:YAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JAe{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let i="";typeof t=="number"?i=`float outputValue = ${t.toFixed(2)};`:i=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZAe={kernelName:l2,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=e,a=t,l=new JAe(s.shape,i),[u,d]=Q2(o,s.shape[1],s.shape[2]),f=[[u,d,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,f)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eRe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,tRe=Rt({opSnippet:eRe}),nRe={kernelName:Zy,backendName:"webgl",kernelFunc:tRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sRe="return inversesqrt(x);",rRe=Rt({opSnippet:sRe,cpuKernelImpl:yCe}),iRe={kernelName:e0,backendName:"webgl",kernelFunc:rRe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZA{constructor(e,t,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const u=sn(i.length),d=sn(o.length);let f="";s===1?f="i":s===2&&(f="i, j");const m=`getIndices(${f})`;let y="";r===1?y="i":r===2&&(y="i, coords[1]");const b=`getUpdates(${y})`;let w="";l&&(w="coords[0], coords[1]");const v=`getDefaultValue(${w})`,S=t>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${d} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${m});
              flattenedIndex += index * ${S};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${b};
              found = true;
            }
          }
          setOutput(mix(${v}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oRe{constructor(e,t,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const u=sn(i.length),d=sn(o.length);let f="";s===1?f="i":s===2&&(f="i, j");const m=`getIndices(${f})`;let y="";r===1?y="i":r===2&&(y="i, coords[1]");const b=`getUpdates(${y})`;let w="";l&&(w="coords[0], coords[1]");const v=`getDefaultValue(${w})`,S=t>1?"strides[j]":"strides",T=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${d} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${m});
              flattenedIndex += index.xz * ${S};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${T};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${b};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${v}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aRe(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=Rh(i,r,o),m=[f/u,u];if(f===0)return t.makeTensorInfo(o,r.dtype);const y=$e({inputs:{x:r},backend:t,attrs:{shape:[l,a]}}),b=$e({inputs:{x:i},backend:t,attrs:{shape:[l,u]}}),w=t.makeTensorInfo([],"float32",new Float32Array([0]));let v;pe().getBool("WEBGL_PACK")?v=new oRe(l,a,y.shape.length,b.shape.length,d,m):v=new ZA(l,a,y.shape.length,b.shape.length,d,m);const S=t.runWebGLProgram(v,[b,y,w],b.dtype),T=$e({inputs:{x:S},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(S),t.disposeIntermediateTensorInfo(w),T}const lRe={kernelName:yz,backendName:"webgl",kernelFunc:aRe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cRe{constructor(e,t,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=pe().getNumber("WEBGL_VERSION")===2?i:o,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uRe(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:i}=e,{side:o}=s,a=new cRe(r.shape[0],r.shape[1],i.shape[1],o),l=[[r.shape[1]]];return t.runWebGLProgram(a,[r,i],"int32",l)}const hRe={kernelName:xz,backendName:"webgl",kernelFunc:uRe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dRe{constructor(e,t,s){this.variableNames=["c","a","b"],this.outputShape=t;let r,i;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)i="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let d=0;d<t.length;d++)u.push(`${a[d]}`),d<e&&l.push(`${a[d]}`);r=l.join(),i=u.join()}const o=sn(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fRe(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:i}=e,o=new dRe(s.shape.length,r.shape,r.shape.length);return t.runWebGLProgram(o,[s,r,i],Gr(r.dtype,i.dtype))}const pRe={kernelName:X_,backendName:"webgl",kernelFunc:fRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mRe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${m1};
  float scale = ${g1};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,gRe=Rt({opSnippet:mRe}),yRe={kernelName:t0,backendName:"webgl",kernelFunc:gRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bRe=dp+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,xRe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,vRe=Rt({opSnippet:bRe,packedOpSnippet:xRe,cpuKernelImpl:xCe}),wRe={kernelName:i0,backendName:"webgl",kernelFunc:vRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Re=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,SRe=Rt({opSnippet:_Re}),CRe={kernelName:r0,backendName:"webgl",kernelFunc:SRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TRe=dp+`
  return sin(x);
`,ERe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Mh}
  return result;
`,IRe=Rt({opSnippet:TRe,packedOpSnippet:ERe}),kRe={kernelName:n0,backendName:"webgl",kernelFunc:IRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NRe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,ARe=Rt({opSnippet:NRe}),RRe={kernelName:s0,backendName:"webgl",kernelFunc:ARe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Re=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,DRe=Rt({opSnippet:$Re}),ORe={kernelName:o0,backendName:"webgl",kernelFunc:DRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PRe=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,paddings:o}=s;j(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((S,T)=>S*T),l=[[0,0]];l.push(...o);for(let S=1+i.length;S<r.shape.length;++S)l.push([0,0]);const u=[],d=OH({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),f=x0(d.shape,i,a,!1),m=v0(f.length,i.length,!1),y=w0(d.shape,i,a,!1),b=$e({inputs:{x:d},backend:t,attrs:{shape:f}}),w=gr({inputs:{x:b},backend:t,attrs:{perm:m}}),v=$e({inputs:{x:w},backend:t,attrs:{shape:y}});return u.push(d),u.push(b),u.push(w),u.forEach(S=>t.disposeIntermediateTensorInfo(S)),v},MRe={kernelName:J_,backendName:"webgl",kernelFunc:PRe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LRe(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.readSync(s.dataId),l=t.readSync(r.dataId),u=t.readSync(i.dataId),d=t.readSync(o.dataId)[0],[f,m,y,b,w]=wCe(a,s.shape,s.dtype,l,r.dtype,u,d);return[t.makeTensorInfo(m,s.dtype,f),t.makeTensorInfo([m[0]],r.dtype,y),t.makeTensorInfo([b.length],"bool",new Uint8Array(b.map(v=>Number(v)))),t.makeTensorInfo([w.length],s.dtype,new Int32Array(w))]}const FRe={kernelName:vz,backendName:"webgl",kernelFunc:LRe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VRe(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.readSync(r.dataId)),a=t.readSync(s.dataId),l=Array.from(t.readSync(i.dataId)),[u,d,f]=_Ce(a,s.shape,s.dtype,o,l);return[t.makeTensorInfo(d,s.dtype,u),t.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}const URe={kernelName:wz,backendName:"webgl",kernelFunc:VRe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BRe(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,d]=iH(o,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(d,s.dtype,u)}const zRe={kernelName:_z,backendName:"webgl",kernelFunc:BRe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jRe(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,d]=iH(o,s.shape,s.dtype,a,l);return t.makeTensorInfo(d,s.dtype,u)}const WRe={kernelName:Sz,backendName:"webgl",kernelFunc:jRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GRe(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:d,strides:f,outputSize:m}=Rh(i,r,a),y=!1;if(i.dtype==="string"){const S=t.bufferSync(r),T=t.bufferSync(i),I=xc(t.readSync(o.dataId)[0]),k=bCe(S,T,a,m,d,u,l,f,I,y);return t.makeTensorInfo(a,k.dtype,k.values)}const b=new ZA(u,l,r.shape.length,i.shape.length,f,[m,1],y),w=t.runWebGLProgram(b,[i,r,o],i.dtype),v=$e({inputs:{x:w},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(w),v}const HRe={kernelName:Cz,backendName:"webgl",kernelFunc:GRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qRe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=dt(o,r.shape)[0],l=dA(r,i,a),u=r.shape.length,d=new Array(u).fill(0),f=r.shape.slice();return l.map(m=>{const y=[...f];y[a]=m;const b=fp({inputs:{x:r},backend:t,attrs:{begin:d,size:y}});return d[a]+=m,b})}const KRe={kernelName:Z_,backendName:"webgl",kernelFunc:qRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c3="return sqrt(x);",XRe=Rt({opSnippet:c3,packedOpSnippet:c3,cpuKernelImpl:SCe}),YRe={kernelName:a0,backendName:"webgl",kernelFunc:XRe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QRe="return x * x;",JRe=Rt({opSnippet:QRe}),ZRe={kernelName:n2,backendName:"webgl",kernelFunc:JRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u3="return (a - b) * (a - b);",e$e=Vs({opSnippet:u3,packedOpSnippet:u3}),t$e={kernelName:l0,backendName:"webgl",kernelFunc:e$e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n$e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const i=t.readSync(r.dataId),o=tl(i),a=CCe(o,"string",s);return t.makeTensorInfo(r.shape,"string",a)}const s$e={kernelName:s2,backendName:"webgl",kernelFunc:n$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r$e({inputs:n,attrs:e,backend:t}){const{x:s}=n,r=Fi+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new Oo(s.shape,r);return t.runWebGLProgram(i,[s],s.dtype)}const i$e={kernelName:f0,backendName:"webgl",kernelFunc:r$e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class o$e{constructor(e,t,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,i=sn(s.length),o=sn(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((u,d)=>(l++,s.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${l-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${t});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a$e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:m}=s,{finalShapeSparse:y,finalShape:b,isIdentity:w,sliceDim0:v,isSimpleSlice:S,begin:T,end:I,strides:k}=K2(r.shape,i,o,a,l,u,d,f,m);let O;if(w)O=$e({inputs:{x:r},backend:t,attrs:{shape:b}});else if(v||S){j(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const P=G2(T,I,k),D=fp({inputs:{x:r},backend:t,attrs:{begin:T,size:P}});O=$e({inputs:{x:D},backend:t,attrs:{shape:b}}),t.disposeIntermediateTensorInfo(D)}else if(t.shouldExecuteOnCPU([r])){const D=t.readSync(r.dataId),$=ht(r.shape,r.dtype,D),R=TCe(y,$,k,T);O=t.makeTensorInfo(b,r.dtype,R.values)}else{const D=new o$e(T,k,y);O=t.runWebGLProgram(D,[r],r.dtype)}const V=$e({inputs:{x:O},backend:t,attrs:{shape:b}});return t.disposeIntermediateTensorInfo(O),V}const l$e={kernelName:r2,backendName:"webgl",kernelFunc:a$e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c$e(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:d,dataSplits:f}=e,m=t.readSync(d.dataId),y=t.readSync(f.dataId),[b,w]=ECe(m,y,r,i,o,a,l,u);return[t.makeTensorInfo([b.length],"string",b),t.makeTensorInfo(f.shape,"int32",w)]}const u$e={kernelName:Tz,backendName:"webgl",kernelFunc:c$e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h$e(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.readSync(i.dataId),l=t.readSync(o.dataId)[0],[u,d,f]=ICe(a,l,r),m=d.length;return[t.makeTensorInfo([m,2],"int32",u),t.makeTensorInfo([m],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const d$e={kernelName:Ez,backendName:"webgl",kernelFunc:h$e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f$e(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=t.readSync(i.dataId),a=kCe(o,r);return t.makeTensorInfo(i.shape,"int32",a)}const p$e={kernelName:Iz,backendName:"webgl",kernelFunc:f$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m$e="return tan(x);",g$e=Rt({opSnippet:m$e}),y$e={kernelName:u0,backendName:"webgl",kernelFunc:g$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b$e=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,x$e=Rt({opSnippet:b$e}),v$e={kernelName:h0,backendName:"webgl",kernelFunc:x$e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w$e(n){const{inputs:e,backend:t,attrs:s}=n,{tensor:r,indices:i,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=Rh(o,i,r.shape),m=[f/u,u];if(f===0)return t.makeTensorInfo(r.shape,i.dtype);const y=$e({inputs:{x:i},backend:t,attrs:{shape:[l,a]}}),b=$e({inputs:{x:o},backend:t,attrs:{shape:[l,u]}}),w=$e({inputs:{x:r},backend:t,attrs:{shape:m}}),v=new ZA(l,a,y.shape.length,b.shape.length,d,m,!1,!0),S=t.runWebGLProgram(v,[b,y,w],w.dtype),T=$e({inputs:{x:S},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(S),T}const _$e={kernelName:bz,backendName:"webgl",kernelFunc:w$e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S$e{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[o]*t[o];this.outputShape=s,this.rank=s.length;const r=sn(this.rank),i=C$e(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function C$e(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${t[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MH(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:i}=s;if(r.dtype==="string"||r.shape.length>5){const l=t.readSync(r.dataId),u=r.dtype==="string"?l.map(m=>xc(m)):l,d=ht(r.shape,r.dtype,u),f=ACe(d,i);return t.makeTensorInfo(f.shape,f.dtype,f.values)}const o=new S$e(r.shape,i);return t.runWebGLProgram(o,[r],r.dtype)}const T$e={kernelName:d0,backendName:"webgl",kernelFunc:MH};class E$e{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class I$e{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tu(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function h3(n){let e=1;for(;e<n;)e*=2;return e}function k$e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:i,sorted:o}=s,a=pe().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=pe().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=r.shape,d=u[u.length-1];if(t.shouldExecuteOnCPU([r])||d<a||i>l){const R=t.readSync(r.dataId),[A,U]=RCe(R,u,r.dtype,i,o);return[t.makeTensorInfo(A.shape,A.dtype,A.values),t.makeTensorInfo(U.shape,U.dtype,U.values)]}if(i===0)return u[u.length-1]=0,[t.makeTensorInfo(u,r.dtype,[]),t.makeTensorInfo(u,"int32",[])];if(d===1)return[r,P0({attrs:{shape:u,dtype:"int32",value:0},backend:t})];const f=t.texData.get(r.dataId),m=f!==null&&f.isPacked,y=m?t.unpackTensor(r):r,w=xe(u)/d,v=$e({inputs:{x:y},attrs:{shape:[w,d]},backend:t});m&&Tu(t,y);const S=h3(i),T=h3(d);let I=null;const k=()=>I===null?[v,v]:[v,I],O=(R,A,U)=>{const F=k(),ne=new E$e(U),G=[[d],[I===null?1:0],[Number.NEGATIVE_INFINITY],[R],[A]],K=I;I=t.runWebGLProgram(ne,F,"int32",G),Tu(t,K)};for(let R=1;R<S;R*=2){const A=R*2;for(let U=R;U>=1;U/=2)O(A,U,[w,T])}for(let R=T;R>S;R/=2){const A=k(),U=new I$e([w,R/2]),ne=[[d],[I===null?1:0],[S]],Q=I;I=t.runWebGLProgram(U,A,"int32",ne),Tu(t,Q);const G=S/2,K=G*2;for(let J=G;J>=1;J/=2)O(K,J,I.shape)}let V=I;I=fp({inputs:{x:I},backend:t,attrs:{begin:0,size:[w,i]}}),Tu(t,V);let P=kH({inputs:{x:v,indices:I},backend:t,attrs:{axis:1,batchDims:1}});Tu(t,v);const D=u.slice(0,-1);D.push(i),V=I,I=$e({inputs:{x:I},attrs:{shape:D},backend:t}),Tu(t,V);const $=P;return P=$e({inputs:{x:P},attrs:{shape:D},backend:t}),Tu(t,$),[P,I]}const N$e={kernelName:i2,backendName:"webgl",kernelFunc:k$e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A$e{constructor(e,t,s,r,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R$e(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=s,[d,f,m,y]=r.shape,[b,w]=u??[f,m],v=[d,b,w,y],S=new A$e(f,m,o,a,l,v);return t.runWebGLProgram(S,[r,i],"float32")}const $$e={kernelName:o2,backendName:"webgl",kernelFunc:R$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D$e(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:i}=e;$0(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(i.dataId),{outputValues:a,outputShape:l,indices:u}=$Ce(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const O$e={kernelName:a2,backendName:"webgl",kernelFunc:D$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P$e(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r,a=o.shape.length,l=r.shape[i],u=new Array(a-1);let d=0;for(let w=0;w<a;w++)w!==i&&(u[d++]=o.shape[w]);const f=[],m=new Array(a).fill(0),y=o.shape.slice();y[i]=1;const b=new Array(l);for(let w=0;w<b.length;w++){m[i]=w;const v=fp({inputs:{x:o},backend:t,attrs:{begin:m,size:y}}),S=$e({inputs:{x:v},backend:t,attrs:{shape:u}});b[w]=S,f.push(v)}return f.forEach(w=>t.disposeIntermediateTensorInfo(w)),b}const M$e={kernelName:t1,backendName:"webgl",kernelFunc:P$e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L$e{constructor(e,t){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/s);this.outputShape=[r,a];const l="0.0",u="sumValue",d=Math.floor(s/4)*4,f=s%4,m=`
        sumValue += dot(values, segFilter);
    `;let y="";i%s>0&&(y=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let b="";i%s>0&&(b=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${y}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${b}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${m}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${m}
        } else if (${f===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${m}
        } else if (${f===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${m}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F$e(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:i}=e,{numSegments:o}=s,a=r.shape.length,l=[];let u=0;const d=Nn([u],a);let f=r;d!=null&&(f=gr({inputs:{x:r},backend:t,attrs:{perm:d}}),l.push(f),u=Bn(1,a)[0]);const m=y6(f.shape,u,o),y=xe([f.shape[u]]),b=$e({inputs:{x:f},backend:t,attrs:{shape:[-1,y]}});l.push(b);const w=c2(r.dtype),v=(k,O,V,P,D)=>{const $=k.shape[0],R=k.shape[1],A=g6(R,D),U={windowSize:A,inSize:R,batchSize:$,numSegments:D},F=new L$e(U,O),ne=t.compileAndRun(F,[k,V],P);if(l.push(ne),ne.shape[1]===D)return ne;const Q=PH({backend:t,attrs:{start:0,stop:D,step:1,dtype:"float32"}}),G=MH({inputs:{x:Q},backend:t,attrs:{reps:[R/A]}});return l.push(Q),l.push(G),v(ne,O,G,P,D)},S=v(b,"unsortedSegmentSum",i,w,o),T=$e({inputs:{x:S},backend:t,attrs:{shape:m}});let I=T;if(d!=null){l.push(T);const k=Fc(d);I=gr({inputs:{x:I},backend:t,attrs:{perm:k}})}return l.forEach(k=>t.disposeIntermediateTensorInfo(k)),I}const V$e={kernelName:n1,backendName:"webgl",kernelFunc:F$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U$e=[STe,TTe,kTe,RTe,DTe,MTe,FTe,UTe,WTe,HTe,XTe,JTe,tEe,iEe,lEe,uEe,dEe,gEe,bEe,vEe,CEe,REe,DEe,LEe,VEe,GEe,qEe,QEe,oTe,eIe,iIe,cIe,mIe,bIe,vIe,_Ie,CIe,kIe,RIe,OIe,MIe,FIe,UIe,jIe,GIe,XIe,QIe,eke,ske,ike,cke,fke,yke,vke,Ske,Cke,Eke,kke,Ake,$ke,Oke,Fke,Bke,Wke,Hke,Xke,Jke,nNe,oNe,iTe,lNe,sIe,hNe,pNe,yNe,lTe,wNe,TNe,INe,RNe,ONe,FNe,BNe,GNe,XNe,JNe,e2e,r2e,o2e,l2e,d2e,p2e,g2e,b2e,v2e,C2e,k2e,$2e,U2e,hTe,W2e,q2e,Y2e,Z2e,BEe,nAe,rAe,oAe,cAe,fAe,uTe,mAe,yAe,xAe,wAe,_Ae,zEe,M2e,TAe,NAe,DAe,fTe,LAe,UAe,WAe,qAe,QAe,ZAe,nRe,iRe,lRe,hRe,pRe,yRe,wRe,CRe,kRe,RRe,NEe,F2e,ORe,MRe,FRe,URe,zRe,WRe,HRe,KRe,YRe,ZRe,t$e,s$e,i$e,l$e,u$e,d$e,p$e,L2e,vTe,y$e,v$e,_$e,T$e,N$e,$$e,wTe,O$e,M$e,V$e,sAe];for(const n of U$e)Nz(n);class B$e{static model=null;static async load(){if(!this.model){const e=qz("indexeddb://ai-tutor-model");e.length>0?this.model=await CF(e[0]):(this.model=await CF("/models/ai-tutor/model.json"),await this.model.save("indexeddb://ai-tutor-model"))}return this.model}static async predict(e){const t=await this.load(),s=ev([[...yourTextToVectorFunction(e)]]);return t.predict(s).arraySync()[0]}}"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js").then(()=>console.log("AI Model: Offline support enabled"));function LH(){return te.useContext(o4)}function z$e(){const{user:n}=LH(),[e,t]=te.useState([]),[s,r]=te.useState(""),[i,o]=te.useState(!1),a=te.useRef(null);te.useEffect(()=>{(async()=>{const{data:d}=await Ei.from("chat_history").select("*").eq("user_id",n.id).order("created_at",{ascending:!0});d&&t(d)})()},[n]),te.useEffect(()=>{a.current?.scrollIntoView({behavior:"smooth"})},[e]);const l=async u=>{if(u.preventDefault(),!s.trim())return;const d={content:s,role:"user",user_id:n.id,created_at:new Date().toISOString()};t(f=>[...f,d]),r(""),o(!0);try{const m={content:await B$e.predict(s),role:"assistant",user_id:n.id,created_at:new Date().toISOString()};await Ei.from("chat_history").insert([d,m]),t(y=>[...y,m])}catch(f){console.error("AI Error:",f),t(m=>[...m,{content:"I'm having trouble connecting. Working in offline mode with limited capabilities.",role:"system"}])}finally{o(!1)}};return E.jsxs("div",{className:"flex flex-col h-full",children:[E.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.map((u,d)=>E.jsx("div",{className:`flex ${u.role==="user"?"justify-end":"justify-start"}`,children:E.jsx("div",{className:`max-w-3/4 p-3 rounded-lg ${u.role==="user"?"bg-blue-500 text-white":"bg-gray-200 text-gray-800"}`,children:u.content})},d)),E.jsx("div",{ref:a})]}),E.jsx("form",{onSubmit:l,className:"p-4 border-t",children:E.jsxs("div",{className:"flex space-x-2",children:[E.jsx("input",{type:"text",value:s,onChange:u=>r(u.target.value),className:"flex-1 p-2 border rounded-lg",placeholder:"Ask your AI tutor...",disabled:i}),E.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded-lg disabled:opacity-50",disabled:i,children:i?"...":"Send"})]})})]})}function j$e(){return E.jsxs("div",{className:"p-10",children:[E.jsx("h1",{className:"text-3xl font-bold",children:" Progress"}),E.jsx("p",{children:"This page shows your learning performance, goals, and stats."})]})}function W$e(){return E.jsxs("div",{className:"p-10",children:[E.jsx("h1",{className:"text-3xl font-bold",children:" Offline Help"}),E.jsx("p",{children:"Heres how to use the app without internet access."})]})}function G$e(){const[n]=yy(Di),e=Ec(),{darkMode:t,setDarkMode:s}=_I(),[r,i]=te.useState(null),[o,a]=te.useState({displayName:"",email:"",currentPassword:"",newPassword:"",confirmPassword:"",language:"en",notifications:!0}),[l,u]=te.useState({}),[d,f]=te.useState(""),[m,y]=te.useState(!1),[b,w]=te.useState({length:!1,uppercase:!1,number:!1,specialChar:!1});te.useEffect(()=>{if(n){const k=Hu(qu,`users/${n.uid}`);Dv(k,O=>{const V=O.val();i(V),a(P=>({...P,displayName:n.displayName||"",email:n.email||"",language:V?.language||"en",notifications:V?.notifications??!0}))})}},[n]),te.useEffect(()=>{o.newPassword&&w({length:o.newPassword.length>=8,uppercase:/[A-Z]/.test(o.newPassword),number:/\d/.test(o.newPassword),specialChar:/[!@#$%^&*(),.?":{}|<>]/.test(o.newPassword)})},[o.newPassword]);const v=k=>{const{name:O,value:V,type:P,checked:D}=k.target;a($=>({...$,[O]:P==="checkbox"?D:V}))},S=async k=>{k.preventDefault(),y(!0),u({}),f("");try{if(o.newPassword&&o.newPassword!==o.confirmPassword)throw new Error("New passwords do not match");const O={};o.displayName!==n.displayName&&(O.displayName=o.displayName),O.language=o.language,O.notifications=o.notifications,O.darkMode=t,await NE(Hu(qu,`users/${n.uid}`),O),f("Settings updated successfully!")}catch(O){console.error("Update error:",O),u({general:O.message||"Failed to update settings"})}finally{y(!1)}},T=()=>{const k=!t;s(k),n&&NE(Hu(qu,`users/${n.uid}`),{darkMode:k})},I=async()=>{try{await Di.signOut(),e("/login")}catch(k){console.error("Logout error:",k)}};return n?E.jsxs("div",{className:`min-h-screen transition-colors duration-300 ${t?"dark bg-gray-900":"bg-gray-50"}`,children:[E.jsx("header",{className:`sticky top-0 z-10 backdrop-blur-md ${t?"bg-black/80":"bg-white/80"} shadow-sm`,children:E.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[E.jsxs(nn,{to:"/profile",className:"flex items-center text-teal-600 hover:text-teal-700 dark:text-teal-400 dark:hover:text-teal-300",children:[E.jsx(n_,{className:"mr-1"})," Back to Profile"]}),E.jsx("h1",{className:"text-xl font-bold bg-gradient-to-r from-teal-400 to-teal-600 bg-clip-text text-transparent",children:"Account Settings"}),E.jsx("div",{})," "]})}),E.jsx("main",{className:"container mx-auto px-4 py-8",children:E.jsx("div",{className:"max-w-2xl mx-auto",children:E.jsx("div",{className:`p-6 rounded-xl shadow-lg mb-8 backdrop-blur-sm ${t?"bg-gray-800/70 border border-gray-700":"bg-white/80 border border-gray-200"}`,children:E.jsxs("form",{onSubmit:S,children:[l.general&&E.jsx("div",{className:`mb-4 p-3 rounded-lg ${t?"bg-red-900/50 text-red-200":"bg-red-100 text-red-800"}`,children:l.general}),d&&E.jsx("div",{className:`mb-4 p-3 rounded-lg ${t?"bg-teal-900/50 text-teal-200":"bg-teal-100 text-teal-800"}`,children:d}),E.jsxs("div",{className:"space-y-8",children:[E.jsxs("div",{children:[E.jsxs("h2",{className:`text-lg font-semibold mb-4 flex items-center ${t?"text-gray-200":"text-gray-800"}`,children:[E.jsx(s_,{className:"mr-2 text-teal-500"}),"Profile Information"]}),E.jsxs("div",{className:"space-y-4",children:[E.jsxs("div",{children:[E.jsx("label",{htmlFor:"displayName",className:`block text-sm font-medium mb-1 ${t?"text-gray-300":"text-gray-700"}`,children:"Display Name"}),E.jsx("input",{type:"text",id:"displayName",name:"displayName",value:o.displayName,onChange:v,className:`w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"}`})]}),E.jsxs("div",{children:[E.jsx("label",{htmlFor:"email",className:`block text-sm font-medium mb-1 ${t?"text-gray-300":"text-gray-700"}`,children:"Email Address"}),E.jsx("input",{type:"email",id:"email",name:"email",value:o.email,onChange:v,disabled:!0,className:`w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent ${t?"bg-gray-700/50 border-gray-600 text-gray-400":"bg-gray-100 border-gray-300 text-gray-600"}`}),E.jsx("p",{className:`mt-1 text-xs ${t?"text-gray-400":"text-gray-500"}`,children:"Contact support to change your email address"})]})]})]}),E.jsxs("div",{children:[E.jsxs("h2",{className:`text-lg font-semibold mb-4 flex items-center ${t?"text-gray-200":"text-gray-800"}`,children:[E.jsx(dN,{className:"mr-2 text-teal-500"}),"Security"]}),E.jsxs("div",{className:"space-y-4",children:[E.jsxs("div",{children:[E.jsx("label",{htmlFor:"currentPassword",className:`block text-sm font-medium mb-1 ${t?"text-gray-300":"text-gray-700"}`,children:"Current Password"}),E.jsx("input",{type:"password",id:"currentPassword",name:"currentPassword",value:o.currentPassword,onChange:v,className:`w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"}`,placeholder:"Required for password changes"})]}),E.jsxs("div",{children:[E.jsx("label",{htmlFor:"newPassword",className:`block text-sm font-medium mb-1 ${t?"text-gray-300":"text-gray-700"}`,children:"New Password"}),E.jsx("input",{type:"password",id:"newPassword",name:"newPassword",value:o.newPassword,onChange:v,className:`w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"}`,placeholder:"Leave blank to keep current password"})]}),o.newPassword&&E.jsxs("div",{className:`p-3 rounded-lg ${t?"bg-gray-700/50":"bg-gray-100"}`,children:[E.jsx("h4",{className:`text-sm font-medium mb-2 ${t?"text-gray-300":"text-gray-700"}`,children:"Password Requirements:"}),E.jsxs("ul",{className:"space-y-1 text-sm",children:[E.jsxs("li",{className:`flex items-center ${b.length?"text-green-500":t?"text-gray-400":"text-gray-600"}`,children:[b.length?E.jsx(gx,{className:"mr-1"}):E.jsx(yx,{className:"mr-1"}),"At least 8 characters"]}),E.jsxs("li",{className:`flex items-center ${b.uppercase?"text-green-500":t?"text-gray-400":"text-gray-600"}`,children:[b.uppercase?E.jsx(gx,{className:"mr-1"}):E.jsx(yx,{className:"mr-1"}),"At least one uppercase letter"]}),E.jsxs("li",{className:`flex items-center ${b.number?"text-green-500":t?"text-gray-400":"text-gray-600"}`,children:[b.number?E.jsx(gx,{className:"mr-1"}):E.jsx(yx,{className:"mr-1"}),"At least one number"]}),E.jsxs("li",{className:`flex items-center ${b.specialChar?"text-green-500":t?"text-gray-400":"text-gray-600"}`,children:[b.specialChar?E.jsx(gx,{className:"mr-1"}):E.jsx(yx,{className:"mr-1"}),"At least one special character"]})]})]}),E.jsxs("div",{children:[E.jsx("label",{htmlFor:"confirmPassword",className:`block text-sm font-medium mb-1 ${t?"text-gray-300":"text-gray-700"}`,children:"Confirm New Password"}),E.jsx("input",{type:"password",id:"confirmPassword",name:"confirmPassword",value:o.confirmPassword,onChange:v,className:`w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"}`,placeholder:"Confirm your new password"})]})]})]}),E.jsxs("div",{children:[E.jsxs("h2",{className:`text-lg font-semibold mb-4 flex items-center ${t?"text-gray-200":"text-gray-800"}`,children:[E.jsx(KB,{className:"mr-2 text-teal-500"}),"Preferences"]}),E.jsxs("div",{className:"space-y-6",children:[E.jsxs("div",{className:"flex items-center justify-between",children:[E.jsxs("div",{children:[E.jsx("h3",{className:`font-medium ${t?"text-gray-200":"text-gray-800"}`,children:"Theme"}),E.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:t?"Dark mode":"Light mode"})]}),E.jsx("button",{type:"button",onClick:T,className:`p-2 rounded-full ${t?"bg-gray-700 text-teal-400":"bg-gray-200 text-gray-700"}`,"aria-label":"Toggle dark mode",children:t?E.jsx(toe,{className:"w-5 h-5"}):E.jsx(Qie,{className:"w-5 h-5"})})]}),E.jsxs("div",{children:[E.jsx("label",{htmlFor:"language",className:`block text-sm font-medium mb-1 ${t?"text-gray-300":"text-gray-700"}`,children:"Language"}),E.jsxs("select",{id:"language",name:"language",value:o.language,onChange:v,className:`w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"}`,children:[E.jsx("option",{value:"en",children:"English"}),E.jsx("option",{value:"hi",children:" (Hindi)"}),E.jsx("option",{value:"ta",children:" (Tamil)"}),E.jsx("option",{value:"te",children:" (Telugu)"}),E.jsx("option",{value:"bn",children:" (Bengali)"}),E.jsx("option",{value:"mr",children:" (Marathi)"})]})]}),E.jsxs("div",{className:"flex items-center",children:[E.jsx("input",{type:"checkbox",id:"notifications",name:"notifications",checked:o.notifications,onChange:v,className:`h-4 w-4 rounded focus:ring-teal-500 ${t?"bg-gray-700 border-gray-600":"bg-white border-gray-300"}`}),E.jsx("label",{htmlFor:"notifications",className:`ml-2 block text-sm ${t?"text-gray-300":"text-gray-700"}`,children:"Email Notifications"})]})]})]}),E.jsxs("div",{className:"pt-4 flex flex-col sm:flex-row justify-between gap-4",children:[E.jsxs("button",{type:"submit",disabled:m,className:`flex-1 py-3 px-4 rounded-lg font-medium text-white bg-gradient-to-r from-teal-500 to-teal-600 hover:from-teal-600 hover:to-teal-700 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 flex items-center justify-center ${t?"focus:ring-offset-gray-800":"focus:ring-offset-white"}`,children:[E.jsx(Jie,{className:"mr-2"}),m?"Saving...":"Save Changes"]}),E.jsxs("button",{type:"button",onClick:I,className:`flex-1 py-3 px-4 rounded-lg font-medium flex items-center justify-center ${t?"bg-red-600/90 text-white hover:bg-red-700 border border-red-700":"bg-red-500 text-white hover:bg-red-600 border border-red-600"}`,children:[E.jsx(fN,{className:"mr-2"}),"Sign Out"]})]})]})]})})})})]}):E.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:E.jsxs("div",{className:"text-center p-8 rounded-xl bg-white/80 dark:bg-gray-800/70 backdrop-blur-sm shadow-lg border border-gray-200 dark:border-gray-700",children:[E.jsx("h2",{className:"text-2xl font-bold mb-4 dark:text-gray-200",children:"Please sign in to access settings"}),E.jsx(nn,{to:"/login",className:"text-teal-600 hover:text-teal-700 dark:text-teal-400 dark:hover:text-teal-300 font-medium",children:"Go to login page"})]})})}function H$e(){return E.jsxs("div",{className:"text-center p-10",children:[E.jsx("h1",{className:"text-4xl font-bold text-red-600",children:"404 - Page Not Found"}),E.jsx("p",{className:"text-gray-600 mt-4",children:"Oops! The page you're looking for doesn't exist."})]})}const FH=6048e5,q$e=864e5,d3=Symbol.for("constructDateFrom");function Tc(n,e){return typeof n=="function"?n(e):n&&typeof n=="object"&&d3 in n?n[d3](e):n instanceof Date?new n.constructor(e):new Date(e)}function uo(n,e){return Tc(e||n,n)}let K$e={};function O1(){return K$e}function Xg(n,e){const t=O1(),s=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??t.weekStartsOn??t.locale?.options?.weekStartsOn??0,r=uo(n,e?.in),i=r.getDay(),o=(i<s?7:0)+i-s;return r.setDate(r.getDate()-o),r.setHours(0,0,0,0),r}function xw(n,e){return Xg(n,{...e,weekStartsOn:1})}function VH(n,e){const t=uo(n,e?.in),s=t.getFullYear(),r=Tc(t,0);r.setFullYear(s+1,0,4),r.setHours(0,0,0,0);const i=xw(r),o=Tc(t,0);o.setFullYear(s,0,4),o.setHours(0,0,0,0);const a=xw(o);return t.getTime()>=i.getTime()?s+1:t.getTime()>=a.getTime()?s:s-1}function f3(n){const e=uo(n),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+n-+t}function X$e(n,...e){const t=Tc.bind(null,e.find(s=>typeof s=="object"));return e.map(t)}function p3(n,e){const t=uo(n,e?.in);return t.setHours(0,0,0,0),t}function Y$e(n,e,t){const[s,r]=X$e(t?.in,n,e),i=p3(s),o=p3(r),a=+i-f3(i),l=+o-f3(o);return Math.round((a-l)/q$e)}function Q$e(n,e){const t=VH(n,e),s=Tc(n,0);return s.setFullYear(t,0,4),s.setHours(0,0,0,0),xw(s)}function J$e(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function Z$e(n){return!(!J$e(n)&&typeof n!="number"||isNaN(+uo(n)))}function eDe(n,e){const t=uo(n,e?.in);return t.setFullYear(t.getFullYear(),0,1),t.setHours(0,0,0,0),t}const tDe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},nDe=(n,e,t)=>{let s;const r=tDe[n];return typeof r=="string"?s=r:e===1?s=r.one:s=r.other.replace("{{count}}",e.toString()),t?.addSuffix?t.comparison&&t.comparison>0?"in "+s:s+" ago":s};function $T(n){return(e={})=>{const t=e.width?String(e.width):n.defaultWidth;return n.formats[t]||n.formats[n.defaultWidth]}}const sDe={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},rDe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},iDe={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},oDe={date:$T({formats:sDe,defaultWidth:"full"}),time:$T({formats:rDe,defaultWidth:"full"}),dateTime:$T({formats:iDe,defaultWidth:"full"})},aDe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},lDe=(n,e,t,s)=>aDe[n];function $m(n){return(e,t)=>{const s=t?.context?String(t.context):"standalone";let r;if(s==="formatting"&&n.formattingValues){const o=n.defaultFormattingWidth||n.defaultWidth,a=t?.width?String(t.width):o;r=n.formattingValues[a]||n.formattingValues[o]}else{const o=n.defaultWidth,a=t?.width?String(t.width):n.defaultWidth;r=n.values[a]||n.values[o]}const i=n.argumentCallback?n.argumentCallback(e):e;return r[i]}}const cDe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},uDe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},hDe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},dDe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},fDe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},pDe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},mDe=(n,e)=>{const t=Number(n),s=t%100;if(s>20||s<10)switch(s%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},gDe={ordinalNumber:mDe,era:$m({values:cDe,defaultWidth:"wide"}),quarter:$m({values:uDe,defaultWidth:"wide",argumentCallback:n=>n-1}),month:$m({values:hDe,defaultWidth:"wide"}),day:$m({values:dDe,defaultWidth:"wide"}),dayPeriod:$m({values:fDe,defaultWidth:"wide",formattingValues:pDe,defaultFormattingWidth:"wide"})};function Dm(n){return(e,t={})=>{const s=t.width,r=s&&n.matchPatterns[s]||n.matchPatterns[n.defaultMatchWidth],i=e.match(r);if(!i)return null;const o=i[0],a=s&&n.parsePatterns[s]||n.parsePatterns[n.defaultParseWidth],l=Array.isArray(a)?bDe(a,f=>f.test(o)):yDe(a,f=>f.test(o));let u;u=n.valueCallback?n.valueCallback(l):l,u=t.valueCallback?t.valueCallback(u):u;const d=e.slice(o.length);return{value:u,rest:d}}}function yDe(n,e){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&e(n[t]))return t}function bDe(n,e){for(let t=0;t<n.length;t++)if(e(n[t]))return t}function xDe(n){return(e,t={})=>{const s=e.match(n.matchPattern);if(!s)return null;const r=s[0],i=e.match(n.parsePattern);if(!i)return null;let o=n.valueCallback?n.valueCallback(i[0]):i[0];o=t.valueCallback?t.valueCallback(o):o;const a=e.slice(r.length);return{value:o,rest:a}}}const vDe=/^(\d+)(th|st|nd|rd)?/i,wDe=/\d+/i,_De={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},SDe={any:[/^b/i,/^(a|c)/i]},CDe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},TDe={any:[/1/i,/2/i,/3/i,/4/i]},EDe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},IDe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},kDe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},NDe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},ADe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},RDe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},$De={ordinalNumber:xDe({matchPattern:vDe,parsePattern:wDe,valueCallback:n=>parseInt(n,10)}),era:Dm({matchPatterns:_De,defaultMatchWidth:"wide",parsePatterns:SDe,defaultParseWidth:"any"}),quarter:Dm({matchPatterns:CDe,defaultMatchWidth:"wide",parsePatterns:TDe,defaultParseWidth:"any",valueCallback:n=>n+1}),month:Dm({matchPatterns:EDe,defaultMatchWidth:"wide",parsePatterns:IDe,defaultParseWidth:"any"}),day:Dm({matchPatterns:kDe,defaultMatchWidth:"wide",parsePatterns:NDe,defaultParseWidth:"any"}),dayPeriod:Dm({matchPatterns:ADe,defaultMatchWidth:"any",parsePatterns:RDe,defaultParseWidth:"any"})},DDe={code:"en-US",formatDistance:nDe,formatLong:oDe,formatRelative:lDe,localize:gDe,match:$De,options:{weekStartsOn:0,firstWeekContainsDate:1}};function ODe(n,e){const t=uo(n,e?.in);return Y$e(t,eDe(t))+1}function PDe(n,e){const t=uo(n,e?.in),s=+xw(t)-+Q$e(t);return Math.round(s/FH)+1}function UH(n,e){const t=uo(n,e?.in),s=t.getFullYear(),r=O1(),i=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,o=Tc(e?.in||n,0);o.setFullYear(s+1,0,i),o.setHours(0,0,0,0);const a=Xg(o,e),l=Tc(e?.in||n,0);l.setFullYear(s,0,i),l.setHours(0,0,0,0);const u=Xg(l,e);return+t>=+a?s+1:+t>=+u?s:s-1}function MDe(n,e){const t=O1(),s=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??t.firstWeekContainsDate??t.locale?.options?.firstWeekContainsDate??1,r=UH(n,e),i=Tc(e?.in||n,0);return i.setFullYear(r,0,s),i.setHours(0,0,0,0),Xg(i,e)}function LDe(n,e){const t=uo(n,e?.in),s=+Xg(t,e)-+MDe(t,e);return Math.round(s/FH)+1}function tn(n,e){const t=n<0?"-":"",s=Math.abs(n).toString().padStart(e,"0");return t+s}const Ul={y(n,e){const t=n.getFullYear(),s=t>0?t:1-t;return tn(e==="yy"?s%100:s,e.length)},M(n,e){const t=n.getMonth();return e==="M"?String(t+1):tn(t+1,2)},d(n,e){return tn(n.getDate(),e.length)},a(n,e){const t=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(n,e){return tn(n.getHours()%12||12,e.length)},H(n,e){return tn(n.getHours(),e.length)},m(n,e){return tn(n.getMinutes(),e.length)},s(n,e){return tn(n.getSeconds(),e.length)},S(n,e){const t=e.length,s=n.getMilliseconds(),r=Math.trunc(s*Math.pow(10,t-3));return tn(r,e.length)}},zd={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},m3={G:function(n,e,t){const s=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(s,{width:"abbreviated"});case"GGGGG":return t.era(s,{width:"narrow"});case"GGGG":default:return t.era(s,{width:"wide"})}},y:function(n,e,t){if(e==="yo"){const s=n.getFullYear(),r=s>0?s:1-s;return t.ordinalNumber(r,{unit:"year"})}return Ul.y(n,e)},Y:function(n,e,t,s){const r=UH(n,s),i=r>0?r:1-r;if(e==="YY"){const o=i%100;return tn(o,2)}return e==="Yo"?t.ordinalNumber(i,{unit:"year"}):tn(i,e.length)},R:function(n,e){const t=VH(n);return tn(t,e.length)},u:function(n,e){const t=n.getFullYear();return tn(t,e.length)},Q:function(n,e,t){const s=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(s);case"QQ":return tn(s,2);case"Qo":return t.ordinalNumber(s,{unit:"quarter"});case"QQQ":return t.quarter(s,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(s,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(s,{width:"wide",context:"formatting"})}},q:function(n,e,t){const s=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(s);case"qq":return tn(s,2);case"qo":return t.ordinalNumber(s,{unit:"quarter"});case"qqq":return t.quarter(s,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(s,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(s,{width:"wide",context:"standalone"})}},M:function(n,e,t){const s=n.getMonth();switch(e){case"M":case"MM":return Ul.M(n,e);case"Mo":return t.ordinalNumber(s+1,{unit:"month"});case"MMM":return t.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(s,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(s,{width:"wide",context:"formatting"})}},L:function(n,e,t){const s=n.getMonth();switch(e){case"L":return String(s+1);case"LL":return tn(s+1,2);case"Lo":return t.ordinalNumber(s+1,{unit:"month"});case"LLL":return t.month(s,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(s,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(s,{width:"wide",context:"standalone"})}},w:function(n,e,t,s){const r=LDe(n,s);return e==="wo"?t.ordinalNumber(r,{unit:"week"}):tn(r,e.length)},I:function(n,e,t){const s=PDe(n);return e==="Io"?t.ordinalNumber(s,{unit:"week"}):tn(s,e.length)},d:function(n,e,t){return e==="do"?t.ordinalNumber(n.getDate(),{unit:"date"}):Ul.d(n,e)},D:function(n,e,t){const s=ODe(n);return e==="Do"?t.ordinalNumber(s,{unit:"dayOfYear"}):tn(s,e.length)},E:function(n,e,t){const s=n.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(s,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(s,{width:"short",context:"formatting"});case"EEEE":default:return t.day(s,{width:"wide",context:"formatting"})}},e:function(n,e,t,s){const r=n.getDay(),i=(r-s.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return tn(i,2);case"eo":return t.ordinalNumber(i,{unit:"day"});case"eee":return t.day(r,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(r,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(r,{width:"short",context:"formatting"});case"eeee":default:return t.day(r,{width:"wide",context:"formatting"})}},c:function(n,e,t,s){const r=n.getDay(),i=(r-s.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return tn(i,e.length);case"co":return t.ordinalNumber(i,{unit:"day"});case"ccc":return t.day(r,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(r,{width:"narrow",context:"standalone"});case"cccccc":return t.day(r,{width:"short",context:"standalone"});case"cccc":default:return t.day(r,{width:"wide",context:"standalone"})}},i:function(n,e,t){const s=n.getDay(),r=s===0?7:s;switch(e){case"i":return String(r);case"ii":return tn(r,e.length);case"io":return t.ordinalNumber(r,{unit:"day"});case"iii":return t.day(s,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(s,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(s,{width:"short",context:"formatting"});case"iiii":default:return t.day(s,{width:"wide",context:"formatting"})}},a:function(n,e,t){const r=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(n,e,t){const s=n.getHours();let r;switch(s===12?r=zd.noon:s===0?r=zd.midnight:r=s/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(n,e,t){const s=n.getHours();let r;switch(s>=17?r=zd.evening:s>=12?r=zd.afternoon:s>=4?r=zd.morning:r=zd.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(n,e,t){if(e==="ho"){let s=n.getHours()%12;return s===0&&(s=12),t.ordinalNumber(s,{unit:"hour"})}return Ul.h(n,e)},H:function(n,e,t){return e==="Ho"?t.ordinalNumber(n.getHours(),{unit:"hour"}):Ul.H(n,e)},K:function(n,e,t){const s=n.getHours()%12;return e==="Ko"?t.ordinalNumber(s,{unit:"hour"}):tn(s,e.length)},k:function(n,e,t){let s=n.getHours();return s===0&&(s=24),e==="ko"?t.ordinalNumber(s,{unit:"hour"}):tn(s,e.length)},m:function(n,e,t){return e==="mo"?t.ordinalNumber(n.getMinutes(),{unit:"minute"}):Ul.m(n,e)},s:function(n,e,t){return e==="so"?t.ordinalNumber(n.getSeconds(),{unit:"second"}):Ul.s(n,e)},S:function(n,e){return Ul.S(n,e)},X:function(n,e,t){const s=n.getTimezoneOffset();if(s===0)return"Z";switch(e){case"X":return y3(s);case"XXXX":case"XX":return Au(s);case"XXXXX":case"XXX":default:return Au(s,":")}},x:function(n,e,t){const s=n.getTimezoneOffset();switch(e){case"x":return y3(s);case"xxxx":case"xx":return Au(s);case"xxxxx":case"xxx":default:return Au(s,":")}},O:function(n,e,t){const s=n.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+g3(s,":");case"OOOO":default:return"GMT"+Au(s,":")}},z:function(n,e,t){const s=n.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+g3(s,":");case"zzzz":default:return"GMT"+Au(s,":")}},t:function(n,e,t){const s=Math.trunc(+n/1e3);return tn(s,e.length)},T:function(n,e,t){return tn(+n,e.length)}};function g3(n,e=""){const t=n>0?"-":"+",s=Math.abs(n),r=Math.trunc(s/60),i=s%60;return i===0?t+String(r):t+String(r)+e+tn(i,2)}function y3(n,e){return n%60===0?(n>0?"-":"+")+tn(Math.abs(n)/60,2):Au(n,e)}function Au(n,e=""){const t=n>0?"-":"+",s=Math.abs(n),r=tn(Math.trunc(s/60),2),i=tn(s%60,2);return t+r+e+i}const b3=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},BH=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},FDe=(n,e)=>{const t=n.match(/(P+)(p+)?/)||[],s=t[1],r=t[2];if(!r)return b3(n,e);let i;switch(s){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",b3(s,e)).replace("{{time}}",BH(r,e))},VDe={p:BH,P:FDe},UDe=/^D+$/,BDe=/^Y+$/,zDe=["D","DD","YY","YYYY"];function jDe(n){return UDe.test(n)}function WDe(n){return BDe.test(n)}function GDe(n,e,t){const s=HDe(n,e,t);if(console.warn(s),zDe.includes(n))throw new RangeError(s)}function HDe(n,e,t){const s=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${s} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const qDe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,KDe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,XDe=/^'([^]*?)'?$/,YDe=/''/g,QDe=/[a-zA-Z]/;function DT(n,e,t){const s=O1(),r=s.locale??DDe,i=s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1,o=s.weekStartsOn??s.locale?.options?.weekStartsOn??0,a=uo(n,t?.in);if(!Z$e(a))throw new RangeError("Invalid time value");let l=e.match(KDe).map(d=>{const f=d[0];if(f==="p"||f==="P"){const m=VDe[f];return m(d,r.formatLong)}return d}).join("").match(qDe).map(d=>{if(d==="''")return{isToken:!1,value:"'"};const f=d[0];if(f==="'")return{isToken:!1,value:JDe(d)};if(m3[f])return{isToken:!0,value:d};if(f.match(QDe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+f+"`");return{isToken:!1,value:d}});r.localize.preprocessor&&(l=r.localize.preprocessor(a,l));const u={firstWeekContainsDate:i,weekStartsOn:o,locale:r};return l.map(d=>{if(!d.isToken)return d.value;const f=d.value;(WDe(f)||jDe(f))&&GDe(f,e,String(n));const m=m3[f[0]];return m(a,f,r.localize,u)}).join("")}function JDe(n){const e=n.match(XDe);return e?e[1].replace(YDe,"'"):n}function ZDe(){const[n]=yy(Di),e=Ec(),{darkMode:t}=_I(),[s,r]=te.useState(null),[i,o]=te.useState([]),[a,l]=te.useState([]),[u,d]=te.useState("questions");te.useEffect(()=>{if(n){const m=Hu(qu,`users/${n.uid}`);Dv(m,S=>{const T=S.val();r(T)});const y=Jd($u(Kl,"questions"),xv("userId","==",n.uid)),b=Zd(y,S=>{o(S.docs.map(T=>({id:T.id,...T.data()})))}),w=Jd($u(Kl,"answers"),xv("userId","==",n.uid)),v=Zd(w,S=>{l(S.docs.map(T=>({id:T.id,...T.data()})))});return()=>{b(),v()}}},[n]);const f=async()=>{try{await Di.signOut(),e("/login")}catch(m){console.error("Logout error:",m)}};return n?E.jsxs("div",{className:`min-h-screen transition-colors duration-300 ${t?"dark bg-gray-900":"bg-gray-50"}`,children:[E.jsx("header",{className:`sticky top-0 z-10 backdrop-blur-md ${t?"bg-black/80":"bg-white/80"} shadow-sm`,children:E.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[E.jsx(nn,{to:"/",className:"text-2xl font-bold bg-gradient-to-r from-teal-400 to-teal-600 bg-clip-text text-transparent",children:"StudiQ"}),E.jsxs("nav",{className:"flex items-center space-x-4",children:[E.jsxs(nn,{to:"/settings",className:`flex items-center ${t?"text-gray-300 hover:text-teal-400":"text-gray-700 hover:text-teal-600"}`,children:[E.jsx(XB,{className:"mr-1"})," Settings"]}),E.jsxs("button",{onClick:f,className:`flex items-center ${t?"text-red-400 hover:text-red-300":"text-red-600 hover:text-red-800"}`,children:[E.jsx(fN,{className:"mr-1"})," Sign Out"]})]})]})}),E.jsx("main",{className:"container mx-auto px-4 py-8",children:E.jsxs("div",{className:"max-w-6xl mx-auto",children:[E.jsx("div",{className:`p-6 rounded-xl shadow-lg mb-6 ${t?"bg-gray-800/70":"bg-white/80"} backdrop-blur-sm`,children:E.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-6",children:[E.jsx("div",{className:`w-32 h-32 rounded-full flex items-center justify-center text-5xl ${t?"bg-teal-900 text-teal-300":"bg-teal-100 text-teal-800"}`,children:n.displayName?.charAt(0)||"U"}),E.jsxs("div",{className:"flex-1 text-center md:text-left",children:[E.jsx("h1",{className:`text-3xl font-bold mb-2 ${t?"text-gray-100":"text-gray-800"}`,children:n.displayName||"User"}),E.jsx("p",{className:`mb-4 ${t?"text-gray-400":"text-gray-600"}`,children:n.email}),E.jsxs("div",{className:`flex flex-wrap justify-center md:justify-start gap-4 ${t?"text-gray-300":"text-gray-700"}`,children:[E.jsxs("div",{className:"flex items-center",children:[E.jsx(ag,{className:"mr-2 text-teal-500"}),E.jsxs("span",{children:[s?.points||0," Points"]})]}),E.jsxs("div",{className:"flex items-center",children:[E.jsx(lg,{className:"mr-2 text-teal-500"}),E.jsxs("span",{children:[i.length," Questions"]})]}),E.jsxs("div",{className:"flex items-center",children:[E.jsx(cg,{className:"mr-2 text-teal-500"}),E.jsxs("span",{children:[a.length," Answers"]})]})]})]})]})}),E.jsxs("div",{className:`grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 ${t?"text-gray-200":"text-gray-800"}`,children:[E.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-800":"bg-gray-100"}`,children:[E.jsxs("h3",{className:"font-semibold flex items-center",children:[E.jsx(ag,{className:"mr-2 text-yellow-500"})," Best Answers"]}),E.jsx("p",{className:"text-2xl font-bold",children:s?.bestAnswers||0})]}),E.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-800":"bg-gray-100"}`,children:[E.jsxs("h3",{className:"font-semibold flex items-center",children:[E.jsx(hN,{className:"mr-2 text-blue-500"})," Active Days"]}),E.jsx("p",{className:"text-2xl font-bold",children:s?.activeDays||1})]}),E.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-800":"bg-gray-100"}`,children:[E.jsxs("h3",{className:"font-semibold flex items-center",children:[E.jsx(s_,{className:"mr-2 text-green-500"})," Member Since"]}),E.jsx("p",{className:"text-xl",children:n?.metadata?.creationTime?DT(new Date(n.metadata.creationTime),"MMM yyyy"):"Recently"})]}),E.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-800":"bg-gray-100"}`,children:[E.jsxs("h3",{className:"font-semibold flex items-center",children:[E.jsx(cg,{className:"mr-2 text-purple-500"})," Answer Rate"]}),E.jsx("p",{className:"text-2xl font-bold",children:i.length>0?`${Math.round(i.filter(m=>m.answered).length/i.length*100)}%`:"0%"})]})]}),E.jsx("div",{className:`mb-4 border-b ${t?"border-gray-700":"border-gray-200"}`,children:E.jsxs("nav",{className:"flex space-x-4",children:[E.jsxs("button",{onClick:()=>d("questions"),className:`py-2 px-4 font-medium ${u==="questions"?t?"text-teal-400 border-b-2 border-teal-400":"text-teal-600 border-b-2 border-teal-600":t?"text-gray-400 hover:text-gray-300":"text-gray-600 hover:text-gray-800"}`,children:["My Questions (",i.length,")"]}),E.jsxs("button",{onClick:()=>d("answers"),className:`py-2 px-4 font-medium ${u==="answers"?t?"text-teal-400 border-b-2 border-teal-400":"text-teal-600 border-b-2 border-teal-600":t?"text-gray-400 hover:text-gray-300":"text-gray-600 hover:text-gray-800"}`,children:["My Answers (",a.length,")"]}),E.jsxs("button",{onClick:()=>d("bookmarks"),className:`py-2 px-4 font-medium ${u==="bookmarks"?t?"text-teal-400 border-b-2 border-teal-400":"text-teal-600 border-b-2 border-teal-600":t?"text-gray-400 hover:text-gray-300":"text-gray-600 hover:text-gray-800"}`,children:["Bookmarks (",s?.bookmarks?Object.keys(s.bookmarks).length:0,")"]})]})}),E.jsxs("div",{className:`p-6 rounded-xl shadow-lg ${t?"bg-gray-800/70":"bg-white/80"} backdrop-blur-sm`,children:[u==="questions"&&E.jsxs("div",{className:"space-y-4",children:[E.jsxs("h2",{className:`text-xl font-semibold mb-4 ${t?"text-gray-200":"text-gray-800"}`,children:[E.jsx(lg,{className:"inline mr-2"})," My Questions"]}),i.length>0?i.map(m=>E.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-700/50 hover:bg-gray-700":"bg-gray-100 hover:bg-gray-200"}`,children:[E.jsx(nn,{to:`/question/${m.id}`,className:`font-medium block mb-1 ${t?"text-teal-400 hover:text-teal-300":"text-teal-600 hover:text-teal-800"}`,children:m.title}),E.jsxs("div",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:[E.jsx("span",{className:"capitalize",children:m.subject})," ",m.createdAt?.toDate?DT(m.createdAt.toDate(),"MMM d, yyyy"):"Recent"," ",m.answered?E.jsx("span",{className:"text-green-500 ml-1",children:"Answered"}):E.jsx("span",{className:"text-yellow-500 ml-1",children:"Pending"})]})]},m.id)):E.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"No questions yet"})]}),u==="answers"&&E.jsxs("div",{className:"space-y-4",children:[E.jsxs("h2",{className:`text-xl font-semibold mb-4 ${t?"text-gray-200":"text-gray-800"}`,children:[E.jsx(cg,{className:"inline mr-2"})," My Answers"]}),a.length>0?a.map(m=>E.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-700/50 hover:bg-gray-700":"bg-gray-100 hover:bg-gray-200"}`,children:[E.jsxs(nn,{to:`/question/${m.questionId}`,className:`font-medium block mb-1 ${t?"text-teal-400 hover:text-teal-300":"text-teal-600 hover:text-teal-800"}`,children:[m.content.substring(0,100),"..."]}),E.jsxs("div",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:[m.createdAt?.toDate?DT(m.createdAt.toDate(),"MMM d, yyyy"):"Recent"," ",m.bestAnswer?E.jsx("span",{className:"text-green-500 ml-1",children:"Marked as Best"}):E.jsx("span",{className:"text-gray-500 ml-1",children:"Regular answer"})]})]},m.id)):E.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"No answers yet"})]}),u==="bookmarks"&&E.jsxs("div",{className:"space-y-4",children:[E.jsxs("h2",{className:`text-xl font-semibold mb-4 ${t?"text-gray-200":"text-gray-800"}`,children:[E.jsx(FiBookmark,{className:"inline mr-2"})," My Bookmarks"]}),s?.bookmarks?Object.keys(s.bookmarks).length>0?E.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"Bookmarked questions will appear here"}):E.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"No bookmarks yet"}):E.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"No bookmarks yet"})]})]})]})})]}):E.jsx("div",{className:`min-h-screen flex items-center justify-center ${t?"dark bg-gray-900":"bg-gray-50"}`,children:E.jsxs("div",{className:`p-8 rounded-xl shadow-lg ${t?"bg-gray-800":"bg-white"}`,children:[E.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Please sign in to view your profile"}),E.jsx(nn,{to:"/login",className:"text-teal-600 hover:underline",children:"Go to login page"})]})})}function eOe(){const[n]=yy(Di);Ec();const[e,t]=te.useState(!1),[s,r]=te.useState("faq"),[i,o]=te.useState({name:"",email:"",subject:"",message:""}),[a,l]=te.useState(!1);te.useEffect(()=>{const y=localStorage.getItem("darkMode")==="true";t(y),document.documentElement.classList.toggle("dark",y)},[]);const u=y=>{const{name:b,value:w}=y.target;o(v=>({...v,[b]:w}))},d=y=>{y.preventDefault(),console.log("Contact form submitted:",i),l(!0),o({name:"",email:"",subject:"",message:""}),setTimeout(()=>l(!1),5e3)},f=[{question:"How do I post a question?",answer:"Navigate to the home page and click on the 'Ask your question' box. Type your question, select a subject, and click 'Post Question'."},{question:"How do I earn points?",answer:"You earn points by asking questions, providing helpful answers, and receiving upvotes on your contributions."},{question:"Can I change my display name?",answer:"Yes, you can change your display name in the Account Settings page under Profile Information."},{question:"How do I report inappropriate content?",answer:"Click on the three dots next to any question or answer and select 'Report'. Our moderation team will review it."},{question:"Is there a mobile app available?",answer:"Currently we're web-only, but our site is fully responsive and works great on mobile browsers."}],m=[{title:"Getting Started",content:"Learn how to create an account, set up your profile, and make your first post."},{title:"Community Guidelines",content:"Understand our rules and expectations for participation in the StudiQ community."},{title:"Answering Questions",content:"Tips for providing helpful, high-quality answers that earn you points and reputation."},{title:"Privacy & Security",content:"How we protect your data and what you can do to keep your account secure."}];return E.jsxs("div",{className:`min-h-screen transition-colors duration-300 ${e?"dark bg-gray-900":"bg-gray-50"}`,children:[E.jsx("header",{className:`sticky top-0 z-10 backdrop-blur-md ${e?"bg-black/80":"bg-white/80"} shadow-sm`,children:E.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[E.jsxs(nn,{to:n?"/":"/login",className:"flex items-center text-teal-600 hover:text-teal-700",children:[E.jsx(n_,{className:"mr-1"})," ",n?"Back to Home":"Back to Login"]}),E.jsx("h1",{className:"text-xl font-bold bg-gradient-to-r from-teal-400 to-teal-600 bg-clip-text text-transparent",children:"Help Center"}),E.jsx("div",{})," "]})}),E.jsx("main",{className:"container mx-auto px-4 py-8",children:E.jsx("div",{className:"max-w-4xl mx-auto",children:E.jsx("div",{className:`p-6 rounded-xl shadow-lg mb-8 backdrop-blur-sm ${e?"bg-gray-800/70 border border-gray-700":"bg-white/80 border border-gray-200"}`,children:E.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[E.jsx("div",{className:"md:w-1/3",children:E.jsxs("div",{className:`p-4 rounded-lg sticky top-4 ${e?"bg-gray-700/50":"bg-gray-100"}`,children:[E.jsxs("h2",{className:`text-lg font-semibold mb-4 flex items-center ${e?"text-gray-200":"text-gray-800"}`,children:[E.jsx(zv,{className:"mr-2 text-teal-500"}),"Help Topics"]}),E.jsxs("nav",{className:"space-y-2",children:[E.jsx("button",{onClick:()=>r("faq"),className:`w-full text-left px-3 py-2 rounded transition-all ${s==="faq"?"bg-teal-500/10 text-teal-500 border border-teal-500/30":e?"hover:bg-gray-600 text-gray-300":"hover:bg-gray-200 text-gray-700"}`,children:"FAQs"}),E.jsx("button",{onClick:()=>r("guides"),className:`w-full text-left px-3 py-2 rounded transition-all ${s==="guides"?"bg-teal-500/10 text-teal-500 border border-teal-500/30":e?"hover:bg-gray-600 text-gray-300":"hover:bg-gray-200 text-gray-700"}`,children:"Guides"}),E.jsx("button",{onClick:()=>r("contact"),className:`w-full text-left px-3 py-2 rounded transition-all ${s==="contact"?"bg-teal-500/10 text-teal-500 border border-teal-500/30":e?"hover:bg-gray-600 text-gray-300":"hover:bg-gray-200 text-gray-700"}`,children:"Contact Us"}),E.jsx("button",{onClick:()=>r("community"),className:`w-full text-left px-3 py-2 rounded transition-all ${s==="community"?"bg-teal-500/10 text-teal-500 border border-teal-500/30":e?"hover:bg-gray-600 text-gray-300":"hover:bg-gray-200 text-gray-700"}`,children:"Community"})]})]})}),E.jsxs("div",{className:"md:w-2/3",children:[s==="faq"&&E.jsxs("div",{children:[E.jsxs("h2",{className:`text-xl font-semibold mb-6 flex items-center ${e?"text-gray-200":"text-gray-800"}`,children:[E.jsx(zv,{className:"mr-2 text-teal-500"}),"Frequently Asked Questions"]}),E.jsx("div",{className:"space-y-4",children:f.map((y,b)=>E.jsxs("div",{className:`p-4 rounded-lg ${e?"bg-gray-700/50 border border-gray-600":"bg-white border border-gray-200"}`,children:[E.jsx("h3",{className:`font-medium mb-2 ${e?"text-teal-400":"text-teal-600"}`,children:y.question}),E.jsx("p",{className:e?"text-gray-300":"text-gray-700",children:y.answer})]},b))})]}),s==="guides"&&E.jsxs("div",{children:[E.jsxs("h2",{className:`text-xl font-semibold mb-6 flex items-center ${e?"text-gray-200":"text-gray-800"}`,children:[E.jsx(Xie,{className:"mr-2 text-teal-500"}),"Helpful Guides"]}),E.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:m.map((y,b)=>E.jsxs("div",{className:`p-4 rounded-lg ${e?"bg-gray-700/50 border border-gray-600":"bg-white border border-gray-200"}`,children:[E.jsx("h3",{className:`font-medium mb-2 ${e?"text-teal-400":"text-teal-600"}`,children:y.title}),E.jsx("p",{className:e?"text-gray-300":"text-gray-700",children:y.content}),E.jsx("button",{className:`mt-3 text-sm ${e?"text-teal-400 hover:text-teal-300":"text-teal-600 hover:text-teal-800"}`,children:"Read more "})]},b))})]}),s==="contact"&&E.jsxs("div",{children:[E.jsxs("h2",{className:`text-xl font-semibold mb-6 flex items-center ${e?"text-gray-200":"text-gray-800"}`,children:[E.jsx(pN,{className:"mr-2 text-teal-500"}),"Contact Support"]}),a?E.jsx("div",{className:`p-4 rounded-lg ${e?"bg-teal-900/30 text-teal-200":"bg-teal-100 text-teal-800"}`,children:"Thank you for contacting us! We'll get back to you within 24 hours."}):E.jsxs("form",{onSubmit:d,className:"space-y-4",children:[E.jsxs("div",{children:[E.jsx("label",{htmlFor:"name",className:`block text-sm font-medium mb-1 ${e?"text-gray-300":"text-gray-700"}`,children:"Your Name"}),E.jsx("input",{type:"text",id:"name",name:"name",value:i.name,onChange:u,required:!0,className:`w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent ${e?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"}`})]}),E.jsxs("div",{children:[E.jsx("label",{htmlFor:"email",className:`block text-sm font-medium mb-1 ${e?"text-gray-300":"text-gray-700"}`,children:"Email Address"}),E.jsx("input",{type:"email",id:"email",name:"email",value:i.email,onChange:u,required:!0,className:`w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent ${e?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"}`})]}),E.jsxs("div",{children:[E.jsx("label",{htmlFor:"subject",className:`block text-sm font-medium mb-1 ${e?"text-gray-300":"text-gray-700"}`,children:"Subject"}),E.jsxs("select",{id:"subject",name:"subject",value:i.subject,onChange:u,required:!0,className:`w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent ${e?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"}`,children:[E.jsx("option",{value:"",children:"Select a topic"}),E.jsx("option",{value:"account",children:"Account Issues"}),E.jsx("option",{value:"technical",children:"Technical Problems"}),E.jsx("option",{value:"billing",children:"Billing Questions"}),E.jsx("option",{value:"feedback",children:"Feedback"}),E.jsx("option",{value:"other",children:"Other"})]})]}),E.jsxs("div",{children:[E.jsx("label",{htmlFor:"message",className:`block text-sm font-medium mb-1 ${e?"text-gray-300":"text-gray-700"}`,children:"Message"}),E.jsx("textarea",{id:"message",name:"message",rows:"5",value:i.message,onChange:u,required:!0,className:`w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent ${e?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-800"}`})]}),E.jsx("button",{type:"submit",className:`w-full py-3 px-4 rounded-lg font-medium text-white bg-gradient-to-r from-teal-500 to-teal-600 hover:from-teal-600 hover:to-teal-700 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 ${e?"focus:ring-offset-gray-800":"focus:ring-offset-white"}`,children:"Send Message"})]})]}),s==="community"&&E.jsxs("div",{children:[E.jsxs("h2",{className:`text-xl font-semibold mb-6 flex items-center ${e?"text-gray-200":"text-gray-800"}`,children:[E.jsx(YB,{className:"mr-2 text-teal-500"}),"Community Resources"]}),E.jsxs("div",{className:`p-6 rounded-lg mb-6 ${e?"bg-gray-700/50 border border-gray-600":"bg-white border border-gray-200"}`,children:[E.jsx("h3",{className:`text-lg font-medium mb-3 ${e?"text-teal-400":"text-teal-600"}`,children:"Join Our Community"}),E.jsx("p",{className:`mb-4 ${e?"text-gray-300":"text-gray-700"}`,children:"Connect with other learners, ask questions, and share knowledge in our active community forums."}),E.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[E.jsxs("div",{className:`p-4 rounded-lg ${e?"bg-gray-600/30":"bg-gray-100"}`,children:[E.jsxs("h4",{className:`font-medium mb-2 ${e?"text-gray-200":"text-gray-800"}`,children:[E.jsx(cg,{className:"inline mr-2 text-teal-500"}),"Discussion Forums"]}),E.jsx("p",{className:e?"text-gray-400":"text-gray-600",children:"Participate in topic-specific discussions with students and educators."}),E.jsx("button",{className:`mt-3 text-sm ${e?"text-teal-400 hover:text-teal-300":"text-teal-600 hover:text-teal-800"}`,children:"Visit Forums "})]}),E.jsxs("div",{className:`p-4 rounded-lg ${e?"bg-gray-600/30":"bg-gray-100"}`,children:[E.jsxs("h4",{className:`font-medium mb-2 ${e?"text-gray-200":"text-gray-800"}`,children:[E.jsx(KB,{className:"inline mr-2 text-teal-500"}),"Local Study Groups"]}),E.jsx("p",{className:e?"text-gray-400":"text-gray-600",children:"Find or create study groups in your area or language."}),E.jsx("button",{className:`mt-3 text-sm ${e?"text-teal-400 hover:text-teal-300":"text-teal-600 hover:text-teal-800"}`,children:"Find Groups "})]})]})]})]})]})]})})})})]})}const tOe=[{label:"Dashboard",to:"/dashboard"},{label:"Content Library",to:"/library"},{label:"Quiz Zone",to:"/quiz"},{label:"AI Tutor",to:"/tutor"},{label:"Progress",to:"/progress"},{label:"Offline Help",to:"/offline"},{label:"Settings",to:"/settings"}];function nOe(){return E.jsxs("aside",{className:"w-64 bg-white dark:bg-gray-800 shadow-lg hidden sm:block",children:[E.jsx("div",{className:"p-4 text-xl font-bold text-center border-b dark:border-gray-700",children:"TutorAI"}),E.jsx("nav",{className:"p-4 space-y-2",children:tOe.map(n=>E.jsx(P3,{to:n.to,className:({isActive:e})=>`block px-3 py-2 rounded text-sm ${e?"bg-blue-600 text-white":"text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:n.label},n.to))})]})}function sOe(){const{logout:n}=LH(),e=Ec(),t=async()=>{await n(),e("/")};return E.jsxs("header",{className:"bg-white dark:bg-gray-800 px-4 py-3 border-b dark:border-gray-700 flex justify-between items-center",children:[E.jsx("h1",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:"AI Tutor Platform"}),E.jsx("button",{onClick:t,className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm",children:"Logout"})]})}function rOe(){return E.jsxs("footer",{className:"bg-gray-100 dark:bg-gray-800 text-center text-sm p-3 mt-auto",children:[" ",new Date().getFullYear()," AI Tutor Platform. All rights reserved."]})}function iOe(){return E.jsxs("div",{className:"flex h-screen w-screen bg-gray-100 dark:bg-gray-900 overflow-hidden",children:[E.jsx(nOe,{}),E.jsxs("div",{className:"flex flex-col flex-1 w-full",children:[E.jsx(sOe,{}),E.jsx("main",{className:"flex-1 p-4 w-full",children:E.jsx(f9,{})}),E.jsx(rOe,{})]})]})}function oOe(){return E.jsxs("div",{className:"text-gray-800 dark:text-white",children:[E.jsx("h2",{className:"text-2xl font-bold mb-4",children:" Admin Dashboard"}),E.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[E.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded shadow",children:[E.jsx("h3",{className:"font-semibold mb-2",children:" Usage Analytics"}),E.jsx("p",{children:"Coming soon: User stats, content views, quiz completions."})]}),E.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded shadow",children:[E.jsx("h3",{className:"font-semibold mb-2",children:" Manage Content"}),E.jsx("p",{children:"Use ContentUploader to add or update content."})]})]})]})}function aOe(){const[n,e]=te.useState([]);return te.useEffect(()=>{(async()=>{const{data:s,error:r}=await Ei.from("profiles").select("*").eq("role","student");r?console.error(r):e(s)})()},[]),E.jsxs("div",{className:"text-gray-800 dark:text-white",children:[E.jsx("h2",{className:"text-2xl font-bold mb-4",children:" Student Manager"}),n.length===0?E.jsx("p",{children:"No students found."}):E.jsx("div",{className:"overflow-x-auto",children:E.jsxs("table",{className:"min-w-full border dark:border-gray-700",children:[E.jsx("thead",{children:E.jsxs("tr",{className:"bg-gray-200 dark:bg-gray-700",children:[E.jsx("th",{className:"text-left p-2",children:"Name"}),E.jsx("th",{className:"text-left p-2",children:"Email"}),E.jsx("th",{className:"text-left p-2",children:"Progress"})]})}),E.jsx("tbody",{children:n.map((t,s)=>E.jsxs("tr",{className:"border-t dark:border-gray-700",children:[E.jsx("td",{className:"p-2",children:t.name||"N/A"}),E.jsx("td",{className:"p-2",children:t.email}),E.jsx("td",{className:"p-2",children:"Coming soon"})]},s))})]})})]})}function lOe(){const[n,e]=te.useState({title:"",topic:"",type:"pdf",url:""}),[t,s]=te.useState(""),r=o=>{e({...n,[o.target.name]:o.target.value})},i=async o=>{o.preventDefault();const{error:a}=await Ei.from("contents").insert([n]);a?(console.error(a),s(" Failed to upload.")):(s(" Content uploaded!"),e({title:"",topic:"",type:"pdf",url:""}))};return E.jsxs("div",{className:"text-gray-800 dark:text-white max-w-md",children:[E.jsx("h2",{className:"text-2xl font-bold mb-4",children:" Upload Content"}),E.jsxs("form",{onSubmit:i,className:"space-y-3",children:[E.jsx("input",{name:"title",placeholder:"Title",value:n.title,onChange:r,className:"input w-full",required:!0}),E.jsx("input",{name:"topic",placeholder:"Topic",value:n.topic,onChange:r,className:"input w-full",required:!0}),E.jsxs("select",{name:"type",value:n.type,onChange:r,className:"input w-full",children:[E.jsx("option",{value:"pdf",children:"PDF"}),E.jsx("option",{value:"video",children:"Video"}),E.jsx("option",{value:"audio",children:"Audio"}),E.jsx("option",{value:"text",children:"Text"})]}),E.jsx("input",{name:"url",placeholder:"Content URL",value:n.url,onChange:r,className:"input w-full",required:!0}),E.jsx("button",{type:"submit",className:"bg-green-600 text-white px-4 py-2 rounded",children:"Upload"}),t&&E.jsx("p",{className:"mt-2",children:t})]})]})}function cOe(){const[n,e]=te.useState({question:"",options:"",correct_answer:""}),[t,s]=te.useState(""),r=o=>{e({...n,[o.target.name]:o.target.value})},i=async o=>{o.preventDefault();const a={question:n.question,options:n.options.split(",").map(u=>u.trim()),correct_answer:n.correct_answer.trim()},{error:l}=await Ei.from("quizzes").insert([a]);l?(console.error(l),s(" Failed to save quiz.")):(s(" Quiz added!"),e({question:"",options:"",correct_answer:""}))};return E.jsxs("div",{className:"text-gray-800 dark:text-white max-w-md",children:[E.jsx("h2",{className:"text-2xl font-bold mb-4",children:" Quiz Manager"}),E.jsxs("form",{onSubmit:i,className:"space-y-3",children:[E.jsx("textarea",{name:"question",placeholder:"Question",value:n.question,onChange:r,className:"input w-full",required:!0}),E.jsx("input",{name:"options",placeholder:"Comma-separated options",value:n.options,onChange:r,className:"input w-full",required:!0}),E.jsx("input",{name:"correct_answer",placeholder:"Correct answer",value:n.correct_answer,onChange:r,className:"input w-full",required:!0}),E.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Save"}),t&&E.jsx("p",{className:"mt-2",children:t})]})]})}function uOe(){return E.jsx(F3,{children:E.jsxs(m9,{children:[E.jsx(ys,{path:"/",element:E.jsx(ioe,{})}),E.jsx(ys,{path:"/login",element:E.jsx(ooe,{})}),E.jsx(ys,{path:"/signup",element:E.jsx(aoe,{})}),E.jsx(ys,{path:"/profile",element:E.jsx(ZDe,{})}),E.jsx(ys,{path:"/help",element:E.jsx(eOe,{})}),E.jsx(ys,{path:"/settings",element:E.jsx(G$e,{})}),E.jsxs(ys,{element:E.jsx(iOe,{}),children:[E.jsx(ys,{path:"/dashboard",element:E.jsx(poe,{})}),E.jsx(ys,{path:"/library",element:E.jsx(goe,{})}),E.jsx(ys,{path:"/quiz",element:E.jsx(voe,{})}),E.jsx(ys,{path:"/tutor",element:E.jsx(z$e,{})}),E.jsx(ys,{path:"/progress",element:E.jsx(j$e,{})}),E.jsx(ys,{path:"/offline",element:E.jsx(W$e,{})}),E.jsx(ys,{path:"/admin",element:E.jsx(oOe,{})}),E.jsx(ys,{path:"/admin/students",element:E.jsx(aOe,{})}),E.jsx(ys,{path:"/admin/upload-content",element:E.jsx(lOe,{})}),E.jsx(ys,{path:"/admin/quiz-manager",element:E.jsx(cOe,{})})]}),E.jsx(ys,{path:"*",element:E.jsx(H$e,{})})]})})}function hOe(){return E.jsx(F3,{children:E.jsx(QK,{children:E.jsx(F9,{children:E.jsx(uOe,{})})})})}_8.createRoot(document.getElementById("root")).render(E.jsx(te.StrictMode,{children:E.jsx(hOe,{})}));
